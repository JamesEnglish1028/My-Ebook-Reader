const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DEdeNmiP.js","assets/pdf-D-gusrb1.js"])))=>i.map(i=>d[i]);
function dg(r,s){for(var n=0;n<s.length;n++){const o=s[n];if(typeof o!="string"&&!Array.isArray(o)){for(const c in o)if(c!=="default"&&!(c in r)){const l=Object.getOwnPropertyDescriptor(o,c);l&&Object.defineProperty(r,c,l.get?l:{enumerable:!0,get:()=>o[c]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function n(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(c){if(c.ep)return;c.ep=!0;const l=n(c);fetch(c.href,l)}})();var Ao=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Fl={exports:{}},ui={},Dl={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rf;function fg(){if(rf)return tt;rf=1;var r=Symbol.for("react.element"),s=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),u=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),k=Symbol.iterator;function x(P){return P===null||typeof P!="object"?null:(P=k&&P[k]||P["@@iterator"],typeof P=="function"?P:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,g={};function w(P,$,ye){this.props=P,this.context=$,this.refs=g,this.updater=ye||y}w.prototype.isReactComponent={},w.prototype.setState=function(P,$){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,$,"setState")},w.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function N(){}N.prototype=w.prototype;function A(P,$,ye){this.props=P,this.context=$,this.refs=g,this.updater=ye||y}var L=A.prototype=new N;L.constructor=A,S(L,w.prototype),L.isPureReactComponent=!0;var T=Array.isArray,I=Object.prototype.hasOwnProperty,D={current:null},W={key:!0,ref:!0,__self:!0,__source:!0};function F(P,$,ye){var fe,oe={},be=null,Se=null;if($!=null)for(fe in $.ref!==void 0&&(Se=$.ref),$.key!==void 0&&(be=""+$.key),$)I.call($,fe)&&!W.hasOwnProperty(fe)&&(oe[fe]=$[fe]);var ke=arguments.length-2;if(ke===1)oe.children=ye;else if(1<ke){for(var _e=Array(ke),De=0;De<ke;De++)_e[De]=arguments[De+2];oe.children=_e}if(P&&P.defaultProps)for(fe in ke=P.defaultProps,ke)oe[fe]===void 0&&(oe[fe]=ke[fe]);return{$$typeof:r,type:P,key:be,ref:Se,props:oe,_owner:D.current}}function U(P,$){return{$$typeof:r,type:P.type,key:$,ref:P.ref,props:P.props,_owner:P._owner}}function V(P){return typeof P=="object"&&P!==null&&P.$$typeof===r}function ie(P){var $={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(ye){return $[ye]})}var B=/\/+/g;function H(P,$){return typeof P=="object"&&P!==null&&P.key!=null?ie(""+P.key):$.toString(36)}function C(P,$,ye,fe,oe){var be=typeof P;(be==="undefined"||be==="boolean")&&(P=null);var Se=!1;if(P===null)Se=!0;else switch(be){case"string":case"number":Se=!0;break;case"object":switch(P.$$typeof){case r:case s:Se=!0}}if(Se)return Se=P,oe=oe(Se),P=fe===""?"."+H(Se,0):fe,T(oe)?(ye="",P!=null&&(ye=P.replace(B,"$&/")+"/"),C(oe,$,ye,"",function(De){return De})):oe!=null&&(V(oe)&&(oe=U(oe,ye+(!oe.key||Se&&Se.key===oe.key?"":(""+oe.key).replace(B,"$&/")+"/")+P)),$.push(oe)),1;if(Se=0,fe=fe===""?".":fe+":",T(P))for(var ke=0;ke<P.length;ke++){be=P[ke];var _e=fe+H(be,ke);Se+=C(be,$,ye,_e,oe)}else if(_e=x(P),typeof _e=="function")for(P=_e.call(P),ke=0;!(be=P.next()).done;)be=be.value,_e=fe+H(be,ke++),Se+=C(be,$,ye,_e,oe);else if(be==="object")throw $=String(P),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return Se}function Q(P,$,ye){if(P==null)return P;var fe=[],oe=0;return C(P,fe,"","",function(be){return $.call(ye,be,oe++)}),fe}function ae(P){if(P._status===-1){var $=P._result;$=$(),$.then(function(ye){(P._status===0||P._status===-1)&&(P._status=1,P._result=ye)},function(ye){(P._status===0||P._status===-1)&&(P._status=2,P._result=ye)}),P._status===-1&&(P._status=0,P._result=$)}if(P._status===1)return P._result.default;throw P._result}var J={current:null},te={transition:null},re={ReactCurrentDispatcher:J,ReactCurrentBatchConfig:te,ReactCurrentOwner:D};function ee(){throw Error("act(...) is not supported in production builds of React.")}return tt.Children={map:Q,forEach:function(P,$,ye){Q(P,function(){$.apply(this,arguments)},ye)},count:function(P){var $=0;return Q(P,function(){$++}),$},toArray:function(P){return Q(P,function($){return $})||[]},only:function(P){if(!V(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},tt.Component=w,tt.Fragment=n,tt.Profiler=c,tt.PureComponent=A,tt.StrictMode=o,tt.Suspense=p,tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=re,tt.act=ee,tt.cloneElement=function(P,$,ye){if(P==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+P+".");var fe=S({},P.props),oe=P.key,be=P.ref,Se=P._owner;if($!=null){if($.ref!==void 0&&(be=$.ref,Se=D.current),$.key!==void 0&&(oe=""+$.key),P.type&&P.type.defaultProps)var ke=P.type.defaultProps;for(_e in $)I.call($,_e)&&!W.hasOwnProperty(_e)&&(fe[_e]=$[_e]===void 0&&ke!==void 0?ke[_e]:$[_e])}var _e=arguments.length-2;if(_e===1)fe.children=ye;else if(1<_e){ke=Array(_e);for(var De=0;De<_e;De++)ke[De]=arguments[De+2];fe.children=ke}return{$$typeof:r,type:P.type,key:oe,ref:be,props:fe,_owner:Se}},tt.createContext=function(P){return P={$$typeof:u,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},P.Provider={$$typeof:l,_context:P},P.Consumer=P},tt.createElement=F,tt.createFactory=function(P){var $=F.bind(null,P);return $.type=P,$},tt.createRef=function(){return{current:null}},tt.forwardRef=function(P){return{$$typeof:f,render:P}},tt.isValidElement=V,tt.lazy=function(P){return{$$typeof:b,_payload:{_status:-1,_result:P},_init:ae}},tt.memo=function(P,$){return{$$typeof:h,type:P,compare:$===void 0?null:$}},tt.startTransition=function(P){var $=te.transition;te.transition={};try{P()}finally{te.transition=$}},tt.unstable_act=ee,tt.useCallback=function(P,$){return J.current.useCallback(P,$)},tt.useContext=function(P){return J.current.useContext(P)},tt.useDebugValue=function(){},tt.useDeferredValue=function(P){return J.current.useDeferredValue(P)},tt.useEffect=function(P,$){return J.current.useEffect(P,$)},tt.useId=function(){return J.current.useId()},tt.useImperativeHandle=function(P,$,ye){return J.current.useImperativeHandle(P,$,ye)},tt.useInsertionEffect=function(P,$){return J.current.useInsertionEffect(P,$)},tt.useLayoutEffect=function(P,$){return J.current.useLayoutEffect(P,$)},tt.useMemo=function(P,$){return J.current.useMemo(P,$)},tt.useReducer=function(P,$,ye){return J.current.useReducer(P,$,ye)},tt.useRef=function(P){return J.current.useRef(P)},tt.useState=function(P){return J.current.useState(P)},tt.useSyncExternalStore=function(P,$,ye){return J.current.useSyncExternalStore(P,$,ye)},tt.useTransition=function(){return J.current.useTransition()},tt.version="18.3.1",tt}var nf;function fc(){return nf||(nf=1,Dl.exports=fg()),Dl.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sf;function hg(){if(sf)return ui;sf=1;var r=fc(),s=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function u(f,p,h){var b,k={},x=null,y=null;h!==void 0&&(x=""+h),p.key!==void 0&&(x=""+p.key),p.ref!==void 0&&(y=p.ref);for(b in p)o.call(p,b)&&!l.hasOwnProperty(b)&&(k[b]=p[b]);if(f&&f.defaultProps)for(b in p=f.defaultProps,p)k[b]===void 0&&(k[b]=p[b]);return{$$typeof:s,type:f,key:x,ref:y,props:k,_owner:c.current}}return ui.Fragment=n,ui.jsx=u,ui.jsxs=u,ui}var of;function pg(){return of||(of=1,Fl.exports=hg()),Fl.exports}var a=pg(),R=fc();const mt=dc(R),mg=dg({__proto__:null,default:mt},[R]);var To={},Bl={exports:{}},hr={},Ml={exports:{}},Ul={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var af;function gg(){return af||(af=1,(function(r){function s(te,re){var ee=te.length;te.push(re);e:for(;0<ee;){var P=ee-1>>>1,$=te[P];if(0<c($,re))te[P]=re,te[ee]=$,ee=P;else break e}}function n(te){return te.length===0?null:te[0]}function o(te){if(te.length===0)return null;var re=te[0],ee=te.pop();if(ee!==re){te[0]=ee;e:for(var P=0,$=te.length,ye=$>>>1;P<ye;){var fe=2*(P+1)-1,oe=te[fe],be=fe+1,Se=te[be];if(0>c(oe,ee))be<$&&0>c(Se,oe)?(te[P]=Se,te[be]=ee,P=be):(te[P]=oe,te[fe]=ee,P=fe);else if(be<$&&0>c(Se,ee))te[P]=Se,te[be]=ee,P=be;else break e}}return re}function c(te,re){var ee=te.sortIndex-re.sortIndex;return ee!==0?ee:te.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var u=Date,f=u.now();r.unstable_now=function(){return u.now()-f}}var p=[],h=[],b=1,k=null,x=3,y=!1,S=!1,g=!1,w=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function L(te){for(var re=n(h);re!==null;){if(re.callback===null)o(h);else if(re.startTime<=te)o(h),re.sortIndex=re.expirationTime,s(p,re);else break;re=n(h)}}function T(te){if(g=!1,L(te),!S)if(n(p)!==null)S=!0,ae(I);else{var re=n(h);re!==null&&J(T,re.startTime-te)}}function I(te,re){S=!1,g&&(g=!1,N(F),F=-1),y=!0;var ee=x;try{for(L(re),k=n(p);k!==null&&(!(k.expirationTime>re)||te&&!ie());){var P=k.callback;if(typeof P=="function"){k.callback=null,x=k.priorityLevel;var $=P(k.expirationTime<=re);re=r.unstable_now(),typeof $=="function"?k.callback=$:k===n(p)&&o(p),L(re)}else o(p);k=n(p)}if(k!==null)var ye=!0;else{var fe=n(h);fe!==null&&J(T,fe.startTime-re),ye=!1}return ye}finally{k=null,x=ee,y=!1}}var D=!1,W=null,F=-1,U=5,V=-1;function ie(){return!(r.unstable_now()-V<U)}function B(){if(W!==null){var te=r.unstable_now();V=te;var re=!0;try{re=W(!0,te)}finally{re?H():(D=!1,W=null)}}else D=!1}var H;if(typeof A=="function")H=function(){A(B)};else if(typeof MessageChannel<"u"){var C=new MessageChannel,Q=C.port2;C.port1.onmessage=B,H=function(){Q.postMessage(null)}}else H=function(){w(B,0)};function ae(te){W=te,D||(D=!0,H())}function J(te,re){F=w(function(){te(r.unstable_now())},re)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(te){te.callback=null},r.unstable_continueExecution=function(){S||y||(S=!0,ae(I))},r.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<te?Math.floor(1e3/te):5},r.unstable_getCurrentPriorityLevel=function(){return x},r.unstable_getFirstCallbackNode=function(){return n(p)},r.unstable_next=function(te){switch(x){case 1:case 2:case 3:var re=3;break;default:re=x}var ee=x;x=re;try{return te()}finally{x=ee}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(te,re){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var ee=x;x=te;try{return re()}finally{x=ee}},r.unstable_scheduleCallback=function(te,re,ee){var P=r.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?P+ee:P):ee=P,te){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=ee+$,te={id:b++,callback:re,priorityLevel:te,startTime:ee,expirationTime:$,sortIndex:-1},ee>P?(te.sortIndex=ee,s(h,te),n(p)===null&&te===n(h)&&(g?(N(F),F=-1):g=!0,J(T,ee-P))):(te.sortIndex=$,s(p,te),S||y||(S=!0,ae(I))),te},r.unstable_shouldYield=ie,r.unstable_wrapCallback=function(te){var re=x;return function(){var ee=x;x=re;try{return te.apply(this,arguments)}finally{x=ee}}}})(Ul)),Ul}var lf;function yg(){return lf||(lf=1,Ml.exports=gg()),Ml.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cf;function vg(){if(cf)return hr;cf=1;var r=fc(),s=yg();function n(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,c={};function l(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(c[e]=t,e=0;e<t.length;e++)o.add(t[e])}var f=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),p=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,b={},k={};function x(e){return p.call(k,e)?!0:p.call(b,e)?!1:h.test(e)?k[e]=!0:(b[e]=!0,!1)}function y(e,t,i,d){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return d?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function S(e,t,i,d){if(t===null||typeof t>"u"||y(e,t,i,d))return!0;if(d)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function g(e,t,i,d,m,v,O){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=d,this.attributeNamespace=m,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=v,this.removeEmptyString=O}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){w[e]=new g(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];w[t]=new g(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){w[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){w[e]=new g(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){w[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){w[e]=new g(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){w[e]=new g(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){w[e]=new g(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){w[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)});var N=/[\-:]([a-z])/g;function A(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(N,A);w[t]=new g(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(N,A);w[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(N,A);w[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){w[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)}),w.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){w[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)});function L(e,t,i,d){var m=w.hasOwnProperty(t)?w[t]:null;(m!==null?m.type!==0:d||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(S(t,i,m,d)&&(i=null),d||m===null?x(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):m.mustUseProperty?e[m.propertyName]=i===null?m.type===3?!1:"":i:(t=m.attributeName,d=m.attributeNamespace,i===null?e.removeAttribute(t):(m=m.type,i=m===3||m===4&&i===!0?"":""+i,d?e.setAttributeNS(d,t,i):e.setAttribute(t,i))))}var T=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,I=Symbol.for("react.element"),D=Symbol.for("react.portal"),W=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),V=Symbol.for("react.provider"),ie=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),ae=Symbol.for("react.lazy"),J=Symbol.for("react.offscreen"),te=Symbol.iterator;function re(e){return e===null||typeof e!="object"?null:(e=te&&e[te]||e["@@iterator"],typeof e=="function"?e:null)}var ee=Object.assign,P;function $(e){if(P===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return`
`+P+e}var ye=!1;function fe(e,t){if(!e||ye)return"";ye=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(me){var d=me}Reflect.construct(e,[],t)}else{try{t.call()}catch(me){d=me}e.call(t.prototype)}else{try{throw Error()}catch(me){d=me}e()}}catch(me){if(me&&d&&typeof me.stack=="string"){for(var m=me.stack.split(`
`),v=d.stack.split(`
`),O=m.length-1,G=v.length-1;1<=O&&0<=G&&m[O]!==v[G];)G--;for(;1<=O&&0<=G;O--,G--)if(m[O]!==v[G]){if(O!==1||G!==1)do if(O--,G--,0>G||m[O]!==v[G]){var Y=`
`+m[O].replace(" at new "," at ");return e.displayName&&Y.includes("<anonymous>")&&(Y=Y.replace("<anonymous>",e.displayName)),Y}while(1<=O&&0<=G);break}}}finally{ye=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?$(e):""}function oe(e){switch(e.tag){case 5:return $(e.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return e=fe(e.type,!1),e;case 11:return e=fe(e.type.render,!1),e;case 1:return e=fe(e.type,!0),e;default:return""}}function be(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case W:return"Fragment";case D:return"Portal";case U:return"Profiler";case F:return"StrictMode";case H:return"Suspense";case C:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case ie:return(e.displayName||"Context")+".Consumer";case V:return(e._context.displayName||"Context")+".Provider";case B:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Q:return t=e.displayName||null,t!==null?t:be(e.type)||"Memo";case ae:t=e._payload,e=e._init;try{return be(e(t))}catch{}}return null}function Se(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return be(t);case 8:return t===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ke(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function _e(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function De(e){var t=_e(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),d=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var m=i.get,v=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return m.call(this)},set:function(O){d=""+O,v.call(this,O)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return d},setValue:function(O){d=""+O},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ve(e){e._valueTracker||(e._valueTracker=De(e))}function et(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),d="";return e&&(d=_e(e)?e.checked?"true":"false":e.value),e=d,e!==i?(t.setValue(e),!0):!1}function Ke(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function j(e,t){var i=t.checked;return ee({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function he(e,t){var i=t.defaultValue==null?"":t.defaultValue,d=t.checked!=null?t.checked:t.defaultChecked;i=ke(t.value!=null?t.value:i),e._wrapperState={initialChecked:d,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function de(e,t){t=t.checked,t!=null&&L(e,"checked",t,!1)}function q(e,t){de(e,t);var i=ke(t.value),d=t.type;if(i!=null)d==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(d==="submit"||d==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Z(e,t.type,i):t.hasOwnProperty("defaultValue")&&Z(e,t.type,ke(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function z(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var d=t.type;if(!(d!=="submit"&&d!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function Z(e,t,i){(t!=="number"||Ke(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var ce=Array.isArray;function ue(e,t,i,d){if(e=e.options,t){t={};for(var m=0;m<i.length;m++)t["$"+i[m]]=!0;for(i=0;i<e.length;i++)m=t.hasOwnProperty("$"+e[i].value),e[i].selected!==m&&(e[i].selected=m),m&&d&&(e[i].defaultSelected=!0)}else{for(i=""+ke(i),t=null,m=0;m<e.length;m++){if(e[m].value===i){e[m].selected=!0,d&&(e[m].defaultSelected=!0);return}t!==null||e[m].disabled||(t=e[m])}t!==null&&(t.selected=!0)}}function X(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(n(91));return ee({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function _(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(n(92));if(ce(i)){if(1<i.length)throw Error(n(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:ke(i)}}function E(e,t){var i=ke(t.value),d=ke(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),d!=null&&(e.defaultValue=""+d)}function M(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function K(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ge(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?K(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var je,we=(function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,d,m){MSApp.execUnsafeLocalFunction(function(){return e(t,i,d,m)})}:e})(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(je=je||document.createElement("div"),je.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=je.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ve(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var Le={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ae=["Webkit","ms","Moz","O"];Object.keys(Le).forEach(function(e){Ae.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Le[t]=Le[e]})});function Pe(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||Le.hasOwnProperty(e)&&Le[e]?(""+t).trim():t+"px"}function qe(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var d=i.indexOf("--")===0,m=Pe(i,t[i],d);i==="float"&&(i="cssFloat"),d?e.setProperty(i,m):e[i]=m}}var st=ee({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function He(e,t){if(t){if(st[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(n(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(n(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(n(61))}if(t.style!=null&&typeof t.style!="object")throw Error(n(62))}}function nt(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Je=null;function it(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ft=null,ht=null,Tt=null;function Ht(e){if(e=Qs(e)){if(typeof ft!="function")throw Error(n(280));var t=e.stateNode;t&&(t=Wi(t),ft(e.stateNode,e.type,t))}}function or(e){ht?Tt?Tt.push(e):Tt=[e]:ht=e}function qr(){if(ht){var e=ht,t=Tt;if(Tt=ht=null,Ht(e),t)for(e=0;e<t.length;e++)Ht(t[e])}}function xr(e,t){return e(t)}function It(){}var Ir=!1;function Pn(e,t,i){if(Ir)return e(t,i);Ir=!0;try{return xr(e,t,i)}finally{Ir=!1,(ht!==null||Tt!==null)&&(It(),qr())}}function Er(e,t){var i=e.stateNode;if(i===null)return null;var d=Wi(i);if(d===null)return null;i=d[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(e=e.type,d=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!d;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(n(231,t,typeof i));return i}var Hr=!1;if(f)try{var rr={};Object.defineProperty(rr,"passive",{get:function(){Hr=!0}}),window.addEventListener("test",rr,rr),window.removeEventListener("test",rr,rr)}catch{Hr=!1}function Fr(e,t,i,d,m,v,O,G,Y){var me=Array.prototype.slice.call(arguments,3);try{t.apply(i,me)}catch(Ce){this.onError(Ce)}}var Gr=!1,Te=null,Be=!1,Ge=null,bt={onError:function(e){Gr=!0,Te=e}};function ar(e,t,i,d,m,v,O,G,Y){Gr=!1,Te=null,Fr.apply(bt,arguments)}function Rt(e,t,i,d,m,v,O,G,Y){if(ar.apply(this,arguments),Gr){if(Gr){var me=Te;Gr=!1,Te=null}else throw Error(n(198));Be||(Be=!0,Ge=me)}}function Pt(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function Dr(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Lt(e){if(Pt(e)!==e)throw Error(n(188))}function Ln(e){var t=e.alternate;if(!t){if(t=Pt(e),t===null)throw Error(n(188));return t!==e?null:e}for(var i=e,d=t;;){var m=i.return;if(m===null)break;var v=m.alternate;if(v===null){if(d=m.return,d!==null){i=d;continue}break}if(m.child===v.child){for(v=m.child;v;){if(v===i)return Lt(m),e;if(v===d)return Lt(m),t;v=v.sibling}throw Error(n(188))}if(i.return!==d.return)i=m,d=v;else{for(var O=!1,G=m.child;G;){if(G===i){O=!0,i=m,d=v;break}if(G===d){O=!0,d=m,i=v;break}G=G.sibling}if(!O){for(G=v.child;G;){if(G===i){O=!0,i=v,d=m;break}if(G===d){O=!0,d=v,i=m;break}G=G.sibling}if(!O)throw Error(n(189))}}if(i.alternate!==d)throw Error(n(190))}if(i.tag!==3)throw Error(n(188));return i.stateNode.current===i?e:t}function nn(e){return e=Ln(e),e!==null?Ci(e):null}function Ci(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Ci(e);if(t!==null)return t;e=e.sibling}return null}var ji=s.unstable_scheduleCallback,Ei=s.unstable_cancelCallback,ea=s.unstable_shouldYield,ta=s.unstable_requestPaint,Nt=s.unstable_now,ra=s.unstable_getCurrentPriorityLevel,xe=s.unstable_ImmediatePriority,Ie=s.unstable_UserBlockingPriority,Ue=s.unstable_NormalPriority,Ye=s.unstable_LowPriority,ze=s.unstable_IdlePriority,ot=null,pt=null;function sn(e){if(pt&&typeof pt.onCommitFiberRoot=="function")try{pt.onCommitFiberRoot(ot,e,void 0,(e.current.flags&128)===128)}catch{}}var gt=Math.clz32?Math.clz32:kt,vt=Math.log,Ut=Math.LN2;function kt(e){return e>>>=0,e===0?32:31-(vt(e)/Ut|0)|0}var at=64,zt=4194304;function Gt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function on(e,t){var i=e.pendingLanes;if(i===0)return 0;var d=0,m=e.suspendedLanes,v=e.pingedLanes,O=i&268435455;if(O!==0){var G=O&~m;G!==0?d=Gt(G):(v&=O,v!==0&&(d=Gt(v)))}else O=i&~m,O!==0?d=Gt(O):v!==0&&(d=Gt(v));if(d===0)return 0;if(t!==0&&t!==d&&(t&m)===0&&(m=d&-d,v=t&-t,m>=v||m===16&&(v&4194240)!==0))return t;if((d&4)!==0&&(d|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=d;0<t;)i=31-gt(t),m=1<<i,d|=e[i],t&=~m;return d}function Tp(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Rp(e,t){for(var i=e.suspendedLanes,d=e.pingedLanes,m=e.expirationTimes,v=e.pendingLanes;0<v;){var O=31-gt(v),G=1<<O,Y=m[O];Y===-1?((G&i)===0||(G&d)!==0)&&(m[O]=Tp(G,t)):Y<=t&&(e.expiredLanes|=G),v&=~G}}function na(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Lc(){var e=at;return at<<=1,(at&4194240)===0&&(at=64),e}function sa(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Ps(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-gt(t),e[t]=i}function Pp(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var d=e.eventTimes;for(e=e.expirationTimes;0<i;){var m=31-gt(i),v=1<<m;t[m]=0,d[m]=-1,e[m]=-1,i&=~v}}function ia(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var d=31-gt(i),m=1<<d;m&t|e[d]&t&&(e[d]|=t),i&=~m}}var dt=0;function Oc(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var Ic,oa,Fc,Dc,Bc,aa=!1,_i=[],an=null,ln=null,cn=null,Ls=new Map,Os=new Map,un=[],Lp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mc(e,t){switch(e){case"focusin":case"focusout":an=null;break;case"dragenter":case"dragleave":ln=null;break;case"mouseover":case"mouseout":cn=null;break;case"pointerover":case"pointerout":Ls.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Os.delete(t.pointerId)}}function Is(e,t,i,d,m,v){return e===null||e.nativeEvent!==v?(e={blockedOn:t,domEventName:i,eventSystemFlags:d,nativeEvent:v,targetContainers:[m]},t!==null&&(t=Qs(t),t!==null&&oa(t)),e):(e.eventSystemFlags|=d,t=e.targetContainers,m!==null&&t.indexOf(m)===-1&&t.push(m),e)}function Op(e,t,i,d,m){switch(t){case"focusin":return an=Is(an,e,t,i,d,m),!0;case"dragenter":return ln=Is(ln,e,t,i,d,m),!0;case"mouseover":return cn=Is(cn,e,t,i,d,m),!0;case"pointerover":var v=m.pointerId;return Ls.set(v,Is(Ls.get(v)||null,e,t,i,d,m)),!0;case"gotpointercapture":return v=m.pointerId,Os.set(v,Is(Os.get(v)||null,e,t,i,d,m)),!0}return!1}function Uc(e){var t=On(e.target);if(t!==null){var i=Pt(t);if(i!==null){if(t=i.tag,t===13){if(t=Dr(i),t!==null){e.blockedOn=t,Bc(e.priority,function(){Fc(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ai(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=ca(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var d=new i.constructor(i.type,i);Je=d,i.target.dispatchEvent(d),Je=null}else return t=Qs(i),t!==null&&oa(t),e.blockedOn=i,!1;t.shift()}return!0}function zc(e,t,i){Ai(e)&&i.delete(t)}function Ip(){aa=!1,an!==null&&Ai(an)&&(an=null),ln!==null&&Ai(ln)&&(ln=null),cn!==null&&Ai(cn)&&(cn=null),Ls.forEach(zc),Os.forEach(zc)}function Fs(e,t){e.blockedOn===t&&(e.blockedOn=null,aa||(aa=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Ip)))}function Ds(e){function t(m){return Fs(m,e)}if(0<_i.length){Fs(_i[0],e);for(var i=1;i<_i.length;i++){var d=_i[i];d.blockedOn===e&&(d.blockedOn=null)}}for(an!==null&&Fs(an,e),ln!==null&&Fs(ln,e),cn!==null&&Fs(cn,e),Ls.forEach(t),Os.forEach(t),i=0;i<un.length;i++)d=un[i],d.blockedOn===e&&(d.blockedOn=null);for(;0<un.length&&(i=un[0],i.blockedOn===null);)Uc(i),i.blockedOn===null&&un.shift()}var rs=T.ReactCurrentBatchConfig,Ti=!0;function Fp(e,t,i,d){var m=dt,v=rs.transition;rs.transition=null;try{dt=1,la(e,t,i,d)}finally{dt=m,rs.transition=v}}function Dp(e,t,i,d){var m=dt,v=rs.transition;rs.transition=null;try{dt=4,la(e,t,i,d)}finally{dt=m,rs.transition=v}}function la(e,t,i,d){if(Ti){var m=ca(e,t,i,d);if(m===null)ja(e,t,d,Ri,i),Mc(e,d);else if(Op(m,e,t,i,d))d.stopPropagation();else if(Mc(e,d),t&4&&-1<Lp.indexOf(e)){for(;m!==null;){var v=Qs(m);if(v!==null&&Ic(v),v=ca(e,t,i,d),v===null&&ja(e,t,d,Ri,i),v===m)break;m=v}m!==null&&d.stopPropagation()}else ja(e,t,d,null,i)}}var Ri=null;function ca(e,t,i,d){if(Ri=null,e=it(d),e=On(e),e!==null)if(t=Pt(e),t===null)e=null;else if(i=t.tag,i===13){if(e=Dr(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ri=e,null}function $c(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ra()){case xe:return 1;case Ie:return 4;case Ue:case Ye:return 16;case ze:return 536870912;default:return 16}default:return 16}}var dn=null,ua=null,Pi=null;function Wc(){if(Pi)return Pi;var e,t=ua,i=t.length,d,m="value"in dn?dn.value:dn.textContent,v=m.length;for(e=0;e<i&&t[e]===m[e];e++);var O=i-e;for(d=1;d<=O&&t[i-d]===m[v-d];d++);return Pi=m.slice(e,1<d?1-d:void 0)}function Li(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Oi(){return!0}function Vc(){return!1}function pr(e){function t(i,d,m,v,O){this._reactName=i,this._targetInst=m,this.type=d,this.nativeEvent=v,this.target=O,this.currentTarget=null;for(var G in e)e.hasOwnProperty(G)&&(i=e[G],this[G]=i?i(v):v[G]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Oi:Vc,this.isPropagationStopped=Vc,this}return ee(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Oi)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Oi)},persist:function(){},isPersistent:Oi}),t}var ns={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},da=pr(ns),Bs=ee({},ns,{view:0,detail:0}),Bp=pr(Bs),fa,ha,Ms,Ii=ee({},Bs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ma,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ms&&(Ms&&e.type==="mousemove"?(fa=e.screenX-Ms.screenX,ha=e.screenY-Ms.screenY):ha=fa=0,Ms=e),fa)},movementY:function(e){return"movementY"in e?e.movementY:ha}}),qc=pr(Ii),Mp=ee({},Ii,{dataTransfer:0}),Up=pr(Mp),zp=ee({},Bs,{relatedTarget:0}),pa=pr(zp),$p=ee({},ns,{animationName:0,elapsedTime:0,pseudoElement:0}),Wp=pr($p),Vp=ee({},ns,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),qp=pr(Vp),Hp=ee({},ns,{data:0}),Hc=pr(Hp),Gp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Kp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xp(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Qp[e])?!!t[e]:!1}function ma(){return Xp}var Zp=ee({},Bs,{key:function(e){if(e.key){var t=Gp[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Li(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Kp[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ma,charCode:function(e){return e.type==="keypress"?Li(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Li(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Yp=pr(Zp),Jp=ee({},Ii,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gc=pr(Jp),em=ee({},Bs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ma}),tm=pr(em),rm=ee({},ns,{propertyName:0,elapsedTime:0,pseudoElement:0}),nm=pr(rm),sm=ee({},Ii,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),im=pr(sm),om=[9,13,27,32],ga=f&&"CompositionEvent"in window,Us=null;f&&"documentMode"in document&&(Us=document.documentMode);var am=f&&"TextEvent"in window&&!Us,Kc=f&&(!ga||Us&&8<Us&&11>=Us),Qc=" ",Xc=!1;function Zc(e,t){switch(e){case"keyup":return om.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yc(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ss=!1;function lm(e,t){switch(e){case"compositionend":return Yc(t);case"keypress":return t.which!==32?null:(Xc=!0,Qc);case"textInput":return e=t.data,e===Qc&&Xc?null:e;default:return null}}function cm(e,t){if(ss)return e==="compositionend"||!ga&&Zc(e,t)?(e=Wc(),Pi=ua=dn=null,ss=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Kc&&t.locale!=="ko"?null:t.data;default:return null}}var um={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!um[e.type]:t==="textarea"}function eu(e,t,i,d){or(d),t=Ui(t,"onChange"),0<t.length&&(i=new da("onChange","change",null,i,d),e.push({event:i,listeners:t}))}var zs=null,$s=null;function dm(e){vu(e,0)}function Fi(e){var t=cs(e);if(et(t))return e}function fm(e,t){if(e==="change")return t}var tu=!1;if(f){var ya;if(f){var va="oninput"in document;if(!va){var ru=document.createElement("div");ru.setAttribute("oninput","return;"),va=typeof ru.oninput=="function"}ya=va}else ya=!1;tu=ya&&(!document.documentMode||9<document.documentMode)}function nu(){zs&&(zs.detachEvent("onpropertychange",su),$s=zs=null)}function su(e){if(e.propertyName==="value"&&Fi($s)){var t=[];eu(t,$s,e,it(e)),Pn(dm,t)}}function hm(e,t,i){e==="focusin"?(nu(),zs=t,$s=i,zs.attachEvent("onpropertychange",su)):e==="focusout"&&nu()}function pm(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Fi($s)}function mm(e,t){if(e==="click")return Fi(t)}function gm(e,t){if(e==="input"||e==="change")return Fi(t)}function ym(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var _r=typeof Object.is=="function"?Object.is:ym;function Ws(e,t){if(_r(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),d=Object.keys(t);if(i.length!==d.length)return!1;for(d=0;d<i.length;d++){var m=i[d];if(!p.call(t,m)||!_r(e[m],t[m]))return!1}return!0}function iu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ou(e,t){var i=iu(e);e=0;for(var d;i;){if(i.nodeType===3){if(d=e+i.textContent.length,e<=t&&d>=t)return{node:i,offset:t-e};e=d}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=iu(i)}}function au(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?au(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function lu(){for(var e=window,t=Ke();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=Ke(e.document)}return t}function xa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function vm(e){var t=lu(),i=e.focusedElem,d=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&au(i.ownerDocument.documentElement,i)){if(d!==null&&xa(i)){if(t=d.start,e=d.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var m=i.textContent.length,v=Math.min(d.start,m);d=d.end===void 0?v:Math.min(d.end,m),!e.extend&&v>d&&(m=d,d=v,v=m),m=ou(i,v);var O=ou(i,d);m&&O&&(e.rangeCount!==1||e.anchorNode!==m.node||e.anchorOffset!==m.offset||e.focusNode!==O.node||e.focusOffset!==O.offset)&&(t=t.createRange(),t.setStart(m.node,m.offset),e.removeAllRanges(),v>d?(e.addRange(t),e.extend(O.node,O.offset)):(t.setEnd(O.node,O.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var xm=f&&"documentMode"in document&&11>=document.documentMode,is=null,wa=null,Vs=null,ba=!1;function cu(e,t,i){var d=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;ba||is==null||is!==Ke(d)||(d=is,"selectionStart"in d&&xa(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Vs&&Ws(Vs,d)||(Vs=d,d=Ui(wa,"onSelect"),0<d.length&&(t=new da("onSelect","select",null,t,i),e.push({event:t,listeners:d}),t.target=is)))}function Di(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var os={animationend:Di("Animation","AnimationEnd"),animationiteration:Di("Animation","AnimationIteration"),animationstart:Di("Animation","AnimationStart"),transitionend:Di("Transition","TransitionEnd")},ka={},uu={};f&&(uu=document.createElement("div").style,"AnimationEvent"in window||(delete os.animationend.animation,delete os.animationiteration.animation,delete os.animationstart.animation),"TransitionEvent"in window||delete os.transitionend.transition);function Bi(e){if(ka[e])return ka[e];if(!os[e])return e;var t=os[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in uu)return ka[e]=t[i];return e}var du=Bi("animationend"),fu=Bi("animationiteration"),hu=Bi("animationstart"),pu=Bi("transitionend"),mu=new Map,gu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fn(e,t){mu.set(e,t),l(t,[e])}for(var Sa=0;Sa<gu.length;Sa++){var Na=gu[Sa],wm=Na.toLowerCase(),bm=Na[0].toUpperCase()+Na.slice(1);fn(wm,"on"+bm)}fn(du,"onAnimationEnd"),fn(fu,"onAnimationIteration"),fn(hu,"onAnimationStart"),fn("dblclick","onDoubleClick"),fn("focusin","onFocus"),fn("focusout","onBlur"),fn(pu,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),km=new Set("cancel close invalid load scroll toggle".split(" ").concat(qs));function yu(e,t,i){var d=e.type||"unknown-event";e.currentTarget=i,Rt(d,t,void 0,e),e.currentTarget=null}function vu(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var d=e[i],m=d.event;d=d.listeners;e:{var v=void 0;if(t)for(var O=d.length-1;0<=O;O--){var G=d[O],Y=G.instance,me=G.currentTarget;if(G=G.listener,Y!==v&&m.isPropagationStopped())break e;yu(m,G,me),v=Y}else for(O=0;O<d.length;O++){if(G=d[O],Y=G.instance,me=G.currentTarget,G=G.listener,Y!==v&&m.isPropagationStopped())break e;yu(m,G,me),v=Y}}}if(Be)throw e=Ge,Be=!1,Ge=null,e}function xt(e,t){var i=t[Pa];i===void 0&&(i=t[Pa]=new Set);var d=e+"__bubble";i.has(d)||(xu(t,e,2,!1),i.add(d))}function Ca(e,t,i){var d=0;t&&(d|=4),xu(i,e,d,t)}var Mi="_reactListening"+Math.random().toString(36).slice(2);function Hs(e){if(!e[Mi]){e[Mi]=!0,o.forEach(function(i){i!=="selectionchange"&&(km.has(i)||Ca(i,!1,e),Ca(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Mi]||(t[Mi]=!0,Ca("selectionchange",!1,t))}}function xu(e,t,i,d){switch($c(t)){case 1:var m=Fp;break;case 4:m=Dp;break;default:m=la}i=m.bind(null,t,i,e),m=void 0,!Hr||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(m=!0),d?m!==void 0?e.addEventListener(t,i,{capture:!0,passive:m}):e.addEventListener(t,i,!0):m!==void 0?e.addEventListener(t,i,{passive:m}):e.addEventListener(t,i,!1)}function ja(e,t,i,d,m){var v=d;if((t&1)===0&&(t&2)===0&&d!==null)e:for(;;){if(d===null)return;var O=d.tag;if(O===3||O===4){var G=d.stateNode.containerInfo;if(G===m||G.nodeType===8&&G.parentNode===m)break;if(O===4)for(O=d.return;O!==null;){var Y=O.tag;if((Y===3||Y===4)&&(Y=O.stateNode.containerInfo,Y===m||Y.nodeType===8&&Y.parentNode===m))return;O=O.return}for(;G!==null;){if(O=On(G),O===null)return;if(Y=O.tag,Y===5||Y===6){d=v=O;continue e}G=G.parentNode}}d=d.return}Pn(function(){var me=v,Ce=it(i),Ee=[];e:{var Ne=mu.get(e);if(Ne!==void 0){var Oe=da,Me=e;switch(e){case"keypress":if(Li(i)===0)break e;case"keydown":case"keyup":Oe=Yp;break;case"focusin":Me="focus",Oe=pa;break;case"focusout":Me="blur",Oe=pa;break;case"beforeblur":case"afterblur":Oe=pa;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=qc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=Up;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=tm;break;case du:case fu:case hu:Oe=Wp;break;case pu:Oe=nm;break;case"scroll":Oe=Bp;break;case"wheel":Oe=im;break;case"copy":case"cut":case"paste":Oe=qp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=Gc}var $e=(t&4)!==0,At=!$e&&e==="scroll",le=$e?Ne!==null?Ne+"Capture":null:Ne;$e=[];for(var se=me,pe;se!==null;){pe=se;var Re=pe.stateNode;if(pe.tag===5&&Re!==null&&(pe=Re,le!==null&&(Re=Er(se,le),Re!=null&&$e.push(Gs(se,Re,pe)))),At)break;se=se.return}0<$e.length&&(Ne=new Oe(Ne,Me,null,i,Ce),Ee.push({event:Ne,listeners:$e}))}}if((t&7)===0){e:{if(Ne=e==="mouseover"||e==="pointerover",Oe=e==="mouseout"||e==="pointerout",Ne&&i!==Je&&(Me=i.relatedTarget||i.fromElement)&&(On(Me)||Me[Kr]))break e;if((Oe||Ne)&&(Ne=Ce.window===Ce?Ce:(Ne=Ce.ownerDocument)?Ne.defaultView||Ne.parentWindow:window,Oe?(Me=i.relatedTarget||i.toElement,Oe=me,Me=Me?On(Me):null,Me!==null&&(At=Pt(Me),Me!==At||Me.tag!==5&&Me.tag!==6)&&(Me=null)):(Oe=null,Me=me),Oe!==Me)){if($e=qc,Re="onMouseLeave",le="onMouseEnter",se="mouse",(e==="pointerout"||e==="pointerover")&&($e=Gc,Re="onPointerLeave",le="onPointerEnter",se="pointer"),At=Oe==null?Ne:cs(Oe),pe=Me==null?Ne:cs(Me),Ne=new $e(Re,se+"leave",Oe,i,Ce),Ne.target=At,Ne.relatedTarget=pe,Re=null,On(Ce)===me&&($e=new $e(le,se+"enter",Me,i,Ce),$e.target=pe,$e.relatedTarget=At,Re=$e),At=Re,Oe&&Me)t:{for($e=Oe,le=Me,se=0,pe=$e;pe;pe=as(pe))se++;for(pe=0,Re=le;Re;Re=as(Re))pe++;for(;0<se-pe;)$e=as($e),se--;for(;0<pe-se;)le=as(le),pe--;for(;se--;){if($e===le||le!==null&&$e===le.alternate)break t;$e=as($e),le=as(le)}$e=null}else $e=null;Oe!==null&&wu(Ee,Ne,Oe,$e,!1),Me!==null&&At!==null&&wu(Ee,At,Me,$e,!0)}}e:{if(Ne=me?cs(me):window,Oe=Ne.nodeName&&Ne.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Ne.type==="file")var We=fm;else if(Jc(Ne))if(tu)We=gm;else{We=pm;var Qe=hm}else(Oe=Ne.nodeName)&&Oe.toLowerCase()==="input"&&(Ne.type==="checkbox"||Ne.type==="radio")&&(We=mm);if(We&&(We=We(e,me))){eu(Ee,We,i,Ce);break e}Qe&&Qe(e,Ne,me),e==="focusout"&&(Qe=Ne._wrapperState)&&Qe.controlled&&Ne.type==="number"&&Z(Ne,"number",Ne.value)}switch(Qe=me?cs(me):window,e){case"focusin":(Jc(Qe)||Qe.contentEditable==="true")&&(is=Qe,wa=me,Vs=null);break;case"focusout":Vs=wa=is=null;break;case"mousedown":ba=!0;break;case"contextmenu":case"mouseup":case"dragend":ba=!1,cu(Ee,i,Ce);break;case"selectionchange":if(xm)break;case"keydown":case"keyup":cu(Ee,i,Ce)}var Xe;if(ga)e:{switch(e){case"compositionstart":var Ze="onCompositionStart";break e;case"compositionend":Ze="onCompositionEnd";break e;case"compositionupdate":Ze="onCompositionUpdate";break e}Ze=void 0}else ss?Zc(e,i)&&(Ze="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Ze="onCompositionStart");Ze&&(Kc&&i.locale!=="ko"&&(ss||Ze!=="onCompositionStart"?Ze==="onCompositionEnd"&&ss&&(Xe=Wc()):(dn=Ce,ua="value"in dn?dn.value:dn.textContent,ss=!0)),Qe=Ui(me,Ze),0<Qe.length&&(Ze=new Hc(Ze,e,null,i,Ce),Ee.push({event:Ze,listeners:Qe}),Xe?Ze.data=Xe:(Xe=Yc(i),Xe!==null&&(Ze.data=Xe)))),(Xe=am?lm(e,i):cm(e,i))&&(me=Ui(me,"onBeforeInput"),0<me.length&&(Ce=new Hc("onBeforeInput","beforeinput",null,i,Ce),Ee.push({event:Ce,listeners:me}),Ce.data=Xe))}vu(Ee,t)})}function Gs(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Ui(e,t){for(var i=t+"Capture",d=[];e!==null;){var m=e,v=m.stateNode;m.tag===5&&v!==null&&(m=v,v=Er(e,i),v!=null&&d.unshift(Gs(e,v,m)),v=Er(e,t),v!=null&&d.push(Gs(e,v,m))),e=e.return}return d}function as(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wu(e,t,i,d,m){for(var v=t._reactName,O=[];i!==null&&i!==d;){var G=i,Y=G.alternate,me=G.stateNode;if(Y!==null&&Y===d)break;G.tag===5&&me!==null&&(G=me,m?(Y=Er(i,v),Y!=null&&O.unshift(Gs(i,Y,G))):m||(Y=Er(i,v),Y!=null&&O.push(Gs(i,Y,G)))),i=i.return}O.length!==0&&e.push({event:t,listeners:O})}var Sm=/\r\n?/g,Nm=/\u0000|\uFFFD/g;function bu(e){return(typeof e=="string"?e:""+e).replace(Sm,`
`).replace(Nm,"")}function zi(e,t,i){if(t=bu(t),bu(e)!==t&&i)throw Error(n(425))}function $i(){}var Ea=null,_a=null;function Aa(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ta=typeof setTimeout=="function"?setTimeout:void 0,Cm=typeof clearTimeout=="function"?clearTimeout:void 0,ku=typeof Promise=="function"?Promise:void 0,jm=typeof queueMicrotask=="function"?queueMicrotask:typeof ku<"u"?function(e){return ku.resolve(null).then(e).catch(Em)}:Ta;function Em(e){setTimeout(function(){throw e})}function Ra(e,t){var i=t,d=0;do{var m=i.nextSibling;if(e.removeChild(i),m&&m.nodeType===8)if(i=m.data,i==="/$"){if(d===0){e.removeChild(m),Ds(t);return}d--}else i!=="$"&&i!=="$?"&&i!=="$!"||d++;i=m}while(i);Ds(t)}function hn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Su(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var ls=Math.random().toString(36).slice(2),Br="__reactFiber$"+ls,Ks="__reactProps$"+ls,Kr="__reactContainer$"+ls,Pa="__reactEvents$"+ls,_m="__reactListeners$"+ls,Am="__reactHandles$"+ls;function On(e){var t=e[Br];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Kr]||i[Br]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=Su(e);e!==null;){if(i=e[Br])return i;e=Su(e)}return t}e=i,i=e.parentNode}return null}function Qs(e){return e=e[Br]||e[Kr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function cs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(n(33))}function Wi(e){return e[Ks]||null}var La=[],us=-1;function pn(e){return{current:e}}function wt(e){0>us||(e.current=La[us],La[us]=null,us--)}function yt(e,t){us++,La[us]=e.current,e.current=t}var mn={},Xt=pn(mn),lr=pn(!1),In=mn;function ds(e,t){var i=e.type.contextTypes;if(!i)return mn;var d=e.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===t)return d.__reactInternalMemoizedMaskedChildContext;var m={},v;for(v in i)m[v]=t[v];return d&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=m),m}function cr(e){return e=e.childContextTypes,e!=null}function Vi(){wt(lr),wt(Xt)}function Nu(e,t,i){if(Xt.current!==mn)throw Error(n(168));yt(Xt,t),yt(lr,i)}function Cu(e,t,i){var d=e.stateNode;if(t=t.childContextTypes,typeof d.getChildContext!="function")return i;d=d.getChildContext();for(var m in d)if(!(m in t))throw Error(n(108,Se(e)||"Unknown",m));return ee({},i,d)}function qi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||mn,In=Xt.current,yt(Xt,e),yt(lr,lr.current),!0}function ju(e,t,i){var d=e.stateNode;if(!d)throw Error(n(169));i?(e=Cu(e,t,In),d.__reactInternalMemoizedMergedChildContext=e,wt(lr),wt(Xt),yt(Xt,e)):wt(lr),yt(lr,i)}var Qr=null,Hi=!1,Oa=!1;function Eu(e){Qr===null?Qr=[e]:Qr.push(e)}function Tm(e){Hi=!0,Eu(e)}function gn(){if(!Oa&&Qr!==null){Oa=!0;var e=0,t=dt;try{var i=Qr;for(dt=1;e<i.length;e++){var d=i[e];do d=d(!0);while(d!==null)}Qr=null,Hi=!1}catch(m){throw Qr!==null&&(Qr=Qr.slice(e+1)),ji(xe,gn),m}finally{dt=t,Oa=!1}}return null}var fs=[],hs=0,Gi=null,Ki=0,wr=[],br=0,Fn=null,Xr=1,Zr="";function Dn(e,t){fs[hs++]=Ki,fs[hs++]=Gi,Gi=e,Ki=t}function _u(e,t,i){wr[br++]=Xr,wr[br++]=Zr,wr[br++]=Fn,Fn=e;var d=Xr;e=Zr;var m=32-gt(d)-1;d&=~(1<<m),i+=1;var v=32-gt(t)+m;if(30<v){var O=m-m%5;v=(d&(1<<O)-1).toString(32),d>>=O,m-=O,Xr=1<<32-gt(t)+m|i<<m|d,Zr=v+e}else Xr=1<<v|i<<m|d,Zr=e}function Ia(e){e.return!==null&&(Dn(e,1),_u(e,1,0))}function Fa(e){for(;e===Gi;)Gi=fs[--hs],fs[hs]=null,Ki=fs[--hs],fs[hs]=null;for(;e===Fn;)Fn=wr[--br],wr[br]=null,Zr=wr[--br],wr[br]=null,Xr=wr[--br],wr[br]=null}var mr=null,gr=null,St=!1,Ar=null;function Au(e,t){var i=Cr(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function Tu(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,mr=e,gr=hn(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,mr=e,gr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Fn!==null?{id:Xr,overflow:Zr}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Cr(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,mr=e,gr=null,!0):!1;default:return!1}}function Da(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Ba(e){if(St){var t=gr;if(t){var i=t;if(!Tu(e,t)){if(Da(e))throw Error(n(418));t=hn(i.nextSibling);var d=mr;t&&Tu(e,t)?Au(d,i):(e.flags=e.flags&-4097|2,St=!1,mr=e)}}else{if(Da(e))throw Error(n(418));e.flags=e.flags&-4097|2,St=!1,mr=e}}}function Ru(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;mr=e}function Qi(e){if(e!==mr)return!1;if(!St)return Ru(e),St=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Aa(e.type,e.memoizedProps)),t&&(t=gr)){if(Da(e))throw Pu(),Error(n(418));for(;t;)Au(e,t),t=hn(t.nextSibling)}if(Ru(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(n(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){gr=hn(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}gr=null}}else gr=mr?hn(e.stateNode.nextSibling):null;return!0}function Pu(){for(var e=gr;e;)e=hn(e.nextSibling)}function ps(){gr=mr=null,St=!1}function Ma(e){Ar===null?Ar=[e]:Ar.push(e)}var Rm=T.ReactCurrentBatchConfig;function Xs(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(n(309));var d=i.stateNode}if(!d)throw Error(n(147,e));var m=d,v=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===v?t.ref:(t=function(O){var G=m.refs;O===null?delete G[v]:G[v]=O},t._stringRef=v,t)}if(typeof e!="string")throw Error(n(284));if(!i._owner)throw Error(n(290,e))}return e}function Xi(e,t){throw e=Object.prototype.toString.call(t),Error(n(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Lu(e){var t=e._init;return t(e._payload)}function Ou(e){function t(le,se){if(e){var pe=le.deletions;pe===null?(le.deletions=[se],le.flags|=16):pe.push(se)}}function i(le,se){if(!e)return null;for(;se!==null;)t(le,se),se=se.sibling;return null}function d(le,se){for(le=new Map;se!==null;)se.key!==null?le.set(se.key,se):le.set(se.index,se),se=se.sibling;return le}function m(le,se){return le=Nn(le,se),le.index=0,le.sibling=null,le}function v(le,se,pe){return le.index=pe,e?(pe=le.alternate,pe!==null?(pe=pe.index,pe<se?(le.flags|=2,se):pe):(le.flags|=2,se)):(le.flags|=1048576,se)}function O(le){return e&&le.alternate===null&&(le.flags|=2),le}function G(le,se,pe,Re){return se===null||se.tag!==6?(se=Tl(pe,le.mode,Re),se.return=le,se):(se=m(se,pe),se.return=le,se)}function Y(le,se,pe,Re){var We=pe.type;return We===W?Ce(le,se,pe.props.children,Re,pe.key):se!==null&&(se.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===ae&&Lu(We)===se.type)?(Re=m(se,pe.props),Re.ref=Xs(le,se,pe),Re.return=le,Re):(Re=bo(pe.type,pe.key,pe.props,null,le.mode,Re),Re.ref=Xs(le,se,pe),Re.return=le,Re)}function me(le,se,pe,Re){return se===null||se.tag!==4||se.stateNode.containerInfo!==pe.containerInfo||se.stateNode.implementation!==pe.implementation?(se=Rl(pe,le.mode,Re),se.return=le,se):(se=m(se,pe.children||[]),se.return=le,se)}function Ce(le,se,pe,Re,We){return se===null||se.tag!==7?(se=qn(pe,le.mode,Re,We),se.return=le,se):(se=m(se,pe),se.return=le,se)}function Ee(le,se,pe){if(typeof se=="string"&&se!==""||typeof se=="number")return se=Tl(""+se,le.mode,pe),se.return=le,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case I:return pe=bo(se.type,se.key,se.props,null,le.mode,pe),pe.ref=Xs(le,null,se),pe.return=le,pe;case D:return se=Rl(se,le.mode,pe),se.return=le,se;case ae:var Re=se._init;return Ee(le,Re(se._payload),pe)}if(ce(se)||re(se))return se=qn(se,le.mode,pe,null),se.return=le,se;Xi(le,se)}return null}function Ne(le,se,pe,Re){var We=se!==null?se.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number")return We!==null?null:G(le,se,""+pe,Re);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case I:return pe.key===We?Y(le,se,pe,Re):null;case D:return pe.key===We?me(le,se,pe,Re):null;case ae:return We=pe._init,Ne(le,se,We(pe._payload),Re)}if(ce(pe)||re(pe))return We!==null?null:Ce(le,se,pe,Re,null);Xi(le,pe)}return null}function Oe(le,se,pe,Re,We){if(typeof Re=="string"&&Re!==""||typeof Re=="number")return le=le.get(pe)||null,G(se,le,""+Re,We);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case I:return le=le.get(Re.key===null?pe:Re.key)||null,Y(se,le,Re,We);case D:return le=le.get(Re.key===null?pe:Re.key)||null,me(se,le,Re,We);case ae:var Qe=Re._init;return Oe(le,se,pe,Qe(Re._payload),We)}if(ce(Re)||re(Re))return le=le.get(pe)||null,Ce(se,le,Re,We,null);Xi(se,Re)}return null}function Me(le,se,pe,Re){for(var We=null,Qe=null,Xe=se,Ze=se=0,Vt=null;Xe!==null&&Ze<pe.length;Ze++){Xe.index>Ze?(Vt=Xe,Xe=null):Vt=Xe.sibling;var ct=Ne(le,Xe,pe[Ze],Re);if(ct===null){Xe===null&&(Xe=Vt);break}e&&Xe&&ct.alternate===null&&t(le,Xe),se=v(ct,se,Ze),Qe===null?We=ct:Qe.sibling=ct,Qe=ct,Xe=Vt}if(Ze===pe.length)return i(le,Xe),St&&Dn(le,Ze),We;if(Xe===null){for(;Ze<pe.length;Ze++)Xe=Ee(le,pe[Ze],Re),Xe!==null&&(se=v(Xe,se,Ze),Qe===null?We=Xe:Qe.sibling=Xe,Qe=Xe);return St&&Dn(le,Ze),We}for(Xe=d(le,Xe);Ze<pe.length;Ze++)Vt=Oe(Xe,le,Ze,pe[Ze],Re),Vt!==null&&(e&&Vt.alternate!==null&&Xe.delete(Vt.key===null?Ze:Vt.key),se=v(Vt,se,Ze),Qe===null?We=Vt:Qe.sibling=Vt,Qe=Vt);return e&&Xe.forEach(function(Cn){return t(le,Cn)}),St&&Dn(le,Ze),We}function $e(le,se,pe,Re){var We=re(pe);if(typeof We!="function")throw Error(n(150));if(pe=We.call(pe),pe==null)throw Error(n(151));for(var Qe=We=null,Xe=se,Ze=se=0,Vt=null,ct=pe.next();Xe!==null&&!ct.done;Ze++,ct=pe.next()){Xe.index>Ze?(Vt=Xe,Xe=null):Vt=Xe.sibling;var Cn=Ne(le,Xe,ct.value,Re);if(Cn===null){Xe===null&&(Xe=Vt);break}e&&Xe&&Cn.alternate===null&&t(le,Xe),se=v(Cn,se,Ze),Qe===null?We=Cn:Qe.sibling=Cn,Qe=Cn,Xe=Vt}if(ct.done)return i(le,Xe),St&&Dn(le,Ze),We;if(Xe===null){for(;!ct.done;Ze++,ct=pe.next())ct=Ee(le,ct.value,Re),ct!==null&&(se=v(ct,se,Ze),Qe===null?We=ct:Qe.sibling=ct,Qe=ct);return St&&Dn(le,Ze),We}for(Xe=d(le,Xe);!ct.done;Ze++,ct=pe.next())ct=Oe(Xe,le,Ze,ct.value,Re),ct!==null&&(e&&ct.alternate!==null&&Xe.delete(ct.key===null?Ze:ct.key),se=v(ct,se,Ze),Qe===null?We=ct:Qe.sibling=ct,Qe=ct);return e&&Xe.forEach(function(ug){return t(le,ug)}),St&&Dn(le,Ze),We}function At(le,se,pe,Re){if(typeof pe=="object"&&pe!==null&&pe.type===W&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case I:e:{for(var We=pe.key,Qe=se;Qe!==null;){if(Qe.key===We){if(We=pe.type,We===W){if(Qe.tag===7){i(le,Qe.sibling),se=m(Qe,pe.props.children),se.return=le,le=se;break e}}else if(Qe.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===ae&&Lu(We)===Qe.type){i(le,Qe.sibling),se=m(Qe,pe.props),se.ref=Xs(le,Qe,pe),se.return=le,le=se;break e}i(le,Qe);break}else t(le,Qe);Qe=Qe.sibling}pe.type===W?(se=qn(pe.props.children,le.mode,Re,pe.key),se.return=le,le=se):(Re=bo(pe.type,pe.key,pe.props,null,le.mode,Re),Re.ref=Xs(le,se,pe),Re.return=le,le=Re)}return O(le);case D:e:{for(Qe=pe.key;se!==null;){if(se.key===Qe)if(se.tag===4&&se.stateNode.containerInfo===pe.containerInfo&&se.stateNode.implementation===pe.implementation){i(le,se.sibling),se=m(se,pe.children||[]),se.return=le,le=se;break e}else{i(le,se);break}else t(le,se);se=se.sibling}se=Rl(pe,le.mode,Re),se.return=le,le=se}return O(le);case ae:return Qe=pe._init,At(le,se,Qe(pe._payload),Re)}if(ce(pe))return Me(le,se,pe,Re);if(re(pe))return $e(le,se,pe,Re);Xi(le,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"?(pe=""+pe,se!==null&&se.tag===6?(i(le,se.sibling),se=m(se,pe),se.return=le,le=se):(i(le,se),se=Tl(pe,le.mode,Re),se.return=le,le=se),O(le)):i(le,se)}return At}var ms=Ou(!0),Iu=Ou(!1),Zi=pn(null),Yi=null,gs=null,Ua=null;function za(){Ua=gs=Yi=null}function $a(e){var t=Zi.current;wt(Zi),e._currentValue=t}function Wa(e,t,i){for(;e!==null;){var d=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,d!==null&&(d.childLanes|=t)):d!==null&&(d.childLanes&t)!==t&&(d.childLanes|=t),e===i)break;e=e.return}}function ys(e,t){Yi=e,Ua=gs=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(ur=!0),e.firstContext=null)}function kr(e){var t=e._currentValue;if(Ua!==e)if(e={context:e,memoizedValue:t,next:null},gs===null){if(Yi===null)throw Error(n(308));gs=e,Yi.dependencies={lanes:0,firstContext:e}}else gs=gs.next=e;return t}var Bn=null;function Va(e){Bn===null?Bn=[e]:Bn.push(e)}function Fu(e,t,i,d){var m=t.interleaved;return m===null?(i.next=i,Va(t)):(i.next=m.next,m.next=i),t.interleaved=i,Yr(e,d)}function Yr(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var yn=!1;function qa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Du(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Jr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function vn(e,t,i){var d=e.updateQueue;if(d===null)return null;if(d=d.shared,(lt&2)!==0){var m=d.pending;return m===null?t.next=t:(t.next=m.next,m.next=t),d.pending=t,Yr(e,i)}return m=d.interleaved,m===null?(t.next=t,Va(d)):(t.next=m.next,m.next=t),d.interleaved=t,Yr(e,i)}function Ji(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var d=t.lanes;d&=e.pendingLanes,i|=d,t.lanes=i,ia(e,i)}}function Bu(e,t){var i=e.updateQueue,d=e.alternate;if(d!==null&&(d=d.updateQueue,i===d)){var m=null,v=null;if(i=i.firstBaseUpdate,i!==null){do{var O={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};v===null?m=v=O:v=v.next=O,i=i.next}while(i!==null);v===null?m=v=t:v=v.next=t}else m=v=t;i={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:v,shared:d.shared,effects:d.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function eo(e,t,i,d){var m=e.updateQueue;yn=!1;var v=m.firstBaseUpdate,O=m.lastBaseUpdate,G=m.shared.pending;if(G!==null){m.shared.pending=null;var Y=G,me=Y.next;Y.next=null,O===null?v=me:O.next=me,O=Y;var Ce=e.alternate;Ce!==null&&(Ce=Ce.updateQueue,G=Ce.lastBaseUpdate,G!==O&&(G===null?Ce.firstBaseUpdate=me:G.next=me,Ce.lastBaseUpdate=Y))}if(v!==null){var Ee=m.baseState;O=0,Ce=me=Y=null,G=v;do{var Ne=G.lane,Oe=G.eventTime;if((d&Ne)===Ne){Ce!==null&&(Ce=Ce.next={eventTime:Oe,lane:0,tag:G.tag,payload:G.payload,callback:G.callback,next:null});e:{var Me=e,$e=G;switch(Ne=t,Oe=i,$e.tag){case 1:if(Me=$e.payload,typeof Me=="function"){Ee=Me.call(Oe,Ee,Ne);break e}Ee=Me;break e;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=$e.payload,Ne=typeof Me=="function"?Me.call(Oe,Ee,Ne):Me,Ne==null)break e;Ee=ee({},Ee,Ne);break e;case 2:yn=!0}}G.callback!==null&&G.lane!==0&&(e.flags|=64,Ne=m.effects,Ne===null?m.effects=[G]:Ne.push(G))}else Oe={eventTime:Oe,lane:Ne,tag:G.tag,payload:G.payload,callback:G.callback,next:null},Ce===null?(me=Ce=Oe,Y=Ee):Ce=Ce.next=Oe,O|=Ne;if(G=G.next,G===null){if(G=m.shared.pending,G===null)break;Ne=G,G=Ne.next,Ne.next=null,m.lastBaseUpdate=Ne,m.shared.pending=null}}while(!0);if(Ce===null&&(Y=Ee),m.baseState=Y,m.firstBaseUpdate=me,m.lastBaseUpdate=Ce,t=m.shared.interleaved,t!==null){m=t;do O|=m.lane,m=m.next;while(m!==t)}else v===null&&(m.shared.lanes=0);zn|=O,e.lanes=O,e.memoizedState=Ee}}function Mu(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var d=e[t],m=d.callback;if(m!==null){if(d.callback=null,d=i,typeof m!="function")throw Error(n(191,m));m.call(d)}}}var Zs={},Mr=pn(Zs),Ys=pn(Zs),Js=pn(Zs);function Mn(e){if(e===Zs)throw Error(n(174));return e}function Ha(e,t){switch(yt(Js,t),yt(Ys,e),yt(Mr,Zs),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ge(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ge(t,e)}wt(Mr),yt(Mr,t)}function vs(){wt(Mr),wt(Ys),wt(Js)}function Uu(e){Mn(Js.current);var t=Mn(Mr.current),i=ge(t,e.type);t!==i&&(yt(Ys,e),yt(Mr,i))}function Ga(e){Ys.current===e&&(wt(Mr),wt(Ys))}var Ct=pn(0);function to(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ka=[];function Qa(){for(var e=0;e<Ka.length;e++)Ka[e]._workInProgressVersionPrimary=null;Ka.length=0}var ro=T.ReactCurrentDispatcher,Xa=T.ReactCurrentBatchConfig,Un=0,jt=null,Ft=null,$t=null,no=!1,ei=!1,ti=0,Pm=0;function Zt(){throw Error(n(321))}function Za(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!_r(e[i],t[i]))return!1;return!0}function Ya(e,t,i,d,m,v){if(Un=v,jt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=e===null||e.memoizedState===null?Fm:Dm,e=i(d,m),ei){v=0;do{if(ei=!1,ti=0,25<=v)throw Error(n(301));v+=1,$t=Ft=null,t.updateQueue=null,ro.current=Bm,e=i(d,m)}while(ei)}if(ro.current=oo,t=Ft!==null&&Ft.next!==null,Un=0,$t=Ft=jt=null,no=!1,t)throw Error(n(300));return e}function Ja(){var e=ti!==0;return ti=0,e}function Ur(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $t===null?jt.memoizedState=$t=e:$t=$t.next=e,$t}function Sr(){if(Ft===null){var e=jt.alternate;e=e!==null?e.memoizedState:null}else e=Ft.next;var t=$t===null?jt.memoizedState:$t.next;if(t!==null)$t=t,Ft=e;else{if(e===null)throw Error(n(310));Ft=e,e={memoizedState:Ft.memoizedState,baseState:Ft.baseState,baseQueue:Ft.baseQueue,queue:Ft.queue,next:null},$t===null?jt.memoizedState=$t=e:$t=$t.next=e}return $t}function ri(e,t){return typeof t=="function"?t(e):t}function el(e){var t=Sr(),i=t.queue;if(i===null)throw Error(n(311));i.lastRenderedReducer=e;var d=Ft,m=d.baseQueue,v=i.pending;if(v!==null){if(m!==null){var O=m.next;m.next=v.next,v.next=O}d.baseQueue=m=v,i.pending=null}if(m!==null){v=m.next,d=d.baseState;var G=O=null,Y=null,me=v;do{var Ce=me.lane;if((Un&Ce)===Ce)Y!==null&&(Y=Y.next={lane:0,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),d=me.hasEagerState?me.eagerState:e(d,me.action);else{var Ee={lane:Ce,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null};Y===null?(G=Y=Ee,O=d):Y=Y.next=Ee,jt.lanes|=Ce,zn|=Ce}me=me.next}while(me!==null&&me!==v);Y===null?O=d:Y.next=G,_r(d,t.memoizedState)||(ur=!0),t.memoizedState=d,t.baseState=O,t.baseQueue=Y,i.lastRenderedState=d}if(e=i.interleaved,e!==null){m=e;do v=m.lane,jt.lanes|=v,zn|=v,m=m.next;while(m!==e)}else m===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function tl(e){var t=Sr(),i=t.queue;if(i===null)throw Error(n(311));i.lastRenderedReducer=e;var d=i.dispatch,m=i.pending,v=t.memoizedState;if(m!==null){i.pending=null;var O=m=m.next;do v=e(v,O.action),O=O.next;while(O!==m);_r(v,t.memoizedState)||(ur=!0),t.memoizedState=v,t.baseQueue===null&&(t.baseState=v),i.lastRenderedState=v}return[v,d]}function zu(){}function $u(e,t){var i=jt,d=Sr(),m=t(),v=!_r(d.memoizedState,m);if(v&&(d.memoizedState=m,ur=!0),d=d.queue,rl(qu.bind(null,i,d,e),[e]),d.getSnapshot!==t||v||$t!==null&&$t.memoizedState.tag&1){if(i.flags|=2048,ni(9,Vu.bind(null,i,d,m,t),void 0,null),Wt===null)throw Error(n(349));(Un&30)!==0||Wu(i,t,m)}return m}function Wu(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=jt.updateQueue,t===null?(t={lastEffect:null,stores:null},jt.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function Vu(e,t,i,d){t.value=i,t.getSnapshot=d,Hu(t)&&Gu(e)}function qu(e,t,i){return i(function(){Hu(t)&&Gu(e)})}function Hu(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!_r(e,i)}catch{return!0}}function Gu(e){var t=Yr(e,1);t!==null&&Lr(t,e,1,-1)}function Ku(e){var t=Ur();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ri,lastRenderedState:e},t.queue=e,e=e.dispatch=Im.bind(null,jt,e),[t.memoizedState,e]}function ni(e,t,i,d){return e={tag:e,create:t,destroy:i,deps:d,next:null},t=jt.updateQueue,t===null?(t={lastEffect:null,stores:null},jt.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(d=i.next,i.next=e,e.next=d,t.lastEffect=e)),e}function Qu(){return Sr().memoizedState}function so(e,t,i,d){var m=Ur();jt.flags|=e,m.memoizedState=ni(1|t,i,void 0,d===void 0?null:d)}function io(e,t,i,d){var m=Sr();d=d===void 0?null:d;var v=void 0;if(Ft!==null){var O=Ft.memoizedState;if(v=O.destroy,d!==null&&Za(d,O.deps)){m.memoizedState=ni(t,i,v,d);return}}jt.flags|=e,m.memoizedState=ni(1|t,i,v,d)}function Xu(e,t){return so(8390656,8,e,t)}function rl(e,t){return io(2048,8,e,t)}function Zu(e,t){return io(4,2,e,t)}function Yu(e,t){return io(4,4,e,t)}function Ju(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function ed(e,t,i){return i=i!=null?i.concat([e]):null,io(4,4,Ju.bind(null,t,e),i)}function nl(){}function td(e,t){var i=Sr();t=t===void 0?null:t;var d=i.memoizedState;return d!==null&&t!==null&&Za(t,d[1])?d[0]:(i.memoizedState=[e,t],e)}function rd(e,t){var i=Sr();t=t===void 0?null:t;var d=i.memoizedState;return d!==null&&t!==null&&Za(t,d[1])?d[0]:(e=e(),i.memoizedState=[e,t],e)}function nd(e,t,i){return(Un&21)===0?(e.baseState&&(e.baseState=!1,ur=!0),e.memoizedState=i):(_r(i,t)||(i=Lc(),jt.lanes|=i,zn|=i,e.baseState=!0),t)}function Lm(e,t){var i=dt;dt=i!==0&&4>i?i:4,e(!0);var d=Xa.transition;Xa.transition={};try{e(!1),t()}finally{dt=i,Xa.transition=d}}function sd(){return Sr().memoizedState}function Om(e,t,i){var d=kn(e);if(i={lane:d,action:i,hasEagerState:!1,eagerState:null,next:null},id(e))od(t,i);else if(i=Fu(e,t,i,d),i!==null){var m=sr();Lr(i,e,d,m),ad(i,t,d)}}function Im(e,t,i){var d=kn(e),m={lane:d,action:i,hasEagerState:!1,eagerState:null,next:null};if(id(e))od(t,m);else{var v=e.alternate;if(e.lanes===0&&(v===null||v.lanes===0)&&(v=t.lastRenderedReducer,v!==null))try{var O=t.lastRenderedState,G=v(O,i);if(m.hasEagerState=!0,m.eagerState=G,_r(G,O)){var Y=t.interleaved;Y===null?(m.next=m,Va(t)):(m.next=Y.next,Y.next=m),t.interleaved=m;return}}catch{}finally{}i=Fu(e,t,m,d),i!==null&&(m=sr(),Lr(i,e,d,m),ad(i,t,d))}}function id(e){var t=e.alternate;return e===jt||t!==null&&t===jt}function od(e,t){ei=no=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function ad(e,t,i){if((i&4194240)!==0){var d=t.lanes;d&=e.pendingLanes,i|=d,t.lanes=i,ia(e,i)}}var oo={readContext:kr,useCallback:Zt,useContext:Zt,useEffect:Zt,useImperativeHandle:Zt,useInsertionEffect:Zt,useLayoutEffect:Zt,useMemo:Zt,useReducer:Zt,useRef:Zt,useState:Zt,useDebugValue:Zt,useDeferredValue:Zt,useTransition:Zt,useMutableSource:Zt,useSyncExternalStore:Zt,useId:Zt,unstable_isNewReconciler:!1},Fm={readContext:kr,useCallback:function(e,t){return Ur().memoizedState=[e,t===void 0?null:t],e},useContext:kr,useEffect:Xu,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,so(4194308,4,Ju.bind(null,t,e),i)},useLayoutEffect:function(e,t){return so(4194308,4,e,t)},useInsertionEffect:function(e,t){return so(4,2,e,t)},useMemo:function(e,t){var i=Ur();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var d=Ur();return t=i!==void 0?i(t):t,d.memoizedState=d.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},d.queue=e,e=e.dispatch=Om.bind(null,jt,e),[d.memoizedState,e]},useRef:function(e){var t=Ur();return e={current:e},t.memoizedState=e},useState:Ku,useDebugValue:nl,useDeferredValue:function(e){return Ur().memoizedState=e},useTransition:function(){var e=Ku(!1),t=e[0];return e=Lm.bind(null,e[1]),Ur().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var d=jt,m=Ur();if(St){if(i===void 0)throw Error(n(407));i=i()}else{if(i=t(),Wt===null)throw Error(n(349));(Un&30)!==0||Wu(d,t,i)}m.memoizedState=i;var v={value:i,getSnapshot:t};return m.queue=v,Xu(qu.bind(null,d,v,e),[e]),d.flags|=2048,ni(9,Vu.bind(null,d,v,i,t),void 0,null),i},useId:function(){var e=Ur(),t=Wt.identifierPrefix;if(St){var i=Zr,d=Xr;i=(d&~(1<<32-gt(d)-1)).toString(32)+i,t=":"+t+"R"+i,i=ti++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=Pm++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Dm={readContext:kr,useCallback:td,useContext:kr,useEffect:rl,useImperativeHandle:ed,useInsertionEffect:Zu,useLayoutEffect:Yu,useMemo:rd,useReducer:el,useRef:Qu,useState:function(){return el(ri)},useDebugValue:nl,useDeferredValue:function(e){var t=Sr();return nd(t,Ft.memoizedState,e)},useTransition:function(){var e=el(ri)[0],t=Sr().memoizedState;return[e,t]},useMutableSource:zu,useSyncExternalStore:$u,useId:sd,unstable_isNewReconciler:!1},Bm={readContext:kr,useCallback:td,useContext:kr,useEffect:rl,useImperativeHandle:ed,useInsertionEffect:Zu,useLayoutEffect:Yu,useMemo:rd,useReducer:tl,useRef:Qu,useState:function(){return tl(ri)},useDebugValue:nl,useDeferredValue:function(e){var t=Sr();return Ft===null?t.memoizedState=e:nd(t,Ft.memoizedState,e)},useTransition:function(){var e=tl(ri)[0],t=Sr().memoizedState;return[e,t]},useMutableSource:zu,useSyncExternalStore:$u,useId:sd,unstable_isNewReconciler:!1};function Tr(e,t){if(e&&e.defaultProps){t=ee({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function sl(e,t,i,d){t=e.memoizedState,i=i(d,t),i=i==null?t:ee({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var ao={isMounted:function(e){return(e=e._reactInternals)?Pt(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var d=sr(),m=kn(e),v=Jr(d,m);v.payload=t,i!=null&&(v.callback=i),t=vn(e,v,m),t!==null&&(Lr(t,e,m,d),Ji(t,e,m))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var d=sr(),m=kn(e),v=Jr(d,m);v.tag=1,v.payload=t,i!=null&&(v.callback=i),t=vn(e,v,m),t!==null&&(Lr(t,e,m,d),Ji(t,e,m))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=sr(),d=kn(e),m=Jr(i,d);m.tag=2,t!=null&&(m.callback=t),t=vn(e,m,d),t!==null&&(Lr(t,e,d,i),Ji(t,e,d))}};function ld(e,t,i,d,m,v,O){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(d,v,O):t.prototype&&t.prototype.isPureReactComponent?!Ws(i,d)||!Ws(m,v):!0}function cd(e,t,i){var d=!1,m=mn,v=t.contextType;return typeof v=="object"&&v!==null?v=kr(v):(m=cr(t)?In:Xt.current,d=t.contextTypes,v=(d=d!=null)?ds(e,m):mn),t=new t(i,v),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=ao,e.stateNode=t,t._reactInternals=e,d&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=m,e.__reactInternalMemoizedMaskedChildContext=v),t}function ud(e,t,i,d){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,d),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,d),t.state!==e&&ao.enqueueReplaceState(t,t.state,null)}function il(e,t,i,d){var m=e.stateNode;m.props=i,m.state=e.memoizedState,m.refs={},qa(e);var v=t.contextType;typeof v=="object"&&v!==null?m.context=kr(v):(v=cr(t)?In:Xt.current,m.context=ds(e,v)),m.state=e.memoizedState,v=t.getDerivedStateFromProps,typeof v=="function"&&(sl(e,t,v,i),m.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(t=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),t!==m.state&&ao.enqueueReplaceState(m,m.state,null),eo(e,i,m,d),m.state=e.memoizedState),typeof m.componentDidMount=="function"&&(e.flags|=4194308)}function xs(e,t){try{var i="",d=t;do i+=oe(d),d=d.return;while(d);var m=i}catch(v){m=`
Error generating stack: `+v.message+`
`+v.stack}return{value:e,source:t,stack:m,digest:null}}function ol(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function al(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var Mm=typeof WeakMap=="function"?WeakMap:Map;function dd(e,t,i){i=Jr(-1,i),i.tag=3,i.payload={element:null};var d=t.value;return i.callback=function(){mo||(mo=!0,kl=d),al(e,t)},i}function fd(e,t,i){i=Jr(-1,i),i.tag=3;var d=e.type.getDerivedStateFromError;if(typeof d=="function"){var m=t.value;i.payload=function(){return d(m)},i.callback=function(){al(e,t)}}var v=e.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(i.callback=function(){al(e,t),typeof d!="function"&&(wn===null?wn=new Set([this]):wn.add(this));var O=t.stack;this.componentDidCatch(t.value,{componentStack:O!==null?O:""})}),i}function hd(e,t,i){var d=e.pingCache;if(d===null){d=e.pingCache=new Mm;var m=new Set;d.set(t,m)}else m=d.get(t),m===void 0&&(m=new Set,d.set(t,m));m.has(i)||(m.add(i),e=Jm.bind(null,e,t,i),t.then(e,e))}function pd(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function md(e,t,i,d,m){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=Jr(-1,1),t.tag=2,vn(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=m,e)}var Um=T.ReactCurrentOwner,ur=!1;function nr(e,t,i,d){t.child=e===null?Iu(t,null,i,d):ms(t,e.child,i,d)}function gd(e,t,i,d,m){i=i.render;var v=t.ref;return ys(t,m),d=Ya(e,t,i,d,v,m),i=Ja(),e!==null&&!ur?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~m,en(e,t,m)):(St&&i&&Ia(t),t.flags|=1,nr(e,t,d,m),t.child)}function yd(e,t,i,d,m){if(e===null){var v=i.type;return typeof v=="function"&&!Al(v)&&v.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=v,vd(e,t,v,d,m)):(e=bo(i.type,null,d,t,t.mode,m),e.ref=t.ref,e.return=t,t.child=e)}if(v=e.child,(e.lanes&m)===0){var O=v.memoizedProps;if(i=i.compare,i=i!==null?i:Ws,i(O,d)&&e.ref===t.ref)return en(e,t,m)}return t.flags|=1,e=Nn(v,d),e.ref=t.ref,e.return=t,t.child=e}function vd(e,t,i,d,m){if(e!==null){var v=e.memoizedProps;if(Ws(v,d)&&e.ref===t.ref)if(ur=!1,t.pendingProps=d=v,(e.lanes&m)!==0)(e.flags&131072)!==0&&(ur=!0);else return t.lanes=e.lanes,en(e,t,m)}return ll(e,t,i,d,m)}function xd(e,t,i){var d=t.pendingProps,m=d.children,v=e!==null?e.memoizedState:null;if(d.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},yt(bs,yr),yr|=i;else{if((i&1073741824)===0)return e=v!==null?v.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,yt(bs,yr),yr|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=v!==null?v.baseLanes:i,yt(bs,yr),yr|=d}else v!==null?(d=v.baseLanes|i,t.memoizedState=null):d=i,yt(bs,yr),yr|=d;return nr(e,t,m,i),t.child}function wd(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function ll(e,t,i,d,m){var v=cr(i)?In:Xt.current;return v=ds(t,v),ys(t,m),i=Ya(e,t,i,d,v,m),d=Ja(),e!==null&&!ur?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~m,en(e,t,m)):(St&&d&&Ia(t),t.flags|=1,nr(e,t,i,m),t.child)}function bd(e,t,i,d,m){if(cr(i)){var v=!0;qi(t)}else v=!1;if(ys(t,m),t.stateNode===null)co(e,t),cd(t,i,d),il(t,i,d,m),d=!0;else if(e===null){var O=t.stateNode,G=t.memoizedProps;O.props=G;var Y=O.context,me=i.contextType;typeof me=="object"&&me!==null?me=kr(me):(me=cr(i)?In:Xt.current,me=ds(t,me));var Ce=i.getDerivedStateFromProps,Ee=typeof Ce=="function"||typeof O.getSnapshotBeforeUpdate=="function";Ee||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(G!==d||Y!==me)&&ud(t,O,d,me),yn=!1;var Ne=t.memoizedState;O.state=Ne,eo(t,d,O,m),Y=t.memoizedState,G!==d||Ne!==Y||lr.current||yn?(typeof Ce=="function"&&(sl(t,i,Ce,d),Y=t.memoizedState),(G=yn||ld(t,i,G,d,Ne,Y,me))?(Ee||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(t.flags|=4194308)):(typeof O.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=d,t.memoizedState=Y),O.props=d,O.state=Y,O.context=me,d=G):(typeof O.componentDidMount=="function"&&(t.flags|=4194308),d=!1)}else{O=t.stateNode,Du(e,t),G=t.memoizedProps,me=t.type===t.elementType?G:Tr(t.type,G),O.props=me,Ee=t.pendingProps,Ne=O.context,Y=i.contextType,typeof Y=="object"&&Y!==null?Y=kr(Y):(Y=cr(i)?In:Xt.current,Y=ds(t,Y));var Oe=i.getDerivedStateFromProps;(Ce=typeof Oe=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(G!==Ee||Ne!==Y)&&ud(t,O,d,Y),yn=!1,Ne=t.memoizedState,O.state=Ne,eo(t,d,O,m);var Me=t.memoizedState;G!==Ee||Ne!==Me||lr.current||yn?(typeof Oe=="function"&&(sl(t,i,Oe,d),Me=t.memoizedState),(me=yn||ld(t,i,me,d,Ne,Me,Y)||!1)?(Ce||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(d,Me,Y),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(d,Me,Y)),typeof O.componentDidUpdate=="function"&&(t.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof O.componentDidUpdate!="function"||G===e.memoizedProps&&Ne===e.memoizedState||(t.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||G===e.memoizedProps&&Ne===e.memoizedState||(t.flags|=1024),t.memoizedProps=d,t.memoizedState=Me),O.props=d,O.state=Me,O.context=Y,d=me):(typeof O.componentDidUpdate!="function"||G===e.memoizedProps&&Ne===e.memoizedState||(t.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||G===e.memoizedProps&&Ne===e.memoizedState||(t.flags|=1024),d=!1)}return cl(e,t,i,d,v,m)}function cl(e,t,i,d,m,v){wd(e,t);var O=(t.flags&128)!==0;if(!d&&!O)return m&&ju(t,i,!1),en(e,t,v);d=t.stateNode,Um.current=t;var G=O&&typeof i.getDerivedStateFromError!="function"?null:d.render();return t.flags|=1,e!==null&&O?(t.child=ms(t,e.child,null,v),t.child=ms(t,null,G,v)):nr(e,t,G,v),t.memoizedState=d.state,m&&ju(t,i,!0),t.child}function kd(e){var t=e.stateNode;t.pendingContext?Nu(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Nu(e,t.context,!1),Ha(e,t.containerInfo)}function Sd(e,t,i,d,m){return ps(),Ma(m),t.flags|=256,nr(e,t,i,d),t.child}var ul={dehydrated:null,treeContext:null,retryLane:0};function dl(e){return{baseLanes:e,cachePool:null,transitions:null}}function Nd(e,t,i){var d=t.pendingProps,m=Ct.current,v=!1,O=(t.flags&128)!==0,G;if((G=O)||(G=e!==null&&e.memoizedState===null?!1:(m&2)!==0),G?(v=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(m|=1),yt(Ct,m&1),e===null)return Ba(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(O=d.children,e=d.fallback,v?(d=t.mode,v=t.child,O={mode:"hidden",children:O},(d&1)===0&&v!==null?(v.childLanes=0,v.pendingProps=O):v=ko(O,d,0,null),e=qn(e,d,i,null),v.return=t,e.return=t,v.sibling=e,t.child=v,t.child.memoizedState=dl(i),t.memoizedState=ul,e):fl(t,O));if(m=e.memoizedState,m!==null&&(G=m.dehydrated,G!==null))return zm(e,t,O,d,G,m,i);if(v){v=d.fallback,O=t.mode,m=e.child,G=m.sibling;var Y={mode:"hidden",children:d.children};return(O&1)===0&&t.child!==m?(d=t.child,d.childLanes=0,d.pendingProps=Y,t.deletions=null):(d=Nn(m,Y),d.subtreeFlags=m.subtreeFlags&14680064),G!==null?v=Nn(G,v):(v=qn(v,O,i,null),v.flags|=2),v.return=t,d.return=t,d.sibling=v,t.child=d,d=v,v=t.child,O=e.child.memoizedState,O=O===null?dl(i):{baseLanes:O.baseLanes|i,cachePool:null,transitions:O.transitions},v.memoizedState=O,v.childLanes=e.childLanes&~i,t.memoizedState=ul,d}return v=e.child,e=v.sibling,d=Nn(v,{mode:"visible",children:d.children}),(t.mode&1)===0&&(d.lanes=i),d.return=t,d.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=d,t.memoizedState=null,d}function fl(e,t){return t=ko({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function lo(e,t,i,d){return d!==null&&Ma(d),ms(t,e.child,null,i),e=fl(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function zm(e,t,i,d,m,v,O){if(i)return t.flags&256?(t.flags&=-257,d=ol(Error(n(422))),lo(e,t,O,d)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(v=d.fallback,m=t.mode,d=ko({mode:"visible",children:d.children},m,0,null),v=qn(v,m,O,null),v.flags|=2,d.return=t,v.return=t,d.sibling=v,t.child=d,(t.mode&1)!==0&&ms(t,e.child,null,O),t.child.memoizedState=dl(O),t.memoizedState=ul,v);if((t.mode&1)===0)return lo(e,t,O,null);if(m.data==="$!"){if(d=m.nextSibling&&m.nextSibling.dataset,d)var G=d.dgst;return d=G,v=Error(n(419)),d=ol(v,d,void 0),lo(e,t,O,d)}if(G=(O&e.childLanes)!==0,ur||G){if(d=Wt,d!==null){switch(O&-O){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=(m&(d.suspendedLanes|O))!==0?0:m,m!==0&&m!==v.retryLane&&(v.retryLane=m,Yr(e,m),Lr(d,e,m,-1))}return _l(),d=ol(Error(n(421))),lo(e,t,O,d)}return m.data==="$?"?(t.flags|=128,t.child=e.child,t=eg.bind(null,e),m._reactRetry=t,null):(e=v.treeContext,gr=hn(m.nextSibling),mr=t,St=!0,Ar=null,e!==null&&(wr[br++]=Xr,wr[br++]=Zr,wr[br++]=Fn,Xr=e.id,Zr=e.overflow,Fn=t),t=fl(t,d.children),t.flags|=4096,t)}function Cd(e,t,i){e.lanes|=t;var d=e.alternate;d!==null&&(d.lanes|=t),Wa(e.return,t,i)}function hl(e,t,i,d,m){var v=e.memoizedState;v===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:d,tail:i,tailMode:m}:(v.isBackwards=t,v.rendering=null,v.renderingStartTime=0,v.last=d,v.tail=i,v.tailMode=m)}function jd(e,t,i){var d=t.pendingProps,m=d.revealOrder,v=d.tail;if(nr(e,t,d.children,i),d=Ct.current,(d&2)!==0)d=d&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Cd(e,i,t);else if(e.tag===19)Cd(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}d&=1}if(yt(Ct,d),(t.mode&1)===0)t.memoizedState=null;else switch(m){case"forwards":for(i=t.child,m=null;i!==null;)e=i.alternate,e!==null&&to(e)===null&&(m=i),i=i.sibling;i=m,i===null?(m=t.child,t.child=null):(m=i.sibling,i.sibling=null),hl(t,!1,m,i,v);break;case"backwards":for(i=null,m=t.child,t.child=null;m!==null;){if(e=m.alternate,e!==null&&to(e)===null){t.child=m;break}e=m.sibling,m.sibling=i,i=m,m=e}hl(t,!0,i,null,v);break;case"together":hl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function co(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function en(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),zn|=t.lanes,(i&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(n(153));if(t.child!==null){for(e=t.child,i=Nn(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Nn(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function $m(e,t,i){switch(t.tag){case 3:kd(t),ps();break;case 5:Uu(t);break;case 1:cr(t.type)&&qi(t);break;case 4:Ha(t,t.stateNode.containerInfo);break;case 10:var d=t.type._context,m=t.memoizedProps.value;yt(Zi,d._currentValue),d._currentValue=m;break;case 13:if(d=t.memoizedState,d!==null)return d.dehydrated!==null?(yt(Ct,Ct.current&1),t.flags|=128,null):(i&t.child.childLanes)!==0?Nd(e,t,i):(yt(Ct,Ct.current&1),e=en(e,t,i),e!==null?e.sibling:null);yt(Ct,Ct.current&1);break;case 19:if(d=(i&t.childLanes)!==0,(e.flags&128)!==0){if(d)return jd(e,t,i);t.flags|=128}if(m=t.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),yt(Ct,Ct.current),d)break;return null;case 22:case 23:return t.lanes=0,xd(e,t,i)}return en(e,t,i)}var Ed,pl,_d,Ad;Ed=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},pl=function(){},_d=function(e,t,i,d){var m=e.memoizedProps;if(m!==d){e=t.stateNode,Mn(Mr.current);var v=null;switch(i){case"input":m=j(e,m),d=j(e,d),v=[];break;case"select":m=ee({},m,{value:void 0}),d=ee({},d,{value:void 0}),v=[];break;case"textarea":m=X(e,m),d=X(e,d),v=[];break;default:typeof m.onClick!="function"&&typeof d.onClick=="function"&&(e.onclick=$i)}He(i,d);var O;i=null;for(me in m)if(!d.hasOwnProperty(me)&&m.hasOwnProperty(me)&&m[me]!=null)if(me==="style"){var G=m[me];for(O in G)G.hasOwnProperty(O)&&(i||(i={}),i[O]="")}else me!=="dangerouslySetInnerHTML"&&me!=="children"&&me!=="suppressContentEditableWarning"&&me!=="suppressHydrationWarning"&&me!=="autoFocus"&&(c.hasOwnProperty(me)?v||(v=[]):(v=v||[]).push(me,null));for(me in d){var Y=d[me];if(G=m?.[me],d.hasOwnProperty(me)&&Y!==G&&(Y!=null||G!=null))if(me==="style")if(G){for(O in G)!G.hasOwnProperty(O)||Y&&Y.hasOwnProperty(O)||(i||(i={}),i[O]="");for(O in Y)Y.hasOwnProperty(O)&&G[O]!==Y[O]&&(i||(i={}),i[O]=Y[O])}else i||(v||(v=[]),v.push(me,i)),i=Y;else me==="dangerouslySetInnerHTML"?(Y=Y?Y.__html:void 0,G=G?G.__html:void 0,Y!=null&&G!==Y&&(v=v||[]).push(me,Y)):me==="children"?typeof Y!="string"&&typeof Y!="number"||(v=v||[]).push(me,""+Y):me!=="suppressContentEditableWarning"&&me!=="suppressHydrationWarning"&&(c.hasOwnProperty(me)?(Y!=null&&me==="onScroll"&&xt("scroll",e),v||G===Y||(v=[])):(v=v||[]).push(me,Y))}i&&(v=v||[]).push("style",i);var me=v;(t.updateQueue=me)&&(t.flags|=4)}},Ad=function(e,t,i,d){i!==d&&(t.flags|=4)};function si(e,t){if(!St)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var d=null;i!==null;)i.alternate!==null&&(d=i),i=i.sibling;d===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:d.sibling=null}}function Yt(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,d=0;if(t)for(var m=e.child;m!==null;)i|=m.lanes|m.childLanes,d|=m.subtreeFlags&14680064,d|=m.flags&14680064,m.return=e,m=m.sibling;else for(m=e.child;m!==null;)i|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=e,m=m.sibling;return e.subtreeFlags|=d,e.childLanes=i,t}function Wm(e,t,i){var d=t.pendingProps;switch(Fa(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(t),null;case 1:return cr(t.type)&&Vi(),Yt(t),null;case 3:return d=t.stateNode,vs(),wt(lr),wt(Xt),Qa(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(e===null||e.child===null)&&(Qi(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Ar!==null&&(Cl(Ar),Ar=null))),pl(e,t),Yt(t),null;case 5:Ga(t);var m=Mn(Js.current);if(i=t.type,e!==null&&t.stateNode!=null)_d(e,t,i,d,m),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!d){if(t.stateNode===null)throw Error(n(166));return Yt(t),null}if(e=Mn(Mr.current),Qi(t)){d=t.stateNode,i=t.type;var v=t.memoizedProps;switch(d[Br]=t,d[Ks]=v,e=(t.mode&1)!==0,i){case"dialog":xt("cancel",d),xt("close",d);break;case"iframe":case"object":case"embed":xt("load",d);break;case"video":case"audio":for(m=0;m<qs.length;m++)xt(qs[m],d);break;case"source":xt("error",d);break;case"img":case"image":case"link":xt("error",d),xt("load",d);break;case"details":xt("toggle",d);break;case"input":he(d,v),xt("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!v.multiple},xt("invalid",d);break;case"textarea":_(d,v),xt("invalid",d)}He(i,v),m=null;for(var O in v)if(v.hasOwnProperty(O)){var G=v[O];O==="children"?typeof G=="string"?d.textContent!==G&&(v.suppressHydrationWarning!==!0&&zi(d.textContent,G,e),m=["children",G]):typeof G=="number"&&d.textContent!==""+G&&(v.suppressHydrationWarning!==!0&&zi(d.textContent,G,e),m=["children",""+G]):c.hasOwnProperty(O)&&G!=null&&O==="onScroll"&&xt("scroll",d)}switch(i){case"input":Ve(d),z(d,v,!0);break;case"textarea":Ve(d),M(d);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(d.onclick=$i)}d=m,t.updateQueue=d,d!==null&&(t.flags|=4)}else{O=m.nodeType===9?m:m.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=K(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=O.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof d.is=="string"?e=O.createElement(i,{is:d.is}):(e=O.createElement(i),i==="select"&&(O=e,d.multiple?O.multiple=!0:d.size&&(O.size=d.size))):e=O.createElementNS(e,i),e[Br]=t,e[Ks]=d,Ed(e,t,!1,!1),t.stateNode=e;e:{switch(O=nt(i,d),i){case"dialog":xt("cancel",e),xt("close",e),m=d;break;case"iframe":case"object":case"embed":xt("load",e),m=d;break;case"video":case"audio":for(m=0;m<qs.length;m++)xt(qs[m],e);m=d;break;case"source":xt("error",e),m=d;break;case"img":case"image":case"link":xt("error",e),xt("load",e),m=d;break;case"details":xt("toggle",e),m=d;break;case"input":he(e,d),m=j(e,d),xt("invalid",e);break;case"option":m=d;break;case"select":e._wrapperState={wasMultiple:!!d.multiple},m=ee({},d,{value:void 0}),xt("invalid",e);break;case"textarea":_(e,d),m=X(e,d),xt("invalid",e);break;default:m=d}He(i,m),G=m;for(v in G)if(G.hasOwnProperty(v)){var Y=G[v];v==="style"?qe(e,Y):v==="dangerouslySetInnerHTML"?(Y=Y?Y.__html:void 0,Y!=null&&we(e,Y)):v==="children"?typeof Y=="string"?(i!=="textarea"||Y!=="")&&ve(e,Y):typeof Y=="number"&&ve(e,""+Y):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(c.hasOwnProperty(v)?Y!=null&&v==="onScroll"&&xt("scroll",e):Y!=null&&L(e,v,Y,O))}switch(i){case"input":Ve(e),z(e,d,!1);break;case"textarea":Ve(e),M(e);break;case"option":d.value!=null&&e.setAttribute("value",""+ke(d.value));break;case"select":e.multiple=!!d.multiple,v=d.value,v!=null?ue(e,!!d.multiple,v,!1):d.defaultValue!=null&&ue(e,!!d.multiple,d.defaultValue,!0);break;default:typeof m.onClick=="function"&&(e.onclick=$i)}switch(i){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Yt(t),null;case 6:if(e&&t.stateNode!=null)Ad(e,t,e.memoizedProps,d);else{if(typeof d!="string"&&t.stateNode===null)throw Error(n(166));if(i=Mn(Js.current),Mn(Mr.current),Qi(t)){if(d=t.stateNode,i=t.memoizedProps,d[Br]=t,(v=d.nodeValue!==i)&&(e=mr,e!==null))switch(e.tag){case 3:zi(d.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&zi(d.nodeValue,i,(e.mode&1)!==0)}v&&(t.flags|=4)}else d=(i.nodeType===9?i:i.ownerDocument).createTextNode(d),d[Br]=t,t.stateNode=d}return Yt(t),null;case 13:if(wt(Ct),d=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(St&&gr!==null&&(t.mode&1)!==0&&(t.flags&128)===0)Pu(),ps(),t.flags|=98560,v=!1;else if(v=Qi(t),d!==null&&d.dehydrated!==null){if(e===null){if(!v)throw Error(n(318));if(v=t.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(n(317));v[Br]=t}else ps(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Yt(t),v=!1}else Ar!==null&&(Cl(Ar),Ar=null),v=!0;if(!v)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=i,t):(d=d!==null,d!==(e!==null&&e.memoizedState!==null)&&d&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(Ct.current&1)!==0?Dt===0&&(Dt=3):_l())),t.updateQueue!==null&&(t.flags|=4),Yt(t),null);case 4:return vs(),pl(e,t),e===null&&Hs(t.stateNode.containerInfo),Yt(t),null;case 10:return $a(t.type._context),Yt(t),null;case 17:return cr(t.type)&&Vi(),Yt(t),null;case 19:if(wt(Ct),v=t.memoizedState,v===null)return Yt(t),null;if(d=(t.flags&128)!==0,O=v.rendering,O===null)if(d)si(v,!1);else{if(Dt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(O=to(e),O!==null){for(t.flags|=128,si(v,!1),d=O.updateQueue,d!==null&&(t.updateQueue=d,t.flags|=4),t.subtreeFlags=0,d=i,i=t.child;i!==null;)v=i,e=d,v.flags&=14680066,O=v.alternate,O===null?(v.childLanes=0,v.lanes=e,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=O.childLanes,v.lanes=O.lanes,v.child=O.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=O.memoizedProps,v.memoizedState=O.memoizedState,v.updateQueue=O.updateQueue,v.type=O.type,e=O.dependencies,v.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return yt(Ct,Ct.current&1|2),t.child}e=e.sibling}v.tail!==null&&Nt()>ks&&(t.flags|=128,d=!0,si(v,!1),t.lanes=4194304)}else{if(!d)if(e=to(O),e!==null){if(t.flags|=128,d=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),si(v,!0),v.tail===null&&v.tailMode==="hidden"&&!O.alternate&&!St)return Yt(t),null}else 2*Nt()-v.renderingStartTime>ks&&i!==1073741824&&(t.flags|=128,d=!0,si(v,!1),t.lanes=4194304);v.isBackwards?(O.sibling=t.child,t.child=O):(i=v.last,i!==null?i.sibling=O:t.child=O,v.last=O)}return v.tail!==null?(t=v.tail,v.rendering=t,v.tail=t.sibling,v.renderingStartTime=Nt(),t.sibling=null,i=Ct.current,yt(Ct,d?i&1|2:i&1),t):(Yt(t),null);case 22:case 23:return El(),d=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==d&&(t.flags|=8192),d&&(t.mode&1)!==0?(yr&1073741824)!==0&&(Yt(t),t.subtreeFlags&6&&(t.flags|=8192)):Yt(t),null;case 24:return null;case 25:return null}throw Error(n(156,t.tag))}function Vm(e,t){switch(Fa(t),t.tag){case 1:return cr(t.type)&&Vi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return vs(),wt(lr),wt(Xt),Qa(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return Ga(t),null;case 13:if(wt(Ct),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(n(340));ps()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return wt(Ct),null;case 4:return vs(),null;case 10:return $a(t.type._context),null;case 22:case 23:return El(),null;case 24:return null;default:return null}}var uo=!1,Jt=!1,qm=typeof WeakSet=="function"?WeakSet:Set,Fe=null;function ws(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(d){Et(e,t,d)}else i.current=null}function ml(e,t,i){try{i()}catch(d){Et(e,t,d)}}var Td=!1;function Hm(e,t){if(Ea=Ti,e=lu(),xa(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var d=i.getSelection&&i.getSelection();if(d&&d.rangeCount!==0){i=d.anchorNode;var m=d.anchorOffset,v=d.focusNode;d=d.focusOffset;try{i.nodeType,v.nodeType}catch{i=null;break e}var O=0,G=-1,Y=-1,me=0,Ce=0,Ee=e,Ne=null;t:for(;;){for(var Oe;Ee!==i||m!==0&&Ee.nodeType!==3||(G=O+m),Ee!==v||d!==0&&Ee.nodeType!==3||(Y=O+d),Ee.nodeType===3&&(O+=Ee.nodeValue.length),(Oe=Ee.firstChild)!==null;)Ne=Ee,Ee=Oe;for(;;){if(Ee===e)break t;if(Ne===i&&++me===m&&(G=O),Ne===v&&++Ce===d&&(Y=O),(Oe=Ee.nextSibling)!==null)break;Ee=Ne,Ne=Ee.parentNode}Ee=Oe}i=G===-1||Y===-1?null:{start:G,end:Y}}else i=null}i=i||{start:0,end:0}}else i=null;for(_a={focusedElem:e,selectionRange:i},Ti=!1,Fe=t;Fe!==null;)if(t=Fe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Fe=e;else for(;Fe!==null;){t=Fe;try{var Me=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(Me!==null){var $e=Me.memoizedProps,At=Me.memoizedState,le=t.stateNode,se=le.getSnapshotBeforeUpdate(t.elementType===t.type?$e:Tr(t.type,$e),At);le.__reactInternalSnapshotBeforeUpdate=se}break;case 3:var pe=t.stateNode.containerInfo;pe.nodeType===1?pe.textContent="":pe.nodeType===9&&pe.documentElement&&pe.removeChild(pe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Re){Et(t,t.return,Re)}if(e=t.sibling,e!==null){e.return=t.return,Fe=e;break}Fe=t.return}return Me=Td,Td=!1,Me}function ii(e,t,i){var d=t.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&e)===e){var v=m.destroy;m.destroy=void 0,v!==void 0&&ml(t,i,v)}m=m.next}while(m!==d)}}function fo(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var d=i.create;i.destroy=d()}i=i.next}while(i!==t)}}function gl(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function Rd(e){var t=e.alternate;t!==null&&(e.alternate=null,Rd(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Br],delete t[Ks],delete t[Pa],delete t[_m],delete t[Am])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Pd(e){return e.tag===5||e.tag===3||e.tag===4}function Ld(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Pd(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function yl(e,t,i){var d=e.tag;if(d===5||d===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=$i));else if(d!==4&&(e=e.child,e!==null))for(yl(e,t,i),e=e.sibling;e!==null;)yl(e,t,i),e=e.sibling}function vl(e,t,i){var d=e.tag;if(d===5||d===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(d!==4&&(e=e.child,e!==null))for(vl(e,t,i),e=e.sibling;e!==null;)vl(e,t,i),e=e.sibling}var Kt=null,Rr=!1;function xn(e,t,i){for(i=i.child;i!==null;)Od(e,t,i),i=i.sibling}function Od(e,t,i){if(pt&&typeof pt.onCommitFiberUnmount=="function")try{pt.onCommitFiberUnmount(ot,i)}catch{}switch(i.tag){case 5:Jt||ws(i,t);case 6:var d=Kt,m=Rr;Kt=null,xn(e,t,i),Kt=d,Rr=m,Kt!==null&&(Rr?(e=Kt,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):Kt.removeChild(i.stateNode));break;case 18:Kt!==null&&(Rr?(e=Kt,i=i.stateNode,e.nodeType===8?Ra(e.parentNode,i):e.nodeType===1&&Ra(e,i),Ds(e)):Ra(Kt,i.stateNode));break;case 4:d=Kt,m=Rr,Kt=i.stateNode.containerInfo,Rr=!0,xn(e,t,i),Kt=d,Rr=m;break;case 0:case 11:case 14:case 15:if(!Jt&&(d=i.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){m=d=d.next;do{var v=m,O=v.destroy;v=v.tag,O!==void 0&&((v&2)!==0||(v&4)!==0)&&ml(i,t,O),m=m.next}while(m!==d)}xn(e,t,i);break;case 1:if(!Jt&&(ws(i,t),d=i.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=i.memoizedProps,d.state=i.memoizedState,d.componentWillUnmount()}catch(G){Et(i,t,G)}xn(e,t,i);break;case 21:xn(e,t,i);break;case 22:i.mode&1?(Jt=(d=Jt)||i.memoizedState!==null,xn(e,t,i),Jt=d):xn(e,t,i);break;default:xn(e,t,i)}}function Id(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new qm),t.forEach(function(d){var m=tg.bind(null,e,d);i.has(d)||(i.add(d),d.then(m,m))})}}function Pr(e,t){var i=t.deletions;if(i!==null)for(var d=0;d<i.length;d++){var m=i[d];try{var v=e,O=t,G=O;e:for(;G!==null;){switch(G.tag){case 5:Kt=G.stateNode,Rr=!1;break e;case 3:Kt=G.stateNode.containerInfo,Rr=!0;break e;case 4:Kt=G.stateNode.containerInfo,Rr=!0;break e}G=G.return}if(Kt===null)throw Error(n(160));Od(v,O,m),Kt=null,Rr=!1;var Y=m.alternate;Y!==null&&(Y.return=null),m.return=null}catch(me){Et(m,t,me)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Fd(t,e),t=t.sibling}function Fd(e,t){var i=e.alternate,d=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Pr(t,e),zr(e),d&4){try{ii(3,e,e.return),fo(3,e)}catch($e){Et(e,e.return,$e)}try{ii(5,e,e.return)}catch($e){Et(e,e.return,$e)}}break;case 1:Pr(t,e),zr(e),d&512&&i!==null&&ws(i,i.return);break;case 5:if(Pr(t,e),zr(e),d&512&&i!==null&&ws(i,i.return),e.flags&32){var m=e.stateNode;try{ve(m,"")}catch($e){Et(e,e.return,$e)}}if(d&4&&(m=e.stateNode,m!=null)){var v=e.memoizedProps,O=i!==null?i.memoizedProps:v,G=e.type,Y=e.updateQueue;if(e.updateQueue=null,Y!==null)try{G==="input"&&v.type==="radio"&&v.name!=null&&de(m,v),nt(G,O);var me=nt(G,v);for(O=0;O<Y.length;O+=2){var Ce=Y[O],Ee=Y[O+1];Ce==="style"?qe(m,Ee):Ce==="dangerouslySetInnerHTML"?we(m,Ee):Ce==="children"?ve(m,Ee):L(m,Ce,Ee,me)}switch(G){case"input":q(m,v);break;case"textarea":E(m,v);break;case"select":var Ne=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!v.multiple;var Oe=v.value;Oe!=null?ue(m,!!v.multiple,Oe,!1):Ne!==!!v.multiple&&(v.defaultValue!=null?ue(m,!!v.multiple,v.defaultValue,!0):ue(m,!!v.multiple,v.multiple?[]:"",!1))}m[Ks]=v}catch($e){Et(e,e.return,$e)}}break;case 6:if(Pr(t,e),zr(e),d&4){if(e.stateNode===null)throw Error(n(162));m=e.stateNode,v=e.memoizedProps;try{m.nodeValue=v}catch($e){Et(e,e.return,$e)}}break;case 3:if(Pr(t,e),zr(e),d&4&&i!==null&&i.memoizedState.isDehydrated)try{Ds(t.containerInfo)}catch($e){Et(e,e.return,$e)}break;case 4:Pr(t,e),zr(e);break;case 13:Pr(t,e),zr(e),m=e.child,m.flags&8192&&(v=m.memoizedState!==null,m.stateNode.isHidden=v,!v||m.alternate!==null&&m.alternate.memoizedState!==null||(bl=Nt())),d&4&&Id(e);break;case 22:if(Ce=i!==null&&i.memoizedState!==null,e.mode&1?(Jt=(me=Jt)||Ce,Pr(t,e),Jt=me):Pr(t,e),zr(e),d&8192){if(me=e.memoizedState!==null,(e.stateNode.isHidden=me)&&!Ce&&(e.mode&1)!==0)for(Fe=e,Ce=e.child;Ce!==null;){for(Ee=Fe=Ce;Fe!==null;){switch(Ne=Fe,Oe=Ne.child,Ne.tag){case 0:case 11:case 14:case 15:ii(4,Ne,Ne.return);break;case 1:ws(Ne,Ne.return);var Me=Ne.stateNode;if(typeof Me.componentWillUnmount=="function"){d=Ne,i=Ne.return;try{t=d,Me.props=t.memoizedProps,Me.state=t.memoizedState,Me.componentWillUnmount()}catch($e){Et(d,i,$e)}}break;case 5:ws(Ne,Ne.return);break;case 22:if(Ne.memoizedState!==null){Md(Ee);continue}}Oe!==null?(Oe.return=Ne,Fe=Oe):Md(Ee)}Ce=Ce.sibling}e:for(Ce=null,Ee=e;;){if(Ee.tag===5){if(Ce===null){Ce=Ee;try{m=Ee.stateNode,me?(v=m.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(G=Ee.stateNode,Y=Ee.memoizedProps.style,O=Y!=null&&Y.hasOwnProperty("display")?Y.display:null,G.style.display=Pe("display",O))}catch($e){Et(e,e.return,$e)}}}else if(Ee.tag===6){if(Ce===null)try{Ee.stateNode.nodeValue=me?"":Ee.memoizedProps}catch($e){Et(e,e.return,$e)}}else if((Ee.tag!==22&&Ee.tag!==23||Ee.memoizedState===null||Ee===e)&&Ee.child!==null){Ee.child.return=Ee,Ee=Ee.child;continue}if(Ee===e)break e;for(;Ee.sibling===null;){if(Ee.return===null||Ee.return===e)break e;Ce===Ee&&(Ce=null),Ee=Ee.return}Ce===Ee&&(Ce=null),Ee.sibling.return=Ee.return,Ee=Ee.sibling}}break;case 19:Pr(t,e),zr(e),d&4&&Id(e);break;case 21:break;default:Pr(t,e),zr(e)}}function zr(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(Pd(i)){var d=i;break e}i=i.return}throw Error(n(160))}switch(d.tag){case 5:var m=d.stateNode;d.flags&32&&(ve(m,""),d.flags&=-33);var v=Ld(e);vl(e,v,m);break;case 3:case 4:var O=d.stateNode.containerInfo,G=Ld(e);yl(e,G,O);break;default:throw Error(n(161))}}catch(Y){Et(e,e.return,Y)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Gm(e,t,i){Fe=e,Dd(e)}function Dd(e,t,i){for(var d=(e.mode&1)!==0;Fe!==null;){var m=Fe,v=m.child;if(m.tag===22&&d){var O=m.memoizedState!==null||uo;if(!O){var G=m.alternate,Y=G!==null&&G.memoizedState!==null||Jt;G=uo;var me=Jt;if(uo=O,(Jt=Y)&&!me)for(Fe=m;Fe!==null;)O=Fe,Y=O.child,O.tag===22&&O.memoizedState!==null?Ud(m):Y!==null?(Y.return=O,Fe=Y):Ud(m);for(;v!==null;)Fe=v,Dd(v),v=v.sibling;Fe=m,uo=G,Jt=me}Bd(e)}else(m.subtreeFlags&8772)!==0&&v!==null?(v.return=m,Fe=v):Bd(e)}}function Bd(e){for(;Fe!==null;){var t=Fe;if((t.flags&8772)!==0){var i=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:Jt||fo(5,t);break;case 1:var d=t.stateNode;if(t.flags&4&&!Jt)if(i===null)d.componentDidMount();else{var m=t.elementType===t.type?i.memoizedProps:Tr(t.type,i.memoizedProps);d.componentDidUpdate(m,i.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var v=t.updateQueue;v!==null&&Mu(t,v,d);break;case 3:var O=t.updateQueue;if(O!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}Mu(t,O,i)}break;case 5:var G=t.stateNode;if(i===null&&t.flags&4){i=G;var Y=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":Y.autoFocus&&i.focus();break;case"img":Y.src&&(i.src=Y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var me=t.alternate;if(me!==null){var Ce=me.memoizedState;if(Ce!==null){var Ee=Ce.dehydrated;Ee!==null&&Ds(Ee)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Jt||t.flags&512&&gl(t)}catch(Ne){Et(t,t.return,Ne)}}if(t===e){Fe=null;break}if(i=t.sibling,i!==null){i.return=t.return,Fe=i;break}Fe=t.return}}function Md(e){for(;Fe!==null;){var t=Fe;if(t===e){Fe=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Fe=i;break}Fe=t.return}}function Ud(e){for(;Fe!==null;){var t=Fe;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{fo(4,t)}catch(Y){Et(t,i,Y)}break;case 1:var d=t.stateNode;if(typeof d.componentDidMount=="function"){var m=t.return;try{d.componentDidMount()}catch(Y){Et(t,m,Y)}}var v=t.return;try{gl(t)}catch(Y){Et(t,v,Y)}break;case 5:var O=t.return;try{gl(t)}catch(Y){Et(t,O,Y)}}}catch(Y){Et(t,t.return,Y)}if(t===e){Fe=null;break}var G=t.sibling;if(G!==null){G.return=t.return,Fe=G;break}Fe=t.return}}var Km=Math.ceil,ho=T.ReactCurrentDispatcher,xl=T.ReactCurrentOwner,Nr=T.ReactCurrentBatchConfig,lt=0,Wt=null,Ot=null,Qt=0,yr=0,bs=pn(0),Dt=0,oi=null,zn=0,po=0,wl=0,ai=null,dr=null,bl=0,ks=1/0,tn=null,mo=!1,kl=null,wn=null,go=!1,bn=null,yo=0,li=0,Sl=null,vo=-1,xo=0;function sr(){return(lt&6)!==0?Nt():vo!==-1?vo:vo=Nt()}function kn(e){return(e.mode&1)===0?1:(lt&2)!==0&&Qt!==0?Qt&-Qt:Rm.transition!==null?(xo===0&&(xo=Lc()),xo):(e=dt,e!==0||(e=window.event,e=e===void 0?16:$c(e.type)),e)}function Lr(e,t,i,d){if(50<li)throw li=0,Sl=null,Error(n(185));Ps(e,i,d),((lt&2)===0||e!==Wt)&&(e===Wt&&((lt&2)===0&&(po|=i),Dt===4&&Sn(e,Qt)),fr(e,d),i===1&&lt===0&&(t.mode&1)===0&&(ks=Nt()+500,Hi&&gn()))}function fr(e,t){var i=e.callbackNode;Rp(e,t);var d=on(e,e===Wt?Qt:0);if(d===0)i!==null&&Ei(i),e.callbackNode=null,e.callbackPriority=0;else if(t=d&-d,e.callbackPriority!==t){if(i!=null&&Ei(i),t===1)e.tag===0?Tm($d.bind(null,e)):Eu($d.bind(null,e)),jm(function(){(lt&6)===0&&gn()}),i=null;else{switch(Oc(d)){case 1:i=xe;break;case 4:i=Ie;break;case 16:i=Ue;break;case 536870912:i=ze;break;default:i=Ue}i=Xd(i,zd.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function zd(e,t){if(vo=-1,xo=0,(lt&6)!==0)throw Error(n(327));var i=e.callbackNode;if(Ss()&&e.callbackNode!==i)return null;var d=on(e,e===Wt?Qt:0);if(d===0)return null;if((d&30)!==0||(d&e.expiredLanes)!==0||t)t=wo(e,d);else{t=d;var m=lt;lt|=2;var v=Vd();(Wt!==e||Qt!==t)&&(tn=null,ks=Nt()+500,Wn(e,t));do try{Zm();break}catch(G){Wd(e,G)}while(!0);za(),ho.current=v,lt=m,Ot!==null?t=0:(Wt=null,Qt=0,t=Dt)}if(t!==0){if(t===2&&(m=na(e),m!==0&&(d=m,t=Nl(e,m))),t===1)throw i=oi,Wn(e,0),Sn(e,d),fr(e,Nt()),i;if(t===6)Sn(e,d);else{if(m=e.current.alternate,(d&30)===0&&!Qm(m)&&(t=wo(e,d),t===2&&(v=na(e),v!==0&&(d=v,t=Nl(e,v))),t===1))throw i=oi,Wn(e,0),Sn(e,d),fr(e,Nt()),i;switch(e.finishedWork=m,e.finishedLanes=d,t){case 0:case 1:throw Error(n(345));case 2:Vn(e,dr,tn);break;case 3:if(Sn(e,d),(d&130023424)===d&&(t=bl+500-Nt(),10<t)){if(on(e,0)!==0)break;if(m=e.suspendedLanes,(m&d)!==d){sr(),e.pingedLanes|=e.suspendedLanes&m;break}e.timeoutHandle=Ta(Vn.bind(null,e,dr,tn),t);break}Vn(e,dr,tn);break;case 4:if(Sn(e,d),(d&4194240)===d)break;for(t=e.eventTimes,m=-1;0<d;){var O=31-gt(d);v=1<<O,O=t[O],O>m&&(m=O),d&=~v}if(d=m,d=Nt()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*Km(d/1960))-d,10<d){e.timeoutHandle=Ta(Vn.bind(null,e,dr,tn),d);break}Vn(e,dr,tn);break;case 5:Vn(e,dr,tn);break;default:throw Error(n(329))}}}return fr(e,Nt()),e.callbackNode===i?zd.bind(null,e):null}function Nl(e,t){var i=ai;return e.current.memoizedState.isDehydrated&&(Wn(e,t).flags|=256),e=wo(e,t),e!==2&&(t=dr,dr=i,t!==null&&Cl(t)),e}function Cl(e){dr===null?dr=e:dr.push.apply(dr,e)}function Qm(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var d=0;d<i.length;d++){var m=i[d],v=m.getSnapshot;m=m.value;try{if(!_r(v(),m))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Sn(e,t){for(t&=~wl,t&=~po,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-gt(t),d=1<<i;e[i]=-1,t&=~d}}function $d(e){if((lt&6)!==0)throw Error(n(327));Ss();var t=on(e,0);if((t&1)===0)return fr(e,Nt()),null;var i=wo(e,t);if(e.tag!==0&&i===2){var d=na(e);d!==0&&(t=d,i=Nl(e,d))}if(i===1)throw i=oi,Wn(e,0),Sn(e,t),fr(e,Nt()),i;if(i===6)throw Error(n(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Vn(e,dr,tn),fr(e,Nt()),null}function jl(e,t){var i=lt;lt|=1;try{return e(t)}finally{lt=i,lt===0&&(ks=Nt()+500,Hi&&gn())}}function $n(e){bn!==null&&bn.tag===0&&(lt&6)===0&&Ss();var t=lt;lt|=1;var i=Nr.transition,d=dt;try{if(Nr.transition=null,dt=1,e)return e()}finally{dt=d,Nr.transition=i,lt=t,(lt&6)===0&&gn()}}function El(){yr=bs.current,wt(bs)}function Wn(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,Cm(i)),Ot!==null)for(i=Ot.return;i!==null;){var d=i;switch(Fa(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&Vi();break;case 3:vs(),wt(lr),wt(Xt),Qa();break;case 5:Ga(d);break;case 4:vs();break;case 13:wt(Ct);break;case 19:wt(Ct);break;case 10:$a(d.type._context);break;case 22:case 23:El()}i=i.return}if(Wt=e,Ot=e=Nn(e.current,null),Qt=yr=t,Dt=0,oi=null,wl=po=zn=0,dr=ai=null,Bn!==null){for(t=0;t<Bn.length;t++)if(i=Bn[t],d=i.interleaved,d!==null){i.interleaved=null;var m=d.next,v=i.pending;if(v!==null){var O=v.next;v.next=m,d.next=O}i.pending=d}Bn=null}return e}function Wd(e,t){do{var i=Ot;try{if(za(),ro.current=oo,no){for(var d=jt.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}no=!1}if(Un=0,$t=Ft=jt=null,ei=!1,ti=0,xl.current=null,i===null||i.return===null){Dt=1,oi=t,Ot=null;break}e:{var v=e,O=i.return,G=i,Y=t;if(t=Qt,G.flags|=32768,Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var me=Y,Ce=G,Ee=Ce.tag;if((Ce.mode&1)===0&&(Ee===0||Ee===11||Ee===15)){var Ne=Ce.alternate;Ne?(Ce.updateQueue=Ne.updateQueue,Ce.memoizedState=Ne.memoizedState,Ce.lanes=Ne.lanes):(Ce.updateQueue=null,Ce.memoizedState=null)}var Oe=pd(O);if(Oe!==null){Oe.flags&=-257,md(Oe,O,G,v,t),Oe.mode&1&&hd(v,me,t),t=Oe,Y=me;var Me=t.updateQueue;if(Me===null){var $e=new Set;$e.add(Y),t.updateQueue=$e}else Me.add(Y);break e}else{if((t&1)===0){hd(v,me,t),_l();break e}Y=Error(n(426))}}else if(St&&G.mode&1){var At=pd(O);if(At!==null){(At.flags&65536)===0&&(At.flags|=256),md(At,O,G,v,t),Ma(xs(Y,G));break e}}v=Y=xs(Y,G),Dt!==4&&(Dt=2),ai===null?ai=[v]:ai.push(v),v=O;do{switch(v.tag){case 3:v.flags|=65536,t&=-t,v.lanes|=t;var le=dd(v,Y,t);Bu(v,le);break e;case 1:G=Y;var se=v.type,pe=v.stateNode;if((v.flags&128)===0&&(typeof se.getDerivedStateFromError=="function"||pe!==null&&typeof pe.componentDidCatch=="function"&&(wn===null||!wn.has(pe)))){v.flags|=65536,t&=-t,v.lanes|=t;var Re=fd(v,G,t);Bu(v,Re);break e}}v=v.return}while(v!==null)}Hd(i)}catch(We){t=We,Ot===i&&i!==null&&(Ot=i=i.return);continue}break}while(!0)}function Vd(){var e=ho.current;return ho.current=oo,e===null?oo:e}function _l(){(Dt===0||Dt===3||Dt===2)&&(Dt=4),Wt===null||(zn&268435455)===0&&(po&268435455)===0||Sn(Wt,Qt)}function wo(e,t){var i=lt;lt|=2;var d=Vd();(Wt!==e||Qt!==t)&&(tn=null,Wn(e,t));do try{Xm();break}catch(m){Wd(e,m)}while(!0);if(za(),lt=i,ho.current=d,Ot!==null)throw Error(n(261));return Wt=null,Qt=0,Dt}function Xm(){for(;Ot!==null;)qd(Ot)}function Zm(){for(;Ot!==null&&!ea();)qd(Ot)}function qd(e){var t=Qd(e.alternate,e,yr);e.memoizedProps=e.pendingProps,t===null?Hd(e):Ot=t,xl.current=null}function Hd(e){var t=e;do{var i=t.alternate;if(e=t.return,(t.flags&32768)===0){if(i=Wm(i,t,yr),i!==null){Ot=i;return}}else{if(i=Vm(i,t),i!==null){i.flags&=32767,Ot=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Dt=6,Ot=null;return}}if(t=t.sibling,t!==null){Ot=t;return}Ot=t=e}while(t!==null);Dt===0&&(Dt=5)}function Vn(e,t,i){var d=dt,m=Nr.transition;try{Nr.transition=null,dt=1,Ym(e,t,i,d)}finally{Nr.transition=m,dt=d}return null}function Ym(e,t,i,d){do Ss();while(bn!==null);if((lt&6)!==0)throw Error(n(327));i=e.finishedWork;var m=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(n(177));e.callbackNode=null,e.callbackPriority=0;var v=i.lanes|i.childLanes;if(Pp(e,v),e===Wt&&(Ot=Wt=null,Qt=0),(i.subtreeFlags&2064)===0&&(i.flags&2064)===0||go||(go=!0,Xd(Ue,function(){return Ss(),null})),v=(i.flags&15990)!==0,(i.subtreeFlags&15990)!==0||v){v=Nr.transition,Nr.transition=null;var O=dt;dt=1;var G=lt;lt|=4,xl.current=null,Hm(e,i),Fd(i,e),vm(_a),Ti=!!Ea,_a=Ea=null,e.current=i,Gm(i),ta(),lt=G,dt=O,Nr.transition=v}else e.current=i;if(go&&(go=!1,bn=e,yo=m),v=e.pendingLanes,v===0&&(wn=null),sn(i.stateNode),fr(e,Nt()),t!==null)for(d=e.onRecoverableError,i=0;i<t.length;i++)m=t[i],d(m.value,{componentStack:m.stack,digest:m.digest});if(mo)throw mo=!1,e=kl,kl=null,e;return(yo&1)!==0&&e.tag!==0&&Ss(),v=e.pendingLanes,(v&1)!==0?e===Sl?li++:(li=0,Sl=e):li=0,gn(),null}function Ss(){if(bn!==null){var e=Oc(yo),t=Nr.transition,i=dt;try{if(Nr.transition=null,dt=16>e?16:e,bn===null)var d=!1;else{if(e=bn,bn=null,yo=0,(lt&6)!==0)throw Error(n(331));var m=lt;for(lt|=4,Fe=e.current;Fe!==null;){var v=Fe,O=v.child;if((Fe.flags&16)!==0){var G=v.deletions;if(G!==null){for(var Y=0;Y<G.length;Y++){var me=G[Y];for(Fe=me;Fe!==null;){var Ce=Fe;switch(Ce.tag){case 0:case 11:case 15:ii(8,Ce,v)}var Ee=Ce.child;if(Ee!==null)Ee.return=Ce,Fe=Ee;else for(;Fe!==null;){Ce=Fe;var Ne=Ce.sibling,Oe=Ce.return;if(Rd(Ce),Ce===me){Fe=null;break}if(Ne!==null){Ne.return=Oe,Fe=Ne;break}Fe=Oe}}}var Me=v.alternate;if(Me!==null){var $e=Me.child;if($e!==null){Me.child=null;do{var At=$e.sibling;$e.sibling=null,$e=At}while($e!==null)}}Fe=v}}if((v.subtreeFlags&2064)!==0&&O!==null)O.return=v,Fe=O;else e:for(;Fe!==null;){if(v=Fe,(v.flags&2048)!==0)switch(v.tag){case 0:case 11:case 15:ii(9,v,v.return)}var le=v.sibling;if(le!==null){le.return=v.return,Fe=le;break e}Fe=v.return}}var se=e.current;for(Fe=se;Fe!==null;){O=Fe;var pe=O.child;if((O.subtreeFlags&2064)!==0&&pe!==null)pe.return=O,Fe=pe;else e:for(O=se;Fe!==null;){if(G=Fe,(G.flags&2048)!==0)try{switch(G.tag){case 0:case 11:case 15:fo(9,G)}}catch(We){Et(G,G.return,We)}if(G===O){Fe=null;break e}var Re=G.sibling;if(Re!==null){Re.return=G.return,Fe=Re;break e}Fe=G.return}}if(lt=m,gn(),pt&&typeof pt.onPostCommitFiberRoot=="function")try{pt.onPostCommitFiberRoot(ot,e)}catch{}d=!0}return d}finally{dt=i,Nr.transition=t}}return!1}function Gd(e,t,i){t=xs(i,t),t=dd(e,t,1),e=vn(e,t,1),t=sr(),e!==null&&(Ps(e,1,t),fr(e,t))}function Et(e,t,i){if(e.tag===3)Gd(e,e,i);else for(;t!==null;){if(t.tag===3){Gd(t,e,i);break}else if(t.tag===1){var d=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(wn===null||!wn.has(d))){e=xs(i,e),e=fd(t,e,1),t=vn(t,e,1),e=sr(),t!==null&&(Ps(t,1,e),fr(t,e));break}}t=t.return}}function Jm(e,t,i){var d=e.pingCache;d!==null&&d.delete(t),t=sr(),e.pingedLanes|=e.suspendedLanes&i,Wt===e&&(Qt&i)===i&&(Dt===4||Dt===3&&(Qt&130023424)===Qt&&500>Nt()-bl?Wn(e,0):wl|=i),fr(e,t)}function Kd(e,t){t===0&&((e.mode&1)===0?t=1:(t=zt,zt<<=1,(zt&130023424)===0&&(zt=4194304)));var i=sr();e=Yr(e,t),e!==null&&(Ps(e,t,i),fr(e,i))}function eg(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),Kd(e,i)}function tg(e,t){var i=0;switch(e.tag){case 13:var d=e.stateNode,m=e.memoizedState;m!==null&&(i=m.retryLane);break;case 19:d=e.stateNode;break;default:throw Error(n(314))}d!==null&&d.delete(t),Kd(e,i)}var Qd;Qd=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||lr.current)ur=!0;else{if((e.lanes&i)===0&&(t.flags&128)===0)return ur=!1,$m(e,t,i);ur=(e.flags&131072)!==0}else ur=!1,St&&(t.flags&1048576)!==0&&_u(t,Ki,t.index);switch(t.lanes=0,t.tag){case 2:var d=t.type;co(e,t),e=t.pendingProps;var m=ds(t,Xt.current);ys(t,i),m=Ya(null,t,d,e,m,i);var v=Ja();return t.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,cr(d)?(v=!0,qi(t)):v=!1,t.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,qa(t),m.updater=ao,t.stateNode=m,m._reactInternals=t,il(t,d,e,i),t=cl(null,t,d,!0,v,i)):(t.tag=0,St&&v&&Ia(t),nr(null,t,m,i),t=t.child),t;case 16:d=t.elementType;e:{switch(co(e,t),e=t.pendingProps,m=d._init,d=m(d._payload),t.type=d,m=t.tag=ng(d),e=Tr(d,e),m){case 0:t=ll(null,t,d,e,i);break e;case 1:t=bd(null,t,d,e,i);break e;case 11:t=gd(null,t,d,e,i);break e;case 14:t=yd(null,t,d,Tr(d.type,e),i);break e}throw Error(n(306,d,""))}return t;case 0:return d=t.type,m=t.pendingProps,m=t.elementType===d?m:Tr(d,m),ll(e,t,d,m,i);case 1:return d=t.type,m=t.pendingProps,m=t.elementType===d?m:Tr(d,m),bd(e,t,d,m,i);case 3:e:{if(kd(t),e===null)throw Error(n(387));d=t.pendingProps,v=t.memoizedState,m=v.element,Du(e,t),eo(t,d,null,i);var O=t.memoizedState;if(d=O.element,v.isDehydrated)if(v={element:d,isDehydrated:!1,cache:O.cache,pendingSuspenseBoundaries:O.pendingSuspenseBoundaries,transitions:O.transitions},t.updateQueue.baseState=v,t.memoizedState=v,t.flags&256){m=xs(Error(n(423)),t),t=Sd(e,t,d,i,m);break e}else if(d!==m){m=xs(Error(n(424)),t),t=Sd(e,t,d,i,m);break e}else for(gr=hn(t.stateNode.containerInfo.firstChild),mr=t,St=!0,Ar=null,i=Iu(t,null,d,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(ps(),d===m){t=en(e,t,i);break e}nr(e,t,d,i)}t=t.child}return t;case 5:return Uu(t),e===null&&Ba(t),d=t.type,m=t.pendingProps,v=e!==null?e.memoizedProps:null,O=m.children,Aa(d,m)?O=null:v!==null&&Aa(d,v)&&(t.flags|=32),wd(e,t),nr(e,t,O,i),t.child;case 6:return e===null&&Ba(t),null;case 13:return Nd(e,t,i);case 4:return Ha(t,t.stateNode.containerInfo),d=t.pendingProps,e===null?t.child=ms(t,null,d,i):nr(e,t,d,i),t.child;case 11:return d=t.type,m=t.pendingProps,m=t.elementType===d?m:Tr(d,m),gd(e,t,d,m,i);case 7:return nr(e,t,t.pendingProps,i),t.child;case 8:return nr(e,t,t.pendingProps.children,i),t.child;case 12:return nr(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(d=t.type._context,m=t.pendingProps,v=t.memoizedProps,O=m.value,yt(Zi,d._currentValue),d._currentValue=O,v!==null)if(_r(v.value,O)){if(v.children===m.children&&!lr.current){t=en(e,t,i);break e}}else for(v=t.child,v!==null&&(v.return=t);v!==null;){var G=v.dependencies;if(G!==null){O=v.child;for(var Y=G.firstContext;Y!==null;){if(Y.context===d){if(v.tag===1){Y=Jr(-1,i&-i),Y.tag=2;var me=v.updateQueue;if(me!==null){me=me.shared;var Ce=me.pending;Ce===null?Y.next=Y:(Y.next=Ce.next,Ce.next=Y),me.pending=Y}}v.lanes|=i,Y=v.alternate,Y!==null&&(Y.lanes|=i),Wa(v.return,i,t),G.lanes|=i;break}Y=Y.next}}else if(v.tag===10)O=v.type===t.type?null:v.child;else if(v.tag===18){if(O=v.return,O===null)throw Error(n(341));O.lanes|=i,G=O.alternate,G!==null&&(G.lanes|=i),Wa(O,i,t),O=v.sibling}else O=v.child;if(O!==null)O.return=v;else for(O=v;O!==null;){if(O===t){O=null;break}if(v=O.sibling,v!==null){v.return=O.return,O=v;break}O=O.return}v=O}nr(e,t,m.children,i),t=t.child}return t;case 9:return m=t.type,d=t.pendingProps.children,ys(t,i),m=kr(m),d=d(m),t.flags|=1,nr(e,t,d,i),t.child;case 14:return d=t.type,m=Tr(d,t.pendingProps),m=Tr(d.type,m),yd(e,t,d,m,i);case 15:return vd(e,t,t.type,t.pendingProps,i);case 17:return d=t.type,m=t.pendingProps,m=t.elementType===d?m:Tr(d,m),co(e,t),t.tag=1,cr(d)?(e=!0,qi(t)):e=!1,ys(t,i),cd(t,d,m),il(t,d,m,i),cl(null,t,d,!0,e,i);case 19:return jd(e,t,i);case 22:return xd(e,t,i)}throw Error(n(156,t.tag))};function Xd(e,t){return ji(e,t)}function rg(e,t,i,d){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cr(e,t,i,d){return new rg(e,t,i,d)}function Al(e){return e=e.prototype,!(!e||!e.isReactComponent)}function ng(e){if(typeof e=="function")return Al(e)?1:0;if(e!=null){if(e=e.$$typeof,e===B)return 11;if(e===Q)return 14}return 2}function Nn(e,t){var i=e.alternate;return i===null?(i=Cr(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function bo(e,t,i,d,m,v){var O=2;if(d=e,typeof e=="function")Al(e)&&(O=1);else if(typeof e=="string")O=5;else e:switch(e){case W:return qn(i.children,m,v,t);case F:O=8,m|=8;break;case U:return e=Cr(12,i,t,m|2),e.elementType=U,e.lanes=v,e;case H:return e=Cr(13,i,t,m),e.elementType=H,e.lanes=v,e;case C:return e=Cr(19,i,t,m),e.elementType=C,e.lanes=v,e;case J:return ko(i,m,v,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case V:O=10;break e;case ie:O=9;break e;case B:O=11;break e;case Q:O=14;break e;case ae:O=16,d=null;break e}throw Error(n(130,e==null?e:typeof e,""))}return t=Cr(O,i,t,m),t.elementType=e,t.type=d,t.lanes=v,t}function qn(e,t,i,d){return e=Cr(7,e,d,t),e.lanes=i,e}function ko(e,t,i,d){return e=Cr(22,e,d,t),e.elementType=J,e.lanes=i,e.stateNode={isHidden:!1},e}function Tl(e,t,i){return e=Cr(6,e,null,t),e.lanes=i,e}function Rl(e,t,i){return t=Cr(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function sg(e,t,i,d,m){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sa(0),this.expirationTimes=sa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sa(0),this.identifierPrefix=d,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function Pl(e,t,i,d,m,v,O,G,Y){return e=new sg(e,t,i,G,Y),t===1?(t=1,v===!0&&(t|=8)):t=0,v=Cr(3,null,null,t),e.current=v,v.stateNode=e,v.memoizedState={element:d,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},qa(v),e}function ig(e,t,i){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:d==null?null:""+d,children:e,containerInfo:t,implementation:i}}function Zd(e){if(!e)return mn;e=e._reactInternals;e:{if(Pt(e)!==e||e.tag!==1)throw Error(n(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(cr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(n(171))}if(e.tag===1){var i=e.type;if(cr(i))return Cu(e,i,t)}return t}function Yd(e,t,i,d,m,v,O,G,Y){return e=Pl(i,d,!0,e,m,v,O,G,Y),e.context=Zd(null),i=e.current,d=sr(),m=kn(i),v=Jr(d,m),v.callback=t??null,vn(i,v,m),e.current.lanes=m,Ps(e,m,d),fr(e,d),e}function So(e,t,i,d){var m=t.current,v=sr(),O=kn(m);return i=Zd(i),t.context===null?t.context=i:t.pendingContext=i,t=Jr(v,O),t.payload={element:e},d=d===void 0?null:d,d!==null&&(t.callback=d),e=vn(m,t,O),e!==null&&(Lr(e,m,O,v),Ji(e,m,O)),O}function No(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Jd(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function Ll(e,t){Jd(e,t),(e=e.alternate)&&Jd(e,t)}function og(){return null}var ef=typeof reportError=="function"?reportError:function(e){console.error(e)};function Ol(e){this._internalRoot=e}Co.prototype.render=Ol.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(n(409));So(e,t,null,null)},Co.prototype.unmount=Ol.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;$n(function(){So(null,e,null,null)}),t[Kr]=null}};function Co(e){this._internalRoot=e}Co.prototype.unstable_scheduleHydration=function(e){if(e){var t=Dc();e={blockedOn:null,target:e,priority:t};for(var i=0;i<un.length&&t!==0&&t<un[i].priority;i++);un.splice(i,0,e),i===0&&Uc(e)}};function Il(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function jo(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function tf(){}function ag(e,t,i,d,m){if(m){if(typeof d=="function"){var v=d;d=function(){var me=No(O);v.call(me)}}var O=Yd(t,d,e,0,null,!1,!1,"",tf);return e._reactRootContainer=O,e[Kr]=O.current,Hs(e.nodeType===8?e.parentNode:e),$n(),O}for(;m=e.lastChild;)e.removeChild(m);if(typeof d=="function"){var G=d;d=function(){var me=No(Y);G.call(me)}}var Y=Pl(e,0,!1,null,null,!1,!1,"",tf);return e._reactRootContainer=Y,e[Kr]=Y.current,Hs(e.nodeType===8?e.parentNode:e),$n(function(){So(t,Y,i,d)}),Y}function Eo(e,t,i,d,m){var v=i._reactRootContainer;if(v){var O=v;if(typeof m=="function"){var G=m;m=function(){var Y=No(O);G.call(Y)}}So(t,O,e,m)}else O=ag(i,t,e,m,d);return No(O)}Ic=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=Gt(t.pendingLanes);i!==0&&(ia(t,i|1),fr(t,Nt()),(lt&6)===0&&(ks=Nt()+500,gn()))}break;case 13:$n(function(){var d=Yr(e,1);if(d!==null){var m=sr();Lr(d,e,1,m)}}),Ll(e,1)}},oa=function(e){if(e.tag===13){var t=Yr(e,134217728);if(t!==null){var i=sr();Lr(t,e,134217728,i)}Ll(e,134217728)}},Fc=function(e){if(e.tag===13){var t=kn(e),i=Yr(e,t);if(i!==null){var d=sr();Lr(i,e,t,d)}Ll(e,t)}},Dc=function(){return dt},Bc=function(e,t){var i=dt;try{return dt=e,t()}finally{dt=i}},ft=function(e,t,i){switch(t){case"input":if(q(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var d=i[t];if(d!==e&&d.form===e.form){var m=Wi(d);if(!m)throw Error(n(90));et(d),q(d,m)}}}break;case"textarea":E(e,i);break;case"select":t=i.value,t!=null&&ue(e,!!i.multiple,t,!1)}},xr=jl,It=$n;var lg={usingClientEntryPoint:!1,Events:[Qs,cs,Wi,or,qr,jl]},ci={findFiberByHostInstance:On,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},cg={bundleType:ci.bundleType,version:ci.version,rendererPackageName:ci.rendererPackageName,rendererConfig:ci.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:T.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=nn(e),e===null?null:e.stateNode},findFiberByHostInstance:ci.findFiberByHostInstance||og,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _o=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_o.isDisabled&&_o.supportsFiber)try{ot=_o.inject(cg),pt=_o}catch{}}return hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lg,hr.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Il(t))throw Error(n(200));return ig(e,t,null,i)},hr.createRoot=function(e,t){if(!Il(e))throw Error(n(299));var i=!1,d="",m=ef;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(d=t.identifierPrefix),t.onRecoverableError!==void 0&&(m=t.onRecoverableError)),t=Pl(e,1,!1,null,null,i,!1,d,m),e[Kr]=t.current,Hs(e.nodeType===8?e.parentNode:e),new Ol(t)},hr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(n(188)):(e=Object.keys(e).join(","),Error(n(268,e)));return e=nn(t),e=e===null?null:e.stateNode,e},hr.flushSync=function(e){return $n(e)},hr.hydrate=function(e,t,i){if(!jo(t))throw Error(n(200));return Eo(null,e,t,!0,i)},hr.hydrateRoot=function(e,t,i){if(!Il(e))throw Error(n(405));var d=i!=null&&i.hydratedSources||null,m=!1,v="",O=ef;if(i!=null&&(i.unstable_strictMode===!0&&(m=!0),i.identifierPrefix!==void 0&&(v=i.identifierPrefix),i.onRecoverableError!==void 0&&(O=i.onRecoverableError)),t=Yd(t,null,e,1,i??null,m,!1,v,O),e[Kr]=t.current,Hs(e),d)for(e=0;e<d.length;e++)i=d[e],m=i._getVersion,m=m(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,m]:t.mutableSourceEagerHydrationData.push(i,m);return new Co(t)},hr.render=function(e,t,i){if(!jo(t))throw Error(n(200));return Eo(null,e,t,!1,i)},hr.unmountComponentAtNode=function(e){if(!jo(e))throw Error(n(40));return e._reactRootContainer?($n(function(){Eo(null,null,e,!1,function(){e._reactRootContainer=null,e[Kr]=null})}),!0):!1},hr.unstable_batchedUpdates=jl,hr.unstable_renderSubtreeIntoContainer=function(e,t,i,d){if(!jo(i))throw Error(n(200));if(e==null||e._reactInternals===void 0)throw Error(n(38));return Eo(e,t,i,!1,d)},hr.version="18.3.1-next-f1338f8080-20240426",hr}var uf;function vh(){if(uf)return Bl.exports;uf=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(s){console.error(s)}}return r(),Bl.exports=vg(),Bl.exports}var df;function xg(){if(df)return To;df=1;var r=vh();return To.createRoot=r.createRoot,To.hydrateRoot=r.hydrateRoot,To}var wg=xg();const bg=dc(wg);var Ts=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},kg={setTimeout:(r,s)=>setTimeout(r,s),clearTimeout:r=>clearTimeout(r),setInterval:(r,s)=>setInterval(r,s),clearInterval:r=>clearInterval(r)},Sg=class{#e=kg;#t=!1;setTimeoutProvider(r){this.#e=r}setTimeout(r,s){return this.#e.setTimeout(r,s)}clearTimeout(r){this.#e.clearTimeout(r)}setInterval(r,s){return this.#e.setInterval(r,s)}clearInterval(r){this.#e.clearInterval(r)}},Qn=new Sg;function Ng(r){setTimeout(r,0)}var Yn=typeof window>"u"||"Deno"in globalThis;function ir(){}function Cg(r,s){return typeof r=="function"?r(s):r}function Ql(r){return typeof r=="number"&&r>=0&&r!==1/0}function xh(r,s){return Math.max(r+(s||0)-Date.now(),0)}function Tn(r,s){return typeof r=="function"?r(s):r}function jr(r,s){return typeof r=="function"?r(s):r}function ff(r,s){const{type:n="all",exact:o,fetchStatus:c,predicate:l,queryKey:u,stale:f}=r;if(u){if(o){if(s.queryHash!==hc(u,s.options))return!1}else if(!xi(s.queryKey,u))return!1}if(n!=="all"){const p=s.isActive();if(n==="active"&&!p||n==="inactive"&&p)return!1}return!(typeof f=="boolean"&&s.isStale()!==f||c&&c!==s.state.fetchStatus||l&&!l(s))}function hf(r,s){const{exact:n,status:o,predicate:c,mutationKey:l}=r;if(l){if(!s.options.mutationKey)return!1;if(n){if(Jn(s.options.mutationKey)!==Jn(l))return!1}else if(!xi(s.options.mutationKey,l))return!1}return!(o&&s.state.status!==o||c&&!c(s))}function hc(r,s){return(s?.queryKeyHashFn||Jn)(r)}function Jn(r){return JSON.stringify(r,(s,n)=>Xl(n)?Object.keys(n).sort().reduce((o,c)=>(o[c]=n[c],o),{}):n)}function xi(r,s){return r===s?!0:typeof r!=typeof s?!1:r&&s&&typeof r=="object"&&typeof s=="object"?Object.keys(s).every(n=>xi(r[n],s[n])):!1}var jg=Object.prototype.hasOwnProperty;function wh(r,s){if(r===s)return r;const n=pf(r)&&pf(s);if(!n&&!(Xl(r)&&Xl(s)))return s;const c=(n?r:Object.keys(r)).length,l=n?s:Object.keys(s),u=l.length,f=n?new Array(u):{};let p=0;for(let h=0;h<u;h++){const b=n?h:l[h],k=r[b],x=s[b];if(k===x){f[b]=k,(n?h<c:jg.call(r,b))&&p++;continue}if(k===null||x===null||typeof k!="object"||typeof x!="object"){f[b]=x;continue}const y=wh(k,x);f[b]=y,y===k&&p++}return c===u&&p===c?r:f}function Fo(r,s){if(!s||Object.keys(r).length!==Object.keys(s).length)return!1;for(const n in r)if(r[n]!==s[n])return!1;return!0}function pf(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function Xl(r){if(!mf(r))return!1;const s=r.constructor;if(s===void 0)return!0;const n=s.prototype;return!(!mf(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function mf(r){return Object.prototype.toString.call(r)==="[object Object]"}function Eg(r){return new Promise(s=>{Qn.setTimeout(s,r)})}function Zl(r,s,n){return typeof n.structuralSharing=="function"?n.structuralSharing(r,s):n.structuralSharing!==!1?wh(r,s):s}function _g(r,s,n=0){const o=[...r,s];return n&&o.length>n?o.slice(1):o}function Ag(r,s,n=0){const o=[s,...r];return n&&o.length>n?o.slice(0,-1):o}var pc=Symbol();function bh(r,s){return!r.queryFn&&s?.initialPromise?()=>s.initialPromise:!r.queryFn||r.queryFn===pc?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}function kh(r,s){return typeof r=="function"?r(...s):!!r}var Tg=class extends Ts{#e;#t;#r;constructor(){super(),this.#r=r=>{if(!Yn&&window.addEventListener){const s=()=>r();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#r=r,this.#t?.(),this.#t=r(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()})}setFocused(r){this.#e!==r&&(this.#e=r,this.onFocus())}onFocus(){const r=this.isFocused();this.listeners.forEach(s=>{s(r)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},mc=new Tg;function Yl(){let r,s;const n=new Promise((c,l)=>{r=c,s=l});n.status="pending",n.catch(()=>{});function o(c){Object.assign(n,c),delete n.resolve,delete n.reject}return n.resolve=c=>{o({status:"fulfilled",value:c}),r(c)},n.reject=c=>{o({status:"rejected",reason:c}),s(c)},n}var Rg=Ng;function Pg(){let r=[],s=0,n=f=>{f()},o=f=>{f()},c=Rg;const l=f=>{s?r.push(f):c(()=>{n(f)})},u=()=>{const f=r;r=[],f.length&&c(()=>{o(()=>{f.forEach(p=>{n(p)})})})};return{batch:f=>{let p;s++;try{p=f()}finally{s--,s||u()}return p},batchCalls:f=>(...p)=>{l(()=>{f(...p)})},schedule:l,setNotifyFunction:f=>{n=f},setBatchNotifyFunction:f=>{o=f},setScheduler:f=>{c=f}}}var Bt=Pg(),Lg=class extends Ts{#e=!0;#t;#r;constructor(){super(),this.#r=r=>{if(!Yn&&window.addEventListener){const s=()=>r(!0),n=()=>r(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#r=r,this.#t?.(),this.#t=r(this.setOnline.bind(this))}setOnline(r){this.#e!==r&&(this.#e=r,this.listeners.forEach(n=>{n(r)}))}isOnline(){return this.#e}},Do=new Lg;function Og(r){return Math.min(1e3*2**r,3e4)}function Sh(r){return(r??"online")==="online"?Do.isOnline():!0}var Jl=class extends Error{constructor(r){super("CancelledError"),this.revert=r?.revert,this.silent=r?.silent}};function Nh(r){let s=!1,n=0,o;const c=Yl(),l=()=>c.status!=="pending",u=g=>{if(!l()){const w=new Jl(g);x(w),r.onCancel?.(w)}},f=()=>{s=!0},p=()=>{s=!1},h=()=>mc.isFocused()&&(r.networkMode==="always"||Do.isOnline())&&r.canRun(),b=()=>Sh(r.networkMode)&&r.canRun(),k=g=>{l()||(o?.(),c.resolve(g))},x=g=>{l()||(o?.(),c.reject(g))},y=()=>new Promise(g=>{o=w=>{(l()||h())&&g(w)},r.onPause?.()}).then(()=>{o=void 0,l()||r.onContinue?.()}),S=()=>{if(l())return;let g;const w=n===0?r.initialPromise:void 0;try{g=w??r.fn()}catch(N){g=Promise.reject(N)}Promise.resolve(g).then(k).catch(N=>{if(l())return;const A=r.retry??(Yn?0:3),L=r.retryDelay??Og,T=typeof L=="function"?L(n,N):L,I=A===!0||typeof A=="number"&&n<A||typeof A=="function"&&A(n,N);if(s||!I){x(N);return}n++,r.onFail?.(n,N),Eg(T).then(()=>h()?void 0:y()).then(()=>{s?x(N):S()})})};return{promise:c,status:()=>c.status,cancel:u,continue:()=>(o?.(),c),cancelRetry:f,continueRetry:p,canStart:b,start:()=>(b()?S():y().then(S),c)}}var Ch=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Ql(this.gcTime)&&(this.#e=Qn.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(Yn?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Qn.clearTimeout(this.#e),this.#e=void 0)}},Ig=class extends Ch{#e;#t;#r;#s;#n;#o;#a;constructor(r){super(),this.#a=!1,this.#o=r.defaultOptions,this.setOptions(r.options),this.observers=[],this.#s=r.client,this.#r=this.#s.getQueryCache(),this.queryKey=r.queryKey,this.queryHash=r.queryHash,this.#e=gf(this.options),this.state=r.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(r){if(this.options={...this.#o,...r},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const s=gf(this.options);s.data!==void 0&&(this.setData(s.data,{updatedAt:s.dataUpdatedAt,manual:!0}),this.#e=s)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(r,s){const n=Zl(this.state.data,r,this.options);return this.#i({data:n,type:"success",dataUpdatedAt:s?.updatedAt,manual:s?.manual}),n}setState(r,s){this.#i({type:"setState",state:r,setStateOptions:s})}cancel(r){const s=this.#n?.promise;return this.#n?.cancel(r),s?s.then(ir).catch(ir):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(r=>jr(r.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===pc||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(r=>Tn(r.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(r=>r.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(r=0){return this.state.data===void 0?!0:r==="static"?!1:this.state.isInvalidated?!0:!xh(this.state.dataUpdatedAt,r)}onFocus(){this.observers.find(s=>s.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(s=>s.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(r){this.observers.includes(r)||(this.observers.push(r),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:r}))}removeObserver(r){this.observers.includes(r)&&(this.observers=this.observers.filter(s=>s!==r),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:r}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(r,s){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&s?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(r&&this.setOptions(r),!this.options.queryFn){const f=this.observers.find(p=>p.options.queryFn);f&&this.setOptions(f.options)}const n=new AbortController,o=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(this.#a=!0,n.signal)})},c=()=>{const f=bh(this.options,s),h=(()=>{const b={client:this.#s,queryKey:this.queryKey,meta:this.meta};return o(b),b})();return this.#a=!1,this.options.persister?this.options.persister(f,h,this):f(h)},u=(()=>{const f={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:c};return o(f),f})();this.options.behavior?.onFetch(u,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==u.fetchOptions?.meta)&&this.#i({type:"fetch",meta:u.fetchOptions?.meta}),this.#n=Nh({initialPromise:s?.initialPromise,fn:u.fetchFn,onCancel:f=>{f instanceof Jl&&f.revert&&this.setState({...this.#t,fetchStatus:"idle"}),n.abort()},onFail:(f,p)=>{this.#i({type:"failed",failureCount:f,error:p})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0});try{const f=await this.#n.start();if(f===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(f),this.#r.config.onSuccess?.(f,this),this.#r.config.onSettled?.(f,this.state.error,this),f}catch(f){if(f instanceof Jl){if(f.silent)return this.#n.promise;if(f.revert){if(this.state.data===void 0)throw f;return this.state.data}}throw this.#i({type:"error",error:f}),this.#r.config.onError?.(f,this),this.#r.config.onSettled?.(this.state.data,f,this),f}finally{this.scheduleGc()}}#i(r){const s=n=>{switch(r.type){case"failed":return{...n,fetchFailureCount:r.failureCount,fetchFailureReason:r.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...jh(n.data,this.options),fetchMeta:r.meta??null};case"success":const o={...n,data:r.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:r.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!r.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=r.manual?o:void 0,o;case"error":const c=r.error;return{...n,error:c,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:c,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...r.state}}};this.state=s(this.state),Bt.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:r})})}};function jh(r,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Sh(s.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function gf(r){const s=typeof r.initialData=="function"?r.initialData():r.initialData,n=s!==void 0,o=n?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:n?o??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Fg=class extends Ts{constructor(r,s){super(),this.options=s,this.#e=r,this.#i=null,this.#a=Yl(),this.bindMethods(),this.setOptions(s)}#e;#t=void 0;#r=void 0;#s=void 0;#n;#o;#a;#i;#m;#f;#h;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),yf(this.#t,this.options)?this.#d():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ec(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ec(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#w(),this.#b(),this.#t.removeObserver(this)}setOptions(r){const s=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof jr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#k(),this.#t.setOptions(this.options),s._defaulted&&!Fo(this.options,s)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const o=this.hasListeners();o&&vf(this.#t,n,this.options,s)&&this.#d(),this.updateResult(),o&&(this.#t!==n||jr(this.options.enabled,this.#t)!==jr(s.enabled,this.#t)||Tn(this.options.staleTime,this.#t)!==Tn(s.staleTime,this.#t))&&this.#g();const c=this.#y();o&&(this.#t!==n||jr(this.options.enabled,this.#t)!==jr(s.enabled,this.#t)||c!==this.#l)&&this.#v(c)}getOptimisticResult(r){const s=this.#e.getQueryCache().build(this.#e,r),n=this.createResult(s,r);return Bg(this,n)&&(this.#s=n,this.#o=this.options,this.#n=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(r,s){return new Proxy(r,{get:(n,o)=>(this.trackProp(o),s?.(o),o==="promise"&&!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(n,o))})}trackProp(r){this.#p.add(r)}getCurrentQuery(){return this.#t}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const s=this.#e.defaultQueryOptions(r),n=this.#e.getQueryCache().build(this.#e,s);return n.fetch().then(()=>this.createResult(n,s))}fetch(r){return this.#d({...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(r){this.#k();let s=this.#t.fetch(this.options,r);return r?.throwOnError||(s=s.catch(ir)),s}#g(){this.#w();const r=Tn(this.options.staleTime,this.#t);if(Yn||this.#s.isStale||!Ql(r))return;const n=xh(this.#s.dataUpdatedAt,r)+1;this.#c=Qn.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#v(r){this.#b(),this.#l=r,!(Yn||jr(this.options.enabled,this.#t)===!1||!Ql(this.#l)||this.#l===0)&&(this.#u=Qn.setInterval(()=>{(this.options.refetchIntervalInBackground||mc.isFocused())&&this.#d()},this.#l))}#x(){this.#g(),this.#v(this.#y())}#w(){this.#c&&(Qn.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(Qn.clearInterval(this.#u),this.#u=void 0)}createResult(r,s){const n=this.#t,o=this.options,c=this.#s,l=this.#n,u=this.#o,p=r!==n?r.state:this.#r,{state:h}=r;let b={...h},k=!1,x;if(s._optimisticResults){const F=this.hasListeners(),U=!F&&yf(r,s),V=F&&vf(r,n,s,o);(U||V)&&(b={...b,...jh(h.data,r.options)}),s._optimisticResults==="isRestoring"&&(b.fetchStatus="idle")}let{error:y,errorUpdatedAt:S,status:g}=b;x=b.data;let w=!1;if(s.placeholderData!==void 0&&x===void 0&&g==="pending"){let F;c?.isPlaceholderData&&s.placeholderData===u?.placeholderData?(F=c.data,w=!0):F=typeof s.placeholderData=="function"?s.placeholderData(this.#h?.state.data,this.#h):s.placeholderData,F!==void 0&&(g="success",x=Zl(c?.data,F,s),k=!0)}if(s.select&&x!==void 0&&!w)if(c&&x===l?.data&&s.select===this.#m)x=this.#f;else try{this.#m=s.select,x=s.select(x),x=Zl(c?.data,x,s),this.#f=x,this.#i=null}catch(F){this.#i=F}this.#i&&(y=this.#i,x=this.#f,S=Date.now(),g="error");const N=b.fetchStatus==="fetching",A=g==="pending",L=g==="error",T=A&&N,I=x!==void 0,W={status:g,fetchStatus:b.fetchStatus,isPending:A,isSuccess:g==="success",isError:L,isInitialLoading:T,isLoading:T,data:x,dataUpdatedAt:b.dataUpdatedAt,error:y,errorUpdatedAt:S,failureCount:b.fetchFailureCount,failureReason:b.fetchFailureReason,errorUpdateCount:b.errorUpdateCount,isFetched:b.dataUpdateCount>0||b.errorUpdateCount>0,isFetchedAfterMount:b.dataUpdateCount>p.dataUpdateCount||b.errorUpdateCount>p.errorUpdateCount,isFetching:N,isRefetching:N&&!A,isLoadingError:L&&!I,isPaused:b.fetchStatus==="paused",isPlaceholderData:k,isRefetchError:L&&I,isStale:gc(r,s),refetch:this.refetch,promise:this.#a,isEnabled:jr(s.enabled,r)!==!1};if(this.options.experimental_prefetchInRender){const F=ie=>{W.status==="error"?ie.reject(W.error):W.data!==void 0&&ie.resolve(W.data)},U=()=>{const ie=this.#a=W.promise=Yl();F(ie)},V=this.#a;switch(V.status){case"pending":r.queryHash===n.queryHash&&F(V);break;case"fulfilled":(W.status==="error"||W.data!==V.value)&&U();break;case"rejected":(W.status!=="error"||W.error!==V.reason)&&U();break}}return W}updateResult(){const r=this.#s,s=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#o=this.options,this.#n.data!==void 0&&(this.#h=this.#t),Fo(s,r))return;this.#s=s;const n=()=>{if(!r)return!0;const{notifyOnChangeProps:o}=this.options,c=typeof o=="function"?o():o;if(c==="all"||!c&&!this.#p.size)return!0;const l=new Set(c??this.#p);return this.options.throwOnError&&l.add("error"),Object.keys(this.#s).some(u=>{const f=u;return this.#s[f]!==r[f]&&l.has(f)})};this.#S({listeners:n()})}#k(){const r=this.#e.getQueryCache().build(this.#e,this.options);if(r===this.#t)return;const s=this.#t;this.#t=r,this.#r=r.state,this.hasListeners()&&(s?.removeObserver(this),r.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#S(r){Bt.batch(()=>{r.listeners&&this.listeners.forEach(s=>{s(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Dg(r,s){return jr(s.enabled,r)!==!1&&r.state.data===void 0&&!(r.state.status==="error"&&s.retryOnMount===!1)}function yf(r,s){return Dg(r,s)||r.state.data!==void 0&&ec(r,s,s.refetchOnMount)}function ec(r,s,n){if(jr(s.enabled,r)!==!1&&Tn(s.staleTime,r)!=="static"){const o=typeof n=="function"?n(r):n;return o==="always"||o!==!1&&gc(r,s)}return!1}function vf(r,s,n,o){return(r!==s||jr(o.enabled,r)===!1)&&(!n.suspense||r.state.status!=="error")&&gc(r,n)}function gc(r,s){return jr(s.enabled,r)!==!1&&r.isStaleByTime(Tn(s.staleTime,r))}function Bg(r,s){return!Fo(r.getCurrentResult(),s)}function xf(r){return{onFetch:(s,n)=>{const o=s.options,c=s.fetchOptions?.meta?.fetchMore?.direction,l=s.state.data?.pages||[],u=s.state.data?.pageParams||[];let f={pages:[],pageParams:[]},p=0;const h=async()=>{let b=!1;const k=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(s.signal.aborted?b=!0:s.signal.addEventListener("abort",()=>{b=!0}),s.signal)})},x=bh(s.options,s.fetchOptions),y=async(S,g,w)=>{if(b)return Promise.reject();if(g==null&&S.pages.length)return Promise.resolve(S);const A=(()=>{const D={client:s.client,queryKey:s.queryKey,pageParam:g,direction:w?"backward":"forward",meta:s.options.meta};return k(D),D})(),L=await x(A),{maxPages:T}=s.options,I=w?Ag:_g;return{pages:I(S.pages,L,T),pageParams:I(S.pageParams,g,T)}};if(c&&l.length){const S=c==="backward",g=S?Mg:wf,w={pages:l,pageParams:u},N=g(o,w);f=await y(w,N,S)}else{const S=r??l.length;do{const g=p===0?u[0]??o.initialPageParam:wf(o,f);if(p>0&&g==null)break;f=await y(f,g),p++}while(p<S)}return f};s.options.persister?s.fetchFn=()=>s.options.persister?.(h,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},n):s.fetchFn=h}}}function wf(r,{pages:s,pageParams:n}){const o=s.length-1;return s.length>0?r.getNextPageParam(s[o],s,n[o],n):void 0}function Mg(r,{pages:s,pageParams:n}){return s.length>0?r.getPreviousPageParam?.(s[0],s,n[0],n):void 0}var Ug=class extends Ch{#e;#t;#r;#s;constructor(r){super(),this.#e=r.client,this.mutationId=r.mutationId,this.#r=r.mutationCache,this.#t=[],this.state=r.state||Eh(),this.setOptions(r.options),this.scheduleGc()}setOptions(r){this.options=r,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(r){this.#t.includes(r)||(this.#t.push(r),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",mutation:this,observer:r}))}removeObserver(r){this.#t=this.#t.filter(s=>s!==r),this.scheduleGc(),this.#r.notify({type:"observerRemoved",mutation:this,observer:r})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#r.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(r){const s=()=>{this.#n({type:"continue"})},n={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=Nh({fn:()=>this.options.mutationFn?this.options.mutationFn(r,n):Promise.reject(new Error("No mutationFn found")),onFail:(l,u)=>{this.#n({type:"failed",failureCount:l,error:u})},onPause:()=>{this.#n({type:"pause"})},onContinue:s,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#r.canRun(this)});const o=this.state.status==="pending",c=!this.#s.canStart();try{if(o)s();else{this.#n({type:"pending",variables:r,isPaused:c}),await this.#r.config.onMutate?.(r,this,n);const u=await this.options.onMutate?.(r,n);u!==this.state.context&&this.#n({type:"pending",context:u,variables:r,isPaused:c})}const l=await this.#s.start();return await this.#r.config.onSuccess?.(l,r,this.state.context,this,n),await this.options.onSuccess?.(l,r,this.state.context,n),await this.#r.config.onSettled?.(l,null,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(l,null,r,this.state.context,n),this.#n({type:"success",data:l}),l}catch(l){try{throw await this.#r.config.onError?.(l,r,this.state.context,this,n),await this.options.onError?.(l,r,this.state.context,n),await this.#r.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(void 0,l,r,this.state.context,n),l}finally{this.#n({type:"error",error:l})}}finally{this.#r.runNext(this)}}#n(r){const s=n=>{switch(r.type){case"failed":return{...n,failureCount:r.failureCount,failureReason:r.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:r.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:r.isPaused,status:"pending",variables:r.variables,submittedAt:Date.now()};case"success":return{...n,data:r.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:r.error,failureCount:n.failureCount+1,failureReason:r.error,isPaused:!1,status:"error"}}};this.state=s(this.state),Bt.batch(()=>{this.#t.forEach(n=>{n.onMutationUpdate(r)}),this.#r.notify({mutation:this,type:"updated",action:r})})}};function Eh(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var zg=class extends Ts{constructor(r={}){super(),this.config=r,this.#e=new Set,this.#t=new Map,this.#r=0}#e;#t;#r;build(r,s,n){const o=new Ug({client:r,mutationCache:this,mutationId:++this.#r,options:r.defaultMutationOptions(s),state:n});return this.add(o),o}add(r){this.#e.add(r);const s=Ro(r);if(typeof s=="string"){const n=this.#t.get(s);n?n.push(r):this.#t.set(s,[r])}this.notify({type:"added",mutation:r})}remove(r){if(this.#e.delete(r)){const s=Ro(r);if(typeof s=="string"){const n=this.#t.get(s);if(n)if(n.length>1){const o=n.indexOf(r);o!==-1&&n.splice(o,1)}else n[0]===r&&this.#t.delete(s)}}this.notify({type:"removed",mutation:r})}canRun(r){const s=Ro(r);if(typeof s=="string"){const o=this.#t.get(s)?.find(c=>c.state.status==="pending");return!o||o===r}else return!0}runNext(r){const s=Ro(r);return typeof s=="string"?this.#t.get(s)?.find(o=>o!==r&&o.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Bt.batch(()=>{this.#e.forEach(r=>{this.notify({type:"removed",mutation:r})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(r){const s={exact:!0,...r};return this.getAll().find(n=>hf(s,n))}findAll(r={}){return this.getAll().filter(s=>hf(r,s))}notify(r){Bt.batch(()=>{this.listeners.forEach(s=>{s(r)})})}resumePausedMutations(){const r=this.getAll().filter(s=>s.state.isPaused);return Bt.batch(()=>Promise.all(r.map(s=>s.continue().catch(ir))))}};function Ro(r){return r.options.scope?.id}var $g=class extends Ts{#e;#t=void 0;#r;#s;constructor(s,n){super(),this.#e=s,this.setOptions(n),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const n=this.options;this.options=this.#e.defaultMutationOptions(s),Fo(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),n?.mutationKey&&this.options.mutationKey&&Jn(n.mutationKey)!==Jn(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(s){this.#n(),this.#o(s)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#o()}mutate(s,n){return this.#s=n,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(s)}#n(){const s=this.#r?.state??Eh();this.#t={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#o(s){Bt.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,o=this.#t.context,c={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};s?.type==="success"?(this.#s.onSuccess?.(s.data,n,o,c),this.#s.onSettled?.(s.data,null,n,o,c)):s?.type==="error"&&(this.#s.onError?.(s.error,n,o,c),this.#s.onSettled?.(void 0,s.error,n,o,c))}this.listeners.forEach(n=>{n(this.#t)})})}},Wg=class extends Ts{constructor(r={}){super(),this.config=r,this.#e=new Map}#e;build(r,s,n){const o=s.queryKey,c=s.queryHash??hc(o,s);let l=this.get(c);return l||(l=new Ig({client:r,queryKey:o,queryHash:c,options:r.defaultQueryOptions(s),state:n,defaultOptions:r.getQueryDefaults(o)}),this.add(l)),l}add(r){this.#e.has(r.queryHash)||(this.#e.set(r.queryHash,r),this.notify({type:"added",query:r}))}remove(r){const s=this.#e.get(r.queryHash);s&&(r.destroy(),s===r&&this.#e.delete(r.queryHash),this.notify({type:"removed",query:r}))}clear(){Bt.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}get(r){return this.#e.get(r)}getAll(){return[...this.#e.values()]}find(r){const s={exact:!0,...r};return this.getAll().find(n=>ff(s,n))}findAll(r={}){const s=this.getAll();return Object.keys(r).length>0?s.filter(n=>ff(r,n)):s}notify(r){Bt.batch(()=>{this.listeners.forEach(s=>{s(r)})})}onFocus(){Bt.batch(()=>{this.getAll().forEach(r=>{r.onFocus()})})}onOnline(){Bt.batch(()=>{this.getAll().forEach(r=>{r.onOnline()})})}},Vg=class{#e;#t;#r;#s;#n;#o;#a;#i;constructor(r={}){this.#e=r.queryCache||new Wg,this.#t=r.mutationCache||new zg,this.#r=r.defaultOptions||{},this.#s=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=mc.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=Do.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#i?.(),this.#i=void 0)}isFetching(r){return this.#e.findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return this.#t.findAll({...r,status:"pending"}).length}getQueryData(r){const s=this.defaultQueryOptions({queryKey:r});return this.#e.get(s.queryHash)?.state.data}ensureQueryData(r){const s=this.defaultQueryOptions(r),n=this.#e.build(this,s),o=n.state.data;return o===void 0?this.fetchQuery(r):(r.revalidateIfStale&&n.isStaleByTime(Tn(s.staleTime,n))&&this.prefetchQuery(s),Promise.resolve(o))}getQueriesData(r){return this.#e.findAll(r).map(({queryKey:s,state:n})=>{const o=n.data;return[s,o]})}setQueryData(r,s,n){const o=this.defaultQueryOptions({queryKey:r}),l=this.#e.get(o.queryHash)?.state.data,u=Cg(s,l);if(u!==void 0)return this.#e.build(this,o).setData(u,{...n,manual:!0})}setQueriesData(r,s,n){return Bt.batch(()=>this.#e.findAll(r).map(({queryKey:o})=>[o,this.setQueryData(o,s,n)]))}getQueryState(r){const s=this.defaultQueryOptions({queryKey:r});return this.#e.get(s.queryHash)?.state}removeQueries(r){const s=this.#e;Bt.batch(()=>{s.findAll(r).forEach(n=>{s.remove(n)})})}resetQueries(r,s){const n=this.#e;return Bt.batch(()=>(n.findAll(r).forEach(o=>{o.reset()}),this.refetchQueries({type:"active",...r},s)))}cancelQueries(r,s={}){const n={revert:!0,...s},o=Bt.batch(()=>this.#e.findAll(r).map(c=>c.cancel(n)));return Promise.all(o).then(ir).catch(ir)}invalidateQueries(r,s={}){return Bt.batch(()=>(this.#e.findAll(r).forEach(n=>{n.invalidate()}),r?.refetchType==="none"?Promise.resolve():this.refetchQueries({...r,type:r?.refetchType??r?.type??"active"},s)))}refetchQueries(r,s={}){const n={...s,cancelRefetch:s.cancelRefetch??!0},o=Bt.batch(()=>this.#e.findAll(r).filter(c=>!c.isDisabled()&&!c.isStatic()).map(c=>{let l=c.fetch(void 0,n);return n.throwOnError||(l=l.catch(ir)),c.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(o).then(ir)}fetchQuery(r){const s=this.defaultQueryOptions(r);s.retry===void 0&&(s.retry=!1);const n=this.#e.build(this,s);return n.isStaleByTime(Tn(s.staleTime,n))?n.fetch(s):Promise.resolve(n.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(ir).catch(ir)}fetchInfiniteQuery(r){return r.behavior=xf(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(ir).catch(ir)}ensureInfiniteQueryData(r){return r.behavior=xf(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return Do.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(r){this.#r=r}setQueryDefaults(r,s){this.#s.set(Jn(r),{queryKey:r,defaultOptions:s})}getQueryDefaults(r){const s=[...this.#s.values()],n={};return s.forEach(o=>{xi(r,o.queryKey)&&Object.assign(n,o.defaultOptions)}),n}setMutationDefaults(r,s){this.#n.set(Jn(r),{mutationKey:r,defaultOptions:s})}getMutationDefaults(r){const s=[...this.#n.values()],n={};return s.forEach(o=>{xi(r,o.mutationKey)&&Object.assign(n,o.defaultOptions)}),n}defaultQueryOptions(r){if(r._defaulted)return r;const s={...this.#r.queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return s.queryHash||(s.queryHash=hc(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===pc&&(s.enabled=!1),s}defaultMutationOptions(r){return r?._defaulted?r:{...this.#r.mutations,...r?.mutationKey&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},_h=R.createContext(void 0),$o=r=>{const s=R.useContext(_h);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},qg=({client:r,children:s})=>(R.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),a.jsx(_h.Provider,{value:r,children:s})),Ah=R.createContext(!1),Hg=()=>R.useContext(Ah);Ah.Provider;function Th(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}var Rh=R.createContext(Th()),Gg=()=>R.useContext(Rh),Kg=({children:r})=>{const[s]=R.useState(()=>Th());return a.jsx(Rh.Provider,{value:s,children:typeof r=="function"?r(s):r})},Qg=(r,s)=>{(r.suspense||r.throwOnError||r.experimental_prefetchInRender)&&(s.isReset()||(r.retryOnMount=!1))},Xg=r=>{R.useEffect(()=>{r.clearReset()},[r])},Zg=({result:r,errorResetBoundary:s,throwOnError:n,query:o,suspense:c})=>r.isError&&!s.isReset()&&!r.isFetching&&o&&(c&&r.data===void 0||kh(n,[r.error,o])),Yg=r=>{if(r.suspense){const n=c=>c==="static"?c:Math.max(c??1e3,1e3),o=r.staleTime;r.staleTime=typeof o=="function"?(...c)=>n(o(...c)):n(o),typeof r.gcTime=="number"&&(r.gcTime=Math.max(r.gcTime,1e3))}},Jg=(r,s)=>r.isLoading&&r.isFetching&&!s,ey=(r,s)=>r?.suspense&&s.isPending,bf=(r,s,n)=>s.fetchOptimistic(r).catch(()=>{n.clearReset()});function ty(r,s,n){const o=Hg(),c=Gg(),l=$o(),u=l.defaultQueryOptions(r);l.getDefaultOptions().queries?._experimental_beforeQuery?.(u),u._optimisticResults=o?"isRestoring":"optimistic",Yg(u),Qg(u,c),Xg(c);const f=!l.getQueryCache().get(u.queryHash),[p]=R.useState(()=>new s(l,u)),h=p.getOptimisticResult(u),b=!o&&r.subscribed!==!1;if(R.useSyncExternalStore(R.useCallback(k=>{const x=b?p.subscribe(Bt.batchCalls(k)):ir;return p.updateResult(),x},[p,b]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),R.useEffect(()=>{p.setOptions(u)},[u,p]),ey(u,h))throw bf(u,p,c);if(Zg({result:h,errorResetBoundary:c,throwOnError:u.throwOnError,query:l.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw h.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(u,h),u.experimental_prefetchInRender&&!Yn&&Jg(h,o)&&(f?bf(u,p,c):l.getQueryCache().get(u.queryHash)?.promise)?.catch(ir).finally(()=>{p.updateResult()}),u.notifyOnChangeProps?h:p.trackResult(h)}function yc(r,s){return ty(r,Fg)}function ry(r,s){const n=$o(),[o]=R.useState(()=>new $g(n,r));R.useEffect(()=>{o.setOptions(r)},[o,r]);const c=R.useSyncExternalStore(R.useCallback(u=>o.subscribe(Bt.batchCalls(u)),[o]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),l=R.useCallback((u,f)=>{o.mutate(u,f).catch(ir)},[o]);if(c.error&&kh(o.options.throwOnError,[c.error]))throw c.error;return{...c,mutate:l,mutateAsync:c.mutate}}const ny="modulepreload",sy=function(r){return"/My-Ebook-Reader/"+r},kf={},Bo=function(s,n,o){let c=Promise.resolve();if(n&&n.length>0){let p=function(h){return Promise.all(h.map(b=>Promise.resolve(b).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),f=u?.nonce||u?.getAttribute("nonce");c=p(n.map(h=>{if(h=sy(h),h in kf)return;kf[h]=!0;const b=h.endsWith(".css"),k=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${k}`))return;const x=document.createElement("link");if(x.rel=b?"stylesheet":ny,b||(x.as="script"),x.crossOrigin="",x.href=h,f&&x.setAttribute("nonce",f),document.head.appendChild(x),b)return new Promise((y,S)=>{x.addEventListener("load",y),x.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return c.then(u=>{for(const f of u||[])f.status==="rejected"&&l(f.reason);return s().catch(l)})};var iy=function(){return null};vh();/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wi(){return wi=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},wi.apply(this,arguments)}var _n;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(_n||(_n={}));const Sf="popstate";function oy(r){r===void 0&&(r={});function s(c,l){let{pathname:u="/",search:f="",hash:p=""}=es(c.location.hash.substr(1));return!u.startsWith("/")&&!u.startsWith(".")&&(u="/"+u),tc("",{pathname:u,search:f,hash:p},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function n(c,l){let u=c.document.querySelector("base"),f="";if(u&&u.getAttribute("href")){let p=c.location.href,h=p.indexOf("#");f=h===-1?p:p.slice(0,h)}return f+"#"+(typeof l=="string"?l:Ph(l))}function o(c,l){Wo(c.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(l)+")")}return ly(s,n,o,r)}function Mt(r,s){if(r===!1||r===null||typeof r>"u")throw new Error(s)}function Wo(r,s){if(!r){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function ay(){return Math.random().toString(36).substr(2,8)}function Nf(r,s){return{usr:r.state,key:r.key,idx:s}}function tc(r,s,n,o){return n===void 0&&(n=null),wi({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof s=="string"?es(s):s,{state:n,key:s&&s.key||o||ay()})}function Ph(r){let{pathname:s="/",search:n="",hash:o=""}=r;return n&&n!=="?"&&(s+=n.charAt(0)==="?"?n:"?"+n),o&&o!=="#"&&(s+=o.charAt(0)==="#"?o:"#"+o),s}function es(r){let s={};if(r){let n=r.indexOf("#");n>=0&&(s.hash=r.substr(n),r=r.substr(0,n));let o=r.indexOf("?");o>=0&&(s.search=r.substr(o),r=r.substr(0,o)),r&&(s.pathname=r)}return s}function ly(r,s,n,o){o===void 0&&(o={});let{window:c=document.defaultView,v5Compat:l=!1}=o,u=c.history,f=_n.Pop,p=null,h=b();h==null&&(h=0,u.replaceState(wi({},u.state,{idx:h}),""));function b(){return(u.state||{idx:null}).idx}function k(){f=_n.Pop;let w=b(),N=w==null?null:w-h;h=w,p&&p({action:f,location:g.location,delta:N})}function x(w,N){f=_n.Push;let A=tc(g.location,w,N);n&&n(A,w),h=b()+1;let L=Nf(A,h),T=g.createHref(A);try{u.pushState(L,"",T)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;c.location.assign(T)}l&&p&&p({action:f,location:g.location,delta:1})}function y(w,N){f=_n.Replace;let A=tc(g.location,w,N);n&&n(A,w),h=b();let L=Nf(A,h),T=g.createHref(A);u.replaceState(L,"",T),l&&p&&p({action:f,location:g.location,delta:0})}function S(w){let N=c.location.origin!=="null"?c.location.origin:c.location.href,A=typeof w=="string"?w:Ph(w);return A=A.replace(/ $/,"%20"),Mt(N,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,N)}let g={get action(){return f},get location(){return r(c,u)},listen(w){if(p)throw new Error("A history only accepts one active listener");return c.addEventListener(Sf,k),p=w,()=>{c.removeEventListener(Sf,k),p=null}},createHref(w){return s(c,w)},createURL:S,encodeLocation(w){let N=S(w);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:x,replace:y,go(w){return u.go(w)}};return g}var Cf;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(Cf||(Cf={}));function cy(r,s,n){return n===void 0&&(n="/"),uy(r,s,n)}function uy(r,s,n,o){let c=typeof s=="string"?es(s):s,l=Ih(c.pathname||"/",n);if(l==null)return null;let u=Lh(r);dy(u);let f=null;for(let p=0;f==null&&p<u.length;++p){let h=Sy(l);f=wy(u[p],h)}return f}function Lh(r,s,n,o){s===void 0&&(s=[]),n===void 0&&(n=[]),o===void 0&&(o="");let c=(l,u,f)=>{let p={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};p.relativePath.startsWith("/")&&(Mt(p.relativePath.startsWith(o),'Absolute route path "'+p.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),p.relativePath=p.relativePath.slice(o.length));let h=Zn([o,p.relativePath]),b=n.concat(p);l.children&&l.children.length>0&&(Mt(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+h+'".')),Lh(l.children,s,b,h)),!(l.path==null&&!l.index)&&s.push({path:h,score:vy(h,l.index),routesMeta:b})};return r.forEach((l,u)=>{var f;if(l.path===""||!((f=l.path)!=null&&f.includes("?")))c(l,u);else for(let p of Oh(l.path))c(l,u,p)}),s}function Oh(r){let s=r.split("/");if(s.length===0)return[];let[n,...o]=s,c=n.endsWith("?"),l=n.replace(/\?$/,"");if(o.length===0)return c?[l,""]:[l];let u=Oh(o.join("/")),f=[];return f.push(...u.map(p=>p===""?l:[l,p].join("/"))),c&&f.push(...u),f.map(p=>r.startsWith("/")&&p===""?"/":p)}function dy(r){r.sort((s,n)=>s.score!==n.score?n.score-s.score:xy(s.routesMeta.map(o=>o.childrenIndex),n.routesMeta.map(o=>o.childrenIndex)))}const fy=/^:[\w-]+$/,hy=3,py=2,my=1,gy=10,yy=-2,jf=r=>r==="*";function vy(r,s){let n=r.split("/"),o=n.length;return n.some(jf)&&(o+=yy),s&&(o+=py),n.filter(c=>!jf(c)).reduce((c,l)=>c+(fy.test(l)?hy:l===""?my:gy),o)}function xy(r,s){return r.length===s.length&&r.slice(0,-1).every((o,c)=>o===s[c])?r[r.length-1]-s[s.length-1]:0}function wy(r,s,n){let{routesMeta:o}=r,c={},l="/",u=[];for(let f=0;f<o.length;++f){let p=o[f],h=f===o.length-1,b=l==="/"?s:s.slice(l.length)||"/",k=by({path:p.relativePath,caseSensitive:p.caseSensitive,end:h},b),x=p.route;if(!k)return null;Object.assign(c,k.params),u.push({params:c,pathname:Zn([l,k.pathname]),pathnameBase:Ty(Zn([l,k.pathnameBase])),route:x}),k.pathnameBase!=="/"&&(l=Zn([l,k.pathnameBase]))}return u}function by(r,s){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[n,o]=ky(r.path,r.caseSensitive,r.end),c=s.match(n);if(!c)return null;let l=c[0],u=l.replace(/(.)\/+$/,"$1"),f=c.slice(1);return{params:o.reduce((h,b,k)=>{let{paramName:x,isOptional:y}=b;if(x==="*"){let g=f[k]||"";u=l.slice(0,l.length-g.length).replace(/(.)\/+$/,"$1")}const S=f[k];return y&&!S?h[x]=void 0:h[x]=(S||"").replace(/%2F/g,"/"),h},{}),pathname:l,pathnameBase:u,pattern:r}}function ky(r,s,n){s===void 0&&(s=!1),n===void 0&&(n=!0),Wo(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let o=[],c="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,f,p)=>(o.push({paramName:f,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(o.push({paramName:"*"}),c+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?c+="\\/*$":r!==""&&r!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,s?void 0:"i"),o]}function Sy(r){try{return r.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return Wo(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),r}}function Ih(r,s){if(s==="/")return r;if(!r.toLowerCase().startsWith(s.toLowerCase()))return null;let n=s.endsWith("/")?s.length-1:s.length,o=r.charAt(n);return o&&o!=="/"?null:r.slice(n)||"/"}const Ny=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cy=r=>Ny.test(r);function jy(r,s){s===void 0&&(s="/");let{pathname:n,search:o="",hash:c=""}=typeof r=="string"?es(r):r,l;if(n)if(Cy(n))l=n;else{if(n.includes("//")){let u=n;n=n.replace(/\/\/+/g,"/"),Wo(!1,"Pathnames cannot have embedded double slashes - normalizing "+(u+" -> "+n))}n.startsWith("/")?l=Ef(n.substring(1),"/"):l=Ef(n,s)}else l=s;return{pathname:l,search:Ry(o),hash:Py(c)}}function Ef(r,s){let n=s.replace(/\/+$/,"").split("/");return r.split("/").forEach(c=>{c===".."?n.length>1&&n.pop():c!=="."&&n.push(c)}),n.length>1?n.join("/"):"/"}function zl(r,s,n,o){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ey(r){return r.filter((s,n)=>n===0||s.route.path&&s.route.path.length>0)}function _y(r,s){let n=Ey(r);return s?n.map((o,c)=>c===n.length-1?o.pathname:o.pathnameBase):n.map(o=>o.pathnameBase)}function Ay(r,s,n,o){o===void 0&&(o=!1);let c;typeof r=="string"?c=es(r):(c=wi({},r),Mt(!c.pathname||!c.pathname.includes("?"),zl("?","pathname","search",c)),Mt(!c.pathname||!c.pathname.includes("#"),zl("#","pathname","hash",c)),Mt(!c.search||!c.search.includes("#"),zl("#","search","hash",c)));let l=r===""||c.pathname==="",u=l?"/":c.pathname,f;if(u==null)f=n;else{let k=s.length-1;if(!o&&u.startsWith("..")){let x=u.split("/");for(;x[0]==="..";)x.shift(),k-=1;c.pathname=x.join("/")}f=k>=0?s[k]:"/"}let p=jy(c,f),h=u&&u!=="/"&&u.endsWith("/"),b=(l||u===".")&&n.endsWith("/");return!p.pathname.endsWith("/")&&(h||b)&&(p.pathname+="/"),p}const Zn=r=>r.join("/").replace(/\/\/+/g,"/"),Ty=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Ry=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Py=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function Ly(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const Fh=["post","put","patch","delete"];new Set(Fh);const Oy=["get",...Fh];new Set(Oy);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bi(){return bi=Object.assign?Object.assign.bind():function(r){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},bi.apply(this,arguments)}const vc=R.createContext(null),Iy=R.createContext(null),Vo=R.createContext(null),qo=R.createContext(null),ts=R.createContext({outlet:null,matches:[],isDataRoute:!1}),Dh=R.createContext(null);function Ho(){return R.useContext(qo)!=null}function xc(){return Ho()||Mt(!1),R.useContext(qo).location}function Bh(r){R.useContext(Vo).static||R.useLayoutEffect(r)}function wc(){let{isDataRoute:r}=R.useContext(ts);return r?Qy():Fy()}function Fy(){Ho()||Mt(!1);let r=R.useContext(vc),{basename:s,future:n,navigator:o}=R.useContext(Vo),{matches:c}=R.useContext(ts),{pathname:l}=xc(),u=JSON.stringify(_y(c,n.v7_relativeSplatPath)),f=R.useRef(!1);return Bh(()=>{f.current=!0}),R.useCallback(function(h,b){if(b===void 0&&(b={}),!f.current)return;if(typeof h=="number"){o.go(h);return}let k=Ay(h,JSON.parse(u),l,b.relative==="path");r==null&&s!=="/"&&(k.pathname=k.pathname==="/"?s:Zn([s,k.pathname])),(b.replace?o.replace:o.push)(k,b.state,b)},[s,o,u,l,r])}function Dy(){let{matches:r}=R.useContext(ts),s=r[r.length-1];return s?s.params:{}}function By(r,s){return My(r,s)}function My(r,s,n,o){Ho()||Mt(!1);let{navigator:c}=R.useContext(Vo),{matches:l}=R.useContext(ts),u=l[l.length-1],f=u?u.params:{};u&&u.pathname;let p=u?u.pathnameBase:"/";u&&u.route;let h=xc(),b;if(s){var k;let w=typeof s=="string"?es(s):s;p==="/"||(k=w.pathname)!=null&&k.startsWith(p)||Mt(!1),b=w}else b=h;let x=b.pathname||"/",y=x;if(p!=="/"){let w=p.replace(/^\//,"").split("/");y="/"+x.replace(/^\//,"").split("/").slice(w.length).join("/")}let S=cy(r,{pathname:y}),g=Vy(S&&S.map(w=>Object.assign({},w,{params:Object.assign({},f,w.params),pathname:Zn([p,c.encodeLocation?c.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?p:Zn([p,c.encodeLocation?c.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),l,n,o);return s&&g?R.createElement(qo.Provider,{value:{location:bi({pathname:"/",search:"",hash:"",state:null,key:"default"},b),navigationType:_n.Pop}},g):g}function Uy(){let r=Ky(),s=Ly(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),n=r instanceof Error?r.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},s),n?R.createElement("pre",{style:c},n):null,null)}const zy=R.createElement(Uy,null);class $y extends R.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,n){return n.location!==s.location||n.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:n.error,location:n.location,revalidation:s.revalidation||n.revalidation}}componentDidCatch(s,n){console.error("React Router caught the following error during render",s,n)}render(){return this.state.error!==void 0?R.createElement(ts.Provider,{value:this.props.routeContext},R.createElement(Dh.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Wy(r){let{routeContext:s,match:n,children:o}=r,c=R.useContext(vc);return c&&c.static&&c.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=n.route.id),R.createElement(ts.Provider,{value:s},o)}function Vy(r,s,n,o){var c;if(s===void 0&&(s=[]),n===void 0&&(n=null),o===void 0&&(o=null),r==null){var l;if(!n)return null;if(n.errors)r=n.matches;else if((l=o)!=null&&l.v7_partialHydration&&s.length===0&&!n.initialized&&n.matches.length>0)r=n.matches;else return null}let u=r,f=(c=n)==null?void 0:c.errors;if(f!=null){let b=u.findIndex(k=>k.route.id&&f?.[k.route.id]!==void 0);b>=0||Mt(!1),u=u.slice(0,Math.min(u.length,b+1))}let p=!1,h=-1;if(n&&o&&o.v7_partialHydration)for(let b=0;b<u.length;b++){let k=u[b];if((k.route.HydrateFallback||k.route.hydrateFallbackElement)&&(h=b),k.route.id){let{loaderData:x,errors:y}=n,S=k.route.loader&&x[k.route.id]===void 0&&(!y||y[k.route.id]===void 0);if(k.route.lazy||S){p=!0,h>=0?u=u.slice(0,h+1):u=[u[0]];break}}}return u.reduceRight((b,k,x)=>{let y,S=!1,g=null,w=null;n&&(y=f&&k.route.id?f[k.route.id]:void 0,g=k.route.errorElement||zy,p&&(h<0&&x===0?(Xy("route-fallback"),S=!0,w=null):h===x&&(S=!0,w=k.route.hydrateFallbackElement||null)));let N=s.concat(u.slice(0,x+1)),A=()=>{let L;return y?L=g:S?L=w:k.route.Component?L=R.createElement(k.route.Component,null):k.route.element?L=k.route.element:L=b,R.createElement(Wy,{match:k,routeContext:{outlet:b,matches:N,isDataRoute:n!=null},children:L})};return n&&(k.route.ErrorBoundary||k.route.errorElement||x===0)?R.createElement($y,{location:n.location,revalidation:n.revalidation,component:g,error:y,children:A(),routeContext:{outlet:null,matches:N,isDataRoute:!0}}):A()},null)}var Mh=(function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r})(Mh||{}),Uh=(function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r})(Uh||{});function qy(r){let s=R.useContext(vc);return s||Mt(!1),s}function Hy(r){let s=R.useContext(Iy);return s||Mt(!1),s}function Gy(r){let s=R.useContext(ts);return s||Mt(!1),s}function zh(r){let s=Gy(),n=s.matches[s.matches.length-1];return n.route.id||Mt(!1),n.route.id}function Ky(){var r;let s=R.useContext(Dh),n=Hy(),o=zh();return s!==void 0?s:(r=n.errors)==null?void 0:r[o]}function Qy(){let{router:r}=qy(Mh.UseNavigateStable),s=zh(Uh.UseNavigateStable),n=R.useRef(!1);return Bh(()=>{n.current=!0}),R.useCallback(function(c,l){l===void 0&&(l={}),n.current&&(typeof c=="number"?r.navigate(c):r.navigate(c,bi({fromRouteId:s},l)))},[r,s])}const _f={};function Xy(r,s,n){_f[r]||(_f[r]=!0)}function Zy(r,s){r?.v7_startTransition,r?.v7_relativeSplatPath}function rc(r){Mt(!1)}function Yy(r){let{basename:s="/",children:n=null,location:o,navigationType:c=_n.Pop,navigator:l,static:u=!1,future:f}=r;Ho()&&Mt(!1);let p=s.replace(/^\/*/,"/"),h=R.useMemo(()=>({basename:p,navigator:l,static:u,future:bi({v7_relativeSplatPath:!1},f)}),[p,f,l,u]);typeof o=="string"&&(o=es(o));let{pathname:b="/",search:k="",hash:x="",state:y=null,key:S="default"}=o,g=R.useMemo(()=>{let w=Ih(b,p);return w==null?null:{location:{pathname:w,search:k,hash:x,state:y,key:S},navigationType:c}},[p,b,k,x,y,S,c]);return g==null?null:R.createElement(Vo.Provider,{value:h},R.createElement(qo.Provider,{children:n,value:g}))}function Jy(r){let{children:s,location:n}=r;return By(nc(s),n)}new Promise(()=>{});function nc(r,s){s===void 0&&(s=[]);let n=[];return R.Children.forEach(r,(o,c)=>{if(!R.isValidElement(o))return;let l=[...s,c];if(o.type===R.Fragment){n.push.apply(n,nc(o.props.children,l));return}o.type!==rc&&Mt(!1),!o.props.index||!o.props.children||Mt(!1);let u={id:o.props.id||l.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(u.children=nc(o.props.children,l)),n.push(u)}),n}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const ev="6";try{window.__reactRouterVersion=ev}catch{}const tv="startTransition",Af=mg[tv];function rv(r){let{basename:s,children:n,future:o,window:c}=r,l=R.useRef();l.current==null&&(l.current=oy({window:c,v5Compat:!0}));let u=l.current,[f,p]=R.useState({action:u.action,location:u.location}),{v7_startTransition:h}=o||{},b=R.useCallback(k=>{h&&Af?Af(()=>p(k)):p(k)},[p,h]);return R.useLayoutEffect(()=>u.listen(b),[u,b]),R.useEffect(()=>Zy(o),[o]),R.createElement(Yy,{basename:s,children:n,location:f.location,navigationType:f.action,navigator:u,future:o})}var Tf;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(Tf||(Tf={}));var Rf;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(Rf||(Rf={}));const $h=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),nv=({className:r})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Rs=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),Go=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),tr=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),bc=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"})}),kc=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})}),Wh=({className:r,filled:s})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:s?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.5 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z"})}),ki=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Sc=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),Vh=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0l-.07.07m15.482 0l.07.07m0 0l-1.018.51a51.011 51.011 0 01-4.456 2.054A51.011 51.011 0 0112 15.342a51.011 51.011 0 01-4.456-2.054l-1.018-.51m0 0l-1.018.51a51.011 51.011 0 01-4.456 2.054A51.011 51.011 0 0112 15.342a51.011 51.011 0 01-4.456-2.054l-1.018-.51"})}),qh=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 13.5V3.75m0 9.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 9.75V10.5"})}),sv=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),Hh=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"})}),iv=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25v13.5m-6-13.5v13.5"})}),ov=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z"})}),av=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"})}),Gh=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),lv=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})}),cv=({className:r})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 01-.354-17.995M12 21a9 9 0 009-9M12 21a9 9 0 00-9-9M12 3c-4.418 0-8 2.015-8 4.5S7.582 12 12 12s8-2.015 8-4.5S16.418 3 12 3z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9"})]}),uv=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),dv=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),fv=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z"})}),hv=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),pv=({onBack:r})=>a.jsxs("div",{className:"theme-text-primary container mx-auto min-h-screen p-4 md:p-8",children:[a.jsx("header",{className:"mb-8",children:a.jsxs("button",{onClick:r,className:"theme-text-secondary inline-flex items-center gap-2 transition-colors hover:text-sky-400",children:[a.jsx(Rs,{className:"w-5 h-5"}),a.jsx("span",{children:"Back to Library"})]})}),a.jsxs("main",{className:"max-w-4xl mx-auto space-y-8",children:[a.jsxs("section",{className:"theme-surface-elevated theme-border rounded-xl border p-6 shadow-lg",children:[a.jsx("h1",{className:"text-3xl font-bold text-sky-300 mb-2",children:"About MeBooks"}),a.jsxs("p",{className:"theme-text-secondary mb-4 text-lg",children:[a.jsx("span",{className:"font-semibold text-sky-200",children:"MeBooks"})," is a modern, browser-based ebook reader inspired by the user experience of Readium's Thorium, but built entirely with web technologies. EPUB books are rendered using ",a.jsx("span",{className:"font-semibold",children:"epub.js"}),", and PDF books are rendered using an embedded distribution of ",a.jsx("span",{className:"font-semibold",children:"pdf.js"})," via ",a.jsx("span",{className:"font-semibold",children:"react-pdf"})," and ",a.jsx("span",{className:"font-semibold",children:"pdfjs-dist"}),". Import EPUB and PDF books into your local library, or browse and download from online OPDS catalogs. Built with accessibility, privacy, and customization in mind."]})]}),a.jsxs("section",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"theme-surface-elevated theme-border flex flex-col gap-2 rounded-xl border p-6 shadow",children:[a.jsxs("h2",{className:"text-xl font-semibold text-sky-300 flex items-center gap-2 mb-2",children:["Accessibility & A11Y",a.jsx("span",{className:"bg-sky-900 text-sky-200 text-xs font-bold px-2 py-1 rounded ml-2",children:"WCAG 2.1 AA"})]}),a.jsxs("ul",{className:"theme-text-secondary list-inside list-disc space-y-1",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Keyboard Navigation:"})," Logical tab order, visible focus, and full keyboard support."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Screen Reader Support:"})," ARIA labels, live regions, and dynamic announcements."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"High Contrast & Color Blind Friendly:"})," Tested palette and contrast ratios."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Skip Links & Landmarks:"})," Quick navigation for assistive tech users."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Accessible Modals & Dialogs:"})," Focus management, ARIA roles, and announcements."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Global Keyboard Shortcuts:"})," Discoverable, accessible shortcuts for power users."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Adjustable Font Size & Family:"})," Reader settings for easy text customization."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Responsive Design:"})," Works on all devices and screen sizes."]})]}),a.jsx("div",{className:"mt-3",children:a.jsx("a",{href:"/JamesEnglish1028-My-Ebook-Reader/VPAT.html",target:"_blank",rel:"noopener noreferrer",className:"block bg-sky-900/80 border border-sky-700 rounded px-4 py-2 text-sky-300 font-semibold text-center hover:bg-sky-800 transition",children:"Accessibility VPAT (Voluntary Product Accessibility Template)"})})]}),a.jsxs("div",{className:"theme-surface-elevated theme-border flex flex-col gap-2 rounded-xl border p-6 shadow",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"Library Management"}),a.jsxs("ul",{className:"theme-text-secondary list-inside list-disc space-y-1",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Local-First Storage:"})," Your books and reading data never leave your computer. Book files are stored in IndexedDB, settings and annotations in LocalStorage."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"EPUB & PDF Import:"})," Build your personal library with ",a.jsx("code",{children:".epub"})," and ",a.jsx("code",{children:".pdf"})," files."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Book Details:"})," View publication info, subjects, and provider IDs."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Library Organization:"})," Sort by title, author, publication date, or date added."]})]})]})]}),a.jsxs("section",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"theme-surface-elevated theme-border flex flex-col gap-2 rounded-xl border p-6 shadow",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"Online Catalogs (OPDS)"}),a.jsxs("ul",{className:"theme-text-secondary list-inside list-disc space-y-1",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Browse Remote Libraries:"})," Add and manage unlimited public OPDS catalogs."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"OPDS v1 & v2 Support:"})," Compatible with XML (Atom) and JSON feeds."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"One-Click Import:"})," Download books directly from catalogs to your library."]})]})]}),a.jsxs("div",{className:"theme-surface-elevated theme-border flex flex-col gap-2 rounded-xl border p-6 shadow",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"Advanced Reader Experience"}),a.jsxs("ul",{className:"theme-text-secondary list-inside list-disc space-y-1",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Browser-Based:"})," No installation neededruns entirely in your browser."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Multi-Format Support:"})," Read EPUB files with ",a.jsx("span",{className:"font-semibold",children:"epub.js"})," and PDF files with an embedded ",a.jsx("span",{className:"font-semibold",children:"pdf.js"})," engine (",a.jsx("span",{className:"font-semibold",children:"react-pdf"})," + ",a.jsx("span",{className:"font-semibold",children:"pdfjs-dist"}),")."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Advanced Navigation:"})," Both readers support table of contents navigation, page jumping, and keyboard shortcuts for moving between chapters or pages."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Full-Text Search:"})," EPUB and PDF readers both support searching the entire book text, with results highlighted and easy navigation between matches."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Customizable Reader (EPUB):"})," Adjust font, theme, and reading mode (paginated or scrolled)."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Rich Tools (EPUB):"})," Bookmarks with notes, academic citation generation, and full-text search."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Citation Export (EPUB):"})," Export citations in ",a.jsx("code",{children:".ris"})," format for Zotero/EndNote."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Read Aloud (EPUB):"})," Text-to-speech with synchronized highlighting."]})]})]})]}),a.jsxs("section",{className:"theme-surface-elevated theme-border rounded-xl border p-6 shadow-lg",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"Technology Stack"}),a.jsxs("ul",{className:"theme-text-secondary list-inside list-disc space-y-1",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"React:"})," Component-based UI library."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"TypeScript:"})," Static typing for maintainable code."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"TailwindCSS:"})," Utility-first CSS for rapid styling."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"epub.js:"})," EPUB parsing and rendering."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"pdf.js:"})," PDF rendering (via ",a.jsx("span",{className:"font-semibold",children:"react-pdf"})," and ",a.jsx("span",{className:"font-semibold",children:"pdfjs-dist"}),")."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"JSZip:"})," EPUB unzipping (via ",a.jsx("code",{children:"epub.js"}),")."]})]}),a.jsx("p",{className:"theme-text-muted mt-2",children:"All external dependencies are loaded from a CDN for simplicity."})]}),a.jsxs("section",{className:"theme-surface-elevated theme-border mt-8 rounded-xl border p-6 shadow-lg",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"For Developers"}),a.jsxs("ul",{className:"theme-text-secondary list-inside list-disc space-y-1",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Vite:"})," Lightning-fast build tool and dev server for modern web apps."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"React Router:"})," Declarative routing for SPA navigation."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"React-PDF:"})," PDF rendering in React using pdf.js."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"TanStack Query:"})," Powerful data fetching and caching (if used)."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Other modern libraries:"})," Includes utility packages and accessibility helpers as needed."]})]}),a.jsxs("p",{className:"theme-text-muted mt-2",children:["See the ",a.jsx("code",{children:"package.json"})," for a full list of dependencies and scripts."]})]})]})]}),Pf={CATALOGS:"ebook-catalogs",REGISTRIES:"ebook-reader-registries"},En={GLOBAL_SETTINGS:"ebook-reader-settings-global",BOOKMARKS_PREFIX:"ebook-reader-bookmarks",CITATIONS_PREFIX:"ebook-reader-citations",POSITION_PREFIX:"ebook-reader-pos",SPOKEN_POSITION_PREFIX:"ebook-reader-spoken-pos",PDF_VIEW_STATE_PREFIX:"ebook-reader-pdf-view-state",EPUB_VIEW_STATE_PREFIX:"ebook-reader-epub-view-state"},mv={THEME:"ebook-reader-ui-theme"},gv={ETAG_CACHE_PREFIX:"mebooks.opds.etag"},_t={bookmarks:r=>`${En.BOOKMARKS_PREFIX}-${String(r)}`,citations:r=>`${En.CITATIONS_PREFIX}-${String(r)}`,position:r=>`${En.POSITION_PREFIX}-${String(r)}`,spokenPosition:r=>`${En.SPOKEN_POSITION_PREFIX}-${String(r)}`,pdfViewState:r=>`${En.PDF_VIEW_STATE_PREFIX}-${String(r)}`,epubViewState:r=>`${En.EPUB_VIEW_STATE_PREFIX}-${String(r)}`,etag:r=>`${gv.ETAG_CACHE_PREFIX}-${r}`},Kh="EbookReaderDB",rt="books",Qh=3,er={TITLE:"title",ISBN:"isbn",PROVIDER_ID:"providerId"},yv={BASE_URL:"/My-Ebook-Reader/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_CLIENT_ID:"970895595671-06di7pi5bs5hi96o9js5jr1eeo2pigm7.apps.googleusercontent.com",VITE_OWN_PROXY_URL:"https://my-ebook-reader.onrender.com"};class vv{isDebugMode(){if(typeof window<"u"&&window.__MEBOOKS_DEBUG__)return!0;try{const s=yv;return s?.DEV||s?.VITE_DEBUG_LOGGING==="true"}catch{return!1}}shouldLog(s){return s==="error"||s==="warn"?!0:this.isDebugMode()}debug(s,...n){this.shouldLog("debug")&&console.debug(`[mebooks:debug] ${s}`,...n)}info(s,...n){this.shouldLog("info")&&console.info(`[mebooks:info] ${s}`,...n)}warn(s,...n){this.shouldLog("warn")&&console.warn(`[mebooks:warn] ${s}`,...n)}error(s,...n){this.shouldLog("error")&&console.error(`[mebooks:error] ${s}`,...n)}log(s,...n){this.isDebugMode()&&console.log(`[mebooks] ${s}`,...n)}}const ne=new vv;class xv{safeParse(s,n){if(!s)return n;try{return JSON.parse(s)}catch(o){return ne.warn("Failed to parse bookmark JSON, using fallback",o),n}}findByBookId(s){try{ne.info("Finding bookmarks for book",{bookId:s});const n=_t.bookmarks(s),o=localStorage.getItem(n),c=this.safeParse(o,[]);return ne.info("Found bookmarks",{bookId:s,count:c.length}),{success:!0,data:c}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding bookmarks";return ne.error("Error finding bookmarks:",o),{success:!1,error:o}}}findById(s,n){try{const o=this.findByBookId(s);return o.success?{success:!0,data:o.data.find(l=>l.id===n)||null}:{success:!1,error:"Failed to find bookmarks"}}catch(o){const c=o instanceof Error?o.message:"Unknown error finding bookmark";return ne.error("Error finding bookmark by ID:",c),{success:!1,error:c}}}add(s,n){try{ne.info("Adding bookmark",{bookId:s,cfi:n.cfi});const o=this.findByBookId(s);if(!o.success)return{success:!1,error:"Failed to retrieve bookmarks"};const c={id:new Date().toISOString(),cfi:n.cfi,label:n.label||"Bookmark",chapter:n.chapter,description:n.description,createdAt:Date.now()},l=[...o.data,c];return this.saveAll(s,l).success?(ne.info("Bookmark added",{bookId:s,bookmarkId:c.id}),{success:!0,data:c}):{success:!1,error:"Failed to save bookmark"}}catch(o){const c=o instanceof Error?o.message:"Unknown error adding bookmark";return ne.error("Error adding bookmark:",c),{success:!1,error:c}}}update(s,n,o){try{ne.info("Updating bookmark",{bookId:s,bookmarkId:n});const c=this.findByBookId(s);if(!c.success)return{success:!1,error:"Failed to retrieve bookmarks"};const l=c.data,u=l.findIndex(h=>h.id===n);if(u===-1)return{success:!1,error:"Bookmark not found"};const f={...l[u],...o};return l[u]=f,this.saveAll(s,l).success?(ne.info("Bookmark updated",{bookId:s,bookmarkId:n}),{success:!0,data:f}):{success:!1,error:"Failed to save updated bookmark"}}catch(c){const l=c instanceof Error?c.message:"Unknown error updating bookmark";return ne.error("Error updating bookmark:",l),{success:!1,error:l}}}delete(s,n){try{ne.info("Deleting bookmark",{bookId:s,bookmarkId:n});const o=this.findByBookId(s);if(!o.success)return{success:!1,error:"Failed to retrieve bookmarks"};const c=o.data.filter(u=>u.id!==n);return c.length===o.data.length?{success:!1,error:"Bookmark not found"}:this.saveAll(s,c).success?(ne.info("Bookmark deleted",{bookId:s,bookmarkId:n}),{success:!0,data:void 0}):{success:!1,error:"Failed to save after deletion"}}catch(o){const c=o instanceof Error?o.message:"Unknown error deleting bookmark";return ne.error("Error deleting bookmark:",c),{success:!1,error:c}}}deleteAll(s){try{ne.warn("Deleting all bookmarks for book",{bookId:s});const n=_t.bookmarks(s);return localStorage.removeItem(n),ne.info("All bookmarks deleted",{bookId:s}),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error deleting all bookmarks";return ne.error("Error deleting all bookmarks:",o),{success:!1,error:o}}}count(s){try{const n=this.findByBookId(s);return n.success?{success:!0,data:n.data.length}:{success:!1,error:"Failed to count bookmarks"}}catch(n){const o=n instanceof Error?n.message:"Unknown error counting bookmarks";return ne.error("Error counting bookmarks:",o),{success:!1,error:o}}}existsAtCfi(s,n){try{const o=this.findByBookId(s);return o.success?{success:!0,data:o.data.some(l=>l.cfi===n)}:{success:!1,error:"Failed to check bookmark existence"}}catch(o){const c=o instanceof Error?o.message:"Unknown error checking bookmark existence";return ne.error("Error checking bookmark existence:",c),{success:!1,error:c}}}findByChapter(s,n){try{ne.info("Finding bookmarks by chapter",{bookId:s,chapter:n});const o=this.findByBookId(s);if(!o.success)return{success:!1,error:"Failed to find bookmarks by chapter"};const c=o.data.filter(l=>l.chapter===n);return ne.info("Found bookmarks by chapter",{bookId:s,chapter:n,count:c.length}),{success:!0,data:c}}catch(o){const c=o instanceof Error?o.message:"Unknown error finding bookmarks by chapter";return ne.error("Error finding bookmarks by chapter:",c),{success:!1,error:c}}}findSortedByDate(s){try{const n=this.findByBookId(s);return n.success?{success:!0,data:[...n.data].sort((c,l)=>l.createdAt-c.createdAt)}:{success:!1,error:"Failed to sort bookmarks"}}catch(n){const o=n instanceof Error?n.message:"Unknown error sorting bookmarks";return ne.error("Error sorting bookmarks:",o),{success:!1,error:o}}}saveAll(s,n){try{const o=_t.bookmarks(s);return localStorage.setItem(o,JSON.stringify(n)),{success:!0,data:void 0}}catch(o){const c=o instanceof Error?o.message:"Unknown error saving bookmarks";return ne.error("Error saving bookmarks:",c),{success:!1,error:c}}}exportBookmarks(s){try{const n=this.findByBookId(s);if(!n.success)return{success:!1,error:"Failed to export bookmarks"};const o=JSON.stringify(n.data,null,2);return ne.info("Bookmarks exported",{bookId:s,count:n.data.length}),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error exporting bookmarks";return ne.error("Error exporting bookmarks:",o),{success:!1,error:o}}}importBookmarks(s,n,o=!1){try{ne.info("Importing bookmarks",{bookId:s,merge:o});const c=this.safeParse(n,[]);if(!Array.isArray(c))return{success:!1,error:"Invalid bookmark data format"};let l=c;if(o){const f=this.findByBookId(s);if(!f.success)return{success:!1,error:"Failed to merge bookmarks"};const p=new Set(f.data.map(b=>b.id)),h=c.filter(b=>!p.has(b.id));l=[...f.data,...h]}return this.saveAll(s,l).success?(ne.info("Bookmarks imported",{bookId:s,count:c.length,totalCount:l.length}),{success:!0,data:c.length}):{success:!1,error:"Failed to save imported bookmarks"}}catch(c){const l=c instanceof Error?c.message:"Unknown error importing bookmarks";return ne.error("Error importing bookmarks:",l),{success:!1,error:l}}}}const mi=new xv;class wv{safeParse(s,n){if(!s)return n;try{return JSON.parse(s)}catch(o){return ne.warn("Failed to parse citation JSON, using fallback",o),n}}findByBookId(s){try{ne.info("Finding citations for book",{bookId:s});const n=_t.citations(s),o=localStorage.getItem(n),c=this.safeParse(o,[]);return ne.info("Found citations",{bookId:s,count:c.length}),{success:!0,data:c}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding citations";return ne.error("Error finding citations:",o),{success:!1,error:o}}}findById(s,n){try{const o=this.findByBookId(s);return o.success?{success:!0,data:o.data.find(l=>l.id===n)||null}:{success:!1,error:"Failed to find citations"}}catch(o){const c=o instanceof Error?o.message:"Unknown error finding citation";return ne.error("Error finding citation by ID:",c),{success:!1,error:c}}}add(s,n){try{ne.info("Adding citation",{bookId:s,cfi:n.cfi});const o=this.findByBookId(s);if(!o.success)return{success:!1,error:"Failed to retrieve citations"};const c={id:new Date().toISOString(),cfi:n.cfi,note:n.note,createdAt:Date.now(),pageNumber:n.pageNumber,chapter:n.chapter,citationFormat:n.citationFormat||"apa"},l=[...o.data,c];return this.saveAll(s,l).success?(ne.info("Citation added",{bookId:s,citationId:c.id}),{success:!0,data:c}):{success:!1,error:"Failed to save citation"}}catch(o){const c=o instanceof Error?o.message:"Unknown error adding citation";return ne.error("Error adding citation:",c),{success:!1,error:c}}}update(s,n,o){try{ne.info("Updating citation",{bookId:s,citationId:n});const c=this.findByBookId(s);if(!c.success)return{success:!1,error:"Failed to retrieve citations"};const l=c.data,u=l.findIndex(h=>h.id===n);if(u===-1)return{success:!1,error:"Citation not found"};const f={...l[u],...o};return l[u]=f,this.saveAll(s,l).success?(ne.info("Citation updated",{bookId:s,citationId:n}),{success:!0,data:f}):{success:!1,error:"Failed to save updated citation"}}catch(c){const l=c instanceof Error?c.message:"Unknown error updating citation";return ne.error("Error updating citation:",l),{success:!1,error:l}}}delete(s,n){try{ne.info("Deleting citation",{bookId:s,citationId:n});const o=this.findByBookId(s);if(!o.success)return{success:!1,error:"Failed to retrieve citations"};const c=o.data.filter(u=>u.id!==n);return c.length===o.data.length?{success:!1,error:"Citation not found"}:this.saveAll(s,c).success?(ne.info("Citation deleted",{bookId:s,citationId:n}),{success:!0,data:void 0}):{success:!1,error:"Failed to save after deletion"}}catch(o){const c=o instanceof Error?o.message:"Unknown error deleting citation";return ne.error("Error deleting citation:",c),{success:!1,error:c}}}deleteAll(s){try{ne.warn("Deleting all citations for book",{bookId:s});const n=_t.citations(s);return localStorage.removeItem(n),ne.info("All citations deleted",{bookId:s}),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error deleting all citations";return ne.error("Error deleting all citations:",o),{success:!1,error:o}}}count(s){try{const n=this.findByBookId(s);return n.success?{success:!0,data:n.data.length}:{success:!1,error:"Failed to count citations"}}catch(n){const o=n instanceof Error?n.message:"Unknown error counting citations";return ne.error("Error counting citations:",o),{success:!1,error:o}}}findByChapter(s,n){try{ne.info("Finding citations by chapter",{bookId:s,chapter:n});const o=this.findByBookId(s);if(!o.success)return{success:!1,error:"Failed to find citations by chapter"};const c=o.data.filter(l=>l.chapter===n);return ne.info("Found citations by chapter",{bookId:s,chapter:n,count:c.length}),{success:!0,data:c}}catch(o){const c=o instanceof Error?o.message:"Unknown error finding citations by chapter";return ne.error("Error finding citations by chapter:",c),{success:!1,error:c}}}findSortedByDate(s){try{const n=this.findByBookId(s);return n.success?{success:!0,data:[...n.data].sort((c,l)=>l.createdAt-c.createdAt)}:{success:!1,error:"Failed to sort citations"}}catch(n){const o=n instanceof Error?n.message:"Unknown error sorting citations";return ne.error("Error sorting citations:",o),{success:!1,error:o}}}saveAll(s,n){try{const o=_t.citations(s);return localStorage.setItem(o,JSON.stringify(n)),{success:!0,data:void 0}}catch(o){const c=o instanceof Error?o.message:"Unknown error saving citations";return ne.error("Error saving citations:",c),{success:!1,error:c}}}formatCitation(s,n,o="apa"){const c=o||n.citationFormat||"apa",l=s.author||"Unknown Author",u=s.title||"Untitled",f=s.publisher||"",p=this.getPublicationYear(s.publicationDate),h=n.chapter?`, ${n.chapter}`:"",b=n.pageNumber?`, p. ${n.pageNumber}`:"";let k="";switch(c.toLowerCase()){case"apa":k=`${this.formatAuthorName(l,"apa")} (${p}). ${u}. ${f}${h}${b}.`.trim();break;case"mla":k=`${l}. ${u}. ${f}, ${p}${h}${b}.`.trim();break;default:k=`${this.formatAuthorName(l,"apa")} (${p}). ${u}. ${f}${h}${b}.`.trim();break}return{text:k,format:c}}getPublicationYear(s){if(!s)return"n.d.";const n=s.match(/\d{4}/);return n?n[0]:"n.d."}formatAuthorName(s,n){const o=s.split(" ").filter(u=>u.trim());if(o.length<2)return s;const c=o.pop(),l=o;if(n==="apa"){const u=l.map(f=>f[0]?`${f[0]}.`:"").join(" ");return`${c}, ${u}`}return`${c}, ${l.join(" ")}`}exportCitations(s){try{const n=this.findByBookId(s);if(!n.success)return{success:!1,error:"Failed to export citations"};const o=JSON.stringify(n.data,null,2);return ne.info("Citations exported",{bookId:s,count:n.data.length}),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error exporting citations";return ne.error("Error exporting citations:",o),{success:!1,error:o}}}importCitations(s,n,o=!1){try{ne.info("Importing citations",{bookId:s,merge:o});const c=this.safeParse(n,[]);if(!Array.isArray(c))return{success:!1,error:"Invalid citation data format"};let l=c;if(o){const f=this.findByBookId(s);if(!f.success)return{success:!1,error:"Failed to merge citations"};const p=new Set(f.data.map(b=>b.id)),h=c.filter(b=>!p.has(b.id));l=[...f.data,...h]}return this.saveAll(s,l).success?(ne.info("Citations imported",{bookId:s,count:c.length,totalCount:l.length}),{success:!0,data:c.length}):{success:!1,error:"Failed to save imported citations"}}catch(c){const l=c instanceof Error?c.message:"Unknown error importing citations";return ne.error("Error importing citations:",l),{success:!1,error:l}}}}const yi=new wv;class bv{getPosition(s){try{ne.info("Getting position for book",{bookId:s});const n=_t.position(s),o=localStorage.getItem(n);return o?ne.info("Found position",{bookId:s,cfi:o.substring(0,50)+"..."}):ne.info("No position found",{bookId:s}),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error getting position";return ne.error("Error getting position:",o),{success:!1,error:o}}}savePosition(s,n){try{ne.info("Saving position for book",{bookId:s,cfi:n.substring(0,50)+"..."});const o=_t.position(s);return localStorage.setItem(o,n),ne.info("Position saved",{bookId:s}),{success:!0,data:void 0}}catch(o){const c=o instanceof Error?o.message:"Unknown error saving position";return ne.error("Error saving position:",c),{success:!1,error:c}}}clearPosition(s){try{ne.info("Clearing position for book",{bookId:s});const n=_t.position(s);return localStorage.removeItem(n),ne.info("Position cleared",{bookId:s}),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error clearing position";return ne.error("Error clearing position:",o),{success:!1,error:o}}}hasPosition(s){try{const n=this.getPosition(s);return n.success?{success:!0,data:n.data!==null}:{success:!1,error:"Failed to check position"}}catch(n){const o=n instanceof Error?n.message:"Unknown error checking position";return ne.error("Error checking position:",o),{success:!1,error:o}}}getReadingPosition(s){try{const n=this.getPosition(s);return n.success?n.data?{success:!0,data:{bookId:s,cfi:n.data,updatedAt:Date.now()}}:{success:!0,data:null}:{success:!1,error:"Failed to get reading position"}}catch(n){const o=n instanceof Error?n.message:"Unknown error getting reading position";return ne.error("Error getting reading position:",o),{success:!1,error:o}}}getSpeechPosition(s){try{ne.info("Getting speech position for book",{bookId:s});const n=_t.spokenPosition(s),o=localStorage.getItem(n);return o?ne.info("Found speech position",{bookId:s,cfi:o.substring(0,50)+"..."}):ne.info("No speech position found",{bookId:s}),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error getting speech position";return ne.error("Error getting speech position:",o),{success:!1,error:o}}}saveSpeechPosition(s,n){try{ne.info("Saving speech position for book",{bookId:s,cfi:n.substring(0,50)+"..."});const o=_t.spokenPosition(s);return localStorage.setItem(o,n),ne.info("Speech position saved",{bookId:s}),{success:!0,data:void 0}}catch(o){const c=o instanceof Error?o.message:"Unknown error saving speech position";return ne.error("Error saving speech position:",c),{success:!1,error:c}}}clearSpeechPosition(s){try{ne.info("Clearing speech position for book",{bookId:s});const n=_t.spokenPosition(s);return localStorage.removeItem(n),ne.info("Speech position cleared",{bookId:s}),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error clearing speech position";return ne.error("Error clearing speech position:",o),{success:!1,error:o}}}clearAllPositions(s){try{ne.info("Clearing all positions for book",{bookId:s});const n=this.clearPosition(s),o=this.clearSpeechPosition(s);return!n.success||!o.success?{success:!1,error:"Failed to clear all positions"}:(ne.info("All positions cleared",{bookId:s}),{success:!0,data:void 0})}catch(n){const o=n instanceof Error?n.message:"Unknown error clearing all positions";return ne.error("Error clearing all positions:",o),{success:!1,error:o}}}calculateProgress(s,n){if(n===0)return 0;const o=s/n*100;return Math.round(Math.max(0,Math.min(100,o)))}createLocationInfo(s,n,o){const c=o!==void 0?o:this.calculateProgress(s,n);return{currentPage:s,totalPages:n,progress:c}}formatLocationInfo(s){return`Page ${s.currentPage} of ${s.totalPages} (${s.progress}%)`}formatPageLabel(s){return`Page ${s.currentPage}`}formatPageWithProgress(s){return`Page ${s.currentPage} (${s.progress}%)`}getAllBooksWithPositions(){try{ne.info("Getting all books with positions");const s=[],n="reader_position_";for(let o=0;o<localStorage.length;o++){const c=localStorage.key(o);if(c&&c.startsWith(n)){const l=c.substring(n.length),u=parseInt(l,10);isNaN(u)||s.push(u)}}return ne.info("Found books with positions",{count:s.length}),{success:!0,data:s}}catch(s){const n=s instanceof Error?s.message:"Unknown error getting books with positions";return ne.error("Error getting books with positions:",n),{success:!1,error:n}}}exportAllPositions(){try{ne.info("Exporting all positions");const s=this.getAllBooksWithPositions();if(!s.success)return{success:!1,error:"Failed to export positions"};const n={};for(const c of s.data){const l=this.getPosition(c),u=this.getSpeechPosition(c);l.success&&u.success&&(n[c]={position:l.data,speechPosition:u.data})}const o=JSON.stringify(n,null,2);return ne.info("Positions exported",{bookCount:Object.keys(n).length}),{success:!0,data:o}}catch(s){const n=s instanceof Error?s.message:"Unknown error exporting positions";return ne.error("Error exporting positions:",n),{success:!1,error:n}}}importPositions(s,n=!1){try{ne.info("Importing positions",{merge:n});const o=JSON.parse(s);if(typeof o!="object"||o===null)return{success:!1,error:"Invalid positions data format"};if(!n){const l=this.getAllBooksWithPositions();if(l.success)for(const u of l.data)this.clearAllPositions(u)}let c=0;for(const[l,u]of Object.entries(o)){const f=parseInt(l,10);isNaN(f)||(u.position&&(this.savePosition(f,u.position),c++),u.speechPosition&&this.saveSpeechPosition(f,u.speechPosition))}return ne.info("Positions imported",{count:c}),{success:!0,data:c}}catch(o){const c=o instanceof Error?o.message:"Unknown error importing positions";return ne.error("Error importing positions:",c),{success:!1,error:c}}}clearAllBooksPositions(){try{ne.warn("Clearing all positions for all books");const s=this.getAllBooksWithPositions();if(!s.success)return{success:!1,error:"Failed to clear all positions"};let n=0;for(const o of s.data)this.clearAllPositions(o).success&&n++;return ne.info("All positions cleared",{count:n}),{success:!0,data:n}}catch(s){const n=s instanceof Error?s.message:"Unknown error clearing all positions";return ne.error("Error clearing all positions:",n),{success:!1,error:n}}}}const di=new bv,Xh=({book:r})=>{const s=c=>"downloadUrl"in c,n=c=>{const l=c.toUpperCase();return l==="PDF"?"bg-red-600":l==="AUDIOBOOK"?"bg-purple-600":"bg-sky-500"},o=s(r)&&r.alternativeFormats&&r.alternativeFormats.length>0?r.alternativeFormats.map((c,l)=>({key:`${r.title}-${c.format}-${l}`,format:c.format,mediaType:c.mediaType})):r.format?[{key:`${r.title}-${r.format}`,format:r.format,mediaType:null}]:[];return a.jsxs("div",{className:"flex gap-1 flex-wrap",children:[s(r)&&r.publicationTypeLabel&&a.jsx("span",{className:"inline-block text-xs font-bold px-2 py-0.5 rounded bg-green-700 text-white",title:`Publication Type: ${r.publicationTypeLabel}${r.schemaOrgType?" ("+r.schemaOrgType+")":""}`,children:r.publicationTypeLabel}),o.length>0&&o.map(c=>a.jsx("span",{className:`inline-block text-white text-[10px] font-bold px-2 py-0.5 rounded ${n(c.format)}`,title:c.mediaType?`Format: ${c.format}, MediaType: ${c.mediaType}`:`Format: ${c.format}`,children:c.format},c.key))]})},kv=r=>{r.target.src="/default-cover.png"},Lf=r=>{const s=new Date(r);return isNaN(s.getTime())?String(r):s.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})},Sv=r=>{if(!r)return;const s=new Date(r);return isNaN(s.getTime())?String(r):s.toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})},Nv=r=>{if(!r.includes("<"))return r;if(typeof window>"u"||typeof DOMParser>"u")return r.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,"").replace(/<style[\s\S]*?>[\s\S]*?<\/style>/gi,"");const n=new DOMParser().parseFromString(`<div>${r}</div>`,"text/html"),o=new Set(["P","BR","EM","STRONG","B","I","UL","OL","LI"]),c=u=>{if(u.nodeType===Node.ELEMENT_NODE){const f=u;if(!o.has(f.tagName)){const p=document.createDocumentFragment();for(;f.firstChild;)p.appendChild(f.firstChild);f.replaceWith(p),Array.from(p.childNodes).forEach(c);return}Array.from(f.attributes).forEach(p=>{f.removeAttribute(p.name)})}Array.from(u.childNodes).forEach(c)},l=n.body.firstElementChild;return l?(Array.from(l.childNodes).forEach(c),l.innerHTML):r},Cv=({libraryBook:r,bookmarks:s=[],citations:n=[],userCitationFormat:o})=>{function c(l,u){const f=new Blob([u],{type:"text/plain"}),p=URL.createObjectURL(f),h=document.createElement("a");h.href=p,h.download=l,document.body.appendChild(h),h.click(),setTimeout(()=>{document.body.removeChild(h),URL.revokeObjectURL(p)},0)}return a.jsxs("section",{className:"mt-8 space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"theme-text-primary mb-2 text-lg font-semibold",children:"Bookmarks"}),s.length>0?a.jsx("ul",{className:"space-y-2",children:s.map((l,u)=>a.jsxs("li",{className:"theme-surface-elevated theme-text-secondary rounded p-3",children:[a.jsx("div",{className:"font-semibold",children:l.label||`Bookmark ${u+1}`}),l.description&&a.jsx("div",{className:"theme-text-secondary mt-1 text-sm",children:l.description}),l.chapter&&a.jsxs("div",{className:"theme-text-muted mt-1 text-xs",children:["Chapter: ",l.chapter]}),a.jsxs("div",{className:"theme-text-muted text-xs",children:["Created: ",Lf(l.createdAt)]})]},l.id||u))}):a.jsx("div",{className:"theme-text-muted text-sm",children:"No bookmarks yet."})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"theme-text-primary mb-2 flex items-center justify-between text-lg font-semibold",children:["Citations",a.jsx("button",{className:"ml-2 px-3 py-1 rounded bg-sky-700 text-white text-xs font-bold hover:bg-sky-600",onClick:()=>{const l=n.map(u=>`${u.note||""} [${u.chapter||""}${u.pageNumber?", p."+u.pageNumber:""}]`).join(`
`);c(`${r.title||"citations"}.ris`,l)},children:"Export to RIS"})]}),n.length>0?a.jsx("ul",{className:"space-y-2",children:n.map((l,u)=>{const p=(l.citationFormat||o||"apa")==="mla"?"mla":"apa",h=yi.formatCitation(r,l,p);return a.jsxs("li",{className:"theme-surface-elevated theme-text-secondary rounded p-3",children:[a.jsx("div",{className:"font-semibold mb-1",children:h.text}),l.note&&a.jsx("div",{className:"theme-text-secondary mt-1 text-sm",children:l.note}),l.chapter&&a.jsxs("div",{className:"theme-text-muted mt-1 text-xs",children:["Chapter: ",l.chapter]}),l.pageNumber&&a.jsxs("div",{className:"theme-text-muted mt-1 text-xs",children:["Page: ",l.pageNumber]}),a.jsxs("div",{className:"theme-text-muted text-xs",children:["Created: ",Lf(l.createdAt)]}),a.jsx("span",{className:"inline-block mt-2 px-2 py-0.5 rounded text-xs font-bold bg-sky-900 text-sky-300",children:h.format.toUpperCase()})]},l.id||u)})}):a.jsx("div",{className:"theme-text-muted text-sm",children:"No citations yet."})]})]})},jv=({book:r,onBack:s,source:n,catalogName:o,userCitationFormat:c="apa",onReadBook:l,onImportFromCatalog:u,importStatus:f,setImportStatus:p})=>{const h=r,b=typeof h.publisher=="string"?h.publisher:h.publisher?.name,k=Sv(h.publicationDate),x=h.description||h.summary||"",y=mt.useMemo(()=>x?Nv(x):"",[x]),S={id:h.id??0,title:r.title,author:r.author,coverImage:r.coverImage,publisher:b,publicationDate:h.publicationDate,providerId:h.providerId,providerName:h.providerName,description:h.description??h.summary??void 0,subjects:h.subjects,format:h.format,isbn:h.isbn,language:h.language,rights:h.rights,identifiers:Array.isArray(h.identifiers)?h.identifiers.map(ae=>typeof ae=="string"?ae:ae?.value).filter(Boolean):void 0,opfRaw:h.opfRaw,accessModes:h.accessModes,accessModesSufficient:h.accessModesSufficient,accessibilityFeatures:h.accessibilityFeatures,hazards:h.hazards,accessibilitySummary:h.accessibilitySummary,certificationConformsTo:h.certificationConformsTo,certification:h.certification,accessibilityFeedback:h.accessibilityFeedback},[g,w]=mt.useState([]),[N,A]=mt.useState([]);mt.useEffect(()=>{if(h.id){const ae=mi.findByBookId(h.id);ae.success&&w(ae.data)}},[h.id]),mt.useEffect(()=>{if(h.id){const ae=yi.findByBookId(h.id);ae.success&&A(ae.data)}},[h.id]);const L=R.useRef(null),T=()=>{l&&h.id&&l(r)},[I,D]=mt.useState(!1),[W,F]=mt.useState(!1),U=r.format?.toUpperCase()||"",ie=(h.mediaType||h.acquisitionMediaType||"").toLowerCase(),B=U==="PDF"||U==="EPUB",H=ie==="application/pdf"||ie==="application/epub+zip",C=B||H,Q=async()=>{if(!W){if(F(!0),u){const ae=await u(r,o);ae.success?D(!0):ae.existingBook&&p&&p({isLoading:!1,message:"",error:`A book with the same identifier is already in your library: "${ae.existingBook.title}".`})}F(!1)}};return a.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-start px-4 md:px-12 md:pr-16 theme-text-primary",children:[a.jsxs("div",{className:"md:w-1/3 flex-shrink-0",children:[a.jsx(Ev,{onBack:s,source:n}),a.jsx("div",{className:"mb-10"}),a.jsxs("div",{className:"mb-6 flex flex-col items-center",children:[r.coverImage?a.jsx("img",{ref:L,src:r.coverImage,alt:r.title,className:"w-full max-w-xs h-auto object-cover rounded-lg shadow-2xl aspect-[2/3] mb-4",onError:kv}):a.jsx("div",{className:"theme-surface-elevated theme-text-muted aspect-[2/3] flex w-full max-w-xs items-center justify-center rounded-lg p-4 text-center shadow-2xl",children:a.jsx("span",{className:"font-semibold",children:r.title})}),n==="library"?a.jsx("button",{className:"mt-2 px-4 py-2 rounded bg-sky-700 text-white font-bold hover:bg-sky-600",onClick:T,children:"Read Book"}):a.jsx("button",{className:"mt-2 px-4 py-2 rounded bg-sky-700 text-white font-bold hover:bg-sky-600 disabled:opacity-60 disabled:cursor-not-allowed",onClick:Q,disabled:W||!C,children:W?"Importing...":C?"Import to My Library":"Cannot Import: Not EPUB or PDF"}),I&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:a.jsxs("div",{className:"theme-surface-elevated theme-border theme-text-primary flex flex-col items-center rounded-lg border p-8 shadow-2xl",children:[a.jsx("h2",{className:"theme-text-primary mb-4 text-2xl font-bold",children:"Import Successful!"}),a.jsx("p",{className:"theme-text-secondary mb-6",children:"The book has been imported to your library."}),a.jsx("button",{className:"px-4 py-2 rounded bg-sky-700 text-white font-bold hover:bg-sky-600",onClick:()=>D(!1),children:"Close"})]})})]}),a.jsx("div",{className:"w-full max-w-xs mx-auto",children:a.jsx(Cv,{libraryBook:S,bookmarks:g,citations:N,userCitationFormat:c})})]}),a.jsxs("div",{className:"md:w-2/3 mt-8 md:mt-0",children:[a.jsxs("div",{className:"mb-6 mt-10 flex flex-col justify-start",children:[a.jsx("h2",{className:"theme-text-primary mb-6 mt-0 text-4xl font-extrabold leading-tight md:text-5xl",children:r.title}),r.author&&a.jsxs("div",{className:"theme-text-secondary mb-2 text-lg",children:["By ",r.author]}),h.contributors&&h.contributors.length>0&&a.jsxs("div",{className:"theme-text-secondary mb-2",children:["Contributors: ",h.contributors.join(", ")]}),h.isbn&&a.jsxs("div",{className:"theme-text-secondary mb-2",children:["Publisher ID: ",h.isbn]}),(r.format||h.mediaType||h.acquisitionMediaType||h.publicationTypeLabel)&&a.jsx("div",{className:"mb-2 flex flex-col gap-1",children:a.jsxs("div",{className:"mb-2 flex flex-col gap-1",children:[a.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a.jsx(Xh,{book:r})}),!B&&(!ie||ie==="text/html")&&a.jsxs("div",{className:"theme-text-warning text-xs font-semibold",children:["Warning: This item may not be a valid book file (mediaType is ",ie?"text/html":"missing",")."]})]})}),x&&a.jsx("div",{className:"theme-text-secondary mt-4 text-base leading-7 [&_ol]:my-4 [&_ol]:list-decimal [&_ol]:pl-6 [&_p]:mb-4 [&_ul]:my-4 [&_ul]:list-disc [&_ul]:pl-6",dangerouslySetInnerHTML:{__html:y}})]}),a.jsxs("div",{className:"md:mb-4 md:mr-6 md:mt-4",children:[a.jsx("h3",{className:"theme-text-primary mb-3 text-xl font-bold",children:"Book Details"}),a.jsx("div",{className:"theme-divider mb-5 border-t"}),a.jsx("div",{className:"theme-surface-elevated rounded-lg p-6 md:p-8",children:a.jsxs("ul",{className:"space-y-2 text-base",children:[a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Catalog Provider:"})," ",a.jsx("span",{className:"theme-text-secondary",children:h.providerName||(n==="catalog"?o:"Imported locally")}),h.providerId?a.jsxs("div",{className:"theme-text-muted mt-1 text-xs",children:["Provider ID: ",/^https?:\/\//.test(h.providerId)?a.jsx("a",{href:h.providerId,target:"_blank",rel:"noopener noreferrer",className:"text-sky-400 underline hover:text-sky-600",children:h.providerId}):h.providerId]}):a.jsx("div",{className:"theme-text-muted mt-1 text-xs",children:"Imported locally"})]}),h.distributor&&a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Distributor:"})," ",a.jsx("span",{className:"theme-text-secondary",children:h.distributor})]}),h.accessibilitySummary&&a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Accessibility:"})," ",a.jsx("span",{className:"theme-text-secondary",children:h.accessibilitySummary})]}),h.accessibilityFeatures&&h.accessibilityFeatures.length>0&&a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Features:"})," ",a.jsx("span",{className:"theme-text-secondary",children:h.accessibilityFeatures.join(", ")})]}),b&&a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Publisher:"})," ",a.jsx("span",{className:"theme-text-secondary",children:b})]}),k&&a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Published:"})," ",a.jsx("span",{className:"theme-text-secondary",children:k})]}),h.language&&a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Language:"})," ",a.jsx("span",{className:"theme-text-secondary",children:h.language})]}),h.categories&&h.categories.length>0&&a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Categories:"})," ",a.jsx("span",{className:"theme-text-secondary",children:h.categories.map(ae=>ae.label||ae.term).join(", ")})]}),(!h.categories||h.categories.length===0)&&r.subjects&&r.subjects.length>0&&a.jsxs("li",{children:[a.jsx("span",{className:"theme-text-primary font-semibold",children:"Subjects:"})," ",a.jsx("span",{className:"theme-text-secondary",children:r.subjects.map(ae=>typeof ae=="string"?ae:ae.name).join(", ")})]})]})})]})]})]})},Ev=({onBack:r,source:s})=>a.jsx("header",{className:"mb-8",children:a.jsxs("button",{onClick:r,className:"theme-text-secondary inline-flex items-center gap-2 transition-colors hover:text-sky-400",children:[a.jsx(Rs,{className:"w-5 h-5"}),a.jsxs("span",{children:["Return to ",s==="library"?"My Library":"Catalog"]})]})}),ut={dbInstance:null},rn=()=>new Promise((r,s)=>{if(ut.dbInstance){r(ut.dbInstance);return}if(typeof indexedDB>"u"){const o=new Error("IndexedDB is not available in this environment.");ne.error("IndexedDB unavailable:",o),s(o);return}const n=indexedDB.open(Kh,Qh);n.onerror=()=>{ne.error("IndexedDB error:",n.error),s(n.error)},n.onsuccess=()=>{ut.dbInstance=n.result,r(ut.dbInstance)},n.onupgradeneeded=o=>{const c=o.target.result;let l;if(!c.objectStoreNames.contains(rt))l=c.createObjectStore(rt,{keyPath:"id",autoIncrement:!0}),l.createIndex(er.TITLE,er.TITLE,{unique:!1});else{const u=o.target.transaction;if(u)l=u.objectStore(rt);else return}o.oldVersion<2&&(l.indexNames.contains(er.ISBN)||l.createIndex(er.ISBN,er.ISBN,{unique:!1})),o.oldVersion<3&&(l.indexNames.contains(er.PROVIDER_ID)||l.createIndex(er.PROVIDER_ID,er.PROVIDER_ID,{unique:!1}))}}),_v=async r=>{let s;try{s=await rn()}catch(n){return Promise.reject(n)}return new Promise((n,o)=>{const u=s.transaction(rt,"readwrite").objectStore(rt).put(r);u.onsuccess=()=>{n(u.result)},u.onerror=()=>{ne.error("Error saving book:",u.error),o("Error saving book")}})},Av=async()=>{const r=await rn();return new Promise((s,n)=>{const l=r.transaction(rt,"readonly").objectStore(rt).openCursor(),u=[];l.onsuccess=f=>{const p=f.target.result;p?(u.push({...p.value}),p.continue()):(console.log("[db.getBooksMetadata] Loaded metadata:",u),s(u))},l.onerror=()=>{ne.error("Error getting books:",l.error),n("Error getting books")}})},Tv=async()=>{const r=await rn();return new Promise((s,n)=>{const l=r.transaction(rt,"readonly").objectStore(rt).getAll();l.onsuccess=()=>{console.log("[db.getAllBooks] Loaded books:",l.result),s(l.result)},l.onerror=()=>{ne.error("Error getting all books:",l.error),n("Error getting all books")}})},Rv=async r=>{const s=await rn();return new Promise((n,o)=>{const u=s.transaction(rt,"readonly").objectStore(rt).get(r);u.onsuccess=()=>{n(u.result)},u.onerror=()=>{ne.error("Error getting book:",u.error),o("Error getting book")}})},Pv=async r=>{const s=await rn();return new Promise((n,o)=>{const u=s.transaction(rt,"readonly").objectStore(rt).get(r);u.onsuccess=()=>{const f=u.result;n(f?{...f,id:f.id}:null)},u.onerror=()=>{ne.error("Error getting book metadata:",u.error),o("Error getting book metadata")}})},Lv=async r=>{if(!r)return null;const s=await rn(),n=c=>new Promise((l,u)=>{try{const p=s.transaction(rt,"readonly").objectStore(rt);if(!p.indexNames.contains(c)){l(null);return}const b=p.index(c).get(r);b.onsuccess=()=>{l(b.result||null)},b.onerror=()=>{ne.error(`Error finding book by ${c}:`,b.error),u(`Error finding book by ${c}`)}}catch(f){ne.error(`Error initiating search on index ${c}:`,f),l(null)}}),o=await n("providerId");return o||n("isbn")},Ov=async r=>{const s=await rn();return new Promise((n,o)=>{const u=s.transaction(rt,"readwrite").objectStore(rt).delete(r);u.onsuccess=()=>{n()},u.onerror=()=>{ne.error("Error deleting book:",u.error),o("Error deleting book")}})},Iv=async()=>{const r=await rn();return new Promise((s,n)=>{const l=r.transaction(rt,"readwrite").objectStore(rt).clear();l.onsuccess=()=>{s()},l.onerror=()=>{ne.error("Error clearing books:",l.error),n("Error clearing books")}})};ut.init=rn;ut.saveBook=_v;ut.getBooksMetadata=Av;ut.getAllBooks=Tv;ut.getBook=Rv;ut.getBookMetadata=Pv;ut.findBookByIdentifier=Lv;ut.deleteBook=Ov;ut.clearAllBooks=Iv;const Ni=(r,s)=>{if(!r)return s;try{return JSON.parse(r)}catch(n){return console.warn("Failed to parse JSON from storage, using fallback",n),s}},Of={fontSize:100,theme:"light",flow:"paginated",fontFamily:"Original",citationFormat:"apa",readAloud:{voiceURI:null,rate:.9,pitch:1,volume:1}},sc=()=>{const r=localStorage.getItem(En.GLOBAL_SETTINGS),s=Ni(r,{});return{...Of,...s,readAloud:{...Of.readAloud,...s.readAloud||{}}}},If=r=>{localStorage.setItem(En.GLOBAL_SETTINGS,JSON.stringify(r))},Fv=r=>{const s=localStorage.getItem(_t.bookmarks(r));return Ni(s,[])},$l=(r,s)=>{localStorage.setItem(_t.bookmarks(r),JSON.stringify(s))},Dv=r=>{const s=localStorage.getItem(_t.citations(r));return Ni(s,[])},Ff=(r,s)=>{localStorage.setItem(_t.citations(r),JSON.stringify(s))},Bv=r=>localStorage.getItem(_t.position(r)),Mv=(r,s)=>{localStorage.setItem(_t.position(r),s)},Uv=async(r,s)=>{if(!s||!r)return[];const n=r.spine.spineItems.map(c=>c.load(r.load.bind(r)).then(()=>{const l=c.find(s.trim());return c.unload(),Promise.resolve(l)}).catch(()=>(c.unload(),Promise.resolve([])))),o=await Promise.all(n);return[].concat(...o)},zv=async r=>{try{if(r.navigation&&Array.isArray(r.navigation.landmarks)&&r.navigation.landmarks.length>0){const s=r.navigation.landmarks.find(n=>(n.type||"").toString().toLowerCase().includes("bodymatter"));if(s&&s.href)return s.href}}catch(s){console.warn("Error reading navigation landmarks when finding first chapter",s)}try{if(r.packaging&&Array.isArray(r.packaging.guide)&&r.packaging.guide.length>0){const s=r.packaging.guide.find(n=>(n.type||"").toString().toLowerCase().includes("text"));if(s&&s.href)return s.href}}catch(s){console.warn("Error reading packaging guide when finding first chapter",s)}if(r.spine&&Array.isArray(r.spine.items)){for(const s of r.spine.items)try{if(r.spine.get){const n=await r.spine.get(s.href);if(!n)continue;const c=(await n.load())?.body;let l=!1;if(c&&(c.textContent||"").trim().length>300&&(l=!0),n.unload(),l)return s.href}else return s.href}catch(n){console.warn(`Could not parse section ${s.href} when searching for first chapter. Skipping.`,n)}return r.spine.items.length>0?r.spine.items[0].href:void 0}},Df=r=>{const s=[];try{if(r&&r.spine&&Array.isArray(r.spine.items))for(let n=0;n<r.spine.items.length;n++){const o=r.spine.items[n],c=o.href||o.idref||`item-${n}`,l=o.id||(o.href?o.href.split("#")[0].split("/").pop():`Section ${n+1}`)||`Section ${n+1}`;s.push({id:`${n}`,href:c,label:l})}}catch(n){console.warn("Failed to build fallback TOC from spine",n)}return s},$v=r=>{try{const s=localStorage.getItem(_t.pdfViewState(r));return Ni(s,{zoomPercent:100,fitMode:"page"})}catch(s){return console.warn("Failed to read pdf view state",s),{zoomPercent:100,fitMode:"page"}}},Wv=(r,s)=>{try{localStorage.setItem(_t.pdfViewState(r),JSON.stringify(s))}catch(n){console.warn("Failed to save pdf view state",n)}},Vv=r=>{try{const s=localStorage.getItem(_t.epubViewState(r));return Ni(s,{})}catch(s){return console.warn("Failed to read epub view state",s),{}}},qv=(r,s)=>{try{localStorage.setItem(_t.epubViewState(r),JSON.stringify(s))}catch(n){console.warn("Failed to save epub view state",n)}},Ko={BASE_URL:"/My-Ebook-Reader/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_CLIENT_ID:"970895595671-06di7pi5bs5hi96o9js5jr1eeo2pigm7.apps.googleusercontent.com",VITE_OWN_PROXY_URL:"https://my-ebook-reader.onrender.com"},Bf=(r,s,n,o,c,l)=>{const u=s.split(" ");let f="",p=o;for(let h=0;h<u.length;h++){const b=f+u[h]+" ";r.measureText(b).width>c&&h>0?(r.fillText(f,n,p),f=u[h]+" ",p+=l):f=b}return r.fillText(f,n,p),p+l},Mf=(r,s)=>new Promise(n=>{const l=document.createElement("canvas");l.width=400,l.height=600;const u=l.getContext("2d");if(!u)return n("");const f=u.createLinearGradient(0,0,400,600);f.addColorStop(0,"#1e3a8a"),f.addColorStop(1,"#4c1d95"),u.fillStyle=f,u.fillRect(0,0,400,600);const p=70,h=35,b=400-p-20,k=20;u.fillStyle="#dc2626",u.fillRect(b,k,p,h),u.font="bold 20px sans-serif",u.fillStyle="white",u.textAlign="center",u.textBaseline="middle",u.fillText("PDF",b+p/2,k+h/2),u.textAlign="left",u.textBaseline="top",u.fillStyle="white",u.font="bold 42px sans-serif";const x=Bf(u,r,30,100,340,50);u.strokeStyle="rgba(255, 255, 255, 0.3)",u.lineWidth=1,u.beginPath(),u.moveTo(30,x+10),u.lineTo(370,x+10),u.stroke(),u.font="24px sans-serif",u.fillStyle="rgba(255, 255, 255, 0.8)",Bf(u,s,30,x+30,340,30),n(l.toDataURL("image/jpeg",.9))});const Uf=typeof import.meta<"u"&&Ko?"https://my-ebook-reader.onrender.com":"",Hv=typeof import.meta<"u"&&Ko&&!1,Gv=typeof import.meta<"u"&&Ko&&!1,zf=()=>{try{return typeof window<"u"&&window.location&&window.location.origin?window.location.origin:""}catch{return""}},qt=r=>{try{if(new URL(r),Uf){let s=Uf.trim();s=s.replace(/\/+$/,""),s.endsWith("/proxy")||(s=`${s}/proxy`);const n=s.includes("?")?"&":"?";return`${s}${n}url=${encodeURIComponent(r)}`}return r}catch{return console.error("Invalid URL passed to proxiedUrl:",r),""}},Or=async(r,s=!1)=>{let n;try{n=new URL(r)}catch{return console.error("Invalid URL for maybeProxyForCors:",r),""}const o=n.hostname.toLowerCase();if(o==="palace.io"||o.endsWith(".palace.io")||o.endsWith("palaceproject.io")||o.endsWith("thepalaceproject.org")||o.endsWith(".thepalaceproject.org")){const f=qt(r);return console.log("[maybeProxyForCors] Palace host detected, skipping direct probe:",r.substring(0,80)),f}const l=zf();if(n.protocol==="http:"&&l.startsWith("https://")){const f=qt(r);if(f&&f!==r)return console.log("[maybeProxyForCors] HTTPS app detected plain HTTP upstream, forcing proxy:",r.substring(0,80)),f;throw new Error("This resource uses plain HTTP and cannot be fetched directly from an HTTPS app. Configure an owned proxy via VITE_OWN_PROXY_URL, enable a proxy, or run the app over HTTP while debugging.")}if(s)return console.log("[maybeProxyForCors] Skipping HEAD probe for open-access content, using direct URL"),r;try{console.log("[maybeProxyForCors] Starting HEAD probe for:",r.substring(0,80));let f=await fetch(r,{method:"HEAD",mode:"cors",redirect:"manual",credentials:"include"});if(f&&f.status===405)try{console.log("[maybeProxyForCors] HEAD returned 405, trying GET probe"),f=await fetch(r,{method:"GET",mode:"cors",redirect:"manual",credentials:"include"})}catch(h){console.log("[maybeProxyForCors] GET probe failed:",String(h).substring(0,80))}if(!f)return console.log("[maybeProxyForCors] No response, using proxy"),qt(r);if(f.status>=300&&f.status<400)return console.log("[maybeProxyForCors] HEAD probe redirect",{url:r.substring(0,80),status:f.status}),qt(r);if(f.status>=200&&f.status<300){const h=f.headers.get("access-control-allow-origin");try{const b=zf();if(console.log("[maybeProxyForCors] HEAD probe success",{url:r.substring(0,80),status:f.status,allow:h,origin:b}),h==="*"||h&&b&&h===b)return console.log("[maybeProxyForCors] CORS allows direct URL, skipping proxy"),r;console.log("[maybeProxyForCors] CORS headers missing or mismatched, using proxy")}catch(b){console.log("[maybeProxyForCors] error determining origin, falling back to proxy",{url:r.substring(0,80),err:String(b).substring(0,80)})}}else console.log("[maybeProxyForCors] probe returned non-2xx:",{url:r.substring(0,80),status:f.status});const p=qt(r);return console.log("[maybeProxyForCors] Returning proxied URL"),p}catch(f){return console.log("[maybeProxyForCors] Probe error (network/CORS), using proxy:",String(f).substring(0,100)),qt(r)}},$f=async r=>{try{const s=qt(r),n=await fetch(s);if(!n.ok)return console.error(`Failed to fetch cover image from ${r}, status: ${n.status}`),null;const o=await n.blob();return new Promise((c,l)=>{const u=new FileReader;u.onloadend=()=>{typeof u.result=="string"&&u.result.startsWith("data:")?c(u.result):(console.error(`Failed to convert resource from ${r} to base64 DataURL.`),c(null))},u.onerror=()=>{console.error(`Error reading blob from ${r} as DataURL.`),l(null)},u.readAsDataURL(o)})}catch(s){return console.error("Error fetching or converting image to base64:",s),null}},Wf=(r,s)=>{try{const n={event:r,payload:s||{},ts:Date.now()};try{window.dispatchEvent(new CustomEvent("analytics",{detail:n}))}catch{}$r()&&console.info("trackEvent:",r,s||{})}catch(n){$r()&&console.warn("trackEvent failed",n)}},$r=()=>{try{if(typeof window<"u"&&window.__MEBOOKS_DEBUG__)return!0}catch{}try{typeof import.meta<"u"}catch{}return!1},Kv="application/atom+xml;profile=opds-catalog",Qv="application/opds+json",Vf="__OPENSEARCH_OPEN__",qf="__OPENSEARCH_CLOSE__";function Xv(r){try{const s=new URL(r).hostname.toLowerCase();return s.endsWith("palace.io")||s.endsWith("palaceproject.io")||s.endsWith("thepalaceproject.org")||s==="palace.io"||s.endsWith(".palace.io")||s.endsWith(".thepalaceproject.org")}catch{return!1}}function Wl(r,s){return Array.from(r.children).find(c=>(c.localName||c.nodeName||"").toLowerCase()===s.toLowerCase())?.textContent?.trim()||void 0}function Zh(r){const s=r.matchAll(/\{([^}]+)\}/g),n=[];for(const o of s){const c=String(o[1]||"").trim();if(!c)continue;(("?&/#.;+".includes(c[0]||"")?c[0]:"")?c.slice(1):c).split(",").map(p=>p.trim()).filter(Boolean).forEach(p=>{const h=!p.endsWith("?"),b=h?p:p.slice(0,-1),[k,x]=b.includes(":")?b.split(/:(.+)/,2):[void 0,b],y=(x||b).trim();y&&n.push({name:y,required:h,namespace:k?.trim()||void 0})})}return n}function Yh(r,s){const n=r.replaceAll("{",Vf).replaceAll("}",qf);return new URL(n,s).href.replaceAll(Vf,"{").replaceAll(qf,"}")}function Hf(r){const s=String(r.type||"").toLowerCase();return s.includes(Kv)?300:s.includes(Qv)?200:s.includes("application/atom+xml")?150:s.includes("application/json")?100:0}function Zv(r){if(r.length!==0)return[...r].sort((s,n)=>{const o=Hf(n)-Hf(s);return o!==0?o:s.method.localeCompare(n.method)})[0]}function Yv(r){return r.replace(/([?&])[^=&?#]+=(?=&|$)/g,"$1").replace(/[?&]{2,}/g,"?").replace(/\?&/g,"?").replace(/[?&]+$/g,"")}function Jh(r){if(r.includes(":")){const[s,n]=r.split(/:(.+)/,2);return{lookupKey:n,queryKey:`${s}:${n}`}}return{lookupKey:r,queryKey:r}}function Jv(r){const s=new Map;return(r||[]).forEach(n=>{s.set(n.name,n.required),n.namespace&&s.set(`${n.namespace}:${n.name}`,n.required)}),s}function ex(r,s,n){const o=!r.endsWith("?"),c=o?r:r.slice(0,-1),{lookupKey:l}=Jh(c),u=n?.get(c)??n?.get(l)??o,f=s[l]??s[c];if(f==null||String(f).length===0){if(u)throw new Error(`Missing required OpenSearch parameter: ${l}`);return""}return encodeURIComponent(String(f))}function tx(r,s,n){const o="?&".includes(r[0]||"")?r[0]:"",l=(o?r.slice(1):r).split(",").map(f=>f.trim()).filter(Boolean);if(!o)return l.map(f=>ex(f,s,n)).join(",");const u=l.map(f=>{const p=!f.endsWith("?"),h=p?f:f.slice(0,-1),{lookupKey:b,queryKey:k}=Jh(h),x=n?.get(h)??n?.get(b)??p,y=s[b]??s[h];if(y==null||String(y).length===0){if(x)throw new Error(`Missing required OpenSearch parameter: ${b}`);return null}return`${k}=${encodeURIComponent(String(y))}`}).filter(f=>f!==null);return u.length===0?"":`${o}${u.join("&")}`}function rx(r,s){const o=new DOMParser().parseFromString(r,"application/xml");if(o.querySelector("parsererror"))throw new Error("Failed to parse OpenSearch description document.");if(!(o.documentElement?.nodeName?.toLowerCase()||"").includes("opensearchdescription"))throw new Error("Invalid OpenSearch description document.");const u=o.documentElement,p=Array.from(u.children).filter(h=>(h.localName||h.nodeName||"").toLowerCase()==="url").map(h=>{const b=h.getAttribute("template")?.trim();if(!b)return null;const k=Yh(b,s),x=h.getAttribute("method")?.trim()||"GET",y=h.getAttribute("rel")?.trim()||void 0,S=Number(h.getAttribute("indexOffset")),g=Number(h.getAttribute("pageOffset"));return{template:k,type:h.getAttribute("type")?.trim()||void 0,method:x,rel:y,indexOffset:Number.isFinite(S)?S:void 0,pageOffset:Number.isFinite(g)?g:void 0,params:Zh(k)}}).filter(h=>h!==null);return{shortName:Wl(u,"ShortName"),description:Wl(u,"Description"),tags:Wl(u,"Tags")?.split(/\s+/).filter(Boolean),urls:p,activeTemplate:Zv(p)}}function nx(r,s){const n=typeof r=="string"?r:r.template,o=Jv(typeof r=="string"?void 0:r.params),c=n.replace(/\{([^}]+)\}/g,(l,u)=>tx(String(u||"").trim(),s,o));return Yv(c)}async function sx(r){try{const s=Xv(r)?qt(r):await Or(r),n=await fetch(s,{method:"GET",headers:{Accept:"application/opensearchdescription+xml, application/xml, text/xml;q=0.9, */*;q=0.5"}});if(!n.ok)throw new Error(`Catalog search is unavailable because the OpenSearch description could not be loaded (${n.status}).`);const o=await n.text();return rx(o,r)}catch(s){throw s instanceof Error&&(s.message.includes("Catalog search is unavailable")||s.message.includes("Invalid OpenSearch description document.")||s.message.includes("Failed to parse OpenSearch description document."))?s:new Error("Catalog search is unavailable because the OpenSearch description could not be reached.")}}const ix="MeBooksCredentialsDB",Vr="credentials",Mo="meta",ox=2,Gf="credential-encryption-key";function Qo(){return new Promise((r,s)=>{const n=indexedDB.open(ix,ox);n.onupgradeneeded=()=>{const o=n.result;o.objectStoreNames.contains(Vr)||o.createObjectStore(Vr,{keyPath:"host"}),o.objectStoreNames.contains(Mo)||o.createObjectStore(Mo,{keyPath:"id"})},n.onsuccess=()=>r(n.result),n.onerror=()=>s(n.error)})}function Kf(r){let s="";for(let o=0;o<r.length;o+=32768){const c=r.subarray(o,o+32768);s+=String.fromCharCode(...c)}return btoa(s)}function Qf(r){const s=atob(r),n=new Uint8Array(s.length);for(let o=0;o<s.length;o++)n[o]=s.charCodeAt(o);return n}async function Nc(r){if(!globalThis.crypto?.subtle)return null;const s=r.transaction(Mo,"readwrite"),n=s.objectStore(Mo),o=await new Promise((l,u)=>{const f=n.get(Gf);f.onsuccess=()=>l(f.result?.key),f.onerror=()=>u(f.error)});if(o)return o;const c=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!1,["encrypt","decrypt"]);return await new Promise((l,u)=>{const f=n.put({id:Gf,key:c});f.onsuccess=()=>l(),f.onerror=()=>u(f.error)}),await new Promise((l,u)=>{s.oncomplete=()=>l(),s.onerror=()=>u(s.error)}),c}async function ax(r,s){const n=crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(s),c=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,o);return{cipher:Kf(new Uint8Array(c)),iv:Kf(n)}}async function lx(r,s,n){const o=Qf(n),c=Qf(s),l=new Uint8Array(o.byteLength);l.set(o);const u=new Uint8Array(c.byteLength);u.set(c);const f=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},r,u);return new TextDecoder().decode(new Uint8Array(f))}async function ep(r,s){if(r.passwordCipher&&r.iv&&s)try{const n=await lx(s,r.passwordCipher,r.iv);return{host:r.host,username:r.username,password:n}}catch(n){ne.warn("Failed to decrypt stored credential",{host:r.host,error:n});return}if(r.password)return{host:r.host,username:r.username,password:r.password}}async function Cc(r,s,n){try{const o=await Qo(),c=await Nc(o),l=o.transaction(Vr,"readwrite"),u=l.objectStore(Vr);let f={host:r,username:s,password:n};if(c){const p=await ax(c,n);f={host:r,username:s,passwordCipher:p.cipher,iv:p.iv,v:2}}return u.put(f),new Promise((p,h)=>{l.oncomplete=()=>p(),l.onerror=()=>h(l.error)})}catch(o){ne.warn("saveCredential failed",o)}}async function tp(){try{const r=await Qo(),s=await Nc(r),c=r.transaction(Vr,"readonly").objectStore(Vr).getAll(),l=await new Promise((f,p)=>{c.onsuccess=()=>f(c.result||[]),c.onerror=()=>p(c.error)});return(await Promise.all(l.map(f=>ep(f,s)))).filter(f=>!!f)}catch(r){return ne.warn("getAllCredentials failed",r),[]}}async function cx(r){try{const s=await Qo(),n=await Nc(s),l=s.transaction(Vr,"readonly").objectStore(Vr).get(r),u=await new Promise((p,h)=>{l.onsuccess=()=>p(l.result),l.onerror=()=>h(l.error)});if(!u)return;const f=await ep(u,n);return f&&n&&u.password&&!u.passwordCipher&&await Cc(f.host,f.username,f.password),f}catch(s){ne.warn("findCredential failed",s);return}}async function ux(r){try{const n=(await Qo()).transaction(Vr,"readwrite");return n.objectStore(Vr).delete(r),new Promise((c,l)=>{n.oncomplete=()=>c(),n.onerror=()=>l(n.error)})}catch(s){ne.warn("deleteCredential failed",s)}}async function dx(r="mebooks.opds.credentials"){try{const s=localStorage.getItem(r);if(!s)return;let n=null;try{n=JSON.parse(s)}catch{n=null}if(!Array.isArray(n))return;const o=await tp(),c=new Set(o.map(l=>l.host));for(const l of n)!l||!l.host||c.has(l.host)||await Cc(l.host,l.username,l.password);try{localStorage.removeItem(r)}catch{}}catch(s){ne.warn("migrateFromLocalStorage failed",s)}}const jc={saveCredential:Cc,getAllCredentials:tp,findCredential:cx,deleteCredential:ux,migrateFromLocalStorage:dx},fx={"https://schema.org/Book":"Book","https://schema.org/Audiobook":"Audiobook","https://schema.org/Photograph":"Photograph","https://schema.org/Drawing":"Drawing","https://schema.org/Sculpture":"Sculpture","https://schema.org/Poster":"Poster","https://schema.org/Painting":"Painting","https://schema.org/image":"Image","https://schema.org/Article":"Article","https://schema.org/Periodical":"Periodical","https://schema.org/ShortStory":"Short Story","https://schema.org/Map":"Map","https://schema.org/Manuscript":"Manuscript","https://schema.org/SheetMusic":"Sheet Music","https://schema.org/audio":"Audio","https://schema.org/video":"Video","https://schema.org/Chapter":"Chapter","https://schema.org/MusicAlbum":"Music Album","https://schema.org/DigitalDocument":"Digital Document"};function hx(r){if(!r)return{schemaOrgType:"https://schema.org/DigitalDocument",publicationTypeLabel:"Digital Document"};const s=fx[r]||"Digital Document";return{schemaOrgType:r,publicationTypeLabel:s}}function gi(r){return r||""}function Uo(r){return String(r??"").toLowerCase()}function Wr(r){const s=String(r??"").trim();return s.length>0?s:void 0}function An(r){return(Array.isArray(r)?r:[r]).map(n=>gi(Uo(n))).filter(n=>n.length>0)}function Hn(r){return r?r.isCatalog?!0:typeof r.type=="string"&&r.type.includes("application/opds+json"):!1}function px(r,s){const n=[];return r.catalogs&&Array.isArray(r.catalogs)&&r.catalogs.forEach(o=>{if(!o)return;const c=o.metadata||{},l=c.title||c.name||o.title||"Catalog",u=Array.isArray(o.links)?o.links:[],p=(()=>{const h=x=>Uo(x).includes("catalog"),b=u.find(x=>typeof x.rel=="string"&&h(x.rel));if(b)return b;const k=u.find(x=>Array.isArray(x.rel)&&x.rel.some(y=>typeof y=="string"&&h(y)));return k||u.find(x=>typeof x.type=="string"&&x.type.includes("opds"))})();p&&p.href&&n.push({title:l,url:new URL(p.href,s).href,rel:"subsection",isCatalog:!0,source:"registry"})}),r.groups&&Array.isArray(r.groups)&&r.groups.forEach(o=>{const c=o.metadata?.title||"";o.navigation&&Array.isArray(o.navigation)&&o.navigation.forEach(l=>{const u=Wr(l.title);if(l.href&&u&&Hn(l)){const f=new URL(l.href,s).href,p=c?`${c}: ${u}`:u;let h="";typeof l.rel=="string"?h=gi(l.rel):Array.isArray(l.rel)&&l.rel.length>0?h=gi(String(l.rel[0])):h=Hn(l)?"subsection":"";const b=Hn(l);n.push({title:p,url:f,rel:Array.isArray(h)?String(h[0]):h,isCatalog:b,type:l.type,source:"group"})}})}),r.navigation&&Array.isArray(r.navigation)&&r.navigation.forEach(o=>{const c=Wr(o.title);if(o.href&&c&&Hn(o)){const l=new URL(o.href,s).href;let u="";typeof o.rel=="string"?u=gi(o.rel):Array.isArray(o.rel)&&o.rel.length>0?u=gi(String(o.rel[0])):u=Hn(o)?"subsection":"";const f=Hn(o);n.push({title:c,url:l,rel:Array.isArray(u)?String(u[0]):u,isCatalog:f,type:o.type,source:"navigation"})}}),r.links&&Array.isArray(r.links)&&r.links.forEach(o=>{if(o.href&&o.rel){const c=An(o.rel),l=new URL(o.href,s).href,u=Wr(o.title),f=c.some(h=>h.includes("start")),p=c.some(h=>h==="up"||h.endsWith("/up"));(f||p)&&n.push({title:u||(f?"Home":"Up"),url:l,rel:c[0]||(f?"start":"up"),type:o.type,isCatalog:!1,source:"navigation"}),Hn(o)&&c.some(h=>h.includes("collection")||h.includes("subsection")||h.includes("section"))&&u&&n.push({title:u,url:l,rel:c[0]||"",type:o.type,isCatalog:!1,source:"navigation"})}}),n}function mx(r,s){if(!Array.isArray(r?.facets))return[];const n=[];return r.facets.forEach((o,c)=>{const l=Wr(o?.metadata?.title)||Wr(o?.title)||`Facet Group ${c+1}`,f=(Array.isArray(o?.links)?o.links:Array.isArray(o?.navigation)?o.navigation:[]).map(p=>{const h=Wr(p?.title),b=Wr(p?.href);if(!h||!b)return null;const k=An(p.rel),x=p?.properties?.numberOfItems??p?.properties?.number_of_items,y=Number(x);return{title:h,url:new URL(b,s).href,type:typeof p?.type=="string"?p.type:void 0,rel:k[0]||void 0,count:Number.isFinite(y)?y:void 0,isActive:k.some(S=>S.includes("self"))}}).filter(p=>p!==null);f.length>0&&n.push({title:l,links:f})}),n}function gx(r,s){if(!Array.isArray(r?.links))return;const n=r.links.find(c=>{const l=An(c?.rel),u=Uo(c?.type);return l.some(f=>f.includes("search"))&&u.includes("application/opds+json")&&c?.templated===!0&&typeof c?.href=="string"&&c.href.includes("{")});if(n?.href){const c=Yh(n.href,s),l=Zh(c).map(u=>({...u,required:u.name==="query"}));return{kind:"opds2-template",template:c,templated:!0,params:l,type:typeof n.type=="string"?n.type:void 0,title:Wr(n.title)||"Search",rel:An(n.rel)[0]||"search"}}const o=r.links.find(c=>{const l=An(c?.rel),u=Uo(c?.type);return l.some(f=>f.includes("search"))&&u.includes("application/opensearchdescription+xml")});if(o?.href)return{kind:"opensearch",descriptionUrl:new URL(o.href,s).href,type:typeof o.type=="string"?o.type:void 0,title:Wr(o.title)||"Search",rel:An(o.rel)[0]||"search"}}function yx(r,s){const n={},o=Number(r?.metadata?.numberOfItems),c=Number(r?.metadata?.itemsPerPage),l=Number(r?.metadata?.currentPage);return Number.isFinite(o)&&(n.totalResults=o),Number.isFinite(c)&&(n.itemsPerPage=c),Number.isFinite(l)&&Number.isFinite(c)&&l>0&&c>0&&(n.startIndex=(l-1)*c+1),r.links&&Array.isArray(r.links)&&r.links.forEach(u=>{if(u.href&&u.rel){const f=An(u.rel),p=new URL(u.href,s).href;f.some(h=>h.includes("next"))&&(n.next=p),f.some(h=>h.includes("prev")||h.includes("previous"))&&(n.prev=p),f.some(h=>h.includes("first"))&&(n.first=p),f.some(h=>h.includes("last"))&&(n.last=p)}}),n}function vx(r){let n="";for(let o=0;o<r.length;o+=32768){const c=r.subarray(o,o+32768);n+=String.fromCharCode.apply(null,Array.prototype.slice.call(c))}return n}const Gn=new WeakMap;async function xx(r){try{const s=Gn.get(r);if(s)return s}catch{}try{if(r&&typeof r.clone=="function"){const s=r.clone();try{const n=await s.arrayBuffer(),o=new Uint8Array(n);try{Gn.set(r,o)}catch{}return o}catch(n){const o=s.body&&s.body.getReader?s.body.getReader():null;if(!o)throw n;const c=[];let l=0;for(;;){const{done:p,value:h}=await o.read();if(p)break;if(h){const b=h instanceof Uint8Array?h:new Uint8Array(h);c.push(b),l+=b.length}}const u=new Uint8Array(l);let f=0;for(const p of c)u.set(p,f),f+=p.length;try{Gn.set(r,u)}catch{}return u}}if(r&&typeof r.arrayBuffer=="function"){const s=await r.arrayBuffer(),n=new Uint8Array(s);try{Gn.set(r,n)}catch{}return n}if(r&&typeof r.text=="function"){const s=await r.text();let n;typeof TextEncoder<"u"?n=new TextEncoder().encode(s):typeof Buffer<"u"?n=new Uint8Array(Buffer.from(s,"utf-8")):n=new Uint8Array;try{Gn.set(r,n)}catch{}return n}if(r&&r.body){if(r.body instanceof Uint8Array){try{Gn.set(r,r.body)}catch{}return r.body}if(typeof Buffer<"u"&&Buffer.isBuffer(r.body)){const s=new Uint8Array(r.body);try{Gn.set(r,s)}catch{}return s}}return new Uint8Array}catch(s){throw s}}async function wx(r){try{const s=await xx(r);try{return new TextDecoder("utf-8",{fatal:!1}).decode(s)}catch{try{return new TextDecoder("iso-8859-1",{fatal:!1}).decode(s)}catch{return vx(s)}}}catch(s){ne.warn("safeReadText: fallback decode failed",s);try{if(r&&typeof r.text=="function")return await r.text()}catch{}return""}}function bx(r){try{return new URL(r).host}catch{return r}}let Xf=!1;async function kx(){if(!Xf){Xf=!0;try{await jc.migrateFromLocalStorage()}catch{}}}function Sx(r,s,n){try{jc.saveCredential(r,s,n)}catch(o){ne.warn("saveOpdsCredential failed",o)}}async function Zf(r){try{await kx();const s=bx(r);return await jc.findCredential(s)}catch{return}}const Io=(r,s)=>{ne.debug("[OPDS2] parseOpds2Json start",{baseUrl:s,typeofJson:typeof r});try{let n=function(T,I){const D=T?String(T).toLowerCase().trim():"",W=I?String(I).toLowerCase().trim():"";if(D==="text/html"||D.includes("html")||W==="text/html"||W.includes("html"))return"Web";if(D.includes("epub")||D==="application/epub+zip"||W.includes("epub")||W==="application/epub+zip")return"EPUB";if(D.includes("pdf")||D==="application/pdf"||W.includes("pdf")||W==="application/pdf")return"PDF";if(D)return D;if(W)return W},o=function(T){if(T.startsWith("urn:isbn:"))return"isbn";if(T.startsWith("urn:issn:"))return"issn";if(T.startsWith("urn:uuid:"))return"uuid";if(T.startsWith("http://")||T.startsWith("https://"))return"uri";if(/^\d{10}(\d{3})?$/.test(T))return"isbn"},c=function(T){const I=[];return T.identifier?((Array.isArray(T.identifier)?T.identifier:[T.identifier]).forEach(W=>{if(typeof W=="string")I.push({value:W,scheme:o(W)});else if(W&&typeof W=="object"){const F=W.value||W.identifier||String(W);I.push({value:F,scheme:W.scheme||W.schemeURI||o(F)})}}),I.length>0?I:void 0):void 0},l=function(T){if(!Array.isArray(T.subject)||T.subject.length===0)return;const I=[];return T.subject.forEach(D=>{if(typeof D=="string")I.push({name:D});else if(D&&typeof D=="object"){const W=D.name||D.label;W&&I.push({name:String(W).trim(),scheme:D.scheme||D.schemeURI,code:D.term||D.code})}}),I.length>0?I:void 0},u=function(T){const I=[],D=T.contributor||T.contributors;return D?((Array.isArray(D)?D:[D]).forEach(F=>{if(typeof F=="string")I.push({name:F});else if(F&&typeof F=="object"){const U=F.name||F.label;U&&I.push({name:String(U).trim(),role:F.role||F.type,uri:F.uri||F.identifier})}}),I.length>0?I:void 0):void 0},f=function(T){if(!(!T.accessMode&&!T.accessibilityFeature&&!T.accessibilityHazard&&!T.conformsTo))return{modes:T.accessMode?Array.isArray(T.accessMode)?T.accessMode:[T.accessMode]:void 0,modesSufficient:T.accessModesSufficient?Array.isArray(T.accessModesSufficient)?T.accessModesSufficient:[T.accessModesSufficient]:void 0,features:T.accessibilityFeature?Array.isArray(T.accessibilityFeature)?T.accessibilityFeature:[T.accessibilityFeature]:void 0,hazards:T.accessibilityHazard?Array.isArray(T.accessibilityHazard)?T.accessibilityHazard:[T.accessibilityHazard]:void 0,summary:T.accessibilitySummary,certification:T.conformsTo?{standard:String(T.conformsTo)}:void 0}},p=function(T){const I=T.join(" ").toLowerCase();return I.includes("/open-access")?"open-access":I.includes("/borrow")||I.includes("/loan")?"borrow":I.includes("/buy")?"buy":I.includes("/sample")?"sample":"generic"},h=function(T,I){const D=T.metadata||{};let W="Unknown Author";if(D.author)if(Array.isArray(D.author)&&D.author.length>0){const E=D.author[0];W=typeof E=="string"?E:typeof E=="object"&&"name"in E&&E.name||"Unknown Author"}else typeof D.author=="string"?W=D.author:typeof D.author=="object"&&"name"in D.author&&(W=D.author.name||"Unknown Author");const F=D.title&&String(D.title).trim()||"Untitled",U=D.description||D.subtitle||null;let V;D.publisher&&(typeof D.publisher=="string"?V=D.publisher:typeof D.publisher=="object"&&"name"in D.publisher&&(V=D.publisher.name));const ie=D.published||D.issued||void 0;let B;if(typeof D.identifier=="string")B=D.identifier;else if(Array.isArray(D.identifier)&&D.identifier.length>0){const E=D.identifier.find(M=>typeof M=="string");E&&(B=E)}let H;try{const E=D.series||D.belongsTo?.series,M=Array.isArray(E)?E[0]:E,K=typeof M=="string"?M:M?.name,ge=typeof M=="object"&&M?M.position??M.ordinal??M.index:void 0;K&&(H={name:K,position:typeof ge=="number"?ge:void 0})}catch{}let C;if(Array.isArray(D.subject)){const E=[];D.subject.forEach(M=>{if(M&&typeof M=="object"){const K=(M.name||M.label||"").trim(),ge=(M.term||M.code||K||"").trim(),je=(M.scheme||M.schemeURI||"http://opds-spec.org/subject").trim();(K||ge)&&E.push({scheme:je,term:ge||K,label:K||ge})}}),E.length>0&&(C=E)}const Q=T.images&&T.images[0]||D.image&&D.image[0],ae=Q?.href?new URL(Q.href,I).href:Q?.url?new URL(Q.url,I).href:null;let J=[];Array.isArray(T.links)?J=T.links:typeof T.links=="object"&&T.links&&(J=[T.links]);const te=[],re=[];J.forEach(E=>{if(!E||!E.href)return;const M=Array.isArray(E.rel)?E.rel.map(ge=>String(ge)):E.rel?[String(E.rel)]:[];if(M.some(ge=>ge.includes("acquisition")||ge==="http://opds-spec.org/acquisition/borrow"||ge==="http://opds-spec.org/acquisition/loan"||ge==="http://opds-spec.org/acquisition/open-access"||ge.includes("/open-access"))){const ge=k(E.indirectAcquisition||E.properties?.indirectAcquisition);te.push({href:new URL(E.href,I).href,rels:M,type:E.type,indirectType:ge})}E.title&&M.includes("collection")&&re.push({title:E.title,href:new URL(E.href,I).href})});const ee=te.map(E=>{const M=n(E.type,E.indirectType)||"UNKNOWN",K=p(E.rels),ge=E.rels.some(je=>je.includes("/open-access")||je==="http://opds-spec.org/acquisition/open-access");return{format:M,downloadUrl:E.href,mediaType:E.type,isOpenAccess:ge,acquisitionType:K}});let P,$=!1;if(te.length>0){const E=(K,ge)=>{if(!K.type)return!1;const je=String(K.type).toLowerCase().trim();return ge==="epub"?je==="application/epub+zip"||je.includes("epub"):ge==="pdf"?je==="application/pdf"||je.includes("pdf"):ge==="html"?je==="text/html"||je.includes("html"):!1},M=K=>K.rels.some(ge=>ge.includes("/open-access")||ge==="http://opds-spec.org/acquisition/open-access");P=te.find(K=>M(K)&&E(K,"epub")),P||(P=te.find(K=>M(K)&&E(K,"pdf"))),P||(P=te.find(K=>E(K,"epub"))),P||(P=te.find(K=>E(K,"pdf"))),P||(P=te.find(K=>!E(K,"html"))),P||(P=te[0]),P&&M(P)&&($=!0)}let ye,fe;if(P&&(ye=P.href,fe=n(P.type,P.indirectType)),!ye&&T.content&&Array.isArray(T.content)&&T.content.length>0){const E=T.content[0];E.href&&(ye=new URL(E.href,I).href),!fe&&E.type&&(fe=n(E.type))}const oe=D["@type"]||D.type,{schemaOrgType:be,publicationTypeLabel:Se}=hx(oe);let ke;P&&P.type&&(ke=b(oe,P.type));const _e=D.language?Array.isArray(D.language)?D.language[0]:D.language:void 0,De=D.duration||D.durationInSeconds?parseInt(String(D.duration||D.durationInSeconds),10):void 0,Ve=D.extent?parseInt(String(D.extent),10):void 0,et=D.source||D.sourceIdentifier,Ke=c(D),j=l(D),he=u(D),de=f(D),q=j?.map(E=>typeof E=="string"?E:String(E?.name??"")).map(E=>E.trim()).filter(E=>E.length>0),z=he?.map(E=>typeof E=="string"?E:String(E?.name??"")).map(E=>E.trim()).filter(E=>E.length>0),Z=P?p(P.rels):void 0,ce=T.properties?.["opds:borrowPeriod"]?parseInt(String(T.properties["opds:borrowPeriod"]),10):void 0,ue=T.properties?.["opds:copies"]?parseInt(String(T.properties["opds:copies"]),10):void 0,X=T.properties?.["opds:holds"]?parseInt(String(T.properties["opds:holds"]),10):void 0;let _;try{const E=D.series||D.belongsTo?.series;E&&(_=(Array.isArray(E)?E:[E]).map(K=>{const ge=typeof K=="string"?K:K?.name;if(ge)return{name:String(ge).trim(),position:typeof K=="object"&&K?K.position??K.ordinal??K.index:void 0,volume:K?.volume,url:K?.uri||K?.url}}).filter(K=>K!==void 0),_.length===0&&(_=void 0))}catch{}if(F&&(ye||ae))return{title:F,author:W,coverImage:ae||null,downloadUrl:ye||"",summary:U||null,publisher:V||void 0,publicationDate:ie||void 0,providerId:B||void 0,subjects:q&&q.length>0?q:void 0,contributors:z&&z.length>0?z:void 0,categories:C||void 0,collections:re.length>0?re:void 0,format:fe||void 0,acquisitionType:Z,mediaType:P&&P.type?String(P.type).toLowerCase().trim():void 0,isOpenAccess:$?!0:void 0,alternativeFormats:ee.length>0?ee:void 0,borrowPeriodDays:ce,copiesAvailable:ue,holdsCount:X,schemaOrgType:be,publicationTypeLabel:Se,mediumFormatCode:ke,series:_,language:_e,duration:De,extent:Ve,source:et,identifiers:Ke,accessibility:de}},b=function(T,I){if(!I)return;const D=String(I).toLowerCase().trim();return D==="text/html"?"Web":D},k=function(T){if(!T)return;const D=(Array.isArray(T)?T:[T])[0];if(D){if(D.type)return D.type;if(D.indirectAcquisition)return k(D.indirectAcquisition)}},x=function(T){if(!T)return;const I=String(T).split(";")[0].trim().toLowerCase();if(I.includes("epub")||I==="application/epub+zip")return"EPUB";if(I.includes("pdf")||I==="application/pdf")return"PDF"};if(typeof r!="object"||r===null)throw new Error("Invalid OPDS2 catalog format: input is not an object");try{ne.debug("[OPDS2] keys",{baseUrl:s,keys:Object.keys(r)})}catch(T){ne.warn("[OPDS2] Object.keys failed",{baseUrl:s,type:typeof r,constructor:r&&r.constructor?r.constructor.name:void 0,err:T})}const y=[],S=px(r,s),g=mx(r,s),w=yx(r,s),N=gx(r,s);if(r.links&&Array.isArray(r.links)&&r.links.forEach(T=>{if(T.href&&T.rel){const I=An(T.rel),D=new URL(T.href,s).href;I.some(F=>F.includes("next"))&&(w.next=D),I.some(F=>F.includes("prev")||F.includes("previous"))&&(w.prev=D),I.some(F=>F.includes("first"))&&(w.first=D),I.some(F=>F.includes("last"))&&(w.last=D);const W=Wr(T.title);W&&(I.some(F=>F.includes("collection"))||I.some(F=>F.includes("subsection"))||I.some(F=>F.includes("section")))&&S.push({title:W,url:D,rel:I[0]||"",type:T.type,source:"navigation"})}}),r.publications&&Array.isArray(r.publications)&&(ne.debug("[OPDS2] Parsing publications",{count:r.publications.length,baseUrl:s}),r.publications&&Array.isArray(r.publications)))for(const T of r.publications){if(typeof T.links=="string"&&T.links.trim().startsWith("<"))try{const W=new DOMParser().parseFromString(T.links,"application/xml"),F=[];Array.from(W.querySelectorAll("link")).forEach(U=>{const V=U.getAttribute("href"),ie=U.getAttribute("rel"),B=U.getAttribute("type"),H={};V&&(H.href=V),ie&&(H.rel=ie),B&&(H.type=B),F.push(H)}),F.length>0&&(T.links=F)}catch{}if(!T.links&&T.properties&&typeof T.properties=="object"){const D=T.properties.links||T.properties.link||T.properties.acquisitions;if(typeof D=="string"&&D.trim().startsWith("<"))try{const F=new DOMParser().parseFromString(D,"application/xml"),U=[];Array.from(F.querySelectorAll("link")).forEach(V=>{const ie=V.getAttribute("href"),B=V.getAttribute("rel"),H=V.getAttribute("type"),C={};ie&&(C.href=ie),B&&(C.rel=B),H&&(C.type=H),U.push(C)}),U.length>0&&(T.links=U)}catch{}}const I=h(T,s);I&&y.push(I)}const A=r.metadata&&typeof r.metadata=="object",L=Array.isArray(r.publications)&&r.publications.length>0;return!A&&!L&&console.warn("[OPDS2] Warning: feed is missing required metadata and publications."),ne.debug("[OPDS2] parseOpds2Json complete",{navLinks:S.length,facetGroups:g.length,books:y.length,paginationKeys:Object.keys(w)}),{books:y,navLinks:S,facetGroups:g,pagination:w,search:N}}catch(n){const o=n instanceof Error?n.message:"Unknown OPDS2 parse error";return ne.error("[OPDS2] parseOpds2Json error",n),{books:[],navLinks:[],facetGroups:[],pagination:{},error:o}}},Nx=async(r,s,n=5)=>{let o=0;const c=r,l=await Or(r);if(typeof l=="string"&&l.includes("corsproxy.io")&&s){const h=new Error("Acquisition would use a public CORS proxy which may strip Authorization or block POST requests. Configure an owned proxy (VITE_OWN_PROXY_URL) to perform authenticated borrows.");throw h.proxyUsed=!0,h}const f=(h=!1)=>{const b={Accept:"application/json, text/json, */*"};return h&&s&&(b.Authorization=`Basic ${btoa(`${s.username}:${s.password}`)}`),b},p=!!s;for(;o<n&&l;){o++;let h=null;try{p?(h=await fetch(l,{method:"GET",headers:f(!0)}),h.status===405&&(h=await fetch(l,{method:"POST",headers:f(!0)}))):(h=await fetch(l,{method:"POST",headers:f(!1)}),h.status===405&&(h=await fetch(l,{method:"GET",headers:f(!1)})))}catch(x){throw x}if(!h)return null;if(h.status>=300&&h.status<400){const x=h.headers&&typeof h.headers.get=="function"?h.headers.get("Location")||h.headers.get("location"):null;if(x)return new URL(x,c).href}const b=typeof h.ok=="boolean"?h.ok:h.status>=200&&h.status<300,k=h.headers&&typeof h.headers.get=="function"&&h.headers.get("Content-Type")||"";if(b){if(k.includes("application/json")||k.includes("text/json")||k.includes("application/opds+json")){const y=await h.json().catch(()=>null),S=y?.url||y?.location||y?.href||y?.contentLocation;if(typeof S=="string"&&S.length>0)return new URL(S,c).href;if(Array.isArray(y?.links)){const g=y.links.find(w=>w?.href&&(w.rel==="content"||w.rel==="self"||String(w.rel).includes("acquisition")));if(g?.href)return new URL(g.href,l).href}}const x=h.headers.get("Location")||h.headers.get("location");if(x)return new URL(x,c).href;if(k.includes("application/epub")||k.includes("application/pdf")||k.includes("application/octet-stream"))return c}if(h.status===401||h.status===403){const x=await wx(h).catch(()=>"");let y=null;try{(h.headers.get&&(h.headers.get("Content-Type")||"").includes("application/vnd.opds.authentication.v1.0+json")||x.trim().startsWith("{"))&&(y=JSON.parse(x))}catch{y=null}const S=new Error(`Acquisition requires authentication: ${h.status} ${h.statusText}`);S.status=h.status,y&&(S.authDocument=y);try{typeof l=="string"&&(l.includes("corsproxy.io")||l.includes("/proxy?url="))&&(S.proxyUsed=!0)}catch{}throw S}break}return null};function Cx(r){let n="";for(let o=0;o<r.length;o+=32768){const c=r.subarray(o,o+32768);n+=String.fromCharCode.apply(null,Array.prototype.slice.call(c))}return n}const Kn=new WeakMap;async function jx(r){try{const s=Kn.get(r);if(s)return s}catch{}try{if(r&&typeof r.arrayBuffer=="function")try{const s=await r.arrayBuffer(),n=new Uint8Array(s);try{Kn.set(r,n)}catch{}return n}catch{}if(r&&typeof r.clone=="function"){const s=r.clone();try{const n=await s.arrayBuffer(),o=new Uint8Array(n);try{Kn.set(r,o)}catch{}return o}catch(n){const o=s.body&&s.body.getReader?s.body.getReader():null;if(!o)throw n;const c=[];let l=0;for(;;){const{done:p,value:h}=await o.read();if(p)break;if(h){const b=h instanceof Uint8Array?h:new Uint8Array(h);c.push(b),l+=b.length}}const u=new Uint8Array(l);let f=0;for(const p of c)u.set(p,f),f+=p.length;try{Kn.set(r,u)}catch{}return u}}if(r&&typeof r.text=="function"){const s=await r.text();let n;typeof TextEncoder<"u"?n=new TextEncoder().encode(s):typeof Buffer<"u"?n=new Uint8Array(Buffer.from(s,"utf-8")):n=new Uint8Array;try{Kn.set(r,n)}catch{}return n}if(r&&r.body){if(r.body instanceof Uint8Array){try{Kn.set(r,r.body)}catch{}return r.body}if(typeof Buffer<"u"&&Buffer.isBuffer(r.body)){const s=new Uint8Array(r.body);try{Kn.set(r,s)}catch{}return s}}return new Uint8Array}catch(s){throw s}}async function Xn(r){try{const s=await jx(r);try{return new TextDecoder("utf-8",{fatal:!1}).decode(s)}catch{try{return new TextDecoder("iso-8859-1",{fatal:!1}).decode(s)}catch{return Cx(s)}}}catch(s){console.warn("safeReadText: fallback decode failed",s);try{if(r&&typeof r.text=="function")return await r.text()}catch{}return""}}const ic=r=>{if(!r)return;const s=r.split(";")[0].trim().toLowerCase();if(s.includes("epub")||s==="application/epub+zip")return"EPUB";if(s.includes("pdf")||s==="application/pdf")return"PDF";if(s.includes("audiobook")||s==="http://bib.schema.org/audiobook")return"AUDIOBOOK"},oc=r=>{if(!r)return;const s=Array.from(r.children);for(const n of s){if((n.localName||n.nodeName||"").toLowerCase()!=="indirectacquisition")continue;const c=oc(n);if(c)return c;const l=n.getAttribute("type")||void 0;if(ic(l))return l}for(const n of s){const o=oc(n);if(o)return o}},fi=(r,s)=>Array.from(r.children).find(c=>(c.localName||c.nodeName||"").toLowerCase()===s.toLowerCase())?.textContent?.trim()||void 0,Ex=(r,s)=>{const n=new Map;return(r||[]).forEach(o=>{n.set(o.href,o)}),(s||[]).forEach(o=>{n.set(o.href,o)}),n.size>0?Array.from(n.values()):void 0},_x=(r,s)=>{const n=new Map;return(r||[]).forEach(o=>{n.set(`${o.scheme}|${o.term}|${o.label}`,o)}),(s||[]).forEach(o=>{n.set(`${o.scheme}|${o.term}|${o.label}`,o)}),n.size>0?Array.from(n.values()):void 0},Ax=(r,s)=>{const n=Array.from(new Set([...r||[],...s||[]].filter(Boolean)));return n.length>0?n:void 0},Tx=(r,s)=>({...r,author:r.author||s.author,coverImage:r.coverImage||s.coverImage,downloadUrl:r.downloadUrl||s.downloadUrl,summary:r.summary||s.summary,publisher:r.publisher||s.publisher,publicationDate:r.publicationDate||s.publicationDate,providerId:r.providerId||s.providerId,distributor:r.distributor||s.distributor,subjects:Ax(r.subjects,s.subjects),categories:_x(r.categories,s.categories),format:r.format||s.format,acquisitionMediaType:r.acquisitionMediaType||s.acquisitionMediaType,collections:Ex(r.collections,s.collections),isOpenAccess:r.isOpenAccess||s.isOpenAccess||void 0,availabilityStatus:r.availabilityStatus||s.availabilityStatus,schemaOrgType:r.schemaOrgType||s.schemaOrgType,publicationTypeLabel:r.publicationTypeLabel||s.publicationTypeLabel,mediumFormatCode:r.mediumFormatCode||s.mediumFormatCode}),rp=r=>{if(r)for(const s of Array.from(r.children)){if((s.localName||s.nodeName||"").toLowerCase()==="availability")return s.getAttribute("status")||void 0;const o=rp(s);if(o)return o}},Rx=r=>{try{const s=new URL(r).hostname.toLowerCase();return s.endsWith("palace.io")||s.endsWith("palaceproject.io")||s.endsWith("thepalaceproject.org")||s==="palace.io"||s.endsWith(".palace.io")||s.endsWith(".thepalaceproject.org")}catch{return!1}},jn=(r,s)=>{const o=new DOMParser().parseFromString(r,"application/xml"),c=o.querySelector("parsererror");if(c)throw console.error("XML Parsing Error:",c.textContent),new Error("Failed to parse catalog feed. The URL may not point to a valid OPDS feed, or the response was not valid XML.");const l=o.documentElement?.nodeName;if(!l||l.toLowerCase()!=="feed"&&!l.endsWith(":feed"))throw new Error("Invalid Atom/OPDS feed. The XML document is missing the root <feed> element.");const u=Array.from(o.querySelectorAll("entry")),f=[],p=[],h=[],b={};let k;const x=new Set,y=new Map,S=Rx(s),g=V=>{if(!S)return!1;const ie=V.title.trim().toLowerCase(),B=(V.rel||"").toLowerCase(),H=(V.type||"").toLowerCase();return ie!=="loans"?!1:B.includes("acquisition")||B.includes("loan")||H.includes("kind=acquisition")||H.includes("profile=opds-catalog")},w=V=>{if(g(V))return;const ie=`${V.rel}|${V.url}`;x.has(ie)||(x.add(ie),p.push(V))},N=V=>{const ie=V.providerId||V.downloadUrl;if(!ie){f.push(V);return}const B=y.get(ie);if(typeof B=="number"){f[B]=Tx(f[B],V);return}y.set(ie,f.length),f.push(V)},A=o.documentElement,L=fi(A,"totalResults"),T=fi(A,"itemsPerPage"),I=fi(A,"startIndex"),D=Number(L),W=Number(T),F=Number(I);if(Number.isFinite(D)&&(b.totalResults=D),Number.isFinite(W)&&(b.itemsPerPage=W),Number.isFinite(F)&&(b.startIndex=F),Array.from(o.querySelectorAll("feed > link")).forEach(V=>{const ie=V.getAttribute("rel")||"",B=String(ie).toLowerCase(),H=V.getAttribute("href");if(H){const C=new URL(H,s).href,Q=V.getAttribute("type")||void 0;if(B.includes("next")&&(b.next=C),(B.includes("prev")||B.includes("previous"))&&(b.prev=C),B.includes("first")&&(b.first=C),B.includes("last")&&(b.last=C),B.includes("facet")){const J=V.getAttribute("title")?.trim();if(!J)return;const te=V.getAttribute("opds:facetGroup")||V.getAttribute("facetGroup")||"Facets",re=V.getAttribute("opds:activeFacet")||V.getAttribute("activeFacet")||"",ee=V.getAttribute("thr:count")||V.getAttribute("count")||"",P=Number(ee),$={title:J,url:C,type:Q,rel:ie||void 0,count:Number.isFinite(P)?P:void 0,isActive:re==="true"||re==="active"},ye=h.find(fe=>fe.title===te);ye?ye.links.push($):h.push({title:te,links:[$]});return}if(B==="search"){if(Q?.toLowerCase().includes("application/opensearchdescription+xml")){k||={kind:"opensearch",descriptionUrl:C,type:Q,title:V.getAttribute("title")?.trim()||"Search",rel:ie||"search"};return}w({title:V.getAttribute("title")?.trim()||"Search",url:C,rel:ie||"search",type:Q,source:"navigation"});return}if(B.includes("start")||B==="up"||B.endsWith("/up")){const J=B.includes("start")?"Home":"Up";w({title:V.getAttribute("title")?.trim()||J,url:C,rel:ie||J.toLowerCase(),type:Q,source:"navigation"});return}if(B==="collection"||B.includes("subsection")){w({title:V.getAttribute("title")?.trim()||C,url:C,rel:ie||"collection",type:Q,source:"navigation"});return}const ae=(Q||"").toLowerCase();ae.includes("profile=opds-catalog")&&(ae.includes("kind=navigation")||ae.includes("kind=acquisition"))&&w({title:V.getAttribute("title")?.trim()||C,url:C,rel:ie||(ae.includes("kind=acquisition")?"acquisition":"navigation"),type:Q,source:"navigation"})}}),u.forEach(V=>{const ie=V.querySelector("title")?.textContent?.trim()||"Untitled",B=Array.from(V.querySelectorAll("link")),H=V.getAttribute("schema:additionalType"),C=H==="http://bib.schema.org/Audiobook"||H==="http://schema.org/Audiobook",Q=B.find(oe=>{const be=oe.getAttribute("rel")||"";return be.includes("/open-access")||be==="http://opds-spec.org/acquisition/open-access"}),ae=Q||B.find(oe=>{const be=oe.getAttribute("rel")||"",Se=oe.getAttribute("type")||"";return be.includes("opds-spec.org/acquisition")&&(Se.includes("epub+zip")||Se.includes("pdf"))})||B.find(oe=>(oe.getAttribute("rel")||"").includes("opds-spec.org/acquisition")),J=!!Q;let te;try{const oe=V.getElementsByTagName("bibframe:distribution");if(oe.length>0){const be=oe[0].getAttribute("bibframe:ProviderName")?.trim();te=be&&be.length>0?be:void 0}}catch{try{const be=V.getElementsByTagName("distribution");if(be.length>0){const Se=be[0].getAttribute("ProviderName")?.trim();te=Se&&Se.length>0?Se:void 0}}catch(be){console.warn("Could not parse distributor information:",be)}}const re=Array.from(V.querySelectorAll('link[rel="collection"]')),ee=re.map(oe=>{const be=oe.getAttribute("href"),Se=oe.getAttribute("title");if(be&&Se){const ke=new URL(be,s).href,_e=Se.trim();return S&&te&&_e.toLowerCase()===te.toLowerCase()||w({title:_e,url:ke,rel:"collection",type:oe.getAttribute("type")||void 0,source:"navigation"}),{title:_e,href:ke}}return null}).filter(oe=>oe!==null),P=V.querySelector('link[rel="subsection"], link[rel="http://opds-spec.org/subsection"]'),$=re.find(oe=>{const be=oe.getAttribute("title")?.trim();return be?!(S&&te&&be.toLowerCase()===te.toLowerCase()):!1})||null,ye=B.find(oe=>{const be=(oe.getAttribute("rel")||"").toLowerCase(),Se=(oe.getAttribute("type")||"").toLowerCase();return be.includes("opds-spec.org/acquisition")?!1:Se.includes("profile=opds-catalog")&&Se.includes("kind=navigation")})||null,fe=B.find(oe=>{const be=(oe.getAttribute("rel")||"").toLowerCase(),Se=(oe.getAttribute("type")||"").toLowerCase();return be.includes("opds-spec.org/acquisition")?!1:Se.includes("profile=opds-catalog")&&Se.includes("kind=acquisition")})||null;if(ae){const oe=Array.from(V.querySelectorAll("author > name")).map(X=>X.textContent?.trim()).filter(X=>!!X),be=oe[0]||"Unknown Author",Se=V.querySelector("summary")?.textContent?.trim()||V.querySelector("content")?.textContent?.trim()||null,_e=(B.find(X=>{const _=(X.getAttribute("rel")||"").toLowerCase();return!!(_==="http://opds-spec.org/image"||_==="http://opds-spec.org/image/thumbnail"||_.includes("image/thumbnail")||_.includes("thumbnail"))})||B.find(X=>{const _=(X.getAttribute("rel")||"").toLowerCase(),E=(X.getAttribute("type")||"").toLowerCase();return _.includes("image")&&E.startsWith("image/")})||B.find(X=>(X.getAttribute("type")||"").toLowerCase().startsWith("image/"))||null)?.getAttribute("href"),De=_e?new URL(_e,s).href:null,Ve=ae?.getAttribute("href"),et=ae?.getAttribute("type")||"",Ke=oc(ae),j=ic(et)?et:Ke;let he=ic(j||et);C&&(he="AUDIOBOOK");const de=rp(ae),q=(V.querySelector("publisher")?.textContent||V.querySelector("dc\\:publisher")?.textContent)?.trim(),z=(V.querySelector("issued")?.textContent||V.querySelector("dc\\:issued")?.textContent||V.querySelector("published")?.textContent)?.trim(),Z=fi(V,"identifier")||fi(V,"id"),ce=Array.from(V.querySelectorAll("category")).map(X=>{const _=X.getAttribute("scheme")||"http://palace.io/subjects",E=X.getAttribute("term")?.trim(),M=X.getAttribute("label")?.trim();return E?{scheme:_,term:E,label:M||E}:null}).filter(X=>X!==null),ue=ce.map(X=>X.label);if(Ve){const X=new URL(Ve,s).href;let _=j||et;!_&&C&&(_="http://bib.schema.org/Audiobook"),N({title:ie,author:be,coverImage:De,downloadUrl:X,summary:Se,publisher:q||void 0,publicationDate:z||void 0,providerId:Z,distributor:te,subjects:ue.length>0?ue:void 0,contributors:oe.length>1?oe.slice(1):void 0,categories:ce.length>0?ce:void 0,format:he,acquisitionMediaType:_||void 0,collections:ee.length>0?ee:void 0,isOpenAccess:J||void 0,availabilityStatus:de||void 0})}}else if(P||$||ye||fe){const oe=P||$||ye||fe,be=oe?.getAttribute("href");be&&w({title:ie,url:new URL(be,s).href,rel:P?"subsection":$?"collection":fe&&oe===fe?"acquisition":"navigation",type:oe?.getAttribute("type")||void 0,source:"navigation"})}}),l&&(l.toLowerCase()==="feed"||l.endsWith(":feed"))&&u.length===0){const V=o.documentElement,ie=!!(V&&V.getElementsByTagName("title")&&V.getElementsByTagName("title").length>0),B=!!(V&&V.getElementsByTagName("link")&&V.getElementsByTagName("link").length>0);if(!ie&&!B)throw new Error("The feed contains no entries.");return{books:[],navLinks:p,facetGroups:h,pagination:b,search:k}}if(l&&(l.toLowerCase()==="feed"||l.endsWith(":feed"))&&u.length>0&&f.length===0&&p.length===0)throw new Error("This appears to be a valid Atom feed, but it contains no recognizable OPDS book entries or navigation links. Please ensure the URL points to an OPDS catalog.");return{books:f,navLinks:p,facetGroups:h,pagination:b,search:k}},Yf=(r,s,n,o)=>{const c=s.get("x-mebooks-proxy-error-source");if(c==="upstream")return`The proxy reached the upstream server, but the upstream server denied the request (${s.get("x-mebooks-upstream-status")||"403"}) for ${r}. This is not a proxy allowlist rejection.`;if(n.includes("application/json"))try{const l=JSON.parse(o);if(l&&l.error&&typeof l.error=="string"){const u=typeof l.host=="string"?l.host:"",f=typeof l.protocol=="string"?l.protocol:"";if(l.error.toLowerCase().includes("host"))return`Proxy denied access to host for ${u||r}. The proxy's HOST_ALLOWLIST may need to include the upstream host.${f==="http:"?" This upstream is plain HTTP, so the proxy must explicitly allow that host and serve the browser over HTTPS.":""}`;if(c==="proxy")return`Proxy error: ${l.error}`}}catch{}return c==="proxy"?`The proxy itself denied the request for ${r}. Check proxy configuration and allowlist rules.`:`Proxy returned 403 for ${r}. The proxy may be blocking this host.`},Px=async(r,s,n="auto")=>{try{let o=r;const c=(()=>{try{return new URL(r).hostname.toLowerCase()}catch{return""}})(),l=c.endsWith("palace.io")||c.endsWith("palaceproject.io")||c.endsWith("thepalaceproject.org")||c==="palace.io"||c.endsWith(".palace.io")||c.endsWith(".thepalaceproject.org");ne.debug("fetchCatalogContent host classification",{hostname:c,isPalaceHost:l,forcedVersion:n});let u;l?u=qt(r):u=await Or(r);const f=l||n==="1"?"application/atom+xml;profile=opds-catalog, application/xml, text/xml, */*":"application/opds+json, application/atom+xml;profile=opds-catalog;q=0.9, application/json;q=0.8, application/xml;q=0.7, */*;q=0.5";ne.debug("fetchCatalogContent fetch details",{fetchUrl:u,acceptHeader:f});const p=u===r,h=await fetch(u,{method:"GET",mode:"cors",credentials:p?"include":"omit",headers:{Accept:f}});try{console.debug("[mebooks] initial response - status:",h.status,"content-type:",h.headers.get("Content-Type"))}catch{}const b=h.status>=300&&h.status<400,k=!!h.headers.get("Access-Control-Allow-Origin");if((b||p&&!k)&&qt){const S=qt(r),g=await fetch(S,{method:"GET",headers:{Accept:f}});if(g){const w=g.headers.get("Content-Type")||"",N=await Xn(g);if(g.status===403)throw new Error(Yf(r,g.headers,w,N));if(w.includes("text/html")&&N.trim().toLowerCase().startsWith("<!doctype html>"))throw new Error("The CORS proxy returned an HTML page instead of the catalog feed. This might indicate the proxy service is down or blocking the request. Please try another catalog or check back later.");if(console.debug("[mebooks] proxied response - forcedVersion:",n,"contentType:",w,"url:",r),n==="1"&&N.trim().startsWith("<"))return console.debug("[mebooks] Forcing OPDS1 (XML) parse for proxied response"),jn(N,o);if(w.includes("application/opds+json")||w.includes("application/json"))try{console.warn("[mebooks] Attempting to parse OPDS2 JSON (proxied), response length:",N.length);const A=JSON.parse(N);return console.warn("[mebooks] Successfully parsed OPDS2 JSON (proxied), keys:",Object.keys(A).slice(0,5)),Io(A,o)}catch(A){if(N&&N.trim().startsWith("<"))try{return console.warn("[mebooks] Response body appears to be XML despite JSON Content-Type; attempting XML parse"),jn(N,o)}catch(L){throw console.error("[mebooks] Failed to parse as XML after JSON Content-Type:",L),new Error("Failed to parse catalog content as both JSON and XML.")}else throw console.error("[mebooks] Failed to parse as JSON (proxied) and does not appear to be XML:",A),new Error("Failed to parse catalog content as JSON.")}else if(w.includes("application/atom+xml")||w.includes("application/xml")||w.includes("text/xml")||N.trim().startsWith("<"))try{return jn(N,o)}catch(A){throw console.error("[mebooks] Failed to parse as XML:",A),new Error("Failed to parse catalog content as XML.")}else throw console.error("[mebooks] Unsupported Content-Type or ambiguous response:",w),new Error(`Unsupported or ambiguous catalog format. Content-Type: "${w}"`)}}if(!h.ok){const S=`${h.status}${h.statusText?` ${h.statusText}`:""}`;let g=`The catalog server responded with an error (${S}). Please check the catalog URL.`;if((h.status===401||h.status===403&&p)&&(g=`Could not access catalog (${S}). This catalog requires authentication (a login or password), which is not supported by this application.`),h.status===403&&!p){const w=h.headers.get("Content-Type")||"",N=await Xn(h).catch(()=>"");g=Yf(r,h.headers,w,N)}throw h.status===429&&(g=`Could not access catalog (${S}). The request was rate-limited by the server or the proxy. Please wait a moment and try again.`),new Error(g)}const x=h.headers.get("Content-Type")||"",y=await Xn(h);if(p&&h.url&&(o=h.url),x.includes("text/html")&&y.trim().toLowerCase().startsWith("<!doctype html>"))throw new Error("The CORS proxy returned an HTML page instead of the catalog feed. This might indicate the proxy service is down or blocking the request. Please try another catalog or check back later.");if(console.debug("[mebooks] direct response - forcedVersion:",n,"contentType:",x,"url:",r),n==="1"&&y.trim().startsWith("<"))return console.debug("[mebooks] Forcing OPDS1 (XML) parse for direct response"),jn(y,o);if(console.warn("[mebooks] About to check JSON condition - forcedVersion:",n,"contentType includes opds+json:",x.includes("application/opds+json")),x.includes("application/opds+json")||x.includes("application/json"))try{console.warn("[mebooks] Attempting to parse OPDS2 JSON (direct), response length:",y.length);const S=JSON.parse(y);return console.warn("[mebooks] Successfully parsed OPDS2 JSON (direct), keys:",Object.keys(S).slice(0,5)),Io(S,o)}catch{if(y&&y.trim().startsWith("<"))try{return console.warn("[mebooks] Direct response body appears to be XML despite JSON Content-Type; attempting XML parse"),jn(y,o)}catch(g){throw console.error("[mebooks] Failed to parse as XML after JSON Content-Type:",g),new Error("Failed to parse catalog content as both JSON and XML.")}throw console.warn("[mebooks] Failed to JSON.parse response (direct)"),new Error(`Failed to parse JSON response for ${r}.`)}else{if(x.includes("application/atom+xml")||x.includes("application/xml")||x.includes("text/xml"))return jn(y,o);if(console.warn("[mebooks] Fell through to else block - forcedVersion:",n,"contentType:",x,"response starts with {:",y.trim().startsWith("{"),"response starts with <:",y.trim().startsWith("<")),n!=="1"&&y.trim().startsWith("{"))try{const S=JSON.parse(y);return Io(S,o)}catch{}if(y.trim().startsWith("<"))return jn(y,o);throw new Error(`Unsupported or ambiguous catalog format. Content-Type: "${x}".`)}}catch(o){console.error("Error fetching or parsing catalog content:",o);let c;return o instanceof TypeError?o.message.includes("exceeds response Body")?c="A network error occurred while downloading the catalog. The response was incomplete, which can be caused by an unstable connection or a proxy issue. Please try again.":o.message==="Failed to fetch"?c="Network Error: Failed to fetch the content. This could be due to your internet connection, the remote catalog being offline, or the public CORS proxy being temporarily unavailable.":c=`A network error occurred: ${o.message}`:o instanceof SyntaxError?c="Failed to parse the catalog feed. The response was not valid JSON or XML.":o instanceof Error?c=o.message:c="An unknown error occurred while loading the catalog.",{books:[],navLinks:[],facetGroups:[],pagination:{},error:c}}},Lx=async(r,s,n=5)=>{let o=0;const c=["application/adobe+epub","application/pdf+lcp","application/vnd.readium.license.status.v1.0+json"],l=r;let u;try{const h=(()=>{try{return new URL(r).hostname.toLowerCase()}catch{return""}})();h.endsWith("palace.io")||h.endsWith("palaceproject.io")||h.endsWith("thepalaceproject.org")||h==="palace.io"||h.endsWith(".palace.io")||h.endsWith(".thepalaceproject.org")?u=qt(r):u=await Or(r)}catch{u=await Or(r)}try{if(typeof u=="string"&&u.includes("corsproxy.io")&&s){const b=new Error("Acquisition would use a public CORS proxy which may strip Authorization or block POST requests. Configure an owned proxy (VITE_OWN_PROXY_URL) to perform authenticated borrows.");throw b.proxyUsed=!0,b}}catch(h){throw h}const f=(h=!1)=>{const b={Accept:"application/atom+xml, application/xml, text/xml, */*"};return h&&s&&(b.Authorization=`Basic ${btoa(`${s.username}:${s.password}`)}`),b},p=!!s;for(;o<n&&u;){o++;let h=null;try{const k=typeof u=="string"&&u===l;p?(h=await fetch(u,{method:"GET",headers:f(!0),credentials:k?"include":"omit"}),h.status===405&&(h=await fetch(u,{method:"POST",headers:f(!0),credentials:k?"include":"omit"}))):(h=await fetch(u,{method:"POST",headers:f(!1),credentials:k?"include":"omit"}),h.status===405&&(h=await fetch(u,{method:"GET",headers:f(!1),credentials:k?"include":"omit"})))}catch(k){throw k}if(!h)return null;if(h.status>=300&&h.status<400){const k=h.headers&&typeof h.headers.get=="function"?h.headers.get("Location")||h.headers.get("location"):null;if(k)return new URL(k,l).href}if(typeof h.ok=="boolean"?h.ok:h.status>=200&&h.status<300){const k=await Xn(h).catch(()=>"");try{if(k.trim().startsWith("<")){const S=new DOMParser().parseFromString(k,"application/xml"),g=Array.from(S.querySelectorAll("link")),w=["application/adobe+epub","application/pdf+lcp","application/vnd.readium.license.status.v1.0+json"],N=g.find(A=>{const L=(A.getAttribute("rel")||"").toLowerCase(),T=(A.getAttribute("type")||"").toLowerCase();return A.getAttribute("href")&&(L.includes("acquisition")||L.includes("borrow")||L.includes("loan")||L.includes("http://opds-spec.org/acquisition"))?(T&&(T.includes("epub")||T.includes("pdf")||w.some(D=>T.includes(D))),!0):!1});if(N){const A=N.getAttribute("href");return new URL(A,l).href}}}catch{}const x=h.headers&&typeof h.headers.get=="function"&&h.headers.get("Content-Type")||"";if(x.includes("application/epub")||x.includes("application/pdf")||x.includes("application/octet-stream"))return l;try{const y=k||await Xn(h).catch(()=>"");if(typeof u=="string"&&(u.includes("corsproxy.io")||u.includes("/proxy?url="))&&(x.includes("text/html")||y&&y.trim().startsWith("<"))){const g=new Error("Acquisition failed via public CORS proxy. The proxy may block POST requests or strip Authorization headers. Configure an owned proxy (VITE_OWN_PROXY_URL) to preserve credentials and HTTP methods.");throw g.status=h.status,g.proxyUsed=!0,g}}catch{}}try{const k=typeof u=="string"&&u===l,x=h.status===401||h.status===403,y=h.headers&&typeof h.headers.get=="function"&&!!h.headers.get("Access-Control-Allow-Origin");if(k&&x&&!y){const S=qt(l),g=S&&S.includes("corsproxy.io");if(!S){const T=new Error("Acquisition failed and no proxy is available. Configure an owned proxy via VITE_OWN_PROXY_URL to allow authenticated downloads from the browser.");throw T.proxyUsed=!0,T}if(g){const T=new Error("Acquisition would require using a public CORS proxy which may strip Authorization or block POSTs. Configure an owned proxy (VITE_OWN_PROXY_URL).");throw T.proxyUsed=!0,T}const w=(T=!1)=>{const I={Accept:"application/atom+xml, application/xml, text/xml, */*"};return T&&s&&(I.Authorization=`Basic ${btoa(`${s.username}:${s.password}`)}`),I};let N=null;try{p?(N=await fetch(S,{method:"GET",headers:w(!0)}),N&&N.status===405&&(N=await fetch(S,{method:"POST",headers:w(!0)}))):(N=await fetch(S,{method:"POST",headers:w(!1)}),N&&N.status===405&&(N=await fetch(S,{method:"GET",headers:w(!1)})))}catch{const I=new Error("Failed to contact owned proxy for authenticated acquisition. Check your proxy configuration.");throw I.proxyUsed=!0,I}if(!N){const T=new Error("Proxy retry failed.");throw T.proxyUsed=!0,T}if(N.status>=300&&N.status<400){const T=N.headers&&typeof N.headers.get=="function"?N.headers.get("Location")||N.headers.get("location"):null;if(T)return new URL(T,l).href}if(typeof N.ok=="boolean"?N.ok:N.status>=200&&N.status<300){const T=await Xn(N).catch(()=>"");try{if(T.trim().startsWith("<")){const W=new DOMParser().parseFromString(T,"application/xml"),U=Array.from(W.querySelectorAll("link")).find(V=>{const ie=(V.getAttribute("rel")||"").toLowerCase(),B=(V.getAttribute("type")||"").toLowerCase();return V.getAttribute("href")&&(ie.includes("acquisition")||ie.includes("borrow")||ie.includes("loan")||ie.includes("http://opds-spec.org/acquisition"))?(B&&(B.includes("epub")||B.includes("pdf")||c.some(C=>B.includes(C))),!0):!1});if(U){const V=U.getAttribute("href");return new URL(V,l).href}}}catch{}const I=N.headers&&typeof N.headers.get=="function"&&N.headers.get("Content-Type")||"";if(I.includes("application/epub")||I.includes("application/pdf")||I.includes("application/octet-stream"))return l}const L=new Error("Authenticated acquisition failed even after retrying via owned proxy.");throw L.proxyUsed=!0,L}}catch(k){throw k}if(h.status===401||h.status===403){const k=await Xn(h).catch(()=>"");let x=null;try{((h.headers.get("Content-Type")||"").includes("application/vnd.opds.authentication.v1.0+json")||k.trim().startsWith("{"))&&(x=JSON.parse(k))}catch{x=null}const y=new Error(`Acquisition requires authentication: ${h.status} ${h.statusText}`);y.status=h.status,x&&(y.authDocument=x);try{typeof u=="string"&&(u.includes("corsproxy.io")||u.includes("/proxy?url="))&&(y.proxyUsed=!0)}catch{}throw y}break}return null},Ox=(r,s)=>s==="all"?r:r.filter(n=>{if(n.categories&&n.categories.length>0){const o=n.categories.filter(c=>c.scheme.includes("audience")||c.scheme.includes("target-age"));if(o.length>0)return o.some(l=>{const u=l.label.toLowerCase(),f=l.term.toLowerCase();switch(s){case"adult":return u.includes("adult")&&!u.includes("young")||f.includes("adult")&&!f.includes("young")||u.includes("18+")||f.includes("18+");case"young-adult":return u.includes("young adult")||u.includes("teen")||f.includes("young-adult")||f.includes("teen")||u.includes("ya")||f.includes("ya");case"children":return u.includes("children")||u.includes("child")||u.includes("juvenile")||u.includes("kids")||f.includes("children")||f.includes("child")||f.includes("juvenile")||f.includes("kids");default:return!1}})}return n.subjects&&n.subjects.length>0&&n.subjects.some(c=>{const l=c.toLowerCase();switch(s){case"adult":return l.includes("adult")&&!l.includes("young");case"young-adult":return l.includes("young adult")||l.includes("teen")||l.includes("ya");case"children":return l.includes("children")||l.includes("child")||l.includes("juvenile")||l.includes("kids");default:return!1}})?!0:s==="adult"}),Ix=r=>{const s=new Set(["all"]);return r.forEach(n=>{n.categories&&n.categories.length>0&&n.categories.forEach(o=>{if(o.scheme.includes("audience")||o.scheme.includes("target-age")){const c=o.label.toLowerCase(),l=o.term.toLowerCase();(c.includes("adult")&&!c.includes("young")||l.includes("adult")&&!l.includes("young")||c.includes("18+")||l.includes("18+"))&&s.add("adult"),(c.includes("young adult")||c.includes("teen")||l.includes("young-adult")||l.includes("teen")||c.includes("ya")||l.includes("ya"))&&s.add("young-adult"),(c.includes("children")||c.includes("child")||c.includes("juvenile")||c.includes("kids")||l.includes("children")||l.includes("child")||l.includes("juvenile")||l.includes("kids"))&&s.add("children")}}),n.subjects&&n.subjects.length>0&&n.subjects.forEach(o=>{const c=o.toLowerCase();c.includes("adult")&&!c.includes("young")&&s.add("adult"),(c.includes("young adult")||c.includes("teen")||c.includes("ya"))&&s.add("young-adult"),(c.includes("children")||c.includes("child")||c.includes("juvenile")||c.includes("kids"))&&s.add("children")})}),Array.from(s)},Fx=(r,s)=>s==="all"?r:r.filter(n=>{if(n.categories&&n.categories.length>0){const o=n.categories.filter(c=>c.scheme.includes("fiction")||c.scheme.includes("genre")||c.scheme.includes("bisac"));if(o.length>0){const c=o.some(l=>{const u=l.label.toLowerCase(),f=l.term.toLowerCase();if(u.includes("fiction")||f.includes("fiction"))return!u.includes("non-fiction")&&!f.includes("non-fiction");if(u.includes("non-fiction")||f.includes("non-fiction")||u.includes("nonfiction")||f.includes("nonfiction"))return!1;const p=["romance","mystery","thriller","fantasy","science fiction","horror","adventure","literary","drama","suspense"],h=["biography","history","science","philosophy","religion","self-help","health","business","politics","economics"],b=p.some(x=>u.includes(x)||f.includes(x));return h.some(x=>u.includes(x)||f.includes(x))?!1:b?!0:null});if(c!==null)return s==="fiction"?c:!c}}if(n.subjects&&n.subjects.length>0){const o=n.subjects.some(c=>{const l=c.toLowerCase();if(l.includes("fiction")&&!l.includes("non-fiction"))return!0;if(l.includes("non-fiction")||l.includes("nonfiction"))return!1;const u=["romance","mystery","thriller","fantasy","science fiction","horror","adventure","literary","drama","suspense"];return["biography","history","science","philosophy","religion","self-help","health","business","politics","economics"].some(b=>l.includes(b))?!1:u.some(b=>l.includes(b))?!0:null});if(o!==null)return s==="fiction"?o:!o}return!0}),Dx=r=>{const s=new Set(["all"]);let n=!1,o=!1;return r.forEach(c=>{c.categories&&c.categories.length>0&&c.categories.forEach(l=>{if(l.scheme.includes("fiction")||l.scheme.includes("genre")||l.scheme.includes("bisac")){const u=String(l.label||"").toLowerCase(),f=String(l.term||"").toLowerCase();(u.includes("fiction")&&!u.includes("non-fiction")||f.includes("fiction")&&!f.includes("non-fiction"))&&(n=!0),(u.includes("non-fiction")||f.includes("non-fiction")||u.includes("nonfiction")||f.includes("nonfiction"))&&(o=!0);const p=["romance","mystery","thriller","fantasy","science fiction","horror","adventure","literary","drama","suspense"],h=["biography","history","science","philosophy","religion","self-help","health","business","politics","economics"],b=p.some(x=>u.includes(x)||f.includes(x)),k=h.some(x=>u.includes(x)||f.includes(x));b&&(n=!0),k&&(o=!0)}}),c.subjects&&c.subjects.length>0&&c.subjects.forEach(l=>{const u=String(l||"").toLowerCase();u.includes("fiction")&&!u.includes("non-fiction")&&(n=!0),(u.includes("non-fiction")||u.includes("nonfiction"))&&(o=!0);const f=["romance","mystery","thriller","fantasy","science fiction","horror","adventure","literary","drama","suspense"],p=["biography","history","science","philosophy","religion","self-help","health","business","politics","economics"],h=f.some(k=>u.includes(k)),b=p.some(k=>u.includes(k));h&&(n=!0),b&&(o=!0)})}),n&&s.add("fiction"),o&&s.add("non-fiction"),Array.from(s)},Bx=(r,s)=>s==="all"?r:r.filter(n=>{const o=(n.acquisitionMediaType||n.mediaType)?.toLowerCase(),c=n.format?.toUpperCase();return s==="epub"?o==="application/epub+zip"||o?.includes("epub")||c==="EPUB":s==="pdf"?o==="application/pdf"||o?.includes("pdf")||c==="PDF":s==="audiobook"?o?.includes("bib.schema.org/audiobook")||o?.includes("audiobook")||c==="AUDIOBOOK":!1}),Mx=r=>{const s=new Set(["all"]);return r.forEach(o=>{const c=o.acquisitionMediaType||o.mediaType,l=c?.toLowerCase(),u=o.format?.toUpperCase();(l?.includes("bib.schema.org/audiobook")||l?.includes("audiobook")||c==="http://bib.schema.org/Audiobook"||u==="AUDIOBOOK")&&s.add("audiobook"),(l==="application/epub+zip"||l?.includes("epub")||u==="EPUB")&&s.add("epub"),(l==="application/pdf"||l?.includes("pdf")||u==="PDF")&&s.add("pdf")}),Array.from(s)},Jf=r=>r&&(r.trim().split("/").filter(Boolean).pop()||r.trim()).replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/[^a-zA-Z0-9]+/g,"-").replace(/^-+|-+$/g,"").toLowerCase()||void 0,Ux=r=>{if(r.publicationTypeLabel?.trim())return r.publicationTypeLabel.trim();if(r.schemaOrgType?.trim()){const s=r.schemaOrgType.trim().split("/").filter(Boolean).pop();return s?s.replace(/([a-z0-9])([A-Z])/g,"$1 $2"):void 0}if(r.format?.toUpperCase()==="AUDIOBOOK")return"Audiobook"},np=r=>Jf(r.schemaOrgType)||Jf(r.publicationTypeLabel)||(r.format?.toUpperCase()==="AUDIOBOOK"?"audiobook":void 0),zx=(r,s)=>s==="all"?r:r.filter(n=>np(n)===s),$x=r=>{const s=new Map;return r.forEach(n=>{const o=np(n),c=Ux(n);o&&c&&!s.has(o)&&s.set(o,c)}),Array.from(s.entries()).map(([n,o])=>({key:n,label:o}))},Wx=(r,s)=>s==="all"?r:r.filter(n=>(n.availabilityStatus||"available")===s),Vx=r=>{const s={available:"Available",unavailable:"Unavailable",reserved:"Reserved",ready:"Ready"},n=new Set;return r.forEach(o=>{n.add(o.availabilityStatus||"available")}),Array.from(n).sort().map(o=>({key:o,label:s[o]||o.replace(/-/g," ")}))},qx=(r,s)=>s==="all"?r:r.filter(n=>(n.distributor||"").trim()===s),Hx=r=>{const s=new Set;return r.forEach(n=>{const o=n.distributor?.trim();o&&s.add(o)}),Array.from(s).sort()},Gx={},sp="970895595671-06di7pi5bs5hi96o9js5jr1eeo2pigm7.apps.googleusercontent.com".trim(),ac=Number(Gx?.VITE_GOOGLE_INIT_TIMEOUT_MS||12e3),Kx=["https://www.googleapis.com/auth/drive.file","openid","profile","email"].join(" "),Ec="Custom Ebook Reader Library",ip="books",zo="library.json",_c="latest.json",op="library-snapshot-",eh="g_access_token_expires_at",th=3,Qx=400;let rh=!1,nh=!1,sh=null;const Xx=r=>new Promise(s=>setTimeout(s,r)),Zx=r=>r===429||typeof r=="number"&&r>=500&&r<600,ap=r=>{if(!r||typeof r!="object")return;const s=r;if(typeof s.status=="number")return s.status;if(typeof s.code=="number")return s.code;if(typeof s.result?.error?.code=="number")return s.result.error.code},Xo=(r,s)=>{const n=ap(r);if(n===401)return new Error("Google session expired or permission was revoked. Please sign in again.");if(r&&typeof r=="object"){const o=r,c=o.result?.error,l=Array.isArray(c?.errors)?c.errors.map(f=>f?.reason||f?.message).filter(f=>!!(f&&f.trim().length>0)):[];if(n===403){const f=[c?.status,...l,c?.message,o.details,o.message].filter(p=>!!(p&&p.trim().length>0)).join(" | ").toLowerCase();if(f.includes("insufficient")||f.includes("scope"))return new Error("Google sign-in succeeded, but Drive access was not granted. Sign out, then sign in again and approve Google Drive access.")}const u=[o.error,o.details,o.message,c?.message,...l].filter(f=>!!(f&&f.trim().length>0));if(u.length>0)return new Error(u.join(" - "))}return r instanceof Error?r:new Error(s)};async function Zo(r,s){let n=0;for(;n<th;)try{return await s()}catch(o){n+=1;const c=ap(o);if(!(Zx(c)||o instanceof TypeError&&o.message==="Failed to fetch")||n>=th)throw o;const u=Qx*Math.pow(2,n-1);ne.warn(`[google] ${r} failed, retrying`,{attempt:n,delay:u,status:c,error:o}),await Xx(u)}throw new Error(`[google] ${r} failed after retries`)}function Yx(){if(!sp)throw new Error("Google sync is not configured. Set VITE_GOOGLE_CLIENT_ID in your environment.")}const ih=(r,s,n=ac)=>new Promise((o,c)=>{const l=Date.now(),u=setInterval(()=>{const f=window[r];if(!!(f&&(!s||f[s]))){clearInterval(u),o(f);return}Date.now()-l>=n&&(clearInterval(u),c(new Error(`Timed out waiting for Google SDK (${r}${s?`.${s}`:""}) after ${n}ms.`)))},100)}),Jx=async()=>{rh||await new Promise((r,s)=>{const n=setTimeout(()=>{s(new Error(`Timed out loading gapi client after ${ac}ms.`))},ac);window.gapi.load("client",()=>{window.gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}).then(()=>{rh=!0,clearTimeout(n),r()}).catch(o=>{clearTimeout(n),s(o)})})})},As=()=>{const r=window.gapi?.client?.getToken?.(),s=r?.access_token;if(!s)throw new Error("Google session not available. Please sign in before syncing.");let n=null;if(typeof r?.expires_at=="number"&&Number.isFinite(r.expires_at)&&(n=r.expires_at>1e12?r.expires_at:r.expires_at*1e3),n!==null&&n<=Date.now()+6e4)throw new Error("Google session expired. Please sign in again.");const o=localStorage.getItem(eh),c=o?Number(o):NaN;return n===null&&Number.isFinite(c)&&c<=Date.now()+6e4&&localStorage.removeItem(eh),s};async function Yo(r){return Zo("drive.files.list",()=>window.gapi.client.drive.files.list(r))}async function e0(r){return Zo("drive.files.create",()=>window.gapi.client.drive.files.create(r))}async function lc(r){return Zo("drive.files.get",()=>window.gapi.client.drive.files.get(r))}const t0=r=>{const s=r.toISOString().replace(/[:.]/g,"-");return`${op}${s}.json`};async function Ac(r,s,n){return Zo(n,async()=>{const o=await fetch(r,s);if(!o.ok){const c=new Error(`${n} failed: ${o.status} ${o.statusText}`);throw c.status=o.status,c}return o})}const r0=r=>new Promise((s,n)=>{(async()=>{try{Yx(),await Promise.all([ih("gapi"),ih("google","accounts")]),nh||(sh=window.google.accounts.oauth2.initTokenClient({client_id:sp,scope:Kx,include_granted_scopes:!0,callback:r}),nh=!0),await Jx(),s(sh)}catch(o){ne.error("Error during Google Client initialization:",o),n(Xo(o,"Failed to initialize Google Client."))}})()}),n0=r=>{window.google?.accounts?.oauth2&&window.google.accounts.oauth2.revoke(r,()=>{ne.info("Access token revoked.")})},Si=async(r,s)=>{const n=`mimeType='application/vnd.google-apps.folder' and name='${r}' and trashed=false`+(s?` and '${s}' in parents`:""),o=await Yo({q:n});if(o.result.files&&o.result.files.length>0)return o.result.files[0].id;const c={name:r,mimeType:"application/vnd.google-apps.folder",...s&&{parents:[s]}};return(await e0({resource:c,fields:"id"})).result.id},_s=async(r,s)=>{const n=`'${r}' in parents and name='${s}' and trashed=false`,o=await Yo({q:n,fields:"files(id,name)"});return o.result.files&&o.result.files.length>0?o.result.files[0]:null},Vl=async(r,s,n)=>{const o=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),c=await _s(r,s);return c?.id?(await s0(c.id,o,"application/json"),c.id):lp(r,s,o,"application/json")},lp=async(r,s,n,o)=>{const c={name:s,parents:[r]},l=new FormData;l.append("metadata",new Blob([JSON.stringify(c)],{type:"application/json"})),l.append("file",new Blob([n],{type:o}));const u=As(),p=await(await Ac("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:new Headers({Authorization:`Bearer ${u}`}),body:l},"drive.uploadFile")).json();if(p.error)throw new Error(p.error.message);return p.id},s0=async(r,s,n)=>{const o=As(),l=await(await Ac(`https://www.googleapis.com/upload/drive/v3/files/${r}?uploadType=media`,{method:"PATCH",headers:new Headers({Authorization:`Bearer ${o}`,"Content-Type":n}),body:s},"drive.updateFile")).json();if(l.error)throw new Error(l.error.message);return l},i0=async(r,s,n)=>{try{As();const o=await Si(Ec);localStorage.setItem("ebook-reader-drive-folder-id",o),n(`Uploading ${s.length} book files...`);const c=await Si(ip,o),l=s.map(async(h,b)=>{n(`Uploading book ${b+1}/${s.length}: ${h.title}`);const k=(h.format||"epub").toLowerCase(),x=k==="pdf"?"application/pdf":"application/epub+zip",y=`${h.id}.${k}`;await lp(c,y,h.epubData,x)});await Promise.all(l),n("Uploading library metadata...");const u=new Date,f=t0(u),p=await Vl(o,f,r);await Vl(o,zo,r),await Vl(o,_c,{latestSnapshotFileId:p,latestSnapshotFileName:f,updatedAt:u.toISOString(),version:1}),n("Upload complete!")}catch(o){throw Xo(o,"Upload failed.")}},o0=async()=>{try{As();const r=await Si(Ec);let s,n;const o=await _s(r,_c);if(o?.id)try{const p=await lc({fileId:o.id,alt:"media"}),h=JSON.parse(p.body||"{}");s=typeof h.latestSnapshotFileId=="string"?h.latestSnapshotFileId:void 0,n=typeof h.latestSnapshotFileName=="string"?h.latestSnapshotFileName:void 0}catch(p){ne.warn("Failed to parse latest.json pointer",p)}const c=`'${r}' in parents and name contains '${op}' and trashed=false`,l=await Yo({q:c,fields:"files(id,name,createdTime,modifiedTime)",orderBy:"modifiedTime desc",pageSize:50}),f=(Array.isArray(l?.result?.files)?l.result.files:[]).filter(p=>typeof p?.id=="string"&&typeof p?.name=="string").map(p=>({id:p.id,name:p.name,createdAt:p.createdTime||p.modifiedTime||new Date(0).toISOString(),isLatest:s&&s===p.id||n&&n===p.name||!1}));if(f.length===0){const p=await _s(r,zo);if(p?.id)return[{id:p.id,name:zo,createdAt:new Date(0).toISOString(),isLatest:!0}]}return f}catch(r){throw Xo(r,"Failed to list Drive snapshots.")}},a0=async(r,s)=>{try{As(),r("Finding app folder in Drive...");const n=await Si(Ec);r("Resolving metadata snapshot...");let o=s;if(!o){const p=await _s(n,_c);if(p?.id)try{const h=await lc({fileId:p.id,alt:"media"}),b=JSON.parse(h.body||"{}");typeof b.latestSnapshotFileId=="string"?o=b.latestSnapshotFileId:typeof b.latestSnapshotFileName=="string"&&(o=(await _s(n,b.latestSnapshotFileName))?.id)}catch(h){ne.warn("Failed to resolve latest snapshot pointer; falling back to library.json",h)}}if(o||(o=(await _s(n,zo))?.id),!o)return null;r("Downloading library metadata...");const c=await lc({fileId:o,alt:"media"}),l=JSON.parse(c.body);r("Finding books subfolder...");const u=await Si(ip,n),f=[];for(let p=0;p<l.library.length;p++){const h=l.library[p];if(!h.id){ne.warn(`Book metadata for "${h.title}" is missing an ID, skipping download.`);continue}r(`Downloading book ${p+1}/${l.library.length}: ${h.title}`);const b=(h.format||"epub").toLowerCase(),k=`${h.id}.${b}`,x=`'${u}' in parents and name='${k}' and trashed=false`,y=await Yo({q:x});if(!(y.result.files&&y.result.files.length>0)){ne.warn(`Book file for "${h.title}" (ID: ${h.id}, filename: ${k}) not found in Drive.`);continue}const S=y.result.files[0].id;try{const g=As(),N=await(await Ac(`https://www.googleapis.com/drive/v3/files/${S}?alt=media`,{headers:{Authorization:`Bearer ${g}`}},"drive.downloadBookFile")).arrayBuffer(),A={...h,epubData:N};f.push(A)}catch(g){ne.warn(`Failed to download book file for "${h.title}" (ID: ${h.id}).`,g)}}return r("Download complete!"),{payload:l,booksWithData:f}}catch(n){throw Xo(n,"Download failed.")}};function cc(r,s){const[n,o]=R.useState(()=>{try{const l=localStorage.getItem(r);return l?JSON.parse(l):s}catch(l){return ne.error(`Error reading localStorage key "${r}":`,l),s}});R.useEffect(()=>{try{localStorage.setItem(r,JSON.stringify(n))}catch(l){ne.error(`Error writing to localStorage key "${r}":`,l)}},[r,n]);const c=R.useCallback(()=>{try{localStorage.removeItem(r),o(s)}catch(l){ne.error(`Error removing localStorage key "${r}":`,l)}},[r,s]);return[n,o,c]}function cp(){const[r,s]=cc(Pf.CATALOGS,[]),[n,o]=cc(Pf.REGISTRIES,[]),c=R.useMemo(()=>n.map(({id:k,name:x,url:y})=>({id:k,name:x,url:y})),[n]);R.useEffect(()=>{if(r.some(x=>!x.opdsVersion)){const x=r.map(y=>y.opdsVersion?y:{...y,opdsVersion:"auto"});s(x)}},[r,s]),R.useEffect(()=>{n.some(x=>"opdsVersion"in x)&&o(c)},[n,c,o]);const l=R.useCallback((k,x,y="auto")=>{const S={id:new Date().toISOString(),name:k,url:x,opdsVersion:y};return s(g=>[...g,S]),S},[s]),u=R.useCallback(k=>{s(x=>x.filter(y=>y.id!==k))},[s]),f=R.useCallback((k,x)=>{s(y=>y.map(S=>S.id===k?{...S,...x}:S))},[s]),p=R.useCallback((k,x)=>{console.warn("[useCatalogs] addRegistry called:",{name:k,url:x});const y={id:new Date().toISOString(),name:k,url:x};return console.warn("[useCatalogs] Created registry object:",y),console.warn("[useCatalogs] Has opdsVersion?","opdsVersion"in y),o(S=>{const g=[...S,y];return console.warn("[useCatalogs] Updated registries:",g),g}),y},[o]),h=R.useCallback(k=>{o(x=>x.filter(y=>y.id!==k))},[o]),b=R.useCallback((k,x)=>{o(y=>y.map(S=>S.id===k?{...S,...x}:S))},[o]);return{catalogs:r,registries:c,addCatalog:l,deleteCatalog:u,updateCatalog:f,addRegistry:p,deleteRegistry:h,updateRegistry:b}}const l0=()=>typeof window>"u"||typeof window.matchMedia!="function"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";function up(){const[r,s]=cc(mv.THEME,"system"),[n,o]=R.useState(()=>l0());R.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),u=f=>{o(f.matches?"dark":"light")};return o(l.matches?"dark":"light"),typeof l.addEventListener=="function"?(l.addEventListener("change",u),()=>l.removeEventListener("change",u)):(l.addListener(u),()=>l.removeListener(u))},[]);const c=R.useMemo(()=>r==="system"?n:r,[n,r]);return R.useEffect(()=>{if(typeof document>"u")return;const l=document.documentElement,u=document.body;l.dataset.uiTheme=r,l.dataset.uiThemeResolved=c,u.dataset.uiTheme=r,u.dataset.uiThemeResolved=c,u.classList.remove("bg-slate-900","text-white","bg-slate-50","text-slate-950"),c==="light"?u.classList.add("bg-slate-50","text-slate-950"):u.classList.add("bg-slate-900","text-white")},[c,r]),{uiTheme:r,setUiTheme:s,resolvedTheme:c}}class c0{constructor(){this.dbInstance=null}async init(){return this.dbInstance?this.dbInstance:new Promise((s,n)=>{const o=indexedDB.open(Kh,Qh);o.onerror=()=>{ne.error("IndexedDB error:",o.error),n(new Error("Failed to open IndexedDB"))},o.onsuccess=()=>{this.dbInstance=o.result,s(this.dbInstance)},o.onupgradeneeded=c=>{const l=c.target.result;let u;if(!l.objectStoreNames.contains(rt))u=l.createObjectStore(rt,{keyPath:"id",autoIncrement:!0}),u.createIndex(er.TITLE,er.TITLE,{unique:!1});else{const f=c.target.transaction;if(f)u=f.objectStore(rt);else return}c.oldVersion<2&&(u.indexNames.contains(er.ISBN)||u.createIndex(er.ISBN,er.ISBN,{unique:!1})),c.oldVersion<3&&(u.indexNames.contains(er.PROVIDER_ID)||u.createIndex(er.PROVIDER_ID,er.PROVIDER_ID,{unique:!1}))}})}async save(s){try{const n=await this.init(),o=await new Promise((c,l)=>{const p=n.transaction(rt,"readwrite").objectStore(rt).put(s);p.onsuccess=()=>{c(p.result)},p.onerror=()=>{ne.error("Error saving book:",p.error),l(new Error("Failed to save book"))}});return ne.info(`Book saved successfully with ID: ${o}`),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error saving book";return ne.error("BookRepository.save error:",o),{success:!1,error:o}}}async findById(s){try{const n=await this.init();return{success:!0,data:await new Promise((c,l)=>{const p=n.transaction(rt,"readonly").objectStore(rt).get(s);p.onsuccess=()=>{c(p.result)},p.onerror=()=>{ne.error("Error getting book:",p.error),l(new Error("Failed to get book"))}})||null}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding book";return ne.error("BookRepository.findById error:",o),{success:!1,error:o}}}async findMetadataById(s){try{const n=await this.findById(s);if(!n.success)return{success:!1,error:"Failed to find book metadata"};if(!n.data)return{success:!0,data:null};const o=n.data;return{success:!0,data:{id:o.id,title:o.title,author:o.author,coverImage:o.coverImage,publisher:o.publisher,publicationDate:o.publicationDate,isbn:o.isbn,providerId:o.providerId,providerName:o.providerName,distributor:o.distributor,description:o.description,subjects:o.subjects,format:o.format,language:o.language,rights:o.rights,identifiers:o.identifiers,opfRaw:o.opfRaw,accessModes:o.accessModes,accessModesSufficient:o.accessModesSufficient,accessibilityFeatures:o.accessibilityFeatures,hazards:o.hazards,accessibilitySummary:o.accessibilitySummary,certificationConformsTo:o.certificationConformsTo,certification:o.certification,accessibilityFeedback:o.accessibilityFeedback}}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding metadata";return ne.error("BookRepository.findMetadataById error:",o),{success:!1,error:o}}}async findAll(){try{const s=await this.init();return{success:!0,data:await new Promise((o,c)=>{const f=s.transaction(rt,"readonly").objectStore(rt).getAll();f.onsuccess=()=>{o(f.result)},f.onerror=()=>{ne.error("Error getting all books:",f.error),c(new Error("Failed to get all books"))}})}}catch(s){const n=s instanceof Error?s.message:"Unknown error finding all books";return ne.error("BookRepository.findAll error:",n),{success:!1,error:n}}}async findAllMetadata(){try{const s=await this.init(),n=await new Promise((o,c)=>{const f=s.transaction(rt,"readonly").objectStore(rt).openCursor(),p=[];f.onsuccess=h=>{const b=h.target.result;b?(p.push({...b.value}),b.continue()):(console.log("[BookRepository.findAllMetadata] Loaded metadata:",p),o(p))},f.onerror=()=>{ne.error("Error getting books metadata:",f.error),c(new Error("Failed to get books metadata"))}});return console.log("[BookRepository.findAllMetadata] Returning books:",n),{success:!0,data:n}}catch(s){const n=s instanceof Error?s.message:"Unknown error finding all metadata";return ne.error("BookRepository.findAllMetadata error:",n),{success:!1,error:n}}}async findByIdentifier(s){if(!s)return{success:!0,data:null};try{const n=await this.init(),o=async u=>new Promise((f,p)=>{try{const b=n.transaction(rt,"readonly").objectStore(rt);if(!b.indexNames.contains(u)){f(null);return}const x=b.index(u).get(s);x.onsuccess=()=>{f(x.result||null)},x.onerror=()=>{ne.error(`Error finding book by ${u}:`,x.error),p(new Error(`Failed to find book by ${u}`))}}catch(h){ne.error(`Error initiating search on index ${u}:`,h),f(null)}}),c=await o("providerId");return c?{success:!0,data:c}:{success:!0,data:await o("isbn")}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding by identifier";return ne.error("BookRepository.findByIdentifier error:",o),{success:!1,error:o}}}async delete(s){try{const n=await this.init();return await new Promise((o,c)=>{const f=n.transaction(rt,"readwrite").objectStore(rt).delete(s);f.onsuccess=()=>{o()},f.onerror=()=>{ne.error("Error deleting book:",f.error),c(new Error("Failed to delete book"))}}),ne.info(`Book deleted successfully: ${s}`),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error deleting book";return ne.error("BookRepository.delete error:",o),{success:!1,error:o}}}async deleteAll(){try{const s=await this.init();return await new Promise((n,o)=>{const u=s.transaction(rt,"readwrite").objectStore(rt).clear();u.onsuccess=()=>{n()},u.onerror=()=>{ne.error("Error clearing all books:",u.error),o(new Error("Failed to clear all books"))}}),ne.warn("All books cleared from library"),{success:!0,data:void 0}}catch(s){const n=s instanceof Error?s.message:"Unknown error clearing all books";return ne.error("BookRepository.deleteAll error:",n),{success:!1,error:n}}}async update(s,n){try{const o=await this.findById(s);if(!o.success)return{success:!1,error:"Failed to find book for update"};if(!o.data)return{success:!1,error:"Book not found"};const c={...o.data,...n,id:s};return(await this.save(c)).success?{success:!0,data:void 0}:{success:!1,error:"Failed to save updated book"}}catch(o){const c=o instanceof Error?o.message:"Unknown error updating book";return ne.error("BookRepository.update error:",c),{success:!1,error:c}}}async exists(s){const n=await this.findByIdentifier(s);return n.success?{success:!0,data:n.data!==null}:{success:!1,error:"Failed to check if book exists"}}async count(){try{const s=await this.init();return{success:!0,data:await new Promise((o,c)=>{const f=s.transaction(rt,"readonly").objectStore(rt).count();f.onsuccess=()=>{o(f.result)},f.onerror=()=>{ne.error("Error counting books:",f.error),c(new Error("Failed to count books"))}})}}catch(s){const n=s instanceof Error?s.message:"Unknown error counting books";return ne.error("BookRepository.count error:",n),{success:!1,error:n}}}}const dp=new c0,vi={all:["books"],detail:r=>["books",r],metadata:r=>["books",r,"metadata"]};function u0(){return yc({queryKey:vi.all,queryFn:async()=>{const r=await dp.findAllMetadata();if(r.success)return r.data;{const s=r.error;throw ne.error("Failed to fetch books from repository:",s),new Error(s)}}})}function d0(){const r=$o();return ry({mutationFn:async s=>{const n=await dp.delete(s);if(!n.success){const o=n.error;throw ne.error(`Failed to delete book ${s}:`,o),new Error(o)}},onSuccess:()=>{r.invalidateQueries({queryKey:vi.all})}})}class f0{async fetchCatalog(s,n,o="auto"){try{const c=(()=>{try{return new URL(s).hostname.toLowerCase()}catch{return""}})(),u=c.endsWith("palace.io")||c.endsWith("palaceproject.io")||c.endsWith("thepalaceproject.org")||c==="palace.io"||c.endsWith(".palace.io")||c.endsWith(".thepalaceproject.org")?"1":o,f=await Px(s,n,u);return f.error?{success:!1,error:f.error}:{success:!0,data:{books:f.books,navigationLinks:f.navLinks,facetGroups:f.facetGroups||[],pagination:f.pagination,search:f.search}}}catch(c){const l=c instanceof Error?c.message:"Unknown error fetching OPDS catalog";return ne.error("OPDS fetch error:",l),{success:!1,error:l}}}async parseOPDS1(s,n){try{ne.info("Parsing OPDS 1 feed",{baseUrl:n});const o=jn(s,n);return ne.info("OPDS 1 parse successful",{bookCount:o.books.length,navLinkCount:o.navLinks.length}),{success:!0,data:{books:o.books,navigationLinks:o.navLinks,facetGroups:o.facetGroups||[],pagination:o.pagination,search:o.search}}}catch(o){const c=o instanceof Error?o.message:"Unknown error parsing OPDS 1";return ne.error("OPDS 1 parse error:",c),{success:!1,error:c}}}async parseOPDS2(s,n){try{ne.info("Parsing OPDS 2 feed",{baseUrl:n});const o=Io(s,n);if(o.error){const c=o.error;return ne.error("OPDS 2 parse reported error",{baseUrl:n,error:c}),{success:!1,error:c}}return ne.info("OPDS 2 parse successful",{bookCount:o.books.length,navLinkCount:o.navLinks.length}),{success:!0,data:{books:o.books,navigationLinks:o.navLinks,facetGroups:o.facetGroups||[],pagination:o.pagination,search:o.search}}}catch(o){const c=o instanceof Error?o.message:"Unknown error parsing OPDS 2";return ne.error("OPDS 2 parse error:",c),{success:!1,error:c}}}async parseOPDS(s,n){try{if(typeof s=="object"&&s!==null)return this.parseOPDS2(s,n);const o=s.trim();if(o.startsWith("<"))return this.parseOPDS1(o,n);if(o.startsWith("{")||o.startsWith("["))try{const c=JSON.parse(o);return this.parseOPDS2(c,n)}catch{return{success:!1,error:"Invalid JSON content"}}return{success:!1,error:"Unable to detect OPDS version"}}catch(o){const c=o instanceof Error?o.message:"Unknown error parsing OPDS";return ne.error("OPDS auto-parse error:",c),{success:!1,error:c}}}detectVersion(s){if(typeof s=="object"&&s!==null)return"2";if(typeof s=="string"){const n=s.trim();if(n.startsWith("<"))return"1";if(n.startsWith("{")||n.startsWith("["))return"2"}return null}}class h0{async resolveOPDS2(s,n,o=5){try{ne.info("Resolving OPDS 2 acquisition chain",{href:s});const c=await Nx(s,n,o);return c?(ne.info("OPDS 2 acquisition resolved",{finalUrl:c}),{success:!0,data:c}):{success:!1,error:"Failed to resolve acquisition chain"}}catch(c){const l=c instanceof Error?c.message:"Unknown error resolving acquisition";return ne.error("OPDS 2 acquisition error:",l),{success:!1,error:l,status:c?.status,proxyUsed:c?.proxyUsed}}}async resolveOPDS1(s,n,o=5){try{ne.info("Resolving OPDS 1 acquisition chain",{href:s});const c=await Lx(s,n,o);return c?(ne.info("OPDS 1 acquisition resolved",{finalUrl:c}),{success:!0,data:c}):{success:!1,error:"Failed to resolve acquisition chain"}}catch(c){const l=c instanceof Error?c.message:"Unknown error resolving acquisition";return ne.error("OPDS 1 acquisition error:",l),{success:!1,error:l,status:c?.status,proxyUsed:c?.proxyUsed}}}async resolve(s,n="auto",o,c=5){if(n==="2")return this.resolveOPDS2(s,o,c);if(n==="1")return this.resolveOPDS1(s,o,c);ne.info("Auto-detecting OPDS version for acquisition",{href:s});const l=await this.resolveOPDS2(s,o,c);return l.success?l:(ne.info("OPDS 2 resolution failed, trying OPDS 1",{href:s}),this.resolveOPDS1(s,o,c))}}const uc=new f0,ql=new h0,p0={all:["catalogs"],content:(r,s,n)=>["catalogs","content",r,s,n]};function m0(r,s,n="auto",o=!0){return yc({queryKey:p0.content(r||"",s,n),queryFn:async()=>{if(!r)return{books:[],navigationLinks:[],facetGroups:[],pagination:{},search:null,error:"No URL provided"};ne.debug(`[useCatalogContent] Fetching: ${r}`);const c=await uc.fetchCatalog(r,s,n);if(!c.success)return{books:[],navigationLinks:[],facetGroups:[],pagination:{},search:null,error:"error"in c?c.error:"Failed to fetch catalog content"};const l=c.data.navigationLinks.length>0&&c.data.books.length===0;let u=c.data.navigationLinks;if(l&&c.data.pagination){const f=Object.values(c.data.pagination).filter(p=>!!p);u=c.data.navigationLinks.filter(p=>!f.includes(p.url))}return{books:c.data.books,navigationLinks:u,facetGroups:c.data.facetGroups,pagination:c.data.pagination,search:c.data.search||null,error:null}},enabled:o&&!!r,staleTime:120*1e3})}const g0={all:["catalog-search"],description:r=>["catalog-search","description",r]};function y0(r,s=!0){const n=r?.kind==="opensearch"&&r.descriptionUrl||"";return yc({queryKey:g0.description(n),queryFn:async()=>{if(r?.kind!=="opensearch"||!r.descriptionUrl)throw new Error("No OpenSearch description URL provided");return sx(r.descriptionUrl)},enabled:s&&!!n,staleTime:600*1e3,retry:!1})}function v0(r,s=!0){const n=y0(r,s&&r?.kind==="opensearch"),o=R.useMemo(()=>r?.kind!=="opds2-template"||!r.template?null:{shortName:r.title,activeTemplate:{template:r.template,type:r.type,method:"GET",rel:r.rel,params:r.params||[]}},[r]);return r?.kind==="opds2-template"?{data:o,isLoading:!1,error:null}:{data:n.data?{shortName:n.data.shortName,activeTemplate:n.data.activeTemplate}:null,isLoading:n.isLoading,error:n.error}}function x0(r={}){const{enableArrowKeys:s=!1,enableActivation:n=!1,enableEscape:o=!1,onArrowKey:c,onActivate:l,onEscape:u,preventDefault:f=!0,stopPropagation:p=!1}=r,h=R.useRef(c),b=R.useRef(l),k=R.useRef(u);R.useEffect(()=>{h.current=c,b.current=l,k.current=u},[c,l,u]);const x=R.useCallback(y=>{if(s&&h.current){let S=null;switch(y.key){case"ArrowUp":S="up";break;case"ArrowDown":S="down";break;case"ArrowLeft":S="left";break;case"ArrowRight":S="right";break}if(S){f&&y.preventDefault(),p&&y.stopPropagation(),h.current(S,y);return}}if(n&&b.current&&(y.key==="Enter"||y.key===" ")){f&&y.preventDefault(),p&&y.stopPropagation(),b.current(y);return}if(o&&k.current&&y.key==="Escape"){f&&y.preventDefault(),p&&y.stopPropagation(),k.current(y);return}},[s,n,o,f,p]);R.useEffect(()=>(window.addEventListener("keydown",x),()=>{window.removeEventListener("keydown",x)}),[x])}function vr(r){const{isActive:s,initialFocusRef:n,returnFocusRef:o,onEscape:c}=r,l=R.useRef(null),u=R.useRef(null),f=R.useCallback(h=>{const b=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].join(",");return Array.from(h.querySelectorAll(b)).filter(x=>x.offsetParent!==null&&getComputedStyle(x).visibility!=="hidden")},[]),p=R.useCallback(h=>{if(l.current){if(h.key==="Escape"&&c){h.preventDefault(),c();return}if(h.key==="Tab"){const b=f(l.current);if(b.length===0){h.preventDefault();return}const k=b[0],x=b[b.length-1];if(h.shiftKey&&document.activeElement===k){h.preventDefault(),x.focus();return}if(!h.shiftKey&&document.activeElement===x){h.preventDefault(),k.focus();return}}}},[f,c]);return R.useEffect(()=>{if(!s||!l.current)return;u.current=document.activeElement;const h=f(l.current);n?.current?n.current.focus():h.length>0&&h[0].focus();const b=l.current;return b&&b.addEventListener("keydown",p),()=>{b&&b.removeEventListener("keydown",p),o?.current?o.current.focus():u.current&&u.current.focus()}},[s,n,o,f,p]),l}function w0(r){const{shortcuts:s,enabled:n=!0,preventInInputs:o=!0}=r,c=R.useRef(s);R.useEffect(()=>{c.current=s},[s]);const l=R.useCallback(u=>{if(!n)return;if(o){const p=u.target,h=p.tagName.toLowerCase();if(h==="input"||h==="textarea"||p.isContentEditable)return}const f=c.current.find(p=>{if(p.enabled===!1||!(u.key===p.key))return!1;const b=p.ctrl?u.ctrlKey||u.metaKey:!u.ctrlKey&&!u.metaKey,k=p.shift?u.shiftKey:!u.shiftKey,x=p.alt?u.altKey:!u.altKey;return b&&k&&x});f&&(f.preventDefault&&u.preventDefault(),f.action(u))},[n,o]);R.useEffect(()=>{if(n)return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[n,l])}function b0(r){const s=typeof navigator<"u"&&navigator.platform.toUpperCase().includes("MAC"),n=[];r.ctrl&&n.push(s?"":"Ctrl"),r.shift&&n.push(s?"":"Shift"),r.alt&&n.push(s?"":"Alt");let o=r.key;return o===" "?o="Space":o==="ArrowLeft"?o="":o==="ArrowRight"?o="":o==="ArrowUp"?o="":o==="ArrowDown"?o="":o==="Escape"&&(o="Esc"),n.push(o),n.join(s?"":"+")}const fp=({isOpen:r,onClose:s,onSave:n})=>{const[o,c]=R.useState(""),l=200,u=R.useRef(null),f=vr({isActive:r,initialFocusRef:u,onEscape:s});if(R.useEffect(()=>{r&&c("")},[r]),!r)return null;const p=()=>{n(o)},h=l-o.length;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:s,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:f,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-md rounded-lg border p-6 shadow-xl",onClick:b=>b.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Add Bookmark"}),a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"theme-text-secondary mb-4 text-sm",children:"A bookmark for the current location will be created. You can add an optional note below."}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"bookmark-note",className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Note (optional)"}),a.jsx("textarea",{ref:u,id:"bookmark-note",rows:4,value:o,onChange:b=>{b.target.value.length<=l&&c(b.target.value)},className:"theme-input w-full rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500",placeholder:"Add a brief note..."}),a.jsxs("p",{className:`mt-1 text-right text-xs ${h<20?"theme-text-danger":"theme-text-muted"}`,children:[h," characters remaining"]})]}),a.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[a.jsx("button",{onClick:s,className:"theme-button-neutral theme-hover-surface rounded-md px-4 py-2 font-semibold transition-colors",children:"Cancel"}),a.jsx("button",{onClick:p,className:"py-2 px-6 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold",children:"Save Bookmark"})]})]})})},hp=({isOpen:r,onClose:s,onSave:n})=>{const[o,c]=R.useState(""),l=50,u=R.useRef(null),f=vr({isActive:r,initialFocusRef:u,onEscape:s});if(R.useEffect(()=>{r&&c("")},[r]),!r)return null;const p=()=>{n(o)},h=l-o.length;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:s,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:f,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-md rounded-lg border p-6 shadow-xl",onClick:b=>b.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Create Citation"}),a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"theme-text-secondary mb-4 text-sm",children:"A citation for the current location will be created. You can add an optional note below."}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"citation-note",className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Note (optional)"}),a.jsx("textarea",{ref:u,id:"citation-note",rows:3,value:o,onChange:b=>{b.target.value.length<=l&&c(b.target.value)},className:"theme-input w-full rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500",placeholder:"Add a brief note..."}),a.jsxs("p",{className:`mt-1 text-right text-xs ${h<10?"theme-text-danger":"theme-text-muted"}`,children:[h," characters remaining"]})]}),a.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[a.jsx("button",{onClick:s,className:"theme-button-neutral theme-hover-surface rounded-md px-4 py-2 font-semibold transition-colors",children:"Discard"}),a.jsx("button",{onClick:p,className:"py-2 px-6 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold",children:"Save Citation"})]})]})})},Rn=({text:r,size:s="medium"})=>{const n=s==="small"?"h-5 w-5 border-2":"h-12 w-12 border-b-2",o=s==="small"?"text-sm":"text-base";return a.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",role:"status","aria-live":"polite","aria-busy":"true",children:[a.jsx("div",{className:`animate-spin rounded-full border-sky-400 ${n}`,"aria-hidden":"true"}),r&&a.jsx("p",{className:`text-sky-300 ${o}`,children:r}),!r&&a.jsx("span",{className:"sr-only",children:"Loading..."})]})},k0=({excerpt:r,query:s})=>{if(!s)return a.jsx("span",{children:r});const n=s.toLowerCase(),o=r.replace(/\s+/g," ").trim(),l=o.toLowerCase().indexOf(n);if(l===-1){const y=r.split(new RegExp(`(${s})`,"gi"));return a.jsx("span",{className:"theme-text-secondary text-sm transition-colors group-hover:text-sky-300",children:y.map((S,g)=>S.toLowerCase()===n?a.jsx("strong",{className:"text-sky-300 bg-sky-800/50 font-normal rounded",children:S},g):a.jsx("span",{children:S},g))})}let u=o.lastIndexOf(".",l);u=Math.max(u,o.lastIndexOf("!",l)),u=Math.max(u,o.lastIndexOf("?",l));let f=o.indexOf(".",l+s.length);f===-1&&(f=1/0);let p=o.indexOf("!",l+s.length);p!==-1&&(f=Math.min(f,p)),p=o.indexOf("?",l+s.length),p!==-1&&(f=Math.min(f,p)),f===1/0?f=o.length:f++,u===-1?u=0:u++;const h=o.substring(u,f).trim(),b=u>0,k=f<o.length,x=h.split(new RegExp(`(${s})`,"gi"));return a.jsxs("span",{className:"theme-text-secondary text-sm transition-colors group-hover:text-sky-300",children:[b&&"...",x.map((y,S)=>y.toLowerCase()===n?a.jsx("strong",{className:"text-sky-300 bg-sky-800/50 font-normal rounded",children:y},S):a.jsx("span",{children:y},S)),k&&"..."]})},S0=({isOpen:r,onClose:s,onQueryChange:n,onNavigate:o,results:c,isLoading:l,searchQuery:u})=>r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/60 z-30",onClick:s,"aria-hidden":"true"}),a.jsxs("div",{className:`theme-surface-elevated theme-border theme-text-primary fixed top-0 left-0 z-40 flex h-full w-80 transform flex-col border-r shadow-2xl transition-transform duration-300 ease-in-out ${r?"translate-x-0":"-translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"search-heading",children:[a.jsxs("div",{className:"theme-divider flex shrink-0 items-center justify-between border-b p-4",children:[a.jsx("h3",{id:"search-heading",className:"theme-text-primary text-xl font-semibold",children:"Search"}),a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2","aria-label":"Close search",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"theme-divider shrink-0 border-b p-4",children:a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:a.jsx(Sc,{className:"theme-text-muted h-5 w-5"})}),a.jsx("input",{type:"search",placeholder:"Search in book...",value:u,onChange:f=>n(f.target.value),className:"theme-input w-full rounded-md py-2 pl-10 pr-3 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Search input",autoFocus:!0})]})}),a.jsx("div",{className:"overflow-y-auto flex-grow",children:l?a.jsx("div",{className:"flex justify-center items-center h-full",children:a.jsx(Rn,{text:"Searching..."})}):u&&c.length>0?a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"theme-text-muted px-4 pb-2 pt-4 text-xs",children:[c.length," result",c.length!==1&&"s",' found for "',u,'"']}),a.jsx("ul",{className:"theme-divider divide-y",children:c.map((f,p)=>a.jsx("li",{className:"group",children:a.jsx("button",{onClick:()=>o(f.cfi),className:"w-full text-left p-4 hover:bg-sky-500/10 transition-colors theme-hover-surface",children:a.jsx(k0,{excerpt:f.excerpt.trim(),query:u})})},p))})]}):u&&c.length===0?a.jsxs("p",{className:"theme-text-secondary p-8 text-center",children:['No results found for "',u,'".']}):a.jsx("p",{className:"theme-text-secondary p-8 text-center",children:"Enter a term above to search the book."})})]})]}):null,N0=({isOpen:r,onClose:s,settings:n,onSettingsChange:o})=>{const[c,l]=R.useState("display"),[u,f]=R.useState([]);if(R.useEffect(()=>{if(r){const k=()=>{const x=window.speechSynthesis.getVoices();x.length>0&&f(x)};return k(),window.speechSynthesis.onvoiceschanged=k,()=>{window.speechSynthesis.onvoiceschanged=null}}},[r]),!r)return null;const p=k=>{o({readAloud:{...n.readAloud,...k}})},h=k=>{window.speechSynthesis.cancel();const x=new SpeechSynthesisUtterance("Hello, this is a preview of my voice.");x.voice=k,x.rate=n.readAloud.rate,x.pitch=n.readAloud.pitch,window.speechSynthesis.speak(x)},b=()=>{const k=u.find(x=>x.voiceURI===n.readAloud.voiceURI);return a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("label",{className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Voice"}),a.jsxs("div",{className:"theme-surface rounded-md p-3 mb-4",children:[a.jsx("p",{className:"theme-text-muted text-center text-xs",children:"Current Voice"}),a.jsx("p",{className:"font-semibold text-sky-300 truncate text-center",title:k?k.name:"System Default",children:k?k.name:"System Default"})]}),a.jsx("p",{className:"theme-text-muted mb-2 text-xs",children:"Select a new voice from the list below:"}),a.jsx("div",{className:"theme-surface theme-border max-h-48 overflow-y-auto rounded-md border",children:a.jsx("ul",{className:"theme-divider divide-y",children:u.length>0?u.map(x=>a.jsxs("li",{className:`flex items-center justify-between p-2 text-sm transition-colors ${n.readAloud.voiceURI===x.voiceURI?"bg-sky-500/20 text-sky-300":"theme-hover-surface"}`,children:[a.jsxs("button",{onClick:()=>p({voiceURI:x.voiceURI}),className:"flex-grow text-left pr-2",children:[a.jsx("span",{className:"font-medium",children:x.name}),a.jsx("span",{className:"theme-text-muted block text-xs",children:x.lang})]}),a.jsx("button",{onClick:()=>h(x),className:"theme-hover-surface shrink-0 rounded-full p-2","aria-label":`Preview voice ${x.name}`,children:a.jsx(Hh,{className:"w-4 h-4"})})]},x.voiceURI)):a.jsx("li",{className:"theme-text-muted p-4 text-center",children:"Loading voices..."})})})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"read-speed",className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Speed"}),a.jsx("input",{id:"read-speed",type:"range",min:"0.5",max:"2",step:"0.1",value:n.readAloud.rate,onChange:x=>p({rate:parseFloat(x.target.value)}),className:"theme-slider h-2 w-full cursor-pointer appearance-none rounded-lg"}),a.jsxs("div",{className:"theme-text-muted mt-1 text-center text-sm",children:[n.readAloud.rate.toFixed(1),"x"]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"read-pitch",className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Pitch"}),a.jsx("input",{id:"read-pitch",type:"range",min:"0",max:"2",step:"0.1",value:n.readAloud.pitch,onChange:x=>p({pitch:parseFloat(x.target.value)}),className:"theme-slider h-2 w-full cursor-pointer appearance-none rounded-lg"}),a.jsx("div",{className:"theme-text-muted mt-1 text-center text-sm",children:n.readAloud.pitch.toFixed(1)})]})]})};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/60 z-30",onClick:s}),a.jsxs("div",{className:`theme-surface-elevated theme-border theme-text-primary fixed top-0 right-0 z-40 flex h-full w-80 transform flex-col border-l shadow-2xl transition-transform duration-300 ease-in-out ${r?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"settings-panel-title",children:[a.jsxs("div",{className:"theme-divider flex shrink-0 items-center justify-between border-b p-4",children:[a.jsx("h3",{id:"settings-panel-title",className:"theme-text-primary text-xl font-semibold",children:"Settings"}),a.jsx("button",{onClick:s,"aria-label":"Close settings",className:"theme-hover-surface rounded-full p-2",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"theme-divider shrink-0 border-b px-2",children:a.jsxs("nav",{className:"flex -mb-px",children:[a.jsxs("button",{onClick:()=>l("display"),className:`flex-1 flex items-center justify-center gap-2 py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${c==="display"?"border-sky-400 text-sky-300":"theme-text-secondary border-transparent hover:text-sky-400 hover:border-slate-500"}`,children:[a.jsx(av,{className:"w-5 h-5"}),"Display"]}),a.jsxs("button",{onClick:()=>l("readAloud"),className:`flex-1 flex items-center justify-center gap-2 py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${c==="readAloud"?"border-sky-400 text-sky-300":"theme-text-secondary border-transparent hover:text-sky-400 hover:border-slate-500"}`,children:[a.jsx(ov,{className:"w-5 h-5"}),"Read Aloud"]})]})}),a.jsxs("div",{className:"theme-text-primary grow overflow-y-auto p-6",children:[c==="display"&&a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"font-size",className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Font Size"}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("span",{className:"text-lg",children:"A"}),a.jsx("input",{id:"font-size",type:"range",min:"80",max:"200",step:"1",value:n.fontSize,onChange:k=>o({fontSize:parseInt(k.target.value,10)}),className:"theme-slider h-2 w-full cursor-pointer appearance-none rounded-lg"}),a.jsx("span",{className:"text-3xl",children:"A"})]}),a.jsxs("div",{className:"theme-text-muted mt-1 text-center text-sm",children:[n.fontSize,"%"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Theme"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{onClick:()=>o({theme:"light"}),className:`p-4 rounded-lg border-2 transition-colors ${n.theme==="light"?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:[a.jsx("div",{className:"w-full h-12 bg-white rounded"}),a.jsx("p",{className:"mt-2 text-center text-sm font-medium",children:"Light"})]}),a.jsxs("button",{onClick:()=>o({theme:"dark"}),className:`p-4 rounded-lg border-2 transition-colors ${n.theme==="dark"?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:[a.jsx("div",{className:"w-full h-12 bg-gray-900 rounded"}),a.jsx("p",{className:"mt-2 text-center text-sm font-medium",children:"Dark"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Font Family"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:["Original","Serif","Sans-Serif"].map(k=>a.jsx("button",{onClick:()=>o({fontFamily:k}),className:`py-2 px-1 rounded-lg border-2 transition-colors text-center text-sm truncate ${n.fontFamily===k?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:a.jsx("span",{className:k==="Serif"?"font-serif-custom":k==="Sans-Serif"?"font-sans-custom":"font-original",children:k})},k))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Reading Mode"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{onClick:()=>o({flow:"paginated"}),className:`p-4 rounded-lg border-2 transition-colors text-center ${n.flow==="paginated"?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:[a.jsx("span",{className:"block text-sm font-medium",children:"Paginated"}),a.jsx("span",{className:"theme-text-muted mt-1 block text-xs",children:"Turn pages like a real book."})]}),a.jsxs("button",{onClick:()=>o({flow:"scrolled"}),className:`p-4 rounded-lg border-2 transition-colors text-center ${n.flow==="scrolled"?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:[a.jsx("span",{className:"block text-sm font-medium",children:"Scrolled"}),a.jsx("span",{className:"theme-text-muted mt-1 block text-xs",children:"Scroll like a webpage."})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"theme-text-secondary mb-2 block text-sm font-medium",children:"Citation Format"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:["APA","MLA"].map(k=>a.jsx("button",{onClick:()=>o({citationFormat:k.toLowerCase()}),className:`py-2 px-1 rounded-lg border-2 transition-colors text-center text-sm truncate ${n.citationFormat===k.toLowerCase()?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:k},k))})]})]}),c==="readAloud"&&a.jsx(b,{})]})]})]})},Hl=({children:r,label:s,placement:n="top"})=>{const[o,c]=R.useState(!1),l=R.useRef(null);return a.jsxs("div",{ref:l,className:"relative inline-flex",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),onFocus:()=>c(!0),onBlur:()=>c(!1),children:[r,a.jsx("div",{role:"tooltip","aria-hidden":!o,className:`theme-surface-elevated theme-border theme-text-primary pointer-events-none absolute z-50 whitespace-nowrap rounded border px-2 py-1 text-xs transition-all duration-200 transform ${o?"opacity-100 scale-100":"opacity-0 scale-95"}`+(n==="top"?" -bottom-9 left-1/2 -translate-x-1/2":""),children:s})]})},Tc=({isOpen:r,onClose:s,onZoomIn:n,onZoomOut:o,onToggleFit:c,activeReader:l=null})=>{const u=R.useRef(null),f=vr({isActive:r,initialFocusRef:u,onEscape:s});if(!r)return null;const p=[{key:"?",description:"Show/hide keyboard shortcuts",category:"global",action:()=>{}},{key:"Escape",description:"Close active modal or return to library",category:"global",action:()=>{}}],h=l?[{key:"ArrowLeft",description:"Previous page",category:"reader",action:()=>{}},{key:"ArrowRight",description:"Next page",category:"reader",action:()=>{}},{key:" ",description:"Next page",category:"reader",action:()=>{}},{key:"+",description:`Zoom in ${l==="epub"?"(increase font size)":""}`,category:"reader",action:()=>{}},{key:"-",description:`Zoom out ${l==="epub"?"(decrease font size)":""}`,category:"reader",action:()=>{}},{key:"f",description:"Toggle fit width / fit page",category:"reader",action:()=>{}},{key:"c",description:"Open/close contents & bookmarks",category:"reader",action:()=>{}},{key:"b",description:"Add a quick bookmark for current page",category:"reader",action:()=>{}}]:[],b=k=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("kbd",{className:"theme-surface-elevated theme-text-primary min-w-[3rem] rounded px-2 py-1 text-center text-xs font-mono",children:b0(k)}),a.jsx("span",{className:"flex-1",children:k.description})]},`${k.key}-${k.description}`);return a.jsxs("div",{className:"fixed inset-0 z-40 flex items-center justify-center",role:"presentation",children:[a.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:s}),a.jsxs("div",{ref:f,role:"dialog","aria-modal":"true","aria-labelledby":"shortcut-help-title",className:"theme-surface-elevated theme-border theme-text-primary relative mx-4 max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-lg border p-6 shadow-lg",onClick:k=>k.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{id:"shortcut-help-title",className:"text-xl font-bold",children:"Keyboard Shortcuts"}),a.jsx("button",{ref:u,onClick:s,className:"p-2 rounded hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-sky-500 theme-hover-surface","aria-label":"Close help",children:""})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wide mb-3 theme-text-secondary",children:"Global"}),a.jsx("ul",{className:"space-y-2 text-sm",children:p.map(b)})]}),l&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("h4",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wide mb-3 theme-text-secondary",children:["Reader (",l==="epub"?"EPUB":"PDF",")"]}),a.jsx("ul",{className:"space-y-2 text-sm",children:h.map(b)})]}),l&&n&&o&&c&&a.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-700 theme-divider",children:[a.jsx("h4",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wide mb-3 theme-text-secondary",children:"Quick Actions"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Hl,{label:"Zoom out (-)",children:a.jsx("button",{onClick:o,className:"theme-button-neutral theme-hover-surface rounded-full p-3 focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Zoom out",children:a.jsx(lv,{className:"theme-text-primary h-5 w-5"})})}),a.jsx(Hl,{label:"Zoom in (+)",children:a.jsx("button",{onClick:n,className:"theme-button-neutral theme-hover-surface rounded-full p-3 focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Zoom in",children:a.jsx(Gh,{className:"theme-text-primary h-5 w-5"})})}),a.jsx(Hl,{label:"Toggle fit (F)",children:a.jsx("button",{onClick:c,className:"theme-button-neutral theme-hover-surface rounded-full p-3 focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Toggle fit mode",children:a.jsx(qh,{className:"theme-text-primary h-5 w-5"})})})]})]}),a.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-700 text-xs text-slate-400 theme-divider theme-text-secondary",children:[a.jsx("p",{children:" Tip: Keyboard shortcuts are disabled when typing in text fields."}),a.jsxs("p",{className:"mt-1",children:["Press ",a.jsx("kbd",{className:"theme-surface-elevated theme-text-primary rounded px-1 py-0.5 text-xs",children:"?"})," anytime to view this help."]})]})]})]})},pp=r=>{if(!r)return"n.d.";const s=new Date(r).getFullYear();if(!isNaN(s))return s.toString();const n=r.match(/^\d{4}/);return n?n[0]:"n.d."},mp=(r,s)=>{const n=r.split(" ").filter(l=>l.trim());if(n.length<2)return r;const o=n.pop(),c=n;if(s==="apa"){const l=c.map(u=>u[0]?`${u[0]}.`:"").join(" ");return`${o}, ${l}`}return`${o}, ${c.join(" ")}`},C0=(r,s)=>{const n=r.author||"Unknown Author",o=r.title||"Untitled Book",c=r.publisher||"[Publisher not available]",l=pp(r.publicationDate),u=mp(n,s);switch(s){case"apa":return{pre:`${u} (${l}). `,title:o,post:`. ${c}.`,isItalic:!0};case"mla":return{pre:`${u}. `,title:o,post:`. ${c}, ${l==="n.d."?"[Date not available]":l}.`,isItalic:!0};case"chicago":return{pre:`${u}. `,title:o,post:`. ${c}, ${l==="n.d."?"[Date not available]":l}.`,isItalic:!1};default:return{pre:`${n}. `,title:o,post:".",isItalic:!1}}},j0=(r,s)=>{const n=[],o=pp(r.publicationDate);return s.forEach(c=>{const l=[];l.push("TY  - CHAP"),r.author&&l.push(`AU  - ${mp(r.author,"ris")}`),r.title&&l.push(`T2  - ${r.title}`),r.publisher&&l.push(`PB  - ${r.publisher}`),o!=="n.d."&&l.push(`PY  - ${o}`),r.isbn&&l.push(`SN  - ${r.isbn}`),c.chapter&&l.push(`TI  - ${c.chapter}`),c.pageNumber&&l.push(`SP  - ${c.pageNumber}`);const u=(c.note||"").replace(/(\r\n|\n|\r)/gm," ");u&&l.push(`N1  - ${u}`),l.push("ER  - "),n.push(l.join(`\r
`))}),n.join(`\r
\r
`)+`\r
`},gp=({item:r,onNavigate:s,level:n})=>{const[o,c]=R.useState(!1),l=!!(r.subitems&&r.subitems.length>0),f=n===0?"font-semibold theme-text-primary":"font-normal theme-text-secondary";return a.jsxs("li",{children:[a.jsxs("div",{className:"flex items-center justify-between w-full py-2 pr-3 hover:bg-sky-500/10","data-level":n,children:[a.jsx("button",{onClick:()=>{r.href&&s(r.href)},className:`flex-1 text-left ${f} group-hover:text-sky-300 transition-colors focus:outline-none`,"aria-label":`Go to ${r.label}`,children:r.label.trim()}),l&&a.jsx("button",{onClick:()=>c(!o),"aria-label":o?`Collapse ${r.label}`:`Expand ${r.label}`,className:"theme-hover-surface ml-2 rounded p-1",children:a.jsx(kc,{className:`w-4 h-4 text-slate-500 transition-transform duration-200 flex-shrink-0 ${o?"rotate-90":""}`})})]}),l&&a.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${o?"max-h-[1000px]":"max-h-0"}`,children:a.jsx("ul",{className:"pt-1",children:r.subitems.map(h=>a.jsx(gp,{item:h,onNavigate:s,level:n+1},h.id))})})]})},yp=({isOpen:r,onClose:s,toc:n,onTocNavigate:o,bookmarks:c,onBookmarkNavigate:l,onDeleteBookmark:u,citations:f,onCitationNavigate:p,onDeleteCitation:h,settings:b,bookData:k})=>{const[x,y]=R.useState("toc"),S=()=>{if(!k||f.length===0)return;const g=j0(k,f),w=new Blob([g],{type:"application/x-research-info-systems;charset=utf-8"}),A=`${(k.title||"book").replace(/[^a-z0-9]/gi,"_").toLowerCase()}_citations.ris`,L=document.createElement("a");L.href=URL.createObjectURL(w),L.download=A,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(L.href)};return r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/60 z-30",onClick:s,"aria-hidden":"true"}),a.jsxs("div",{className:`theme-surface-elevated theme-border theme-text-primary fixed top-0 left-0 z-40 flex h-full w-80 transform flex-col border-r shadow-2xl transition-transform duration-300 ease-in-out ${r?"translate-x-0":"-translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"nav-heading",children:[a.jsxs("div",{className:"theme-divider flex shrink-0 items-center justify-between border-b p-4",children:[a.jsx("h3",{id:"nav-heading",className:"theme-text-primary text-xl font-semibold",children:"Navigation"}),a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2","aria-label":"Close navigation panel",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"theme-divider shrink-0 border-b px-2",children:a.jsxs("nav",{className:"flex -mb-px",children:[a.jsx("button",{onClick:()=>y("toc"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${x==="toc"?"border-sky-400 text-sky-300":"theme-text-secondary border-transparent hover:text-sky-400 hover:border-slate-500"}`,"aria-current":x==="toc"?"page":void 0,children:"Contents"}),a.jsx("button",{onClick:()=>y("bookmarks"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${x==="bookmarks"?"border-sky-400 text-sky-300":"theme-text-secondary border-transparent hover:text-sky-400 hover:border-slate-500"}`,"aria-current":x==="bookmarks"?"page":void 0,children:"Bookmarks"}),a.jsx("button",{onClick:()=>y("citations"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${x==="citations"?"border-sky-400 text-sky-300":"theme-text-secondary border-transparent hover:text-sky-400 hover:border-slate-500"}`,"aria-current":x==="citations"?"page":void 0,children:"Citations"})]})}),a.jsxs("div",{className:"overflow-y-auto flex-grow",children:[x==="toc"&&a.jsx("div",{className:"p-4",children:n.length>0?a.jsx("ul",{className:"space-y-1",children:n.map(g=>a.jsx(gp,{item:g,onNavigate:o,level:0},g.id))}):a.jsx("p",{className:"theme-text-secondary p-4 text-center",children:"No table of contents available."})}),x==="bookmarks"&&a.jsx("div",{children:c.length>0?a.jsx("ul",{className:"theme-divider divide-y",children:c.sort((g,w)=>g.createdAt-w.createdAt).map(g=>a.jsxs("li",{className:"p-4 flex items-center justify-between group",children:[a.jsxs("button",{onClick:()=>l(g.cfi),className:"flex-grow text-left pr-4",children:[g.chapter&&a.jsx("span",{className:"block text-xs font-semibold text-sky-400 uppercase tracking-wider mb-1",children:g.chapter}),a.jsx("span",{className:"theme-text-primary block text-sm font-semibold transition-colors group-hover:text-sky-300",children:g.label}),g.description&&a.jsx("blockquote",{className:"theme-border mt-2 border-l-2 pl-3",children:a.jsx("p",{className:"theme-text-secondary text-sm italic",children:g.description})}),a.jsx("span",{className:"theme-text-muted mt-2 block text-xs",children:new Date(g.createdAt).toLocaleString()})]}),a.jsx("button",{onClick:()=>u(g.id),className:"p-2 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors flex-shrink-0","aria-label":`Delete bookmark: ${g.label}`,children:a.jsx(ki,{className:"w-5 h-5"})})]},g.id))}):a.jsx("p",{className:"theme-text-secondary p-8 text-center",children:"You haven't added any bookmarks yet."})}),x==="citations"&&a.jsxs("div",{children:[k&&f.length>0&&a.jsx("div",{className:"theme-divider border-b p-4",children:a.jsxs("button",{onClick:S,className:"w-full flex items-center justify-center gap-2 py-2 px-4 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-semibold text-white text-sm",children:[a.jsx(sv,{className:"w-5 h-5"}),a.jsx("span",{children:"Export Citations (.ris)"})]})}),f.length>0&&k?a.jsx("ul",{className:"theme-divider divide-y",children:f.sort((g,w)=>g.createdAt-w.createdAt).map(g=>{const w=C0(k,b.citationFormat);return a.jsxs("li",{className:"p-4 flex items-center justify-between group",children:[a.jsxs("button",{onClick:()=>p(g.cfi),className:"flex-grow text-left pr-4",children:[g.chapter&&a.jsx("span",{className:"block text-xs font-semibold text-sky-400 uppercase tracking-wider mb-1",children:g.chapter}),a.jsxs("p",{className:"theme-text-primary text-sm transition-colors group-hover:text-sky-300",children:[w.pre,a.jsx("span",{className:`${w.isItalic?"italic":"not-italic"} theme-text-secondary group-hover:text-sky-400`,children:w.title}),w.post]}),g.note&&a.jsx("blockquote",{className:"theme-border mt-2 border-l-2 pl-3",children:a.jsxs("p",{className:"theme-text-secondary text-sm italic",children:['"',g.note,'"']})}),a.jsxs("div",{className:"theme-text-muted mt-2 flex items-center justify-between text-xs",children:[a.jsx("span",{children:new Date(g.createdAt).toLocaleString()}),g.pageNumber&&a.jsxs("span",{className:"theme-surface rounded px-1.5 py-0.5 font-semibold",children:["p. ",g.pageNumber]})]})]}),a.jsx("button",{onClick:()=>h(g.id),className:"p-2 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors flex-shrink-0","aria-label":"Delete citation",children:a.jsx(ki,{className:"w-5 h-5"})})]},g.id)})}):a.jsx("p",{className:"theme-text-secondary p-8 text-center",children:"You haven't created any citations yet."})]})]})]})]}):null},vp=({value:r,isOpen:s})=>a.jsx("div",{className:"fixed left-1/2 transform -translate-x-1/2 top-6 z-50 pointer-events-none",children:a.jsx("div",{"aria-hidden":!s,"aria-live":"polite",className:`mx-auto transition-all ${s?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 -translate-y-2"} duration-300`,children:a.jsx("div",{className:"bg-sky-600 text-white px-5 py-2 rounded-full shadow-2xl text-sm sm:text-base font-semibold ring-1 ring-sky-700",children:r})})}),E0=({bookId:r,onClose:s,animationData:n})=>{const[o,c]=R.useState(null),[l,u]=R.useState(null),[f,p]=R.useState(!0),[h,b]=R.useState(!1),[k,x]=R.useState(!1),[y,S]=R.useState(!1),[g,w]=R.useState(!1),[N,A]=R.useState(!1),[L,T]=R.useState([]),[I,D]=R.useState([]),[W,F]=R.useState([]),[U,V]=R.useState([]),[ie,B]=R.useState(!1),[H,C]=R.useState(""),[Q,ae]=R.useState({currentPage:0,totalPages:0,progress:0}),[J,te]=R.useState(!0),[re,ee]=R.useState(null),[P,$]=R.useState(""),[ye,fe]=R.useState(null),[oe,be]=R.useState(n?"start":"finished"),[Se,ke]=R.useState(!1),[_e,De]=R.useState(!1);R.useEffect(()=>{if(!_e)return;const xe=window.setTimeout(()=>De(!1),8e3);return()=>clearTimeout(xe)},[_e]);const[Ve,et]=R.useState("stopped"),[Ke,j]=R.useState(!1),[he,de]=R.useState(!1),q=R.useRef(null);R.useEffect(()=>{if(he)return q.current&&clearTimeout(q.current),q.current=window.setTimeout(()=>de(!1),1200),()=>{q.current&&(clearTimeout(q.current),q.current=null)}},[he]);const[z,Z]=R.useState(sc),ce=R.useRef(null),ue=R.useRef(null),X=R.useRef(null),_=R.useRef(null),E=R.useRef(z);E.current=z;const M=R.useRef(Ve);M.current=Ve;const K=R.useRef(null),ge=R.useRef(null),je=R.useRef(null),we=R.useRef(null),ve=R.useRef(null),Le=R.useRef(null),Ae=R.useRef(null),Pe=R.useRef(null),qe=R.useRef(!1),st=R.useRef(null),He=R.useRef(null),nt=R.useRef(null),Je=R.useRef(null),it=R.useRef(""),ft=R.useRef(null),ht=R.useRef(!1),Tt=R.useMemo(()=>h||k||y,[h,k,y]),Ht=R.useCallback(()=>{Ae.current&&clearTimeout(Ae.current)},[]),or=R.useCallback(()=>{Ht(),Tt||(Ae.current=window.setTimeout(()=>{te(!1)},3e3))},[Tt,Ht]);R.useEffect(()=>{if(oe!=="start")return;const xe=setTimeout(()=>be("expanding"),50);return()=>clearTimeout(xe)},[oe]),R.useEffect(()=>{const xe=ue.current;!xe||!n||(oe==="start"?(xe.style.position="absolute",xe.style.top=`${n.rect.top}px`,xe.style.left=`${n.rect.left}px`,xe.style.width=`${n.rect.width}px`,xe.style.height=`${n.rect.height}px`,xe.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)"):oe==="expanding"&&(xe.style.position="absolute",xe.style.top="50%",xe.style.left="50%",xe.style.transform="translate(-50%, -50%)",xe.style.width="auto",xe.style.height="80vh",xe.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)"))},[oe,n]),R.useEffect(()=>{(async()=>{const Ie=await ut.getBook(r);Ie?c(Ie):(console.error("Book not found"),s())})()},[r,s]),R.useEffect(()=>{const xe=()=>{if(sc().readAloud.voiceURI)return;const Ue=window.speechSynthesis.getVoices();if(Ue.length===0)return;const Ye=Ue.find(ze=>ze.default)||Ue.find(ze=>ze.lang==="en-US"&&/google/i.test(ze.name))||Ue.find(ze=>ze.lang==="en-US"&&/microsoft/i.test(ze.name))||Ue.find(ze=>ze.lang==="en-US"&&ze.localService)||Ue.find(ze=>ze.lang==="en-US")||null;Ye&&Z(ze=>{const ot={...ze.readAloud,voiceURI:Ye.voiceURI},pt={...ze,readAloud:ot};return If(pt),pt})};return window.speechSynthesis.getVoices().length>0?xe():window.speechSynthesis.onvoiceschanged=xe,()=>{window.speechSynthesis.onvoiceschanged=null}},[]);const qr=R.useCallback(()=>{nt.current&&di.saveSpeechPosition(r,nt.current)},[r]),xr=R.useCallback(()=>{st.current&&_.current&&(_.current.annotations.remove(st.current,"highlight"),st.current=null)},[]),It=R.useCallback(()=>{M.current!=="stopped"&&qr(),et("stopped"),window.speechSynthesis.cancel(),ht.current=!1,xr(),He.current=null,nt.current=null,it.current=""},[xr,qr]),Ir=R.useCallback(()=>{const xe=_.current;if(!xe)return;M.current!=="stopped"&&(window.speechSynthesis.cancel(),xr());const Ie=xe.getContents();if(!Ie||Ie.length===0)return;const Ue=Ie[0].document?.body;if(!Ue)return;const Ye=Ue.textContent||"",ze=Ye.replace(/\s+/g," ").trim();if(!ze){E.current.flow==="paginated"&&M.current==="playing"&&(ht.current=!0,xe.next());return}let ot=ze,pt=0;const sn=Je.current;if(sn)try{const at=Ie[0].range(sn);if(at){const zt=at.toString().replace(/\s+/g," ").trim(),Gt=ze.indexOf(zt);Gt!==-1&&(pt=Gt,ot=ze.substring(pt))}}catch(at){console.error("Could not find start CFI for speech, starting from beginning.",at)}finally{Je.current=null}ft.current={rawText:Ye,normalizedText:ze,startIndexInNormalized:pt};const gt=new SpeechSynthesisUtterance(ot);He.current=gt;const vt=window.speechSynthesis.getVoices(),Ut=E.current,kt=vt.find(at=>at.voiceURI===Ut.readAloud.voiceURI);gt.voice=kt||null,gt.rate=Ut.readAloud.rate,gt.pitch=Ut.readAloud.pitch,gt.volume=Ut.readAloud.volume,gt.onboundary=at=>{if(at.name!=="word"||!_.current||!Ue||!ft.current)return;const{rawText:zt,normalizedText:Gt,startIndexInNormalized:on}=ft.current;at.charIndex+on},gt.onend=()=>{if(xr(),M.current!=="playing"){if(M.current==="paused")return;et("stopped");return}E.current.flow==="paginated"?(ht.current=!0,_.current?.next()):et("stopped")},gt.onerror=at=>{console.error("SpeechSynthesisUtterance error",at),It()},window.speechSynthesis.speak(gt),et("playing")},[It,xr]);R.useEffect(()=>{if(oe!=="finished"||!o||!ce.current)return;let xe=!0;return(async()=>{try{p(!0);const Ue=window.ePub,Ye=Ue(o.epubData);X.current=Ye,ce.current&&(ce.current.innerHTML="",ce.current.style.opacity="0");const ze=Ye.renderTo(ce.current,{width:"100%",height:"100%",flow:z.flow==="scrolled"?"scrolled-doc":"paginated",manager:"default",spread:"auto"});if(!xe)return;u(ze),_.current=ze;const ot=await Ye.loaded.navigation;if(!xe)return;try{if(ot&&ot.toc&&Array.isArray(ot.toc)&&ot.toc.length>0)$r()&&console.debug("ReaderView: using navigation.toc with",ot.toc.length,"entries"),T(ot.toc),De(!1);else{$r()&&console.debug("ReaderView: navigation.toc missing or empty, building fallback TOC from spine");const kt=Df(Ye),at=kt.map(zt=>({id:zt.id,href:zt.href,label:zt.label,subitems:[]}));T(at),De(!0);try{Wf("toc_fallback",{bookId:r,fallbackCount:kt&&kt.length||0})}catch{}}}catch(kt){$r()&&console.warn("Error processing navigation TOC, using fallback",kt);const at=Df(Ye),zt=at.map(Gt=>({id:Gt.id,href:Gt.href,label:Gt.label,subitems:[]}));T(zt),De(!0);try{Wf("toc_fallback",{bookId:r,fallbackCount:at&&at.length||0,error:String(kt)})}catch{}}if(K.current=ot||null,ke(!0),ze.on("relocated",kt=>{if(!xe)return;const at=kt.start.cfi;if(ee(at),at&&(je.current=at,we.current&&clearTimeout(we.current),we.current=window.setTimeout(()=>{di.savePosition(r,at)},1e3)),qe.current&&X.current?.locations){const zt=X.current.locations,Gt=zt.locationFromCfi(kt.start.cfi);if(Gt>-1){const on=zt.percentageFromCfi(kt.start.cfi);ae({currentPage:Gt+1,totalPages:zt.length(),progress:Math.round((on||0)*100)})}}ht.current&&(ht.current=!1,Ir())}),await Ye.ready,!xe||(qe.current=!1,await Ye.locations.generate(1600),!xe))return;qe.current=!0,Ye.locations&&ae(kt=>({...kt,totalPages:Ye.locations.length(),currentPage:1}));const pt=mi.findByBookId(r);pt.success&&D(pt.data);const sn=yi.findByBookId(r);sn.success&&F(sn.data);const gt=di.getSpeechPosition(r);Je.current=gt.success?gt.data:null;const vt=di.getPosition(r),Ut=(vt.success?vt.data:null)||await zv(Ye);if(!xe)return;if(ze)try{await ze.display(Ut||void 0)}catch(kt){console.warn(`rendition.display failed for ${Ut}. Attempting spine fallback.`,kt);try{const at=Ye?.spine?.items&&Ye.spine.items.length>0?Ye.spine.items[0].href:void 0;at?await ze.display(at):await ze.display()}catch(at){console.error("Failed to display book using spine fallback or default",at)}}if(!xe)return;p(!1),ce.current&&(ce.current.style.transition="opacity 0.3s ease-in",ce.current.style.opacity="1");try{if(r){const kt=Vv(r);kt&&kt.fontSize&&typeof kt.fontSize=="number"&&Z(at=>({...at,fontSize:kt.fontSize}))}}catch{}}catch(Ue){xe&&console.error("Error initializing EPUB:",Ue)}})(),()=>{xe=!1,It(),we.current&&clearTimeout(we.current),je.current&&di.savePosition(r,je.current),qe.current=!1,ke(!1),K.current=null,X.current&&(X.current.destroy(),X.current=null),_.current=null,u(null)}},[r,o,z.flow,oe,Ir,It]),R.useEffect(()=>{if(l){if(!l.themesRegistered){const xe={body:{color:"#000",background:"#fff"}},Ie={body:{color:"#fff",background:"#1f2937"}};l.themes.register("light",xe),l.themes.register("dark",Ie),l.themesRegistered=!0}l.themes.select(z.theme),l.themes.fontSize(`${z.fontSize}%`),z.fontFamily==="Original"?l.themes.font("inherit"):z.fontFamily==="Serif"?l.themes.font('Georgia, "Times New Roman", serif'):z.fontFamily==="Sans-Serif"&&l.themes.font('"Helvetica Neue", Helvetica, Arial, sans-serif')}If(z)},[l,z]),R.useEffect(()=>{if(r)try{qv(r,{fontSize:z.fontSize})}catch(xe){console.warn("Failed to save epub view state",xe)}},[z.fontSize,r]);const Pn=()=>{Z(xe=>{const Ie=Math.min(300,Math.round(xe.fontSize*1.15));return{...xe,fontSize:Ie}}),de(!0)},Er=()=>{Z(xe=>{const Ie=Math.max(50,Math.round(xe.fontSize/1.15));return{...xe,fontSize:Ie}}),de(!0)},Hr=()=>{Z(xe=>({...xe,flow:xe.flow==="paginated"?"scrolled":"paginated"}))};R.useEffect(()=>()=>{window.speechSynthesis.cancel()},[]),R.useEffect(()=>{if(l)return Pe.current&&(clearTimeout(Pe.current),Pe.current=null),Pe.current=window.setTimeout(()=>{try{_.current&&typeof _.current.resize=="function"&&_.current.resize()}catch(xe){console.warn("Safe resize failed, rendition may no longer be available.",xe)}},50),()=>{Pe.current&&(clearTimeout(Pe.current),Pe.current=null)}},[J,l]),R.useEffect(()=>(J&&!Tt?or():Ht(),Tt&&!J&&te(!0),Ht),[J,Tt,or,Ht]),R.useEffect(()=>{if(re&&Se&&K.current){const Ie=K.current.get(re);Ie&&typeof Ie.then=="function"&&Ie.then(Ue=>{Ue&&Ue.label&&$(Ue.label.trim())})}},[re,Se]);const rr=R.useCallback(()=>{l?.next(),te(!0),It()},[l,It]),Fr=R.useCallback(()=>{l?.prev(),te(!0),It()},[l,It]);R.useEffect(()=>{const xe=Ie=>{const Ue=document.activeElement&&document.activeElement.tagName;if(!(Ue==="INPUT"||Ue==="TEXTAREA")){if(Ie.key==="ArrowLeft")Fr();else if(Ie.key==="ArrowRight")rr();else if(Ie.key===" ")Ie.preventDefault(),rr();else if(Ie.key.toLowerCase()==="c")x(Ye=>!Ye);else if(Ie.key==="?")j(Ye=>!Ye);else if(Ie.key==="+"||Ie.key==="="&&Ie.shiftKey)Pn();else if(Ie.key==="-"||Ie.key==="_")Er();else if(Ie.key.toLowerCase()==="f")Hr();else if(Ie.key.toLowerCase()==="b"){if(!je.current)return;new Date().toISOString(),je.current,`${Q.currentPage}`;const Ye=mi.add(r,{cfi:je.current,label:`Page ${Q.currentPage}`,chapter:P});if(Ye.success){const ze=[...I,Ye.data];D(ze)}}}};return window.addEventListener("keydown",xe),()=>window.removeEventListener("keydown",xe)},[Fr,rr,I,r,Q.currentPage,P]),R.useEffect(()=>{if(!l)return;const xe=Ie=>{if(h||k||y||!ce.current)return;const Ue=ce.current.getBoundingClientRect(),Ye=Ie.clientX-Ue.left,ze=Ue.width,ot=ze*.3;z.flow==="paginated"?Ye<ot?Fr():Ye>ze-ot?rr():te(pt=>!pt):te(pt=>!pt)};return l.on("click",xe),()=>{l.off("click",xe)}},[l,z.flow,h,k,y,Fr,rr]);const Gr=xe=>{Z(Ie=>{const Ue={...Ie,...xe};return xe.readAloud&&(Ue.readAloud={...Ie.readAloud,...xe.readAloud}),Ue})},Te=R.useCallback(async xe=>{if(!_.current){$r()&&console.warn("safeDisplay: rendition not ready");return}try{await _.current.display(xe||void 0)}catch(Ie){$r()&&console.warn("safeDisplay: rendition.display failed for",xe,Ie);try{const Ue=X.current,Ye=new Set,ze=async vt=>{if(!vt||Ye.has(vt))return!1;Ye.add(vt);try{return $r()&&console.debug("safeDisplay: trying candidate",vt),await _.current.display(vt),!0}catch(Ut){return $r()&&console.debug("safeDisplay: candidate failed",vt,Ut),!1}};if(!xe){const vt=Ue?.spine?.items&&Ue.spine.items.length>0?Ue.spine.items[0].href:void 0;if(vt&&await ze(vt))return;await ze(void 0);return}const ot=xe;if(await ze(ot))return;const pt=ot.split("#")[0];if(pt!==ot&&await ze(pt))return;if(!/[/.]/.test(ot)&&Ue?.spine?.items){for(const vt of Ue.spine.items)if(vt.id===ot||vt.idref===ot||vt.href&&vt.href.split("#")[0].endsWith(ot)){const Ut=vt.href;if(Ut&&await ze(Ut))return}}if(Ue?.spine?.items){const vt=pt.split("/").pop();if(vt){for(const Ut of Ue.spine.items)if(Ut.href&&Ut.href.split("#")[0].endsWith(vt)&&await ze(Ut.href))return}}const gt=Ue?.spine?.items&&Ue.spine.items.length>0?Ue.spine.items[0].href:void 0;if(gt&&await ze(gt))return;await ze(void 0)}catch(Ue){console.error("safeDisplay: rendition.display fallback failed",Ue)}}},[]),Be=xe=>{It(),Te(xe),x(!1)},Ge=xe=>{It(),Te(xe),x(!1)},bt=xe=>{It(),Te(xe),x(!1)},ar=R.useCallback(async xe=>{if(!je.current)return;const Ie=je.current;let Ue=P;if(K.current)try{const ze=K.current.get(Ie);if(ze&&typeof ze.then=="function"){const ot=await ze;ot?.label&&(Ue=ot.label.trim())}}catch(ze){console.warn("Could not fetch chapter for bookmark, using last known chapter.",ze)}new Date().toISOString(),`${Q.currentPage}${Q.progress}`;const Ye=mi.add(r,{cfi:je.current,label:`Page ${Q.currentPage} (${Q.progress}%)`,chapter:Ue,description:xe||void 0});if(Ye.success){const ze=[...I,Ye.data];D(ze)}A(!1)},[r,I,Q.currentPage,Q.progress,P]),Rt=R.useCallback(xe=>{if(mi.delete(r,xe).success){const Ue=I.filter(Ye=>Ye.id!==xe);D(Ue)}},[r,I]),Pt=R.useCallback(async xe=>{if(!je.current)return;const Ie=je.current;let Ue=P;if(K.current)try{const ze=K.current.get(Ie);if(ze&&typeof ze.then=="function"){const ot=await ze;ot?.label&&(Ue=ot.label.trim())}}catch(ze){console.warn("Could not fetch chapter for citation, using last known chapter.",ze)}const Ye=yi.add(r,{cfi:Ie,note:xe,pageNumber:Q.currentPage>0?Q.currentPage:void 0,chapter:Ue,citationFormat:"apa"});if(Ye.success){const ze=[...W,Ye.data];F(ze)}w(!1)},[r,W,Q.currentPage,P]),Dr=R.useCallback(xe=>{if(yi.delete(r,xe).success){const Ue=W.filter(Ye=>Ye.id!==xe);F(Ue)}},[r,W]),Lt=R.useMemo(()=>I.some(xe=>xe.cfi===re),[I,re]),Ln=R.useCallback(()=>{if(Lt){const xe=I.find(Ie=>Ie.cfi===re);xe&&Rt(xe.id)}else A(!0)},[Lt,Rt,I,re]),nn=R.useCallback(async xe=>{if(!xe||!X.current){V([]),B(!1);return}ye&&l&&(l.annotations.remove(ye,"highlight"),fe(null));try{B(!0);const Ie=await Uv(X.current,xe);V(Ie)}catch(Ie){console.error("Search failed:",Ie),V([])}finally{B(!1)}},[l,ye]),Ci=R.useCallback(xe=>{if(C(xe),Le.current&&clearTimeout(Le.current),!xe.trim()){V([]),B(!1);return}Le.current=window.setTimeout(()=>{nn(xe)},500)},[nn]),ji=R.useCallback(xe=>{l&&(ye&&l.annotations.remove(ye,"highlight"),It(),S(!1),Te(xe).then(()=>{try{l.annotations.add("highlight",xe,{},void 0,"hl",{fill:"yellow","fill-opacity":"0.3"}),fe(xe)}catch(Ie){console.warn("Failed to add highlight after navigation",Ie)}}))},[l,ye,It]),Ei=()=>{S(!1),ye&&l&&(l.annotations.remove(ye,"highlight"),fe(null))},ea=xe=>{if(l&&X.current?.locations&&qe.current){te(!0),It();const Ie=parseInt(xe.target.value,10);ae(Ue=>({...Ue,progress:Ie})),ge.current&&clearTimeout(ge.current),ge.current=window.setTimeout(()=>{const Ue=X.current.locations.cfiFromPercentage(Ie/100);Te(Ue)},150)}},ta=xe=>{z.flow==="paginated"&&(ve.current=xe.touches[0].clientX)},Nt=xe=>{if(z.flow!=="paginated"||ve.current===null)return;const Ie=xe.changedTouches[0].clientX-ve.current;Ie>50?Fr():Ie<-50&&rr(),ve.current=null},ra=()=>{M.current==="playing"?(et("paused"),window.speechSynthesis.pause(),qr(),ht.current=!1):M.current==="paused"?(et("playing"),window.speechSynthesis.resume()):Ir()};return a.jsxs(a.Fragment,{children:[n&&oe!=="finished"&&a.jsx("div",{className:`theme-shell fixed inset-0 z-50 flex items-center justify-center transition-opacity duration-300 ${oe==="fading"?"opacity-0":"opacity-100"}`,onTransitionEnd:()=>{oe==="fading"&&be("finished")},children:n.coverImage&&a.jsx("img",{ref:ue,src:n.coverImage,alt:"Expanding book cover",className:"object-contain rounded-lg shadow-2xl transition-all duration-700 ease-[cubic-bezier(0.4,0,0.2,1)]",onTransitionEnd:()=>{oe==="expanding"&&setTimeout(()=>be("fading"),200)}})}),a.jsxs("div",{className:`theme-shell theme-text-primary fixed inset-0 flex flex-col select-none transition-opacity duration-500 ${oe==="fading"||oe==="finished"?"opacity-100":"opacity-0"}`,children:[a.jsxs("header",{className:`theme-surface-elevated theme-border theme-text-primary z-20 flex shrink-0 flex-wrap items-center justify-between border-b p-2 shadow-md transition-transform duration-300 ease-in-out sm:flex-nowrap sm:justify-start sm:gap-4 ${J?"translate-y-0":"-translate-y-full"}`,onMouseEnter:Ht,onMouseLeave:or,children:[_e&&a.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-full mt-2 z-40",children:a.jsxs("div",{className:"flex items-center gap-4 rounded border border-amber-400/50 bg-amber-500/20 px-4 py-2 text-amber-100 shadow-md backdrop-blur-sm",children:[a.jsx("span",{className:"text-sm",children:"This book's navigation was incomplete; a fallback contents list was used."}),a.jsx("button",{onClick:()=>{const xe=X.current?.spine?.items&&X.current.spine.items.length>0?X.current.spine.items[0].href:void 0;xe&&Te(xe),De(!1)},className:"rounded bg-amber-100/10 px-3 py-1 text-sm font-semibold hover:bg-amber-100/20",children:"Open first content"}),a.jsx("button",{onClick:()=>De(!1),className:"px-2 py-1 text-sm underline",children:"Dismiss"})]})}),a.jsxs("div",{className:"flex items-center gap-2 sm:order-1",children:[a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close Reader",children:a.jsx(tr,{className:"w-6 h-6"})}),a.jsxs("button",{onClick:()=>x(!0),className:"theme-hover-surface relative rounded-full p-2 transition-colors","aria-label":"Contents and Bookmarks",children:[a.jsx(bc,{className:"w-6 h-6"}),(I.length>0||W.length>0)&&a.jsx("span",{className:"absolute top-1 right-1 block h-2 w-2 rounded-full bg-sky-400 ring-2 ring-slate-800"})]})]}),a.jsxs("div",{className:"flex justify-end items-center gap-2 sm:order-3",children:[a.jsx("button",{onClick:ra,className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":Ve==="playing"?"Pause Read Aloud":"Start Read Aloud",children:Ve==="playing"?a.jsx(iv,{className:"w-6 h-6 text-sky-400"}):a.jsx(Hh,{className:"w-6 h-6"})}),a.jsx("button",{onClick:()=>S(!0),className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Search in book",children:a.jsx(Sc,{className:"w-6 h-6"})}),a.jsx("button",{onClick:()=>w(!0),className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Create citation for this page",children:a.jsx(Vh,{className:"w-6 h-6"})}),a.jsx("button",{onClick:Ln,className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":Lt?"Remove bookmark from this page":"Add bookmark to this page",children:a.jsx(Wh,{className:"w-6 h-6",filled:Lt})}),a.jsx("button",{onClick:()=>j(!0),className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Keyboard help",children:"?"}),a.jsx("button",{onClick:()=>b(!0),className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Settings",children:a.jsx(nv,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"text-center truncate px-2 w-full pt-2 sm:order-2 sm:w-auto sm:flex-grow sm:min-w-0 sm:pt-0",children:[a.jsx("h2",{className:"text-lg font-bold",children:o?.title||"Loading..."}),a.jsx("p",{className:"theme-text-secondary text-sm",children:o?.author})]})]}),a.jsxs("div",{className:"flex-grow relative min-h-0",onTouchStart:ta,onTouchEnd:Nt,children:[f&&a.jsx("div",{className:"theme-shell absolute inset-0 z-30 flex items-center justify-center",children:a.jsx(Rn,{text:"Loading Book..."})}),a.jsx("div",{ref:ce,id:"viewer",className:"theme-surface h-full w-full p-4 md:p-8"})]}),a.jsxs("footer",{className:`theme-surface-elevated theme-border theme-text-primary z-20 flex shrink-0 items-center gap-4 border-t p-4 transition-transform duration-300 ease-in-out ${J?"translate-y-0":"translate-y-full"}`,onMouseEnter:Ht,onMouseLeave:or,children:[z.flow==="paginated"?a.jsx("button",{onClick:Fr,className:"theme-hover-surface shrink-0 rounded-full p-2 transition-colors","aria-label":"Previous Page",children:a.jsx(Rs,{className:"w-6 h-6"})}):a.jsx("div",{className:"w-10 h-10 flex-shrink-0"}),a.jsxs("div",{className:"flex-grow flex flex-col justify-center",children:[a.jsx("input",{type:"range",min:"0",max:"100",value:Q.progress||0,onChange:ea,className:"theme-slider h-2 w-full cursor-pointer appearance-none rounded-lg disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Book progress",disabled:!qe.current||Q.totalPages===0}),a.jsx("div",{className:"theme-text-secondary mt-2 text-center text-sm","aria-live":"polite",children:Q.totalPages>0&&qe.current?a.jsxs("span",{children:["Page ",Q.currentPage," of ",Q.totalPages,"  ",Q.progress,"%"]}):a.jsx("span",{className:"theme-text-muted",children:"Calculating progress..."})})]}),a.jsxs("div",{className:"flex w-28 flex-col items-center text-sm",children:[a.jsx("label",{className:"theme-text-secondary text-xs",children:"Go to"}),a.jsx("input",{type:"number",min:1,max:Q.totalPages||9999,value:Q.currentPage||"",onChange:xe=>{const Ie=parseInt(xe.target.value||"1",10);if(isNaN(Ie)||!X.current?.locations)return;const Ue=X.current.locations.cfiFromLocation(Ie-1);Ue&&Te(Ue)},className:"theme-input w-full rounded-md px-2 py-1 text-center focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Jump to page"})]}),z.flow==="paginated"?a.jsx("button",{onClick:rr,className:"theme-hover-surface shrink-0 rounded-full p-2 transition-colors","aria-label":"Next Page",children:a.jsx(Go,{className:"w-6 h-6"})}):a.jsx("div",{className:"w-10 h-10 flex-shrink-0"})]}),a.jsx(yp,{isOpen:k,onClose:()=>x(!1),toc:L,onTocNavigate:Be,bookmarks:I,onBookmarkNavigate:Ge,onDeleteBookmark:Rt,citations:W,onCitationNavigate:bt,onDeleteCitation:Dr,settings:z,bookData:o}),a.jsx(S0,{isOpen:y,onClose:Ei,onQueryChange:Ci,onNavigate:ji,results:U,isLoading:ie,searchQuery:H}),a.jsx(N0,{isOpen:h,onClose:()=>b(!1),settings:z,onSettingsChange:Gr}),a.jsx(hp,{isOpen:g,onClose:()=>w(!1),onSave:Pt}),a.jsx(fp,{isOpen:N,onClose:()=>A(!1),onSave:ar}),a.jsx(Tc,{isOpen:Ke,onClose:()=>j(!1),onZoomIn:Pn,onZoomOut:Er,onToggleFit:Hr,activeReader:"epub"}),a.jsx(vp,{value:`${z.fontSize}%`,isOpen:he})]})]})},_0=({isOpen:r,title:s="Confirm",message:n,confirmLabel:o="Confirm",cancelLabel:c="Cancel",onClose:l,onConfirm:u,variant:f="default"})=>{const p=R.useRef(null),h=vr({isActive:r,onEscape:l,initialFocusRef:p});return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:l,role:"dialog","aria-modal":"true",children:a.jsxs("div",{ref:h,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-md rounded-lg border p-6 shadow-xl",onClick:b=>b.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:`text-xl font-bold ${f==="danger"?"text-red-300":"theme-accent-text"}`,children:s}),a.jsx("button",{onClick:l,className:"theme-hover-surface p-2 rounded-full transition-colors","aria-label":"Close",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"theme-text-secondary mb-6 text-sm",children:n}),a.jsxs("div",{className:"flex justify-end gap-4",children:[a.jsx("button",{ref:p,onClick:l,className:"theme-button-neutral theme-hover-surface rounded-md px-4 py-2 font-semibold transition-colors",tabIndex:0,children:c}),a.jsx("button",{onClick:u,className:`py-2 px-6 rounded-md transition-colors font-bold ${f==="danger"?"bg-red-600 hover:bg-red-700":"theme-button-primary"}`,tabIndex:0,children:o})]})]})}):null},A0=({isOpen:r,onClose:s,onConfirm:n,bookTitle:o})=>{const c=vr({isActive:r,onEscape:s});return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:s,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:c,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-md rounded-lg border p-6 shadow-xl",onClick:l=>l.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("h2",{className:"text-xl font-bold text-red-400 flex items-center gap-2",children:[a.jsx(ki,{className:"w-6 h-6"}),"Confirm Deletion"]}),a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsxs("p",{className:"theme-text-secondary mb-6 text-sm",children:['Are you sure you want to permanently delete "',a.jsx("strong",{className:"theme-text-primary font-semibold",children:o}),'"? This action cannot be undone.']}),a.jsxs("div",{className:"flex justify-end gap-4",children:[a.jsx("button",{onClick:s,className:"theme-button-neutral theme-hover-surface rounded-md px-4 py-2 font-semibold transition-colors",children:"Cancel"}),a.jsx("button",{onClick:n,className:"py-2 px-6 rounded-md bg-red-600 hover:bg-red-700 transition-colors font-bold",children:"Delete"})]})]})}):null},T0=({isOpen:r,onClose:s,onReplace:n,onAddAnyway:o,bookTitle:c})=>{const l=vr({isActive:r,onEscape:s});return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:s,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:l,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-md rounded-lg border p-6 shadow-xl",onClick:u=>u.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-yellow-300",children:"Duplicate Book Found"}),a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsxs("p",{className:"theme-text-secondary mb-6 text-sm",children:['The book "',a.jsx("strong",{className:"theme-text-primary font-semibold",children:c}),'" is already in your library. What would you like to do?']}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx("button",{onClick:n,className:"w-full py-2.5 px-4 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold",children:"Replace Existing"}),a.jsx("button",{onClick:o,className:"theme-button-neutral theme-hover-surface w-full rounded-md px-4 py-2.5 font-semibold transition-colors",children:"Add as New Copy"}),a.jsx("button",{onClick:s,className:"theme-text-muted w-full px-4 py-2 text-sm transition-colors hover:text-sky-400",children:"Cancel Import"})]})]})}):null},xp=R.createContext(void 0),R0=({children:r})=>{const[s,n]=R.useState([]),o=R.useRef({}),c=R.useCallback(u=>{if(n(f=>f.filter(p=>p.id!==u)),o.current[u]){try{window.clearTimeout(o.current[u])}catch{}delete o.current[u]}},[]),l=R.useCallback((u,f=4e3,p,h)=>{const b=`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;n(x=>[...x,{id:b,message:u,actionLabel:p,action:h}]);const k=window.setTimeout(()=>c(b),f);return o.current[b]=k,b},[c]);return R.useEffect(()=>()=>{Object.values(o.current).forEach(u=>{try{window.clearTimeout(u)}catch{}}),o.current={}},[]),a.jsx(xp.Provider,{value:{toasts:s,pushToast:l,removeToast:c},children:r})},wp=()=>{const r=R.useContext(xp);return r||{toasts:[],pushToast:(s,n,o,c)=>{try{return`${Date.now().toString(36)}-noop`}catch{return"noop"}},removeToast:s=>{}}},bp=R.createContext(null),P0=({children:r})=>{const[s,n]=R.useState(!1),[o,c]=R.useState({message:""}),l=R.useRef(()=>{});R.useRef(null);const u=wp(),f=b=>(c({...typeof b=="string"?{message:b}:b}),n(!0),new Promise(x=>{l.current=x})),p=()=>{n(!1),l.current(!1)},h=()=>{if(n(!1),l.current(!0),o&&typeof o.undoCallback=="function")try{const b=o.undoCallback(),k=o.undoDurationMs??6e3;u.pushToast("Action performed",k,"Undo",async()=>{try{b&&typeof b.then=="function"?await b:await o.undoCallback()}catch(x){console.error("Undo action failed",x)}}),b&&typeof b.then=="function"&&b.catch(()=>{})}catch(b){console.warn("undoCallback failed",b)}};return a.jsxs(bp.Provider,{value:f,children:[r,a.jsx(_0,{isOpen:s,title:o.title||"Confirm",message:o.message,confirmLabel:o.confirmLabel||"Confirm",cancelLabel:o.cancelLabel||"Cancel",variant:o.variant||"default",onClose:p,onConfirm:h})]})},Jo=()=>{const r=R.useContext(bp);if(!r)throw new Error("useConfirm must be used within a ConfirmProvider");return r},L0=({isOpen:r,onClose:s})=>{const[n,o]=R.useState(null),c=Jo(),l=vr({isActive:r,onEscape:s});R.useEffect(()=>{r&&ut.getBooksMetadata().then(f=>{o(f.length)}).catch(()=>{o(0)})},[r]);const u=()=>{(async()=>{const f={books:[],localStorageEntries:{}};try{f.books=await ut.getAllBooks(),Object.keys(localStorage).filter(h=>h.startsWith("ebook-reader-")).forEach(h=>{f.localStorageEntries[h]=localStorage.getItem(h)})}catch(h){console.warn("Failed to snapshot library before clear",h)}await c({message:`DANGER: This will permanently delete your entire local library, including all books, bookmarks, and citations.

You will have a short window to undo this action.`,title:"Dangerous Operation",confirmLabel:"Yes, delete",variant:"danger",undoCallback:async()=>{try{if(f.books&&f.books.length>0)for(const h of f.books)await ut.saveBook(h);Object.entries(f.localStorageEntries||{}).forEach(([h,b])=>{b===null?localStorage.removeItem(h):localStorage.setItem(h,b)}),setTimeout(()=>window.location.reload(),200)}catch(h){console.error("Failed to restore library on undo",h)}},undoDurationMs:8e3})&&(Object.keys(localStorage).filter(h=>h.startsWith("ebook-reader-")).forEach(h=>localStorage.removeItem(h)),ut.clearAllBooks().then(()=>{window.location.reload()}))})()};return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:s,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:l,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-lg rounded-lg border p-6 shadow-xl",onClick:f=>f.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Local Storage Management"}),a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg theme-surface-muted",children:[a.jsx("h3",{className:"theme-text-primary mb-2 text-lg font-semibold",children:"Library Statistics"}),a.jsx("p",{className:"theme-text-secondary text-sm",children:"Your library is stored locally in your browser's IndexedDB."}),a.jsxs("div",{className:"mt-4",children:[a.jsx("span",{className:"theme-text-secondary font-semibold",children:"Books in Library: "}),a.jsx("span",{className:"font-bold text-sky-300 text-lg",children:n===null?"Loading...":n})]})]}),a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-red-500/30 theme-surface-muted",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Danger Zone"}),a.jsx("p",{className:"theme-text-secondary mb-4 text-sm",children:"This will permanently delete all books and associated data (bookmarks, citations, reading progress) from your browser. This action cannot be undone."}),a.jsxs("button",{onClick:u,className:"w-full flex items-center justify-center gap-2 py-2 px-4 rounded-md bg-red-600 hover:bg-red-700 transition-colors font-semibold text-white text-sm",children:[a.jsx(ki,{className:"w-5 h-5"}),a.jsx("span",{children:"Clear Entire Local Library"})]})]})]})]})}):null},O0=({isOpen:r,onClose:s,catalogs:n,onAddCatalog:o,onDeleteCatalog:c,onUpdateCatalog:l,registries:u,onAddRegistry:f,onDeleteRegistry:p,onUpdateRegistry:h})=>{const[b,k]=R.useState(""),[x,y]=R.useState(""),[S,g]=R.useState("auto"),[w,N]=R.useState(""),[A,L]=R.useState(null),[T,I]=R.useState(""),[D,W]=R.useState("catalogs"),F=vr({isActive:r,onEscape:s});if(!r)return null;const U=Q=>{if(Q.preventDefault(),!b.trim()||!x.trim()){N("Name and URL cannot be empty.");return}try{new URL(x)}catch{N("Please enter a valid URL.");return}N(""),D==="catalogs"?o(b,x,S):f(b,x),k(""),y("")},V=Q=>{L(Q.id),I(Q.name)},ie=()=>{L(null),I("")},B=()=>{!A||!T.trim()||(D==="catalogs"?l(A,T.trim()):h(A,T.trim()),ie())},H=D==="catalogs"?n:u,C=D==="catalogs"?c:p;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:s,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:F,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-lg rounded-lg border p-6 shadow-xl",onClick:Q=>Q.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Manage Sources"}),a.jsx("button",{onClick:s,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"border-b border-slate-700 mb-6 theme-divider",children:a.jsxs("nav",{className:"flex -mb-px gap-4",children:[a.jsx("button",{onClick:()=>W("catalogs"),className:`py-3 px-2 text-sm font-medium border-b-2 transition-colors duration-200 ${D==="catalogs"?"border-sky-400 text-sky-300":"theme-text-secondary border-transparent hover:border-slate-500 hover:text-sky-400"}`,children:"Catalogs"}),a.jsx("button",{onClick:()=>W("registries"),className:`py-3 px-2 text-sm font-medium border-b-2 transition-colors duration-200 ${D==="registries"?"border-sky-400 text-sky-300":"theme-text-secondary border-transparent hover:border-slate-500 hover:text-sky-400"}`,children:"Registries"})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg theme-surface-muted",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(Gh,{className:"w-5 h-5"}),"Add New ",D==="catalogs"?"Catalog":"Registry"]}),a.jsxs("form",{onSubmit:U,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"item-name",className:"block text-sm font-medium text-slate-400 mb-1 theme-text-secondary",children:"Name"}),a.jsx("input",{id:"item-name",type:"text",value:b,onChange:Q=>k(Q.target.value),placeholder:D==="catalogs"?"e.g., Project Gutenberg":"e.g., OPDS Registry",className:"theme-input w-full rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"item-url",className:"block text-sm font-medium text-slate-400 mb-1 theme-text-secondary",children:"URL"}),a.jsx("input",{id:"item-url",type:"url",value:x,onChange:Q=>y(Q.target.value),placeholder:"https://.../catalog.xml",className:"theme-input w-full rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),D==="catalogs"&&a.jsxs("div",{children:[a.jsx("label",{htmlFor:"opds-version",className:"block text-sm font-medium text-slate-400 mb-1 theme-text-secondary",children:"OPDS Version"}),a.jsxs("select",{id:"opds-version",value:S,onChange:Q=>g(Q.target.value),className:"theme-input w-full rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500",children:[a.jsx("option",{value:"auto",children:"Auto-detect (recommended)"}),a.jsx("option",{value:"1",children:"OPDS 1 (Atom/XML)"}),a.jsx("option",{value:"2",children:"OPDS 2 (JSON)"})]})]}),D==="registries"&&a.jsx("p",{className:"text-sm text-slate-400 theme-text-secondary",children:"Registries are always OPDS 2.0 (JSON) format."}),w&&a.jsx("p",{className:"text-sm text-red-400",children:w}),a.jsxs("button",{type:"submit",className:"w-full py-2 px-4 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold text-sm",children:["Add ",D==="catalogs"?"Catalog":"Registry"]})]})]}),a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg theme-surface-muted",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(cv,{className:"w-5 h-5"})," Saved ",D==="catalogs"?"Catalogs":"Registries"]}),H.length>0?a.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:H.map(Q=>a.jsx("li",{className:"theme-surface-elevated flex items-center justify-between gap-2 rounded-md p-2",children:A===Q.id?a.jsxs(a.Fragment,{children:[a.jsx("label",{htmlFor:`edit-name-${Q.id}`,className:"sr-only",children:"Edit name"}),a.jsx("input",{id:`edit-name-${Q.id}`,type:"text",value:T,onChange:ae=>I(ae.target.value),className:"theme-input w-full rounded-md p-1 text-sm focus:outline-none focus:ring-1 focus:ring-sky-500",autoFocus:!0,onKeyDown:ae=>{ae.key==="Enter"&&B(),ae.key==="Escape"&&ie()}}),a.jsxs("div",{className:"flex items-center flex-shrink-0",children:[a.jsx("button",{onClick:B,className:"p-2 rounded-full hover:bg-green-500/20 text-green-400 transition-colors","aria-label":`Save changes for ${Q.name}`,children:a.jsx(hv,{className:"w-4 h-4"})}),a.jsx("button",{onClick:ie,className:"p-2 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors theme-text-muted","aria-label":"Cancel editing",children:a.jsx(tr,{className:"w-4 h-4"})})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"truncate",children:[a.jsx("p",{className:"font-semibold text-slate-200 truncate theme-text-primary",children:Q.name}),a.jsx("p",{className:"text-xs text-slate-400 truncate theme-text-secondary",children:Q.url})]}),a.jsxs("div",{className:"flex items-center flex-shrink-0",children:[a.jsx("button",{onClick:()=>V(Q),className:"p-2 rounded-full hover:bg-sky-500/20 text-slate-500 hover:text-sky-400 transition-colors theme-text-muted","aria-label":`Edit ${Q.name}`,children:a.jsx(fv,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>C(Q.id),className:"p-2 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors theme-text-muted","aria-label":`Delete ${Q.name}`,children:a.jsx(ki,{className:"w-4 h-4"})})]})]})},Q.id))}):a.jsxs("p",{className:"text-sm text-slate-400 text-center py-8 theme-text-secondary",children:["No ",D==="catalogs"?"catalogs":"registries"," added yet."]})]})]})]})})},I0=({isOpen:r,onClose:s})=>{const[n,o]=R.useState(""),[c,l]=R.useState(""),[u,f]=R.useState(!0),[p,h]=R.useState(null),[b,k]=R.useState(!1),x=vr({isActive:r,onEscape:s});if(!$r())return null;const y=async(S=!1)=>{k(!0),h(null);try{let g=n;S?g=qt(n):g=await Or(n);const w={};c&&(w.Authorization=c);let N=null;try{N=await fetch(g,{method:"HEAD",mode:"cors",redirect:"manual",credentials:u?"include":"omit",headers:w}),N&&N.status===405&&(N=await fetch(g,{method:"GET",mode:"cors",redirect:"manual",credentials:u?"include":"omit",headers:w}))}catch(D){h({error:String(D),target:g,requestHeaders:w,documentCookie:typeof document<"u"?document.cookie:""}),k(!1);return}const A=N.headers.get("access-control-allow-origin"),L=N.headers.get("access-control-allow-credentials"),T=N.headers.get("access-control-allow-headers"),I=N.headers.get("access-control-expose-headers");h({ok:N.ok,status:N.status,statusText:N.statusText,url:N.url||g,accessControlAllowOrigin:A,accessControlAllowCredentials:L,accessControlAllowHeaders:T,accessControlExposeHeaders:I,requestHeaders:w,proxied:g!==n,proxiedUrl:g!==n?g:null,documentCookie:typeof document<"u"?document.cookie:""})}catch(g){h({error:String(g)})}k(!1)};return r?a.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center p-6",children:a.jsxs("div",{ref:x,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-2xl overflow-auto rounded border shadow-lg",style:{maxHeight:"80vh"},children:[a.jsxs("div",{className:"theme-divider flex items-center justify-between border-b p-4",children:[a.jsx("strong",{children:"Network Debug"}),a.jsxs("div",{children:[a.jsx("button",{className:"theme-button-neutral theme-hover-surface mr-2 rounded px-3 py-1",onClick:()=>{o(""),h(null)},children:"Clear"}),a.jsx("button",{className:"px-3 py-1 bg-red-500 text-white rounded",onClick:s,children:"Close"})]})]}),a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{className:"block text-sm font-medium",children:"Target URL"}),a.jsx("input",{className:"theme-input w-full rounded border p-2",value:n,onChange:S=>o(S.target.value),placeholder:"https://example.org/opds/borrow/123"})]}),a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{className:"block text-sm font-medium",children:"Authorization header (optional)"}),a.jsx("input",{className:"theme-input w-full rounded border p-2",value:c,onChange:S=>l(S.target.value),placeholder:"Basic base64(...)"}),a.jsx("div",{className:"theme-text-secondary text-xs",children:"You can paste an Authorization header value to simulate client-sent auth. Note: browsers may preflight requests when custom headers are present."})]}),a.jsx("div",{className:"mb-4 flex items-center gap-3",children:a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:u,onChange:S=>f(S.target.checked)})," Include credentials (cookies)"]})}),a.jsxs("div",{className:"mb-4 flex gap-2",children:[a.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:()=>y(!1),disabled:b||!n,children:"Probe (auto)"}),a.jsx("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:()=>y(!0),disabled:b||!n,children:"Force Proxy"})]}),a.jsxs("div",{className:"text-sm",children:[b&&a.jsx("div",{children:"Running probe..."}),p&&a.jsxs("div",{className:"mt-3",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"Target used:"})," ",p.url||p.target]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Proxied:"})," ",String(p.proxied)]}),p.proxiedUrl&&a.jsxs("div",{children:[a.jsx("strong",{children:"Proxied URL:"})," ",p.proxiedUrl]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Response:"})," ",p.status," ",p.statusText]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Access-Control-Allow-Origin:"})," ",String(p.accessControlAllowOrigin)]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Access-Control-Allow-Credentials:"})," ",String(p.accessControlAllowCredentials)]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Access-Control-Allow-Headers:"})," ",String(p.accessControlAllowHeaders)]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Access-Control-Expose-Headers:"})," ",String(p.accessControlExposeHeaders)]}),a.jsxs("div",{className:"mt-2",children:[a.jsx("strong",{children:"Request headers sent (client-side):"}),a.jsx("pre",{className:"theme-surface rounded p-2 text-xs overflow-auto",children:JSON.stringify(p.requestHeaders,null,2)})]}),a.jsxs("div",{className:"mt-2",children:[a.jsx("strong",{children:"document.cookie (current origin):"}),a.jsx("pre",{className:"theme-surface rounded p-2 text-xs overflow-auto",children:p.documentCookie||"<none>"})]}),a.jsx("div",{className:"theme-text-secondary mt-2 text-xs",children:"Limitations: The browser will not expose cross-origin cookies or Set-Cookie headers to JavaScript. A missing Access-Control-Allow-Origin or Access-Control-Allow-Credentials header will still prevent the browser from exposing the response body to the app."})]})]})]})]})}):null},F0=({isOpen:r,host:s,authDocument:n,onClose:o,onSubmit:c,onOpenAuthLink:l,onRetry:u,probeUrl:f})=>{const[p,h]=R.useState(""),[b,k]=R.useState(""),[x,y]=R.useState(!1);R.useEffect(()=>{if(!r){h(""),k(""),y(!1);return}const F=n?.username_hint||n?.username||n?.suggested_username||"",U=n?.password_hint||"";F&&h(String(F)),U&&k("")},[r]);const[S,g]=R.useState(!1),[w,N]=R.useState(!1),A=R.useRef(null);R.useEffect(()=>()=>{if(A.current){try{window.clearInterval(A.current)}catch{}A.current=null}},[]);const L=vr({isActive:r,onEscape:o});if(!r)return null;const T=n?.realm||n?.title||null,I=n?.description||n?.instructions||null,D=n?.logo||n?.image||null,W=Array.isArray(n?.links)?n.links:[];return a.jsx("div",{className:"theme-shell fixed inset-0 z-50 flex items-center justify-center bg-opacity-75 p-4",children:a.jsxs("div",{ref:L,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-md rounded-lg border p-6",children:[a.jsxs("div",{className:"flex items-start gap-4 mb-2",children:[D&&a.jsx("img",{src:D,alt:"provider logo",className:"w-12 h-12 object-contain"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",children:T?`Login to ${T}`:"Authentication required"}),a.jsxs("p",{className:"theme-text-secondary text-sm",children:["This catalog at ",a.jsx("span",{className:"font-mono",children:s})," requires credentials to access the requested content."]})]}),S&&a.jsx("div",{className:"theme-text-secondary mb-3 text-sm",children:"Waiting for provider sign-in to complete... This may take a minute."}),w&&a.jsxs("div",{className:"mb-3 text-sm text-emerald-300 flex items-center justify-between",children:[a.jsx("span",{children:"Direct access appears to be available. You can retry the acquisition now."}),a.jsx("div",{className:"ml-4",children:a.jsx("button",{onClick:()=>{if(A.current){try{window.clearInterval(A.current)}catch{}A.current=null}g(!1),typeof u=="function"&&u()},className:"px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-500 text-white",children:"Retry now"})})]})]}),I&&a.jsx("p",{className:"theme-text-secondary mb-4 text-sm",children:I}),W.length>0&&a.jsxs("div",{className:"theme-text-secondary mb-4 text-sm",children:[a.jsx("div",{className:"font-semibold mb-1",children:"Authentication Links"}),a.jsx("ul",{className:"list-disc list-inside",children:W.map((F,U)=>a.jsxs("li",{children:[a.jsx("a",{className:"text-sky-400",href:F.href,target:"_blank",rel:"noreferrer",children:F.title||F.href})," ",F.rel?a.jsxs("span",{className:"theme-text-muted text-xs",children:["(",F.rel,")"]}):null]},U))})]}),W.length>0&&a.jsx("div",{className:"mb-4 flex gap-2",children:W.map((F,U)=>(F.rel||"").toString().includes("authenticate")?a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("button",{type:"button",onClick:async()=>{let ie=null;try{ie=window.open(F.href,"_blank","noopener")}catch{ie=null}typeof l=="function"&&l(F.href);try{if(!ie||typeof window>"u"||typeof Or!="function")return;g(!0),N(!1);let B=0;const H=30,C=f||F.href;A.current=window.setInterval(async()=>{B+=1;try{await Or(C)===C&&(N(!0),g(!1),A.current&&(window.clearInterval(A.current),A.current=null))}catch{}B>=H&&(g(!1),A.current&&(window.clearInterval(A.current),A.current=null))},2e3)}catch{}},className:"px-3 py-2 rounded bg-emerald-600 hover:bg-emerald-500 text-white",children:"Open sign-in page"})},U):null)}),a.jsx("label",{htmlFor:"opds-username",className:"theme-text-secondary mb-1 block text-sm",children:"Username"}),a.jsx("input",{id:"opds-username","aria-label":"username",placeholder:n?.username_placeholder||"Username",value:p,onChange:F=>h(F.target.value),className:"theme-input mb-3 w-full rounded border p-2"}),a.jsx("label",{htmlFor:"opds-password",className:"theme-text-secondary mb-1 block text-sm",children:"Password"}),a.jsx("input",{id:"opds-password","aria-label":"password",placeholder:n?.password_placeholder||"Password",type:"password",value:b,onChange:F=>k(F.target.value),className:"theme-input mb-3 w-full rounded border p-2"}),n?.username_hint&&a.jsxs("div",{className:"theme-text-muted mb-2 text-xs",children:["Hint: ",n.username_hint]}),n?.password_hint&&a.jsxs("div",{className:"theme-text-muted mb-2 text-xs",children:["Password: ",n.password_hint]}),a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("input",{id:"saveCred",type:"checkbox",checked:x,onChange:F=>y(F.target.checked)}),a.jsx("label",{htmlFor:"saveCred",className:"theme-text-secondary text-sm",children:"Save credential for this host"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:o,className:"theme-button-neutral theme-hover-surface rounded px-4 py-2",children:"Cancel"}),typeof u=="function"&&a.jsx("button",{onClick:()=>u(),className:"px-4 py-2 rounded bg-yellow-600 hover:bg-yellow-500",children:"Retry"}),a.jsx("button",{onClick:()=>c(p,b,x),className:"px-4 py-2 rounded bg-sky-500 hover:bg-sky-600",children:"Continue"})]})]})})},oh="https://www.googleapis.com/auth/drive.file",hi="g_access_token",Po="g_access_token_expires_at",D0=r=>{if(typeof r!="number"&&typeof r!="string")return null;const s=typeof r=="number"?r:Number(r);return Number.isFinite(s)?s>1e12?s:s*1e3:null},kp=R.createContext(null),B0=({children:r})=>{const[s,n]=R.useState(null),[o,c]=R.useState(null),[l,u]=R.useState(!1),[f,p]=R.useState("initializing"),[h,b]=R.useState(null),k=R.useRef("none"),x=R.useRef(null),y=!!s,S=R.useCallback(()=>{localStorage.removeItem(hi),localStorage.removeItem(Po)},[]),g=R.useCallback(()=>{const W=localStorage.getItem(hi);W&&n0(W),n(null),b(null),S(),localStorage.removeItem("ebook-reader-drive-folder-id"),localStorage.removeItem("ebook-reader-drive-file-id"),localStorage.removeItem("ebook-reader-last-sync"),window.gapi?.client&&window.gapi.client.setToken(null)},[S]),w=R.useCallback(W=>{if(!W?.access_token)return null;localStorage.setItem(hi,W.access_token);let F=null;const U=Number(W.expires_in);return Number.isFinite(U)&&U>0?F=Date.now()+U*1e3:F=D0(W.expires_at),F!==null?localStorage.setItem(Po,String(F)):localStorage.removeItem(Po),F},[]),N=R.useCallback(()=>{const W=localStorage.getItem(hi),F=localStorage.getItem(Po),U=F?Number(F):NaN;return W?!Number.isFinite(U)||U<=Date.now()+6e4?(S(),null):W:null},[S]),A=R.useCallback(async(W,F)=>{try{const U=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${W}`}});if(!U.ok)throw new Error(`Failed to fetch user profile, status: ${U.status}`);const V=await U.json();if(window.gapi?.client){const ie={access_token:W};typeof F=="number"&&Number.isFinite(F)&&(ie.expires_at=F),window.gapi.client.setToken(ie)}n({name:V.name,email:V.email,picture:V.picture}),b(null),p("ready")}catch(U){console.error("Token validation/profile fetch failed:",U),g(),p("ready"),b("Google session is invalid or expired. Please sign in again.")}},[g]),L=R.useCallback(W=>{if(!x.current)return;k.current=W;const F=W==="interactive_consent"?"consent":"";try{x.current.requestAccessToken({prompt:F})}catch(U){console.error("Google token request failed to start:",U),k.current="none";const V=U instanceof Error?U.message:"Google sign-in request failed.";b(V)}},[]),T=R.useCallback(async W=>{const F=k.current;if(k.current="none",W?.error){if(F==="interactive_silent"){L("interactive_consent");return}const V=W.error_description||W.error||"Google sign-in failed.";b(V);return}if(!(()=>{const V=window.google?.accounts?.oauth2;if(V?.hasGrantedAllScopes&&W?.access_token)try{return V.hasGrantedAllScopes(W,oh)}catch{}return(typeof W?.scope=="string"?W.scope.split(/\s+/).filter(Boolean):[]).includes(oh)})()){if(F!=="interactive_consent"){L("interactive_consent");return}b("Google Drive access was not granted. Please approve Drive access to use cloud sync.");return}if(W?.access_token){const V=w(W);await A(W.access_token,V)}},[A,L,w]);R.useEffect(()=>{(async()=>{p("initializing"),b(null);try{const F=await r0(T);x.current=F,c(F),p("ready")}catch(F){const U=F instanceof Error?F.message:"Google initialization failed.";U.includes("VITE_GOOGLE_CLIENT_ID")?p("not_configured"):p("error"),b(U)}finally{u(!0)}})()},[T]),R.useEffect(()=>{if(!l||f!=="ready")return;const W=!!localStorage.getItem(hi),F=N();if(F){A(F);return}o&&W&&L("restore_silent")},[f,A,N,l,L,o]);const I=R.useCallback(()=>{x.current&&(b(null),L("interactive_consent"))},[L]),D=R.useCallback(()=>{x.current&&(b(null),L("interactive_consent"))},[L]);return a.jsx(kp.Provider,{value:{user:s,isLoggedIn:y,tokenClient:o,signIn:I,reauthorizeDrive:D,signOut:g,isInitialized:l,authStatus:f,authError:h},children:r})},Rc=()=>{const r=R.useContext(kp);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},M0=({isOpen:r,onClose:s,onUploadToDrive:n,onDownloadFromDrive:o,driveSnapshots:c,selectedSnapshotId:l,onSelectSnapshotId:u,onRefreshSnapshots:f,isLoadingSnapshots:p,syncStatus:h,setSyncStatus:b})=>{const{user:k,isLoggedIn:x,reauthorizeDrive:y,signOut:S,isInitialized:g,authStatus:w,authError:N}=Rc(),A=()=>{h.state!=="syncing"&&(b({state:"idle",message:""}),s())},L=vr({isActive:r,onEscape:A});if(!r)return null;const T=localStorage.getItem("ebook-reader-last-sync"),I=T?new Date(T).toLocaleString():"Never",D=h.state==="syncing",W=h.state==="error"?"theme-danger":h.state==="success"?"theme-success":h.state==="syncing"?"theme-info":"theme-surface-elevated theme-border theme-text-secondary",F=h.state==="idle"?`Last synced: ${I}`:h.message;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:A,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:L,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-lg rounded-lg border p-6 shadow-xl",onClick:U=>U.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Cloud Sync"}),a.jsx("button",{onClick:A,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close",disabled:D,children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg theme-surface-muted",children:[a.jsx("h3",{className:"theme-text-primary mb-4 text-lg font-semibold",children:"Account & Sync"}),x&&k?a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("img",{src:k.picture,alt:"User",className:"w-12 h-12 rounded-full"}),a.jsxs("div",{className:"flex-grow",children:[a.jsx("p",{className:"font-semibold",children:k.name}),a.jsx("p",{className:"theme-text-secondary text-sm",children:k.email})]}),a.jsx("button",{onClick:y,className:"py-2 px-3 rounded-md bg-sky-700 hover:bg-sky-600 transition-colors font-semibold text-xs",children:"Refresh Drive Access"}),a.jsx("button",{onClick:S,className:"theme-button-neutral theme-hover-surface rounded-md px-4 py-2 text-sm font-semibold transition-colors",children:"Sign Out"})]}),a.jsx("div",{className:`rounded-md border px-3 py-2 text-xs ${W}`,children:F}),N&&a.jsx("p",{className:"theme-text-warning text-xs",role:"status",children:N})]}):a.jsxs("div",{children:[a.jsx("p",{className:"theme-text-secondary mb-3 text-sm",children:"Use the main menu's Log In action to connect your Google account, then return here for manual uploads and downloads."}),w==="not_configured"&&a.jsx("p",{className:"theme-text-warning mb-3 text-xs",role:"status",children:"Google sync is not configured for this deployment. Set `VITE_GOOGLE_CLIENT_ID` and redeploy."}),(!g||w==="initializing")&&a.jsx("p",{className:"theme-text-secondary mb-3 text-xs",role:"status",children:"Google sign-in is still initializing."}),w==="error"&&N&&a.jsx("p",{className:"theme-text-warning mb-3 text-xs",role:"status",children:N})]})]}),x&&a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg theme-surface-muted",children:[a.jsx("h3",{className:"theme-text-primary mb-2 text-lg font-semibold",children:"Google Drive Sync"}),a.jsxs("p",{className:"theme-text-muted mb-4 text-xs",children:["Last synced: ",I]}),a.jsxs("div",{className:"theme-surface-elevated theme-border mb-4 rounded-md border p-3",children:[a.jsxs("div",{className:"flex items-center justify-between gap-3 mb-2",children:[a.jsx("p",{className:"theme-text-secondary text-xs font-semibold uppercase",children:"Restore Point"}),a.jsx("button",{onClick:f,disabled:D||p,className:"theme-button-neutral theme-hover-surface rounded px-2 py-1 text-xs disabled:opacity-60",children:p?"Refreshing...":"Refresh"})]}),a.jsx("select",{value:l,onChange:U=>u(U.target.value),disabled:D||p||c.length===0,className:"theme-input w-full rounded border p-2 text-sm",children:c.length===0?a.jsx("option",{value:"",children:"No snapshots found yet"}):c.map(U=>a.jsxs("option",{value:U.id,children:[U.isLatest?"[Latest] ":"",U.name]},U.id))}),a.jsx("p",{className:"theme-text-secondary mt-2 text-xs",children:"Select which cloud snapshot to use when downloading. Upload creates a new timestamped snapshot automatically."})]}),h.state!=="idle"?a.jsxs("div",{className:"theme-surface-elevated rounded-md p-4 text-center",children:[D&&a.jsx(Rn,{text:h.message}),h.state==="success"&&a.jsx("p",{className:"theme-text-success",children:h.message}),h.state==="error"&&a.jsx("p",{className:"theme-text-danger",children:h.message})]}):a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("button",{onClick:n,className:"theme-button-neutral theme-hover-surface flex flex-col items-center justify-center gap-2 rounded-md p-4 transition-colors disabled:opacity-50",disabled:D,children:[a.jsx($h,{className:"w-6 h-6 text-sky-400"}),a.jsx("span",{className:"font-semibold",children:"Upload to Drive"}),a.jsx("span",{className:"theme-text-secondary text-center text-xs",children:"Save your local library to the cloud. This will overwrite any existing data in Drive."})]}),a.jsxs("button",{onClick:o,className:"theme-button-neutral theme-hover-surface flex flex-col items-center justify-center gap-2 rounded-md p-4 transition-colors disabled:opacity-50",disabled:D,children:[a.jsx(dv,{className:"w-6 h-6 text-sky-400"}),a.jsx("span",{className:"font-semibold",children:"Download from Drive"}),a.jsx("span",{className:"theme-text-secondary text-center text-xs",children:"Replace your local library with the one from Drive. Local changes will be lost."})]})]})]})]})]})})},U0=({message:r,isOpen:s})=>a.jsx("div",{className:`fixed right-6 top-6 z-50 pointer-events-none transition-all duration-300 ${s?"opacity-100 translate-y-0":"opacity-0 -translate-y-2"}`,children:a.jsx("div",{className:"bg-green-600 text-white px-4 py-2 rounded-full shadow-lg text-sm font-medium ring-1 ring-green-700",children:r})});class Es extends R.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null},this.handleReset=()=>{this.props.onReset(),this.setState({hasError:!1,error:null})}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,n){console.error("ErrorBoundary caught an error:",s,n)}render(){return this.state.hasError?a.jsx("div",{className:"theme-shell theme-text-primary flex min-h-screen flex-col items-center justify-center p-4 text-center",role:"alert",children:a.jsxs("div",{className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-lg rounded-lg border p-8 shadow-xl",children:[a.jsx("svg",{className:"w-16 h-16 mx-auto text-red-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.jsx("h1",{className:"text-2xl font-bold text-red-300",children:"Something went wrong."}),a.jsx("p",{className:"theme-text-secondary mt-2",children:this.props.fallbackMessage||"An unexpected error occurred. Please try again."}),this.state.error&&a.jsxs("details",{className:"theme-surface theme-text-secondary mt-4 rounded-md p-3 text-left text-sm",children:[a.jsx("summary",{className:"theme-text-secondary cursor-pointer hover:text-sky-400",children:"Error Details"}),a.jsx("pre",{className:"theme-text-muted mt-2 whitespace-pre-wrap break-all",children:a.jsx("code",{children:this.state.error.message})})]}),a.jsx("button",{onClick:this.handleReset,className:"mt-6 py-2 px-6 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold",children:"Try Again"})]})}):this.props.children}}const ah=({message:r,politeness:s="polite",clearAfter:n=5e3,onClear:o})=>{const[c,l]=R.useState(null);return R.useEffect(()=>{if(r){if(l(r),n>0){const u=setTimeout(()=>{l(null),o&&o()},n);return()=>clearTimeout(u)}}else l(null)},[r,n,o]),c?a.jsx("div",{role:"status","aria-live":s,"aria-atomic":"true",className:"sr-only",children:c}):null},z0="/My-Ebook-Reader/assets/MeBooks_lockup_stacked_dark-Bjs16_ps.svg",$0="/My-Ebook-Reader/assets/MeBooks_transparent_white_removed-8vWVlR8U.png",W0=({isVisible:r})=>a.jsx("div",{className:`theme-shell fixed inset-0 z-50 flex flex-col items-center justify-center transition-opacity duration-700 ease-in-out ${r?"opacity-100":"opacity-0 pointer-events-none"}`,children:a.jsx("div",{className:"animate-pulse",children:a.jsx("img",{src:z0,alt:"MeBooks",className:"w-64"})})}),V0=({isCloudSyncModalOpen:r,onCloseCloudSyncModal:s,onUploadToDrive:n,onDownloadFromDrive:o,driveSnapshots:c,selectedSnapshotId:l,onSelectSnapshotId:u,onRefreshSnapshots:f,isLoadingSnapshots:p,syncStatus:h,setSyncStatus:b,isLocalStorageModalOpen:k,onCloseLocalStorageModal:x,credentialPrompt:y,onCloseCredentialPrompt:S,onCredentialSubmit:g,onOpenAuthLink:w,onRetryAfterProviderLogin:N,showNetworkDebug:A,onCloseNetworkDebug:L,onOpenNetworkDebug:T,isShortcutHelpOpen:I,onCloseShortcutHelp:D})=>a.jsxs(a.Fragment,{children:[a.jsx(M0,{isOpen:r,onClose:s,onUploadToDrive:n,onDownloadFromDrive:o,driveSnapshots:c,selectedSnapshotId:l,onSelectSnapshotId:u,onRefreshSnapshots:f,isLoadingSnapshots:p,syncStatus:h,setSyncStatus:b}),a.jsx(L0,{isOpen:k,onClose:x}),a.jsx(F0,{isOpen:y.isOpen,host:y.host,authDocument:y.authDocument,onClose:S,onSubmit:g,onOpenAuthLink:w,onRetry:N,probeUrl:y.pendingHref}),a.jsx(I0,{isOpen:A,onClose:L}),a.jsx(Tc,{isOpen:I,onClose:D,activeReader:null}),typeof window<"u"&&window.__MEBOOKS_DEBUG__&&a.jsx("div",{className:"fixed right-3 bottom-3 z-[60]",children:a.jsx("button",{onClick:T,className:"px-3 py-2 bg-yellow-400 rounded shadow",children:"Network Debug"})})]}),q0=["system","light","dark"],H0=({isOpen:r,currentTheme:s,onClose:n,onSelectTheme:o})=>{const c=vr({isActive:r,onEscape:n});return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:n,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:c,className:"theme-surface-elevated theme-border theme-text-primary w-full max-w-md rounded-lg border p-6 shadow-xl",onClick:l=>l.stopPropagation(),children:[a.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[a.jsx("h2",{className:"theme-accent-text text-xl font-bold",children:"UI Theme"}),a.jsx("button",{onClick:n,className:"theme-hover-surface rounded-full p-2 transition-colors","aria-label":"Close",children:a.jsx(tr,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"theme-text-secondary mb-5 text-sm",children:"Choose how the app interface should look across the library and reader views."}),a.jsx("div",{className:"space-y-3",children:q0.map(l=>{const u=s===l,f=l.charAt(0).toUpperCase()+l.slice(1);return a.jsxs("button",{onClick:()=>{o(l),n()},className:`flex w-full items-center justify-between rounded-md border px-4 py-3 text-left transition-colors ${u?"theme-accent-surface theme-accent-text":"theme-border theme-hover-surface"}`,children:[a.jsx("span",{className:"font-medium",children:f}),a.jsx("span",{className:`text-xs ${u?"theme-accent-text-emphasis":"theme-text-muted"}`,children:u?"Current":"Select"})]},l)})})]})}):null},G0=({availableAudiences:r,availableFictionModes:s,availableMediaModes:n,availablePublicationTypes:o,availableAvailabilityModes:c,availableDistributors:l,audienceMode:u,fictionMode:f,mediaMode:p,publicationMode:h,availabilityMode:b,distributorMode:k,onAudienceChange:x,onFictionChange:y,onMediaChange:S,onPublicationChange:g,onAvailabilityChange:w,onDistributorChange:N})=>{const A=[{key:"all",label:"All Ages",available:!0},{key:"adult",label:"Adult",available:r.includes("adult")},{key:"young-adult",label:"Young Adult",available:r.includes("young-adult")},{key:"children",label:"Children",available:r.includes("children")}],L=[{key:"all",label:"All Types",available:!0},{key:"fiction",label:"Fiction",available:s.includes("fiction")},{key:"non-fiction",label:"Non-Fiction",available:s.includes("non-fiction")}],T=[{key:"all",label:"All Media",available:!0},{key:"epub",label:"EPUB",available:n.includes("epub")},{key:"pdf",label:"PDF",available:n.includes("pdf")},{key:"audiobook",label:"Audiobooks",available:n.includes("audiobook")}],I=r.length>1,D=s.length>1,W=n.length>1,F=o.length>1,U=c.length>1,V=l.length>1;if(!(I||D||W||F||U||V))return null;const B=+(u!=="all")+ +(f!=="all")+ +(p!=="all")+ +(h!=="all")+ +(b!=="all")+ +(k!=="all");return a.jsxs("div",{className:"theme-surface theme-border mb-5 rounded-xl border p-3",children:[a.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[a.jsx("h3",{className:"theme-text-secondary text-xs font-semibold uppercase tracking-[0.18em]",children:"Filters"}),a.jsx("span",{className:"theme-text-muted text-[11px]",children:B>0?`${B} active`:"Local only"})]}),(I||D||W||F||U||V)&&a.jsxs("div",{className:"flex flex-wrap items-start gap-3",children:[I&&a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"theme-text-muted text-xs font-medium uppercase tracking-[0.12em]",children:"Audience"}),a.jsx("div",{className:"flex flex-wrap gap-1.5",children:A.filter(H=>H.available).map(H=>a.jsx("button",{onClick:()=>x(H.key),className:`rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${u===H.key?"theme-nav-link-active border":"theme-pill theme-hover-surface"}`,children:H.label.replace("All Ages","All")},H.key))})]}),D&&a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"theme-text-muted text-xs font-medium uppercase tracking-[0.12em]",children:"Type"}),a.jsx("div",{className:"flex flex-wrap gap-1.5",children:L.filter(H=>H.available).map(H=>a.jsx("button",{onClick:()=>y(H.key),className:`rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${f===H.key?"theme-nav-link-active border":"theme-pill theme-hover-surface"}`,children:H.label.replace("All Types","All")},H.key))})]}),W&&a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"theme-text-muted text-xs font-medium uppercase tracking-[0.12em]",children:"Format"}),a.jsx("div",{className:"flex flex-wrap gap-1.5",children:T.filter(H=>H.available).map(H=>a.jsx("button",{onClick:()=>S(H.key),className:`rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${p===H.key?"theme-nav-link-active border":"theme-pill theme-hover-surface"}`,children:H.label.replace("All Media","All")},H.key))})]}),F&&a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"theme-text-muted text-xs font-medium uppercase tracking-[0.12em]",children:"Publication"}),a.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All"},...o].map(H=>a.jsx("button",{onClick:()=>g(H.key),className:`rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${h===H.key?"theme-nav-link-active border":"theme-pill theme-hover-surface"}`,children:H.label},H.key))})]}),U&&a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"theme-text-muted text-xs font-medium uppercase tracking-[0.12em]",children:"Availability"}),a.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All"},...c].map(H=>a.jsx("button",{onClick:()=>w(H.key),className:`rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${b===H.key?"theme-nav-link-active border":"theme-pill theme-hover-surface"}`,children:H.label},H.key))})]}),V&&a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"theme-text-muted text-xs font-medium uppercase tracking-[0.12em]",children:"Distributor"}),a.jsx("div",{className:"flex flex-wrap gap-1.5",children:["all",...l].map(H=>a.jsx("button",{onClick:()=>N(H),className:`rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${k===H?"theme-nav-link-active border":"theme-pill theme-hover-surface"}`,children:H==="all"?"All":H},H))})]})]})]})},K0=({navPath:r,pagination:s,onBreadcrumbClick:n,onPaginationClick:o,isLoading:c=!1,actions:l})=>{const u=r.length>0,f=s&&(s.first||s.prev||s.next||s.last)&&!c,p=mt.useMemo(()=>{if(!s||c)return null;const h=Number.isFinite(s.totalResults)?Number(s.totalResults):void 0,b=Number.isFinite(s.itemsPerPage)?Number(s.itemsPerPage):void 0,k=Number.isFinite(s.startIndex)?Math.max(1,Number(s.startIndex)):void 0;if(h!==void 0&&k!==void 0&&b!==void 0){const x=Math.min(k+b-1,h);return`Showing ${k}-${x} of ${h}`}return k!==void 0&&b!==void 0?`Showing ${k}-${k+b-1}`:h!==void 0?`${h} results`:null},[c,s]);return a.jsx("div",{className:u||p||f||l?"mb-5":void 0,children:a.jsx("div",{className:"theme-surface theme-border rounded-xl border px-3 py-2",children:a.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[u?a.jsx("nav",{"aria-label":"breadcrumb",className:"theme-text-secondary flex min-w-0 flex-wrap items-center gap-y-1 text-sm",children:r.map((h,b)=>a.jsxs(mt.Fragment,{children:[a.jsx("button",{onClick:()=>n(b),className:`truncate transition-colors hover:text-sky-300 ${b===r.length-1?"theme-text-primary font-medium":""}`,"aria-current":b===r.length-1?"page":void 0,children:h.name}),b<r.length-1&&a.jsx(kc,{className:"mx-1 h-4 w-4 flex-shrink-0"})]},b))}):a.jsx("div",{}),a.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[p&&a.jsx("p",{className:"theme-text-muted mr-1 text-xs sm:text-sm","aria-live":"polite",children:p}),f&&a.jsxs("div",{className:"theme-surface-muted theme-border flex items-center gap-1 rounded-lg border p-1",children:[a.jsx("button",{onClick:()=>s.first&&o(s.first),disabled:!s.first,className:"theme-button-neutral theme-hover-surface rounded-md border px-2 py-1 text-xs font-medium transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50","aria-label":"First page",children:"First"}),a.jsx("button",{onClick:()=>s.prev&&o(s.prev),disabled:!s.prev,className:"theme-button-neutral theme-hover-surface inline-flex items-center rounded-md border px-2 py-1 text-xs font-medium transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Previous page",children:a.jsx(Rs,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>s.next&&o(s.next),disabled:!s.next,className:"theme-button-neutral theme-hover-surface inline-flex items-center rounded-md border px-2 py-1 text-xs font-medium transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Next page",children:a.jsx(Go,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>s.last&&o(s.last),disabled:!s.last,className:"theme-button-neutral theme-hover-surface rounded-md border px-2 py-1 text-xs font-medium transition-colors duration-200 disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Last page",children:"Last"})]}),l]})]})})})},Q0=({value:r,onChange:s,primaryLabel:n="Search this catalog",primaryPlaceholder:o="Search this catalog",advancedFields:c=[],advancedValues:l={},onAdvancedChange:u,onSubmit:f,onClear:p,disabled:h=!1,isLoading:b=!1,errorMessage:k=null,hasActiveSearch:x=!1})=>{const[y,S]=R.useState(!1),g=r.trim(),w=c.length>0;R.useEffect(()=>{w||S(!1)},[w]);const N=A=>A.replace(/([A-Z])/g," $1").replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/^./,L=>L.toUpperCase());return a.jsxs("section",{className:"theme-surface theme-border mb-5 rounded-xl border p-3",children:[a.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[a.jsx("h3",{className:"theme-text-secondary text-xs font-semibold uppercase tracking-[0.18em]",children:"Catalog Search"}),a.jsx("span",{className:"theme-text-muted text-[11px]",children:b?"Loading search":"Remote query"})]}),a.jsxs("form",{className:"flex flex-col gap-2 sm:flex-row",onSubmit:A=>{A.preventDefault(),!(h||g.length===0)&&f()},children:[a.jsx("input",{type:"search",value:r,onChange:A=>s(A.target.value),placeholder:o,disabled:h,className:"theme-input min-w-0 flex-1 rounded-lg border px-3 py-2 text-sm focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60","aria-label":n}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{type:"submit",disabled:h||g.length===0,className:"theme-button-primary rounded-lg px-3 py-2 text-sm font-medium transition-colors disabled:cursor-not-allowed disabled:opacity-60",children:"Search"}),x&&a.jsx("button",{type:"button",onClick:p,className:"theme-button-neutral theme-hover-surface rounded-lg border px-3 py-2 text-sm font-medium transition-colors",children:"Clear"})]})]}),w&&a.jsxs("div",{className:"mt-3",children:[a.jsx("button",{type:"button",onClick:()=>S(A=>!A),className:"theme-text-secondary text-xs font-medium uppercase tracking-[0.14em] transition-colors hover:text-sky-300",children:y?"Hide Advanced":"Show Advanced"}),y&&a.jsx("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:c.map(A=>a.jsxs("label",{className:"theme-text-secondary flex flex-col gap-1 text-xs font-medium uppercase tracking-[0.08em]",children:[a.jsx("span",{children:N(A.name)}),a.jsx("input",{type:"text",value:l[A.name]||"",onChange:L=>u?.(A.name,L.target.value),placeholder:`Optional ${N(A.name).toLowerCase()}`,disabled:h,className:"theme-input rounded-lg border px-3 py-2 text-sm normal-case tracking-normal focus:border-sky-500 focus:outline-none focus:ring-1 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-60","aria-label":N(A.name)})]},A.name))})]}),k&&a.jsx("p",{className:"mt-2 text-xs text-rose-300",children:k})]})},X0=({navigationLinks:r,currentNavigationUrl:s=null,facetGroups:n,onNavigationSelect:o,onFacetSelect:c,isLoading:l=!1})=>{const[u,f]=R.useState(!0),[p,h]=R.useState(!0),[b,k]=R.useState(""),[x,y]=R.useState(!1),[S,g]=R.useState(!1),[w,N]=R.useState(""),A=R.useRef(null),L=R.useRef(null),T=vr({isActive:S,onEscape:()=>g(!1),initialFocusRef:L,returnFocusRef:A}),I=10,D=24,W=12,F=24,U=r.length>0,V=n.some(ee=>ee.links.length>0),ie=r.length>W,B=r.length>F,H=R.useMemo(()=>{const ee=b.trim().toLowerCase();return ee?r.filter(P=>P.title.toLowerCase().includes(ee)):r},[r,b]),C=R.useMemo(()=>{if(r.length<=W)return H;const ee=x?D:I;return H.slice(0,ee)},[H,r.length,x]),Q=Math.max(H.length-C.length,0),ae=R.useMemo(()=>{const ee=w.trim().toLowerCase();return ee?r.filter(P=>P.title.toLowerCase().includes(ee)):r},[w,r]);if(R.useEffect(()=>{y(!1),g(!1),N("")},[s,r]),!U&&!V&&!l)return null;const J=()=>{N(b),g(!0)},te=ee=>{g(!1),o(ee)},re=(ee,P,$)=>{const ye=!!s&&ee.url===s;return a.jsx("button",{onClick:()=>$(ee),className:`w-full rounded-md border px-2.5 py-2 text-left text-sm transition-colors ${ye?"theme-nav-link-active":"theme-nav-link"}`,"aria-current":ye?"page":void 0,children:ee.title},`${ee.url}-${P}`)};return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"theme-surface theme-border rounded-xl border p-3 lg:sticky lg:top-4",children:[a.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[a.jsx("h3",{className:"theme-text-secondary text-xs font-semibold uppercase tracking-[0.18em]",children:"Browse"}),a.jsxs("span",{className:"theme-text-muted text-[11px]",children:[r.length+n.reduce((ee,P)=>ee+P.links.length,0)," options"]})]}),a.jsxs("div",{className:"space-y-2.5",children:[U&&a.jsxs("div",{className:"theme-border overflow-hidden rounded-lg border",children:[a.jsxs("button",{onClick:()=>f(!u),className:"theme-surface-muted theme-hover-surface flex w-full items-center justify-between px-3 py-2 text-left transition-colors",children:[a.jsx("span",{className:"theme-text-secondary text-xs font-medium uppercase tracking-[0.14em]",children:"Navigation"}),a.jsx("svg",{className:`theme-text-muted h-4 w-4 transition-transform ${u?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&a.jsxs("div",{className:"theme-surface space-y-2 p-2",children:[ie&&a.jsx("input",{type:"search",value:b,onChange:ee=>k(ee.target.value),placeholder:`Filter ${r.length} links`,className:"theme-input w-full rounded-md border px-2.5 py-2 text-sm focus:border-sky-500/50 focus:outline-none","aria-label":"Filter navigation links"}),H.length>0?a.jsxs(a.Fragment,{children:[a.jsx("nav",{className:"space-y-1.5",children:C.map((ee,P)=>re(ee,P,o))}),r.length>W&&a.jsxs("div",{className:"flex flex-wrap gap-2 pt-1",children:[Q>0&&a.jsxs("button",{onClick:()=>y(!0),className:"theme-button-neutral theme-hover-surface rounded-md border px-2.5 py-1.5 text-xs font-medium transition-colors",children:["Show ",Math.min(Q,D-I)," more"]}),x&&H.length>I&&a.jsx("button",{onClick:()=>y(!1),className:"theme-button-neutral theme-hover-surface rounded-md border px-2.5 py-1.5 text-xs font-medium transition-colors",children:"Show less"}),B&&a.jsxs("button",{ref:A,onClick:J,className:"theme-nav-link rounded-md border px-2.5 py-1.5 text-xs font-medium transition-colors",children:["View all (",H.length,")"]})]})]}):a.jsx("p",{className:"theme-surface-elevated theme-text-muted rounded-md px-2.5 py-3 text-sm",children:"No navigation links match that filter."})]})]}),V&&a.jsxs("div",{className:"theme-border overflow-hidden rounded-lg border",children:[a.jsxs("button",{onClick:()=>h(!p),className:"theme-surface-muted theme-hover-surface flex w-full items-center justify-between px-3 py-2 text-left transition-colors",children:[a.jsx("span",{className:"theme-text-secondary text-xs font-medium uppercase tracking-[0.14em]",children:"Facets"}),a.jsx("svg",{className:`theme-text-muted h-4 w-4 transition-transform ${p?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p&&a.jsx("div",{className:"theme-surface space-y-3 p-2",children:n.filter(ee=>ee.links.length>0).map((ee,P)=>a.jsxs("div",{children:[a.jsx("p",{className:"theme-text-muted px-1.5 pb-1 text-[11px] font-medium uppercase tracking-[0.14em]",children:ee.title}),a.jsx("nav",{className:"space-y-1.5",children:ee.links.map(($,ye)=>a.jsxs("button",{onClick:()=>c($),className:`flex w-full items-center justify-between gap-3 rounded-md border px-2.5 py-2 text-left text-sm transition-colors ${$.isActive?"border-emerald-500/40 bg-emerald-500/12 text-emerald-100":"theme-button-neutral border-transparent"}`,children:[a.jsx("span",{className:"truncate",children:$.title}),typeof $.count=="number"&&a.jsx("span",{className:"theme-surface-elevated theme-text-muted rounded-full px-2 py-0.5 text-[11px]",children:$.count})]},`${$.url}-${ye}`))})]},`${ee.title}-${P}`))})]})]})]}),S&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:()=>g(!1),role:"dialog","aria-modal":"true","aria-label":"All navigation links",children:a.jsxs("div",{ref:T,className:"theme-surface-elevated theme-border theme-text-primary flex max-h-[85vh] w-full max-w-2xl flex-col overflow-hidden rounded-xl border shadow-xl",onClick:ee=>ee.stopPropagation(),children:[a.jsxs("div",{className:"theme-divider flex items-center justify-between border-b px-4 py-3",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"theme-text-primary text-sm font-semibold",children:"All Navigation Links"}),a.jsxs("p",{className:"theme-text-muted text-xs",children:[r.length," total links"]})]}),a.jsx("button",{onClick:()=>g(!1),className:"theme-text-muted theme-hover-surface rounded-full p-2 transition-colors hover:text-sky-300","aria-label":"Close navigation browser",children:a.jsx(tr,{className:"h-5 w-5"})})]}),a.jsx("div",{className:"theme-divider border-b px-4 py-3",children:a.jsx("input",{ref:L,type:"search",value:w,onChange:ee=>N(ee.target.value),placeholder:`Search ${r.length} links`,className:"theme-input w-full rounded-md border px-3 py-2 text-sm focus:border-sky-500/50 focus:outline-none","aria-label":"Search all navigation links"})}),a.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3",children:ae.length>0?a.jsx("nav",{className:"space-y-1.5",children:ae.map((ee,P)=>re(ee,P,te))}):a.jsx("p",{className:"theme-surface theme-text-muted rounded-md px-3 py-4 text-sm",children:"No navigation links match that search."})})]})})]})},Z0=r=>{try{const s=new URL(r).hostname.toLowerCase();return s==="biblioboard.com"||s.endsWith(".biblioboard.com")}catch{return!1}},Pc=mt.forwardRef(({book:r,onClick:s,onContextMenu:n,className:o="",isFocused:c=!1},l)=>{const u=()=>s(r),f=A=>{n&&(A.preventDefault(),n(r,A))},p=A=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),s(r))},h=A=>"downloadUrl"in A,k="coverImage"in r&&r.coverImage?r.coverImage:"cover"in r&&r.cover?r.cover:null,x=h(r)&&r.coverImage?qt(r.coverImage):null,y=h(r)&&r.coverImage&&Z0(r.coverImage)?x:k,[S,g]=R.useState(y);R.useEffect(()=>{g(y)},[y]);const w=h(r)?r.contributors??[]:[],N=h(r)?(r.categories??[]).map(A=>A.label||A.term).filter(Boolean):[];return a.jsxs("div",{ref:l,onClick:u,onContextMenu:f,onKeyDown:p,tabIndex:0,"aria-label":`${r.title} by ${r.author}`,className:`cursor-pointer group relative focus:outline-none ${c?"ring-2 ring-sky-500 ring-offset-2 theme-ring-offset":""} ${o}`,children:[a.jsx("div",{className:"theme-surface-elevated book-cover-container aspect-[2/3] overflow-hidden rounded-lg shadow-lg transform transition-transform duration-300 group-hover:scale-105",children:S?a.jsx("img",{src:S,alt:r.title,className:"w-full h-full object-cover",loading:"lazy",onError:()=>{if(x&&S!==x){g(x);return}g("/default-cover.png")}}):a.jsx("div",{className:"theme-text-muted flex h-full w-full items-center justify-center p-4 text-center",children:a.jsx("span",{className:"font-semibold",children:r.title})})}),a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsx("h3",{className:"theme-text-primary truncate text-sm font-semibold group-hover:text-sky-400",children:r.title}),a.jsx("p",{className:"theme-text-secondary truncate text-xs",children:r.author}),w.length>0&&a.jsxs("p",{className:"theme-text-secondary truncate text-[11px]",title:w.join(", "),children:["Contributors: ",w.slice(0,2).join(", ")]}),N.length>0&&a.jsxs("p",{className:"theme-text-muted truncate text-[11px]",title:N.join(", "),children:["Categories: ",N.slice(0,2).join(", ")]}),a.jsx(Xh,{book:r})]})]})});Pc.displayName="BookCard";const Y0=r=>{const s=r.match(/^(.*?)(?:\s*\((\d+)\))\s*$/);if(!s)return{displayTitle:r,itemCount:null};const n=s[1]?.trim()||r,o=Number.parseInt(s[2],10);return{displayTitle:n,itemCount:Number.isFinite(o)?o:null}},J0=({laneTitle:r,laneLink:s,books:n,isLoading:o=!1,error:c,hasFetched:l=!1,hasChildNavigation:u=!1,onRequestPreview:f,onOpenLane:p,onBookClick:h})=>{const b=R.useRef(null),k=R.useRef(null),x=N=>{k.current&&k.current.scrollBy({left:N,behavior:"smooth"})},{displayTitle:y,itemCount:S}=Y0(r),g=n.length>0?o?"Refreshing preview":`${n.length} preview titles`:o?"Loading preview":c?"Preview unavailable":l?u?"Nested groups inside":"Open collection":"Preview loads on scroll",w=S===null?null:`${S} items`;return R.useEffect(()=>{if(l||o||!f)return;if(typeof window>"u"||typeof window.IntersectionObserver>"u"){f(s);return}const N=b.current;if(!N)return;const A=window.innerHeight||document.documentElement?.clientHeight||0,L=N.getBoundingClientRect();if(L.top<=A+240&&L.bottom>=-240){f(s);return}const I=new window.IntersectionObserver(D=>{D.some(W=>W.isIntersecting)&&(f(s),I.disconnect())},{rootMargin:"240px 0px"});return I.observe(N),()=>I.disconnect()},[l,o,s,f]),a.jsxs("section",{ref:b,className:"theme-surface theme-border mb-6 rounded-2xl border p-4",children:[a.jsxs("div",{className:"mb-4 flex items-center justify-between gap-4",children:[a.jsxs("button",{type:"button",onClick:()=>p(s),className:"theme-text-primary min-w-0 text-left transition-colors hover:text-sky-300","aria-label":`Open ${y}`,children:[a.jsx("span",{className:"block truncate text-lg font-semibold sm:text-xl",children:y}),a.jsxs("span",{className:"mt-1 inline-flex items-center gap-1 text-xs uppercase tracking-[0.14em]",children:[w&&a.jsx("span",{className:"theme-text-muted",children:w}),w&&a.jsx("span",{className:"theme-text-muted",children:""}),a.jsx("span",{className:"theme-text-muted",children:g}),a.jsxs("span",{className:"theme-accent-text-emphasis inline-flex items-center gap-1 font-medium normal-case tracking-normal",children:["Open lane",a.jsx(kc,{className:"h-3.5 w-3.5"})]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:()=>x(-320),className:"theme-button-neutral theme-hover-surface rounded-full border p-2","aria-label":`Scroll ${r} left`,children:a.jsx(Rs,{className:"h-4 w-4"})}),a.jsx("button",{type:"button",onClick:()=>x(320),className:"theme-button-neutral theme-hover-surface rounded-full border p-2","aria-label":`Scroll ${r} right`,children:a.jsx(Go,{className:"h-4 w-4"})})]})]}),c?a.jsx("div",{className:"theme-surface-muted theme-border theme-text-muted rounded-xl border px-4 py-6 text-sm",children:c}):n.length>0?a.jsx("div",{ref:k,className:"flex gap-4 overflow-x-auto pb-2","aria-label":`${r} titles`,children:n.map((N,A)=>a.jsx(Pc,{book:N,onClick:L=>h(L),className:"w-36 flex-shrink-0"},`${s.url}-${N.providerId||N.downloadUrl}-${A}`))}):o?a.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2","aria-label":`${r} loading`,children:Array.from({length:4}).map((N,A)=>a.jsxs("div",{className:"theme-surface-muted theme-border w-36 flex-shrink-0 rounded-xl border",children:[a.jsx("div",{className:"aspect-[2/3] animate-pulse rounded-t-xl bg-slate-300/20"}),a.jsxs("div",{className:"space-y-2 p-3",children:[a.jsx("div",{className:"h-3 w-3/4 animate-pulse rounded bg-slate-300/20"}),a.jsx("div",{className:"h-3 w-1/2 animate-pulse rounded bg-slate-300/20"})]})]},`${r}-loading-${A}`))}):l?a.jsx("div",{className:"theme-surface-muted theme-border theme-text-muted rounded-xl border px-4 py-6 text-sm",children:u?"This lane opens to nested groups. Open it to browse the next level.":"No preview titles were available for this lane yet. Open it to browse more."}):a.jsx("div",{className:"theme-surface-muted theme-border theme-text-muted rounded-xl border px-4 py-6 text-sm",children:"Preview titles will load when this lane scrolls into view."})]})},ew=5,tw=1,rw="application/atom+xml;profile=opds-catalog, application/opds+json;q=0.9, application/xml, text/xml, application/json;q=0.8, */*;q=0.5",lh={},nw=r=>{try{const s=new URL(r).hostname.toLowerCase();return s.endsWith("palace.io")||s.endsWith("palaceproject.io")||s.endsWith("thepalaceproject.org")||s==="palace.io"||s.endsWith(".palace.io")||s.endsWith(".thepalaceproject.org")}catch{return!1}},sw=r=>{if(typeof window>"u")return!1;try{return new URL(r).origin!==window.location.origin&&qt(r)===r}catch{return!1}},ch=r=>!!(r&&(r.books.length>0||r.hasChildNavigation)),iw=r=>new Promise(s=>{setTimeout(s,r)});function ow({enabled:r,links:s,baseUrl:n,requestedUrls:o,maxPreviewBooks:c=ew}){const[l,u]=R.useState({}),f=R.useRef({}),p=R.useMemo(()=>s.filter(y=>!!(y?.url&&y?.title)),[s]),h=R.useMemo(()=>new Set(o),[o]);R.useEffect(()=>{f.current=l},[l]),R.useEffect(()=>{!r||p.length===0||u(y=>{let S=!1;const g={...y};return p.forEach(w=>{const N=lh[w.url],A=y[w.url]||(N?{...N,link:w,isLoading:!1}:{link:w,books:[],isLoading:!1,hasFetched:!1});if(!y[w.url]){g[w.url]=A,S=!0;return}y[w.url].link!==w&&(g[w.url]={...y[w.url],link:w},S=!0)}),S?g:y})},[r,p]),R.useEffect(()=>{let y=!1;if(!r||h.size===0)return()=>{y=!0};const S=p.filter(g=>{if(!h.has(g.url))return!1;const w=f.current[g.url];return w?w.isLoading?!1:w.hasFetched?!ch(w):!0:!0});return S.length===0?()=>{y=!0}:(u(g=>{const w={...g};return S.forEach(N=>{w[N.url]={...w[N.url]||{link:N,books:[],hasFetched:!1},link:N,isLoading:!0,error:void 0}}),w}),(async()=>{const g=[];let w=0;const N=async T=>{const I=nw(T.url),D=I?qt(T.url):T.url;if(I&&sw(T.url))return{link:T,books:[],isLoading:!1,error:"Preview unavailable: Palace lane previews need a configured CORS proxy for this feed.",hasFetched:!0};if(I&&D!==T.url)try{const F=async()=>fetch(D,{method:"GET",mode:"cors",credentials:"omit",headers:{Accept:rw}});let U;try{U=await F()}catch{await iw(400),U=await F()}if(!U.ok)return{link:T,books:[],isLoading:!1,error:`Preview unavailable: proxy request failed (${U.status}).`,hasFetched:!0};const V=await U.text(),ie=await uc.parseOPDS(V,T.url);return ie.success?{link:T,books:ie.data.books.slice(0,c),isLoading:!1,hasFetched:!0,hasChildNavigation:ie.data.navigationLinks.length>0}:{link:T,books:[],isLoading:!1,error:ie.error,hasFetched:!0}}catch(F){return{link:T,books:[],isLoading:!1,error:F instanceof Error?F.message:"Preview unavailable.",hasFetched:!0}}const W=await uc.fetchCatalog(T.url,n,"1");return W.success?{link:T,books:W.data.books.slice(0,c),isLoading:!1,hasFetched:!0,hasChildNavigation:W.data.navigationLinks.length>0}:{link:T,books:[],isLoading:!1,error:W.error,hasFetched:!0}},A=async()=>{for(;;){const T=w;if(w+=1,T>=S.length)return;g[T]=await N(S[T])}},L=Math.min(tw,S.length);await Promise.all(Array.from({length:L},()=>A())),!y&&u(T=>{const I={...T};return g.forEach(D=>{const W=I[D.link.url];if(W&&W.books.length>0&&D.books.length===0){I[D.link.url]={...W,isLoading:!1,error:void 0,hasFetched:!0};return}I[D.link.url]=D,ch(D)&&(lh[D.link.url]={...D,isLoading:!1})}),I})})(),()=>{y=!0})},[n,r,c,p,h]);const b=R.useMemo(()=>p.map(y=>l[y.url]||{link:y,books:[],isLoading:!1,hasFetched:!1}),[l,p]),k=r&&b.some(y=>y.isLoading),x=b.some(y=>y.books.length>0);return{lanePreviews:b,isLoading:k,hasAnyBooks:x}}const Sp=({message:r,title:s,variant:n="page",severity:o="error",onRetry:c,onDismiss:l,className:u=""})=>{const p=(()=>{switch(o){case"error":return{bg:"theme-danger",border:"",text:"theme-text-danger",icon:"theme-text-danger",button:"bg-red-600 hover:bg-red-700"};case"warning":return{bg:"theme-warning",border:"",text:"theme-text-warning",icon:"theme-text-warning",button:"bg-yellow-600 hover:bg-yellow-700"};case"info":return{bg:"theme-info",border:"",text:"theme-text-info",icon:"theme-text-info",button:"bg-blue-600 hover:bg-blue-700"}}})(),h=()=>{switch(o){case"error":return a.jsx("svg",{className:`w-6 h-6 ${p.icon}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"warning":return a.jsx("svg",{className:`w-6 h-6 ${p.icon}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})});case"info":return a.jsx("svg",{className:`w-6 h-6 ${p.icon}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}};return n==="inline"?a.jsxs("div",{className:`flex items-center gap-2 rounded border p-2 ${p.bg} ${u}`,children:[h(),a.jsx("span",{className:`text-sm ${p.text}`,children:r}),l&&a.jsx("button",{onClick:l,className:"theme-text-muted ml-auto hover:text-sky-400","aria-label":"Dismiss",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):n==="card"?a.jsx("div",{className:`rounded-lg p-6 ${p.bg} ${p.border} border ${u}`,children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:h()}),a.jsxs("div",{className:"flex-1 min-w-0",children:[s&&a.jsx("h3",{className:`text-lg font-semibold mb-2 ${p.text}`,children:s}),a.jsx("p",{className:"theme-text-secondary text-sm",children:r}),(c||l)&&a.jsxs("div",{className:"flex gap-3 mt-4",children:[c&&a.jsx("button",{onClick:c,className:`px-4 py-2 rounded-lg text-white font-medium transition-colors ${p.button}`,children:"Try Again"}),l&&a.jsx("button",{onClick:l,className:"theme-button-neutral theme-hover-surface rounded-lg px-4 py-2 font-medium transition-colors",children:"Dismiss"})]})]}),l&&a.jsx("button",{onClick:l,className:"theme-text-muted shrink-0 hover:text-sky-400","aria-label":"Close",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}):a.jsx("div",{className:`text-center py-20 ${p.bg} rounded-lg ${u}`,children:a.jsxs("div",{className:"flex flex-col items-center max-w-md mx-auto",children:[a.jsx("div",{className:"mb-4",children:h()}),a.jsx("h2",{className:`text-2xl font-semibold mb-2 ${p.text}`,children:s||"Something Went Wrong"}),a.jsx("p",{className:"theme-text-secondary mb-6",children:r}),(c||l)&&a.jsxs("div",{className:"flex gap-3",children:[c&&a.jsx("button",{onClick:c,className:`px-6 py-3 rounded-lg text-white font-bold transition-colors ${p.button}`,children:"Try Again"}),l&&a.jsx("button",{onClick:l,className:"theme-button-neutral theme-hover-surface rounded-lg px-6 py-3 font-bold transition-colors",children:"Dismiss"})]})]})})},Np=({variant:r="spinner",size:s="medium",message:n,className:o=""})=>{if(r==="spinner"){const c=s==="large"?"medium":s;return a.jsx("div",{className:`flex justify-center items-center ${o}`,children:a.jsx(Rn,{text:n,size:c})})}if(r==="inline"){const c={small:"w-4 h-4",medium:"w-5 h-5",large:"w-6 h-6"};return a.jsxs("div",{className:`inline-flex items-center gap-2 ${o}`,children:[a.jsxs("svg",{className:`animate-spin ${c[s]} text-sky-400`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n&&a.jsx("span",{className:"text-sm text-slate-300 theme-text-secondary",children:n})]})}if(r==="skeleton")return a.jsx("div",{className:`animate-pulse ${o}`,children:a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:Array.from({length:12}).map((c,l)=>a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"aspect-[2/3] bg-slate-700 rounded-lg theme-surface-elevated"}),a.jsx("div",{className:"h-4 bg-slate-700 rounded w-3/4 theme-surface-elevated"}),a.jsx("div",{className:"h-3 bg-slate-700 rounded w-1/2 theme-surface-elevated"})]},l))})});if(r==="page"){const c=s==="large"?"medium":s;return a.jsx("div",{className:`fixed inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center z-50 ${o}`,children:a.jsx("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl text-center max-w-sm w-full border theme-surface-elevated theme-border theme-text-primary",children:a.jsx(Rn,{text:n,size:c})})})}return null},Cp=({books:r,isLoading:s=!1,onBookClick:n,onBookContextMenu:o,className:c=""})=>{const[l,u]=R.useState(-1),f=R.useRef(null),p=R.useRef(new Map),h=R.useCallback(()=>{if(typeof window>"u")return 4;const A=window.innerWidth;return A>=1280?6:A>=1024?5:A>=768?4:A>=640?3:2},[]),[b,k]=R.useState(h);R.useEffect(()=>{const A=()=>k(h());return window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[h]);const x=R.useCallback(A=>{r.length!==0&&u(L=>{let T=L;if(L===-1)T=0;else switch(A){case"left":T=L>0?L-1:L;break;case"right":T=L<r.length-1?L+1:L;break;case"up":T=L-b,T<0&&(T=L);break;case"down":T=L+b,T>=r.length&&(T=L);break}const I=p.current.get(T);return I&&(I.focus(),I.scrollIntoView({behavior:"smooth",block:"nearest"})),T})},[r.length,b]),y=R.useCallback(()=>{l>=0&&l<r.length&&n(r[l])},[l,r,n]),[S,g]=R.useState(!1);x0({enableArrowKeys:S&&r.length>0,enableActivation:S&&r.length>0,onArrowKey:x,onActivate:y,preventDefault:!0});const w=R.useCallback(()=>{if(g(!0),l===-1&&r.length>0){u(0);const A=p.current.get(0);A&&A.focus()}},[l,r.length]),N=R.useCallback(A=>{f.current?.contains(A.relatedTarget)||g(!1)},[]);return s?a.jsx("div",{className:"flex justify-center mt-20 theme-text-secondary",children:a.jsx(Rn,{})}):a.jsx("div",{ref:f,className:`grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6 theme-text-primary ${c}`,onFocus:w,onBlur:N,"aria-label":"Book collection",children:r.map((A,L)=>{const T="id"in A&&A.id?`book-${A.id}`:`catalog-${"downloadUrl"in A?A.downloadUrl:A.title}-${L}`;return a.jsx(Pc,{book:A,onClick:n,onContextMenu:o,isFocused:L===l,ref:I=>{I?p.current.set(L,I):p.current.delete(L)}},T)})})},jp=({variant:r,title:s,message:n,error:o})=>{const l=(()=>{switch(r){case"library":return{title:"Your library is empty.",message:"Import your first book or add a catalog to get started!",textColor:"theme-text-primary"};case"catalog":return{title:"Empty Section",message:"No categories or books were found here.",textColor:"theme-text-primary"};case"error":return{title:"Error Loading Source",message:o||"An unexpected error occurred.",textColor:"text-red-500"};default:return{title:"No Content",message:"Nothing to display here.",textColor:"theme-text-primary"}}})(),u=s||l.title,f=n||l.message,p=l.textColor;return a.jsxs("div",{className:"theme-surface-elevated theme-text-primary rounded-lg py-20 text-center",children:[a.jsx("h2",{className:`text-2xl font-semibold ${p}`,children:u}),a.jsx("p",{className:"theme-text-secondary mx-auto mt-2 max-w-xl",children:f})]})},aw=r=>{try{const s=new URL(r).hostname.toLowerCase();return s.endsWith("palace.io")||s.endsWith("palaceproject.io")||s.endsWith("thepalaceproject.org")||s==="palace.io"||s.endsWith(".palace.io")||s.endsWith(".thepalaceproject.org")}catch{return!1}},lw=({activeOpdsSource:r,catalogNavPath:s,setCatalogNavPath:n,onShowBookDetail:o})=>{const[c,l]=R.useState("all"),[u,f]=R.useState("all"),[p,h]=R.useState("all"),[b,k]=R.useState("all"),[x,y]=R.useState("all"),[S,g]=R.useState("all"),[w,N]=R.useState([]),[A,L]=R.useState([]),[T,I]=R.useState(""),[D,W]=R.useState({}),[F,U]=R.useState(null),[V,ie]=R.useState(null),[B,H]=R.useState(null),[C,Q]=R.useState(null),[ae,J]=R.useState(!1),[te,re]=R.useState(!1),[ee,P]=R.useState([]),$=s.length>0?s[s.length-1].url:r?.url||null,ye=r&&"opdsVersion"in r&&r.opdsVersion||"auto";R.useEffect(()=>{N([])},[$,r?.id]),R.useEffect(()=>{L([])},[r?.id]);const{data:fe,isLoading:oe,error:be,refetch:Se}=m0($,r?.url||"",ye,!!r),ke=fe?.books||[],_e=fe?.navigationLinks||[],De=fe?.facetGroups||[],Ve=fe?.pagination||null,et=fe?.search||null;R.useEffect(()=>{H(null),I(""),W({}),U(null),ie(null),Q(null)},[r?.id]),R.useEffect(()=>{et&&H(et)},[et]);const{data:Ke,isLoading:j,error:he}=v0(B,!!B),de=R.useMemo(()=>{if(!Ve)return null;const Te=Ve.prev||(A.length>0?A[A.length-1]:void 0);return{...Ve,prev:Te}},[Ve,A]),{availableAudiences:q,availableFictionModes:z,availableMediaModes:Z,availablePublicationTypes:ce,availableAvailabilityModes:ue,availableDistributors:X}=R.useMemo(()=>({availableAudiences:Ix(ke),availableFictionModes:Dx(ke),availableMediaModes:Mx(ke),availablePublicationTypes:$x(ke),availableAvailabilityModes:Vx(ke),availableDistributors:Hx(ke)}),[ke]);R.useEffect(()=>{if(ke.length===0)return;const Te=Ox(ke,c),Be=Fx(Te,u),Ge=Bx(Be,p),bt=zx(Ge,b),ar=Wx(bt,x),Rt=qx(ar,S);N(Rt)},[c,u,p,b,x,S,ke]);const _=()=>{l("all"),f("all"),h("all"),k("all"),y("all"),g("all")},E=Te=>{n(s.slice(0,Te+1)),_(),L([])},M=Te=>{n(Be=>{if(Be.length===0)return Be;const Ge=[...Be];return Ge[Ge.length-1]={...Ge[Ge.length-1],url:Te},Ge}),L(Be=>{try{if(!$)return Be;const Ge=Be[Be.length-1];return Ge&&Ge===Te?Be.slice(0,-1):[...Be,$]}catch{return Be}})},K=Te=>{o(Te,"catalog",r.name)},ge=()=>{const Te=T.trim(),Be=Ke?.activeTemplate;if(!Te||!Be)return;const Ge=Be.params||[],bt=Ge.find(Lt=>Lt.name==="searchTerms")?.name||Ge.find(Lt=>Lt.name==="query")?.name||Ge.find(Lt=>Lt.required)?.name||Ge[0]?.name||"searchTerms",ar=Ge.reduce((Lt,Ln)=>{if(Ln.name===bt)return Lt;const nn=D[Ln.name]?.trim();return nn&&(Lt[Ln.name]=nn),Lt},{[bt]:Te});let Rt;try{Rt=nx(Be,ar)}catch(Lt){Q(Lt instanceof Error?Lt.message:"Unable to build search URL.");return}const Pt=F&&V?V:s.length>0?s:[{name:r.name,url:r.url}],Dr=[...Pt,{name:`Search: ${Te}`,url:Rt}];ie(Pt),U(Te),Q(null),n(Dr),L([])},je=()=>{n(V||s.slice(0,Math.max(s.length-1,0))),U(null),ie(null),I(""),W({}),Q(null),L([])},we=(Te,Be)=>{W(Ge=>({...Ge,[Te]:Be}))},ve=Te=>{n(Be=>{const Ge=(Te.rel||"").toLowerCase(),bt=Be.length>0?Be:[{name:r.name,url:r.url}],ar=bt.findIndex(Rt=>Rt.url===Te.url);if(ar>=0)return bt.slice(0,ar+1);if(Ge.includes("start"))return[{name:r.name,url:r.url}];if(Ge==="up"||Ge.endsWith("/up")){if(bt.length>1){const Rt=[...bt];return Rt[Rt.length-1]={name:Te.title,url:Te.url},Rt}return[{name:r.name,url:Te.url}]}return[...bt,{name:Te.title,url:Te.url}]}),_(),L([])},Le=Te=>{n(Be=>{if(Be.length===0)return[{name:Te.title,url:Te.url}];const Ge=[...Be];return Ge[Ge.length-1]={...Ge[Ge.length-1],name:Te.title,url:Te.url},Ge}),_(),L([])},Ae=R.useMemo(()=>De.map(Te=>({...Te,links:Te.links.map(Be=>({...Be,isActive:Be.isActive??Be.url===$}))})),[$,De]),Pe=R.useMemo(()=>{if(!$)return _e;const Te=_e.filter(Be=>Be.url!==$);return Te.length>0?Te:_e},[$,_e]),qe=R.useMemo(()=>Ae.flatMap(Te=>Te.links.map(Be=>({title:Be.title,url:Be.url,rel:Be.rel||"facet",type:Be.type,source:"compat",isCatalog:!1}))),[Ae]),st=R.useMemo(()=>(()=>{const Te=Pe.filter(Ge=>{const bt=(Ge.rel||"").toLowerCase();return!Ge.url||!Ge.title?!1:!(bt.includes("start")||bt==="up"||bt.endsWith("/up"))});if(Te.length>0)return Te;const Be=new Set;return qe.filter(Ge=>!Ge.url||!Ge.title||Be.has(Ge.url)?!1:(Be.add(Ge.url),!0))})(),[Pe,qe]),He=Ke?.activeTemplate?.params||[],nt=He.find(Te=>Te.name==="searchTerms")||He.find(Te=>Te.name==="query")||He.find(Te=>Te.required)||He[0]||null,Je=He.filter(Te=>Te.name!==nt?.name),it=nt?.name==="query"?"Search query":"Search this catalog",ft=nt?.name==="query"?"Enter search keywords":"Search this catalog",ht=+(c!=="all")+ +(u!=="all")+ +(p!=="all")+ +(b!=="all")+ +(x!=="all")+ +(S!=="all"),Tt=!!B,Ht=q.length>1||z.length>1||Z.length>1||ce.length>1||ue.length>1||X.length>1,or=aw(r?.url||"")&&st.length>0&&!F;R.useEffect(()=>{if(!or){P([]);return}P(Te=>{const Be=st.slice(0,2).map(bt=>bt.url),Ge=new Set([...Be,...Te.filter(bt=>st.some(ar=>ar.url===bt))]);return Array.from(Ge)})},[st,or]);const{lanePreviews:qr,isLoading:xr,hasAnyBooks:It}=ow({enabled:or,links:st,baseUrl:r?.url||"",requestedUrls:ee}),Ir=Pe.length>0||Ae.some(Te=>Te.links.length>0);if(R.useEffect(()=>{if(!or||xr)return;const Te=st.find(Be=>!ee.includes(Be.url));Te&&P(Be=>Be.includes(Te.url)?Be:[...Be,Te.url])},[xr,st,ee,or]),R.useEffect(()=>{(F||C||he)&&J(!0)},[F,C,he]),R.useEffect(()=>{ht>0&&re(!0)},[ht]),oe)return a.jsx(Np,{variant:"spinner",message:"Loading catalog..."});if(be)return a.jsx(Sp,{variant:"page",title:"Failed to Load Catalog",message:be?.message||"Could not load catalog content.",onRetry:()=>Se()});const Pn=w.length>0,Er=ke.length>0,Hr=or&&(qr.length>0||xr||It),rr=!Er&&!Ir&&!Hr,Fr=Te=>{P(Be=>{const Ge=st.findIndex(Pt=>Pt.url===Te.url);if(Ge===-1)return Be.includes(Te.url)?Be:[...Be,Te.url];const bt=st.slice(0,Ge+1).map(Pt=>Pt.url),ar=Be.filter(Pt=>st.some(Dr=>Dr.url===Pt)),Rt=Array.from(new Set([...bt,...ar]));return Rt.length===Be.length&&Rt.every((Pt,Dr)=>Be[Dr]===Pt)?Be:Rt})},Gr=Te=>{if(Te.source==="compat"){const Be=Ae.flatMap(Ge=>Ge.links).find(Ge=>Ge.url===Te.url&&Ge.title===Te.title);if(Be){Le(Be);return}}ve(Te)};return a.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[Ir&&a.jsx("aside",{className:"order-2 w-full lg:order-1 lg:w-56 lg:flex-shrink-0",children:a.jsx(X0,{navigationLinks:Pe,currentNavigationUrl:$,facetGroups:Ae,onNavigationSelect:ve,onFacetSelect:Le,isLoading:oe})}),a.jsxs("main",{className:"flex-1 min-w-0 order-1 lg:order-2",children:[a.jsx(K0,{navPath:s,pagination:de??Ve,onBreadcrumbClick:E,onPaginationClick:M,isLoading:oe,actions:a.jsxs(a.Fragment,{children:[Tt&&a.jsxs("button",{type:"button",onClick:()=>J(Te=>!Te),className:`theme-button-neutral theme-hover-surface inline-flex items-center gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs font-medium transition-colors ${ae?"theme-nav-link-active":""}`,"aria-label":ae?"Hide catalog search":"Open catalog search",title:"Catalog search",children:[a.jsx(Sc,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Search"})]}),Ht&&a.jsxs("button",{type:"button",onClick:()=>re(Te=>!Te),className:`theme-button-neutral theme-hover-surface inline-flex items-center gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs font-medium transition-colors ${te?"theme-nav-link-active":""}`,"aria-label":te?"Hide filters":"Open filters",title:ht>0?`${ht} active filters`:"Filters",children:[a.jsx(qh,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:ht>0?`Filters (${ht})`:"Filters"})]})]})}),B&&ae&&a.jsx(Q0,{value:T,onChange:I,primaryLabel:it,primaryPlaceholder:ft,advancedFields:Je,advancedValues:D,onAdvancedChange:we,onSubmit:ge,onClear:je,disabled:j||!Ke?.activeTemplate,isLoading:j,errorMessage:C||(he instanceof Error?he.message:null),hasActiveSearch:!!F}),te&&a.jsx(G0,{availableAudiences:q,availableFictionModes:z,availableMediaModes:Z,availablePublicationTypes:ce,availableAvailabilityModes:ue,availableDistributors:X,audienceMode:c,fictionMode:u,mediaMode:p,publicationMode:b,availabilityMode:x,distributorMode:S,onAudienceChange:l,onFictionChange:f,onMediaChange:h,onPublicationChange:k,onAvailabilityChange:y,onDistributorChange:g}),Hr?a.jsx("div",{children:qr.map(Te=>a.jsx(J0,{laneTitle:Te.link.title,laneLink:Te.link,books:Te.books,isLoading:Te.isLoading,error:Te.error,hasFetched:Te.hasFetched,hasChildNavigation:Te.hasChildNavigation,onRequestPreview:Fr,onOpenLane:Gr,onBookClick:K},Te.link.url))}):rr?a.jsx(jp,{variant:"catalog"}):Pn?a.jsx(Cp,{books:w,onBookClick:K,isLoading:oe}):Er?a.jsxs("div",{className:"theme-text-primary py-12 text-center",children:[a.jsx("p",{className:"theme-text-secondary mb-2 text-lg",children:"No books match your current filters"}),a.jsx("p",{className:"theme-text-muted text-sm",children:"Try adjusting the local filters to see more books"})]}):null]})]})},cw=({isLoading:r,onFileChange:s,onActivate:n,alwaysShowLabel:o=!1,className:c=""})=>{const l=R.useRef(null);return a.jsxs(a.Fragment,{children:[a.jsxs("label",{htmlFor:"epub-upload",onClick:n,className:`cursor-pointer bg-sky-500 hover:bg-sky-600 text-white font-bold p-2 sm:py-2 sm:px-4 rounded-lg inline-flex items-center transition-colors duration-200 ${r?"opacity-50 cursor-not-allowed":""} ${c}`,children:[a.jsx($h,{className:"w-5 h-5 sm:mr-2"}),a.jsx("span",{className:o?"inline":"hidden sm:inline",children:"Import Book"})]}),a.jsx("input",{ref:l,id:"epub-upload",type:"file",accept:".epub,.pdf",className:"hidden",onChange:s,disabled:r,"aria-label":"Upload EPUB or PDF file"})]})},uw=({onOpenBook:r,onShowBookDetail:s,onFileChange:n,importStatus:o,libraryRefreshFlag:c})=>{console.log("[LocalLibraryView] mounted. libraryRefreshFlag:",c);const[l,u]=R.useState(null),{data:f=[],isLoading:p,error:h,refetch:b}=u0();mt.useEffect(()=>{console.log("[LocalLibraryView] useEffect triggered by libraryRefreshFlag:",c),b()},[c,b]);const{mutate:k}=d0(),x=g=>{s(g,"library")},y=(g,w)=>{w.preventDefault(),u(g)},S=R.useCallback(()=>{l?.id&&k(l.id,{onSuccess:()=>{u(null)}})},[l,k]);return p?a.jsx(Np,{variant:"skeleton",message:"Loading library..."}):h?a.jsx(Sp,{variant:"page",title:"Failed to Load Library",message:h instanceof Error?h.message:"Could not load books from the library.",onRetry:()=>b()}):a.jsxs(a.Fragment,{children:[f.length>0?a.jsx(Cp,{books:f,onBookClick:x,onBookContextMenu:y}):a.jsx(jp,{variant:"library"}),a.jsx(A0,{isOpen:!!l,onClose:()=>u(null),onConfirm:S,bookTitle:l?.title||""})]})},dw=({onAutoBackupToDrive:r,onOpenBook:s,onShowBookDetail:n,processAndSaveBook:o,importStatus:c,setImportStatus:l,activeOpdsSource:u,setActiveOpdsSource:f,catalogNavPath:p,setCatalogNavPath:h,onOpenCloudSyncModal:b,onOpenLocalStorageModal:k,onShowAbout:x,libraryRefreshFlag:y,syncStatus:S})=>{const g=$o(),w=Jo(),{user:N,isLoggedIn:A,signIn:L,signOut:T,authStatus:I,isInitialized:D}=Rc(),{uiTheme:W,setUiTheme:F}=up(),{catalogs:U,registries:V,addCatalog:ie,deleteCatalog:B,updateCatalog:H,addRegistry:C,deleteRegistry:Q,updateRegistry:ae}=cp(),[J,te]=R.useState(!1),[re,ee]=R.useState(!1),[P,$]=R.useState(!1),[ye,fe]=R.useState(!1),[oe,be]=R.useState(null),[Se,ke]=R.useState(null),_e=R.useRef(null),De=R.useRef(null);R.useEffect(()=>{const ve=Le=>{_e.current&&!_e.current.contains(Le.target)&&te(!1),De.current&&!De.current.contains(Le.target)&&$(!1)};return document.addEventListener("mousedown",ve),()=>document.removeEventListener("mousedown",ve)},[]);const Ve=R.useCallback(ve=>{ve==="library"?(f(null),h([])):(f(ve),h([{name:ve.name,url:ve.url}])),te(!1)},[f,h]),et=R.useCallback((ve,Le,Ae="auto")=>{ie(ve,Le,Ae)},[ie]),Ke=R.useCallback(ve=>{B(ve),u?.id===ve&&Ve("library")},[B,u,Ve]),j=R.useCallback((ve,Le)=>{H(ve,{name:Le}),u?.id===ve&&(f(Ae=>Ae?{...Ae,name:Le}:null),h(Ae=>{if(Ae.length>0){const Pe=[...Ae];return Pe[0]={...Pe[0],name:Le},Pe}return Ae}))},[H,u,f,h]),he=R.useCallback((ve,Le)=>{C(ve,Le)},[C]),de=R.useCallback(ve=>{Q(ve),u?.id===ve&&Ve("library")},[Q,u,Ve]),q=R.useCallback((ve,Le)=>{ae(ve,{name:Le}),u?.id===ve&&f(Ae=>Ae?{...Ae,name:Le}:null)},[ae,u,f]),z=ve=>{console.log("[LibraryView] handleFileChange called",ve.target.files);const Le=ve.target.files;if(!Le||Le.length===0){console.log("[LibraryView] No file selected");return}const Ae=Le[0];if($(!1),console.log("[LibraryView] File selected:",Ae.name,Ae.type,Ae.size),Ae.size===0){console.error("[LibraryView] File size is 0 - file object is invalid!");const Je=/\.(epub|pdf)$/i.test(Ae.name)?'Unable to access file. If this file is stored in iCloud, right-click it in Finder and select "Download Now" to make it available locally, then try again.':"Unable to access file. Please try again.";l({isLoading:!1,message:"",error:Je}),ve.target.value="";return}const Pe=Ae.name;Ae.type;const qe=Pe.toLowerCase().endsWith(".pdf")?"PDF":"EPUB";console.log("[LibraryView] Creating blob from file...");const st=Ae.slice(0,Ae.size,Ae.type),He=new FileReader;console.log("[LibraryView] Starting FileReader.readAsArrayBuffer from blob..."),He.readAsArrayBuffer(st),l({isLoading:!0,message:"Reading file...",error:null}),He.onload=async nt=>{const Je=nt.target?.result;if(!Je){l({isLoading:!1,message:"",error:"Could not read file data."});return}console.log("[LibraryView] File read successfully, calling processAndSaveBook...",{fileName:Pe,size:Je.byteLength});try{const it=await o(Je,Pe,void 0,"file",void 0,void 0,qe);console.log("[LibraryView] processAndSaveBook result:",it),it.success?(console.log("[LibraryView] Invalidating books query cache..."),await g.invalidateQueries({queryKey:vi.all}),console.log("[LibraryView] Books query cache invalidated"),r(),l({isLoading:!1,message:"Import successful!",error:null}),setTimeout(()=>l({isLoading:!1,message:"",error:null}),2e3)):!it.success&&it.bookRecord&&it.existingBook&&(console.log("[LibraryView] Duplicate book detected"),be(it.bookRecord),ke(it.existingBook),l({isLoading:!1,message:"",error:null}))}catch(it){console.error("[LibraryView] Error during processAndSaveBook:",it),l({isLoading:!1,message:"",error:it.message||"Failed to import book"})}ve.target.value=""},He.onerror=nt=>{console.error("[LibraryView] FileReader error:",{error:He.error,errorName:He.error?.name,errorMessage:He.error?.message,event:nt}),l({isLoading:!1,message:"",error:`File read error: ${He.error?.message||"Unknown error"}`}),ve.target.value=""}},Z=R.useCallback(async()=>{if(!oe||!Se)return;l({isLoading:!0,message:"Replacing book...",error:null});const ve={...oe,id:Se.id};be(null),ke(null);try{await ut.saveBook(ve),u||await g.invalidateQueries({queryKey:vi.all}),l({isLoading:!1,message:"Import successful!",error:null}),setTimeout(()=>l({isLoading:!1,message:"",error:null}),2e3)}catch(Le){ne.error("Error replacing book:",Le),l({isLoading:!1,message:"",error:"Failed to replace the book in the library."})}},[u,oe,Se,g,l]),ce=R.useCallback(async()=>{if(!oe)return;l({isLoading:!0,message:"Saving new copy...",error:null});const ve={...oe};be(null),ke(null);try{await ut.saveBook(ve),u||await g.invalidateQueries({queryKey:vi.all}),l({isLoading:!1,message:"Import successful!",error:null}),setTimeout(()=>l({isLoading:!1,message:"",error:null}),2e3)}catch(Le){ne.error("Error adding duplicate book:",Le),l({isLoading:!1,message:"",error:"Failed to add the new copy to the library."})}},[u,oe,g,l]),ue=R.useCallback(()=>{be(null),ke(null),l({isLoading:!1,message:"",error:null})},[l]),X=u?u.name:"My Library",_=!!u,E=localStorage.getItem("ebook-reader-last-sync"),M=E?new Date(E).toLocaleString():"Never",K=S.state==="idle"?`Last synced ${M}`:S.message,ge=S.state==="error"?"theme-text-danger":S.state==="success"?"theme-text-success":S.state==="syncing"?"theme-text-info":"theme-text-muted",je=D&&I!=="initializing"&&I!=="not_configured",we=W.charAt(0).toUpperCase()+W.slice(1);return a.jsxs("div",{className:"container mx-auto p-4 md:p-8 theme-text-primary",children:[a.jsxs("header",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("img",{src:$0,alt:"MeBooks Logo",className:"w-10 h-10 flex-shrink-0"}),a.jsxs("div",{ref:_e,className:"relative",children:[a.jsxs("button",{onClick:()=>te(ve=>!ve),className:"theme-text-primary flex items-center gap-2 text-left","aria-label":"Select book source","aria-expanded":J?"true":"false","aria-haspopup":"true",children:[a.jsx("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:X}),a.jsx(uv,{className:`w-6 h-6 transition-transform flex-shrink-0 mt-1 md:mt-2 ${J?"rotate-180":""}`})]}),J&&a.jsx("div",{className:"theme-surface-elevated theme-border absolute top-full z-20 mt-2 w-72 rounded-lg border shadow-xl",children:a.jsxs("ul",{className:"theme-text-primary max-h-96 overflow-y-auto p-1",children:[a.jsx("li",{children:a.jsx("button",{onClick:()=>Ve("library"),className:`w-full rounded-md px-3 py-2 text-left text-sm ${_?"theme-hover-surface":"bg-sky-600"}`,children:"My Library"})}),(U.length>0||V.length>0)&&a.jsx("li",{className:"theme-divider my-1 border-t"}),U.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("li",{className:"theme-text-secondary px-3 pb-1 pt-2 text-xs font-semibold uppercase",children:"Catalogs"}),U.map(ve=>a.jsx("li",{children:a.jsx("button",{onClick:()=>Ve(ve),className:`w-full truncate rounded-md px-3 py-2 text-left text-sm ${_&&u?.id===ve.id?"bg-sky-600":"theme-hover-surface"}`,children:ve.name})},ve.id))]}),V.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("li",{className:"theme-text-secondary px-3 pb-1 pt-2 text-xs font-semibold uppercase",children:"Registries"}),V.map(ve=>a.jsx("li",{children:a.jsx("button",{onClick:()=>Ve(ve),className:`w-full truncate rounded-md px-3 py-2 text-left text-sm ${_&&u?.id===ve.id?"bg-sky-600":"theme-hover-surface"}`,children:ve.name})},ve.id))]})]})})]})]}),a.jsx("div",{className:"flex items-center gap-2 flex-shrink-0 self-end md:self-auto",children:a.jsxs("div",{ref:De,className:"relative",children:[a.jsx("button",{onClick:()=>$(ve=>!ve),className:"theme-surface theme-border theme-text-secondary h-[36px] w-[36px] cursor-pointer rounded-md p-2 inline-flex items-center justify-center transition-colors duration-200","aria-label":"Open main menu",children:a.jsx(bc,{className:"w-4 h-4"})}),P&&a.jsxs("div",{className:"theme-surface-elevated theme-border absolute top-full right-0 z-20 mt-2 w-64 overflow-hidden rounded-md shadow-xl backdrop-blur-sm",children:[a.jsxs("div",{className:"theme-surface-muted theme-divider px-3 py-2.5 border-b",children:[A&&N?a.jsxs("button",{onClick:async()=>{await w({title:"Sign Out",message:"Are you sure you want to sign out of Google Cloud Sync?",confirmLabel:"Sign Out",cancelLabel:"Stay Signed In",variant:"danger"})&&(T(),$(!1))},className:"theme-hover-surface flex w-full items-center gap-2.5 rounded-sm px-1 py-1 text-left transition-colors","aria-label":`Signed in as ${N.name}. Click to sign out`,children:[a.jsx("img",{src:N.picture,alt:`${N.name} profile`,className:"w-8 h-8 rounded-full object-cover",referrerPolicy:"no-referrer"}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"theme-text-primary truncate text-[13px] font-medium leading-tight",children:N.name}),a.jsx("p",{className:"theme-text-muted truncate text-[11px] leading-tight",children:N.email})]})]}):a.jsx("p",{className:"theme-text-secondary text-[12px] font-medium",children:"Browsing locally"}),a.jsx("p",{className:`mt-2 text-[11px] leading-tight ${ge}`,children:K})]}),a.jsxs("ul",{className:"theme-text-primary p-1.5",children:[!A&&a.jsx("li",{children:a.jsx("button",{onClick:()=>{L(),$(!1)},disabled:!je,className:"theme-text-secondary theme-hover-surface block w-full rounded-sm px-2.5 py-2 text-left text-[13px] font-medium disabled:cursor-not-allowed disabled:opacity-60",children:"Log In"})}),!A&&a.jsx("li",{className:"theme-divider my-1 border-t"}),!_&&a.jsx("li",{children:a.jsx(cw,{isLoading:c.isLoading,onFileChange:z,alwaysShowLabel:!0,className:"theme-text-primary theme-hover-surface w-full justify-start rounded-sm border-0 bg-transparent px-2.5 py-2 text-[13px] font-medium"})}),!_&&a.jsx("li",{className:"theme-divider my-1 border-t"}),a.jsx("li",{children:a.jsx("button",{onClick:()=>{ee(!0),$(!1)},className:"theme-text-secondary theme-hover-surface block w-full rounded-sm px-2.5 py-2 text-left text-[13px]",children:"Manage Sources"})}),a.jsx("li",{className:"theme-divider my-1 border-t"}),a.jsx("li",{children:a.jsx("button",{onClick:()=>{fe(!0),$(!1)},className:"theme-text-secondary theme-hover-surface block w-full rounded-sm px-2.5 py-2 text-left text-[13px]",children:`UI Theme: ${we}`})}),a.jsx("li",{className:"theme-divider my-1 border-t"}),a.jsx("li",{children:a.jsx("button",{onClick:()=>{k(),$(!1)},className:"theme-text-secondary theme-hover-surface block w-full rounded-sm px-2.5 py-2 text-left text-[13px]",children:"Local Storage"})}),a.jsx("li",{children:a.jsx("button",{onClick:()=>{b(),$(!1)},className:"theme-text-secondary theme-hover-surface block w-full rounded-sm px-2.5 py-2 text-left text-[13px]",children:"Cloud Sync"})}),a.jsx("li",{className:"theme-divider my-1 border-t"}),a.jsx("li",{children:a.jsx("button",{onClick:()=>{x(),$(!1)},className:"theme-text-secondary theme-hover-surface block w-full rounded-sm px-2.5 py-2 text-left text-[13px]",children:"About"})})]})]})]})})]}),a.jsx("section",{"aria-label":"Library content",children:_&&u?a.jsx(lw,{activeOpdsSource:u,catalogNavPath:p,setCatalogNavPath:h,onShowBookDetail:n}):a.jsx(uw,{libraryRefreshFlag:y,onOpenBook:s,onShowBookDetail:n,onFileChange:z,importStatus:c})}),a.jsx(O0,{isOpen:re,onClose:()=>ee(!1),catalogs:U,onAddCatalog:et,onDeleteCatalog:Ke,onUpdateCatalog:j,registries:V,onAddRegistry:he,onDeleteRegistry:de,onUpdateRegistry:q}),a.jsx(H0,{isOpen:ye,currentTheme:W,onClose:()=>fe(!1),onSelectTheme:F}),a.jsx(T0,{isOpen:!!oe,onClose:ue,onReplace:Z,onAddAnyway:ce,bookTitle:oe?.title||""})]})},uh="/My-Ebook-Reader/assets/pdf.worker.min-qwK7q_zL.mjs",fw=mt.lazy(()=>Bo(()=>import("./index-DEdeNmiP.js"),__vite__mapDeps([0,1])).then(r=>({default:r.Document}))),dh=mt.lazy(()=>Bo(()=>import("./index-DEdeNmiP.js"),__vite__mapDeps([0,1])).then(r=>({default:r.Page}))),Ep=({bookId:r,onClose:s})=>{const n=Dy(),o=wc(),c=r??(n.id?Number(n.id):null),l=s??(()=>o("/")),[u,f]=R.useState(null),[p,h]=R.useState(null),[b,k]=R.useState(!0),[x,y]=R.useState(null),[S,g]=R.useState(null),[w,N]=R.useState(1),[A,L]=R.useState(100),[T,I]=R.useState("page"),[D,W]=R.useState(!1),F=mt.useRef(null),[U,V]=R.useState(!1),[ie,B]=R.useState([]),[H,C]=R.useState({}),[Q,ae]=R.useState(null),J=mt.useRef(null),[te,re]=R.useState(!1),[ee,P]=R.useState(!1),[$,ye]=R.useState(!1),fe=Jo(),[oe,be]=R.useState(!1),[Se,ke]=R.useState([]),[_e,De]=R.useState([]),[Ve,et]=R.useState(sc),[Ke,j]=R.useState(!1),[he,de]=R.useState(null),q=mt.useRef(null),z=R.useRef(null),Z=R.useRef(null),ce=R.useRef(!1);R.useEffect(()=>{let we=!1;(async()=>{try{const Ae=await Bo(()=>import("./index-DEdeNmiP.js"),__vite__mapDeps([0,1]));try{Ae.pdfjs.GlobalWorkerOptions.workerSrc=uh,we=!0}catch(Pe){console.warn("Could not set worker via static pdfWorkerUrl",Pe)}if(!we){const Pe=await Bo(()=>import("./pdf-D-gusrb1.js").then(qe=>qe.p),[]);Pe.GlobalWorkerOptions.workerSrc=uh,we=!0}}catch(Ae){console.warn("Could not configure pdfjs worker dynamically",Ae),j(!0)}})();let ve=null;return(async()=>{k(!0),y(null),h(null);try{console.debug("[PdfReaderView] fetching book id=",c);const Ae=await ut.getBook(c);if(!Ae)try{const st=(await ut.getAllBooks()).map(He=>He.id).filter(Boolean);throw new Error(`Could not find this book in your library (requested id: ${c}). Available book ids: ${st.join(", ")||"none"}`)}catch{throw new Error(`Could not find this book in your library (requested id: ${c}).`)}if(Ae.format!=="PDF")throw new Error("The selected book is not in PDF format.");f(Ae);const Pe=new Blob([Ae.epubData],{type:"application/pdf"});ve=URL.createObjectURL(Pe),console.debug("[PdfReaderView] created objectUrl",ve,"blob size",Pe.size),de(Pe.size),h(ve)}catch(Ae){console.error("[PdfReaderView] fetchBookData error",Ae),y(Ae instanceof Error?Ae.message:"An unknown error occurred.")}finally{k(!1)}})(),()=>{ve&&URL.revokeObjectURL(ve)}},[c]);const ue=we=>{g(we.numPages||null),N(1),(async()=>{try{be(!0);const ve=await we.getOutline();if(!ve||ve.length===0){B([]);return}let Le=0;const Ae=async(qe,st=0)=>{if(!qe)return null;const He=qe.title||"Untitled";let nt=null;try{let ft=qe.dest;if(typeof ft=="string"&&(ft=await we.getDestination(ft)),Array.isArray(ft)&&ft.length>0)try{nt=await we.getPageIndex(ft[0])+1}catch{}}catch{}const Je=[];if(qe.items&&qe.items.length>0)for(const ft of qe.items){const ht=await Ae(ft,st+1);ht&&Je.push(ht)}return{id:`pdf-toc-${Le++}`,label:He,href:nt?`page:${nt}`:"",subitems:Je}},Pe=[];for(const qe of ve){const st=await Ae(qe,0);st&&Pe.push(st)}B(Pe);try{const qe=[],st=async nt=>{for(const Je of nt){if(Je.href)if(Je.href.startsWith("page:")){const it=Number(Je.href.split(":")[1]);!isNaN(it)&&it>=1&&qe.push({page:it,label:Je.label})}else try{const it=await we.getDestination(Je.href);if(Array.isArray(it)&&it.length>0)try{const ft=await we.getPageIndex(it[0]);qe.push({page:ft+1,label:Je.label})}catch{}}catch{}Je.subitems&&Je.subitems.length>0&&await st(Je.subitems)}};await st(Pe),qe.sort((nt,Je)=>nt.page-Je.page);const He={};for(let nt=0;nt<qe.length;nt++){const Je=qe[nt].page,it=nt+1<qe.length?qe[nt+1].page-1:we.numPages||Je;for(let ft=Je;ft<=it;ft++)He[ft]=qe[nt].label}C(He)}catch(qe){console.warn("Failed to build pdf chapter map",qe)}}catch(ve){console.warn("Failed to map PDF outline",ve),B([])}finally{be(!1)}})();try{const ve=Bv(u?.id??c);if(ve&&typeof ve=="string"&&ve.startsWith("page:")){const Le=Number(ve.split(":")[1]);!isNaN(Le)&&Le>=1&&N(Le)}}catch{}try{if(u?.id&&!ce.current){const ve=$v(u.id);ve&&typeof ve.zoomPercent=="number"&&L(ve.zoomPercent),ve&&ve.fitMode==="width"&&I("width"),ce.current=!0}}catch{}},X=()=>{S&&N(we=>Math.min(S,we+1))},_=()=>{N(we=>Math.max(1,we-1))},E=we=>{if(we){if(we.startsWith("page:")){const ve=Number(we.split(":")[1]);!isNaN(ve)&&ve>=1&&N(ve)}else isNaN(Number(we))||N(Number(we));re(!1)}};mt.useEffect(()=>{if(!u?.id)return;q.current&&clearTimeout(q.current);const we=u.id;return q.current=window.setTimeout(()=>{try{Mv(we,`page:${w}`)}catch(ve){console.warn("Failed to save last PDF position",ve)}},800),()=>{q.current&&(clearTimeout(q.current),q.current=null)}},[w,u]),R.useEffect(()=>{if(u?.id){try{Wv(u.id,{zoomPercent:A,fitMode:T})}catch(we){console.warn("Failed to persist pdf view state",we)}W(!0),F.current&&clearTimeout(F.current),F.current=window.setTimeout(()=>W(!1),1200)}},[A,T,u]);const M=R.useCallback(()=>{if(!z.current)return;const we=z.current.getBoundingClientRect().width;Z.current=we},[]);R.useEffect(()=>{M();const we=new ResizeObserver(()=>M());return z.current&&we.observe(z.current),()=>we.disconnect()},[M]),mt.useEffect(()=>{const we=ve=>{const Le=document.activeElement&&document.activeElement.tagName;if(!(Le==="INPUT"||Le==="TEXTAREA")){if(ve.key==="ArrowLeft")_();else if(ve.key==="ArrowRight")X();else if(ve.key===" ")ve.preventDefault(),X();else if(ve.key==="+"||ve.key==="="&&ve.shiftKey)L(Ae=>Math.min(400,Math.round(Ae*1.15)));else if(ve.key==="-"||ve.key==="_")L(Ae=>Math.max(20,Math.round(Ae/1.15)));else if(ve.key.toLowerCase()==="f")I(Ae=>Ae==="page"?"width":"page");else if(ve.key==="?")V(Ae=>!Ae);else if(ve.key.toLowerCase()==="c")re(Ae=>!Ae);else if(ve.key.toLowerCase()==="b"){if(!u?.id)return;const Ae={id:new Date().toISOString(),cfi:`page:${w}`,label:`Page ${w}`,chapter:void 0,description:void 0,createdAt:Date.now()},Pe=[...Se,Ae];ke(Pe);try{$l(u.id,Pe)}catch(qe){console.warn(qe)}}}};return window.addEventListener("keydown",we),()=>window.removeEventListener("keydown",we)},[_,X,u,w,Se]),R.useEffect(()=>{if(!(!u||!u.id))try{const we=Fv(u.id),ve=Dv(u.id);ke(we||[]),De(ve||[])}catch(we){console.warn("Failed to load bookmarks/citations for PDF",we)}},[u]);const K=async we=>{if(!u?.id)return;if(Se.some(Pe=>Pe.cfi===`page:${w}`))try{if(!await fe({message:"A bookmark already exists for this page. Add another?"}))return}catch{return}const Le={id:new Date().toISOString(),cfi:`page:${w}`,label:`Page ${w}`,chapter:H[w]||void 0,description:we||void 0,createdAt:Date.now()},Ae=[...Se,Le];ke(Ae);try{$l(u.id,Ae)}catch(Pe){console.warn(Pe)}P(!1),ae("Bookmark added"),J.current&&clearTimeout(J.current),J.current=window.setTimeout(()=>ae(null),1400)},ge=async we=>{if(!u?.id)return;if(_e.some(Pe=>Pe.pageNumber===w&&(Pe.note||"")===(we||"")))try{if(!await fe({message:"An identical citation already exists for this page. Add another?"}))return}catch{return}const Le={id:new Date().toISOString(),cfi:`page:${w}`,note:we||void 0,createdAt:Date.now(),pageNumber:w,chapter:H[w]||void 0},Ae=[..._e,Le];De(Ae);try{Ff(u.id,Ae)}catch(Pe){console.warn(Pe)}ye(!1),ae("Citation added"),J.current&&clearTimeout(J.current),J.current=window.setTimeout(()=>ae(null),1400)},je=()=>b?a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx(Rn,{text:"Loading PDF..."})}):x?a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:a.jsxs("div",{className:"theme-surface-elevated theme-border theme-text-primary mx-auto max-w-lg rounded-lg border p-8 text-center shadow-lg",children:[a.jsx("h3",{className:"text-xl font-bold text-red-300 mb-2",children:"Could Not Open PDF"}),a.jsx("p",{className:"theme-text-secondary",children:x})]})}):p?a.jsxs("div",{className:"w-full h-full flex flex-col",children:[a.jsxs("div",{ref:z,className:"flex-grow relative overflow-auto p-4 md:p-8 theme-surface",children:[a.jsx(R.Suspense,{fallback:a.jsx("div",{className:"w-full h-full flex items-center justify-center",children:a.jsx(Rn,{text:"Loading viewer..."})}),children:a.jsxs("div",{className:"w-full max-w-[1100px] mx-auto",children:[a.jsxs("div",{className:"theme-text-secondary mb-2 flex items-center justify-between text-sm",children:[a.jsxs("div",{children:["Size: ",he?`${(he/1024).toFixed(1)} KB`:"unknown"]}),p&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("a",{href:p,target:"_blank",rel:"noreferrer",className:"underline",children:"Open raw PDF"}),a.jsx("a",{href:p,download:u?.title?`${u.title}.pdf`:"book.pdf",className:"underline",children:"Download"})]})]}),a.jsx(fw,{file:p,onLoadSuccess:ue,onLoadError:we=>{console.error("PDF load error",we),y("Failed to load PDF file (viewer). The file may be corrupted or unsupported."),j(!0)},children:(()=>{const we=Z.current||900;if(T==="width"){const Pe=Math.max(200,Math.floor(we-32));return a.jsx(dh,{pageNumber:w,width:Pe,onLoadError:qe=>{console.error("PDF page load error",qe),y("Failed to render PDF page. Showing fallback."),j(!0)}})}const Le=Math.max(200,Math.floor(A/100*900));return a.jsx(dh,{pageNumber:w,width:Le,onLoadError:Ae=>{console.error("PDF page load error",Ae),y("Failed to render PDF page. Showing fallback."),j(!0)}})})()})]})}),Ke?a.jsx("iframe",{src:p,title:u?.title||"PDF Viewer",className:"w-full h-full border-0","aria-hidden":"false"}):a.jsx("iframe",{src:p,title:u?.title||"PDF Viewer",className:"w-full h-full border-0 hidden","aria-hidden":"true"})]}),a.jsxs("footer",{className:"theme-surface-elevated theme-border theme-text-primary z-20 flex shrink-0 items-center gap-4 border-t p-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:_,className:"theme-hover-surface p-2 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Previous page",disabled:w<=1,children:a.jsx(Rs,{className:"w-5 h-5"})}),a.jsx("button",{onClick:X,className:"theme-hover-surface p-2 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Next page",disabled:S!==null&&w>=S,children:a.jsx(Go,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"flex-grow flex flex-col justify-center",children:[a.jsx("input",{type:"range",min:"1",max:S||1,value:w,onChange:we=>N(Number(we.target.value)),className:"theme-slider h-2 w-full cursor-pointer appearance-none rounded-lg","aria-label":"PDF progress",disabled:!S}),a.jsx("div",{className:"theme-text-secondary mt-2 text-center text-sm","aria-live":"polite",children:S?a.jsxs("span",{children:["Page ",w," of ",S]}):a.jsx("span",{className:"theme-text-muted",children:"Loading pages..."})})]}),a.jsxs("div",{className:"flex w-28 flex-col items-center text-sm",children:[a.jsx("label",{className:"theme-text-secondary text-xs",children:"Go to"}),a.jsx("input",{type:"number",min:1,max:S||9999,value:w||"",onChange:we=>{const ve=parseInt(we.target.value||"1",10);isNaN(ve)||ve<1||N(Math.min(S||ve,Math.max(1,ve)))},className:"theme-input w-full rounded-md px-2 py-1 text-center focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Jump to page"})]})]})]}):null;return a.jsxs("div",{className:"theme-shell theme-text-primary fixed inset-0 flex flex-col select-none",children:[a.jsx(vp,{value:T==="page"?`${A}%`:`Fit: ${T}`,isOpen:D}),a.jsx(U0,{message:Q||"",isOpen:!!Q}),a.jsxs("header",{className:"theme-surface-elevated theme-border theme-text-primary z-20 flex shrink-0 items-center justify-between border-b p-2 shadow-md",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:l,className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Close Reader",children:a.jsx(tr,{className:"w-6 h-6"})}),a.jsxs("button",{onClick:()=>re(!0),className:"theme-hover-surface relative rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Contents and Bookmarks",children:[a.jsx(bc,{className:"w-6 h-6"}),(Se.length>0||_e.length>0)&&a.jsx("span",{className:"absolute top-1 right-1 block h-2 w-2 rounded-full bg-sky-400 ring-2 ring-slate-800"})]})]}),a.jsxs("div",{className:"text-center truncate px-2",children:[a.jsx("h2",{className:"text-lg font-bold",children:u?.title||"PDF Reader"}),a.jsx("p",{className:"theme-text-secondary text-sm",children:u?.author})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:"hidden sm:flex items-center gap-1",children:[a.jsx("button",{onClick:()=>L(we=>Math.max(20,Math.round(we/1.15))),className:"theme-hover-surface rounded p-2","aria-label":"Zoom out",children:"-"}),a.jsxs("div",{className:"theme-text-secondary px-2 text-sm",children:[A,"%"]}),a.jsx("button",{onClick:()=>L(we=>Math.min(400,Math.round(we*1.15))),className:"theme-hover-surface rounded p-2","aria-label":"Zoom in",children:"+"}),a.jsx("button",{onClick:()=>I(we=>we==="page"?"width":"page"),className:"theme-hover-surface rounded p-2","aria-label":"Toggle fit mode",children:T==="page"?"Fit Page":"Fit Width"}),a.jsx("button",{onClick:()=>ye(!0),className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Create citation for this page",children:a.jsx(Vh,{className:"w-6 h-6"})}),a.jsx("button",{onClick:()=>P(!0),className:"theme-hover-surface rounded-full p-2 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Add bookmark to this page",children:a.jsx(Wh,{className:"w-6 h-6"})}),a.jsx("button",{onClick:()=>V(we=>!we),className:"theme-hover-surface rounded p-2","aria-label":"Keyboard help",children:"?"})]})})]}),a.jsx("main",{className:"theme-surface flex-grow relative min-h-0",children:je()}),a.jsx(yp,{isOpen:te,onClose:()=>re(!1),toc:ie,onTocNavigate:E,bookmarks:Se,onBookmarkNavigate:we=>{E(we)},onDeleteBookmark:we=>{const ve=Se.filter(Le=>Le.id!==we);ke(ve),u?.id&&$l(u.id,ve)},citations:_e,onCitationNavigate:we=>{E(we)},onDeleteCitation:we=>{const ve=_e.filter(Le=>Le.id!==we);De(ve),u?.id&&Ff(u.id,ve)},settings:Ve,bookData:u}),a.jsx(Tc,{isOpen:U,onClose:()=>V(!1),onZoomIn:()=>L(we=>Math.min(400,Math.round(we*1.15))),onZoomOut:()=>L(we=>Math.max(20,Math.round(we/1.15))),onToggleFit:()=>I(we=>we==="page"?"width":"page"),activeReader:"pdf"}),a.jsx(fp,{isOpen:ee,onClose:()=>P(!1),onSave:K}),a.jsx(hp,{isOpen:$,onClose:()=>ye(!1),onSave:ge})]})},hw=r=>{const{currentView:s,selectedBookId:n,coverAnimationData:o,onCloseReader:c,detailViewData:l,onReturnToLibrary:u,onImportFromCatalog:f,onAutoBackupToDrive:p,onOpenBook:h,onShowBookDetail:b,syncStatus:k,processAndSaveBook:x,activeOpdsSource:y,setActiveOpdsSource:S,catalogNavPath:g,setCatalogNavPath:w,onOpenCloudSyncModal:N,onOpenLocalStorageModal:A,onShowAbout:L,importStatus:T,setImportStatus:I,libraryRefreshFlag:D,userCitationFormat:W}=r,[F,U]=mt.useState(s),[V,ie]=mt.useState(n),[B,H]=mt.useState(o),[C,Q]=mt.useState("reader"),ae=mt.useCallback((J,te)=>{const re=J.mediaType||J.acquisitionMediaType||"",ee=(J.format||"").toUpperCase();let P="reader";re.includes("pdf")||ee==="PDF"?P="pdfReader":(re.includes("epub")||ee==="EPUB")&&(P="reader"),ie(J.id),H(te||null),Q(P),U(P)},[]);switch(mt.useEffect(()=>{U(s)},[s]),mt.useEffect(()=>{ie(n)},[n]),mt.useEffect(()=>{H(o)},[o]),F){case"reader":return V!==null?a.jsx(Es,{onReset:c,fallbackMessage:"There was an error while trying to display this book. Returning to the library.",children:a.jsx(E0,{bookId:V,onClose:c,animationData:B})}):null;case"pdfReader":return V!==null?a.jsx(Es,{onReset:c,fallbackMessage:"There was an error while trying to display this PDF. Returning to the library.",children:a.jsx(Ep,{bookId:V,onClose:c})}):null;case"bookDetail":return l?a.jsx(Es,{onReset:u,fallbackMessage:"There was an error showing the book details. Returning to the library.",children:a.jsx(jv,{book:l.book,source:l.source,catalogName:l.catalogName,onBack:u,onReadBook:ae,onImportFromCatalog:f,importStatus:T,setImportStatus:I,userCitationFormat:W})}):null;case"about":return a.jsx(pv,{onBack:u});case"library":default:return a.jsx(Es,{onReset:()=>window.location.reload(),fallbackMessage:"There was a critical error in the library. Please try reloading the application.",children:a.jsx(dw,{onOpenBook:h,onShowBookDetail:b,processAndSaveBook:x,importStatus:T,setImportStatus:I,activeOpdsSource:y,setActiveOpdsSource:S,catalogNavPath:g,setCatalogNavPath:w,onOpenCloudSyncModal:N,onOpenLocalStorageModal:A,onShowAbout:L,libraryRefreshFlag:D,syncStatus:k,onAutoBackupToDrive:p})})}},Ns={isOpen:!1,host:null,pendingHref:null,pendingBook:null,pendingCatalogName:void 0,authDocument:null},pw=({processAndSaveBook:r,setImportStatus:s,setActiveOpdsSource:n,setCurrentView:o,pushToast:c})=>{const[l,u]=R.useState(Ns),[f,p]=R.useState(!1),h=R.useCallback(async(y,S)=>{if(y.format&&y.format.toUpperCase()!=="EPUB"&&y.format.toUpperCase()!=="PDF"){const g=`Cannot import this book. The application currently only supports EPUB and PDF formats, but this book is a ${y.format}.`;return s({isLoading:!1,message:"",error:g}),{success:!1}}s({isLoading:!0,message:`Downloading ${y.title}...`,error:null});try{let g=y.downloadUrl;if(!y.isOpenAccess){const W=await Zf(y.downloadUrl),F=await ql.resolve(y.downloadUrl,"auto",W?{username:W.username,password:W.password}:null);if(F.success)g=F.data;else{const U=F;if(U.status===401||U.status===403)return s({isLoading:!1,message:"",error:null}),u({isOpen:!0,host:new URL(y.downloadUrl).host,pendingHref:y.downloadUrl,pendingBook:y,pendingCatalogName:S,authDocument:null}),{success:!1};ne.warn("Failed to resolve acquisition chain, using original URL",U.error)}}let w=await Or(g,y.isOpenAccess===!0);const N=await Zf(y.downloadUrl),A={};N&&(A.Authorization=`Basic ${btoa(`${N.username}:${N.password}`)}`);let L;if(y.isOpenAccess)try{L=await fetch(g,{headers:A,credentials:"include",redirect:"follow"})}catch{w=qt(g),L=await fetch(w,{headers:{},credentials:"omit",redirect:"follow"})}else L=await fetch(w,{headers:A,credentials:w===g?"include":"omit"});if(!L.ok){const W=`${L.status}${L.statusText?` ${L.statusText}`:""}`;let F=`Download failed. The server responded with an error (${W}). The book might not be available at this address.`;throw(L.status===401||L.status===403)&&(F=`Download failed (${W}). This catalog or book requires authentication (a login or password), which is not supported by this application.`),L.status===429&&(F=`Download failed (${W}). The request was rate-limited by the server or the proxy. Please wait a moment and try again.`),new Error(F)}const T=await L.arrayBuffer(),I=y.format&&y.format.toUpperCase()==="PDF"?{summary:y.summary,publisher:y.publisher,publicationDate:y.publicationDate,subjects:y.subjects,coverImage:y.coverImage}:void 0,D=await r(T,y.title,y.author,"catalog",S,y.providerId,y.format,y.coverImage,I);return D.success&&(n(null),o("library")),D}catch(g){ne.error("Error importing from catalog:",g);let w="Download failed. The file may no longer be available or there was a network issue.";return g instanceof TypeError&&g.message==="Failed to fetch"?w="Download failed due to a network error. This could be due to your internet connection or the public CORS proxy being temporarily down.":g instanceof Error&&(w=g.message),s({isLoading:!1,message:"",error:w}),{success:!1}}},[r,n,o,s]),b=R.useCallback(async(y,S,g)=>{if(!l.pendingHref){u(Ns);return}const w=l.pendingHref;try{const N=await ql.resolve(w,"auto",{username:y,password:S});if(N.success&&l.pendingBook){g&&l.host&&Sx(l.host,y,S),u(Ns),s({isLoading:!0,message:`Downloading ${l.pendingBook.title}...`,error:null});const A=await Or(N.data),L={};y&&S&&(L.Authorization=`Basic ${btoa(`${y}:${S}`)}`);const T=await fetch(A,{headers:L,credentials:A===N.data?"include":"omit"});if(!T.ok)throw new Error(`Download failed: ${T.status}`);const I=await T.arrayBuffer(),D=await r(I,l.pendingBook.title,l.pendingBook.author,"catalog",l.pendingCatalogName,l.pendingBook.providerId,l.pendingBook.format,l.pendingBook.coverImage);!D.success&&D.existingBook&&s({isLoading:!1,message:"",error:`A book with the same identifier is already in your library: "${D.existingBook.title}".`})}else s({isLoading:!1,message:"",error:"Failed to resolve acquisition URL."}),u(Ns)}catch(N){ne.error("Credential resolve/import failed",N),s({isLoading:!1,message:"",error:N instanceof Error?N.message:"Failed to authenticate and download the book."}),u(Ns)}},[l,r,s]),k=R.useCallback(y=>{},[]),x=R.useCallback(async()=>{if(!(!l.pendingHref||!l.pendingBook)){s({isLoading:!0,message:"Retrying download after provider login...",error:null});try{const y=await ql.resolve(l.pendingHref,"auto",null);if(!y.success)throw new Error("Failed to resolve after login");const S=await Or(y.data);if(typeof S=="string"&&S.includes("corsproxy.io"))throw c("The retry would use a public CORS proxy which commonly strips authentication. Configure an owned proxy via VITE_OWN_PROXY_URL and retry.",12e3),new Error("Retry aborted: public CORS proxy would be used and may block authenticated downloads.");const g=await fetch(S,{credentials:S===y.data?"include":"omit"});if(!g.ok)throw new Error(`Download failed: ${g.status}`);const w=await g.arrayBuffer(),N=await r(w,l.pendingBook.title,l.pendingBook.author,"catalog",l.pendingCatalogName,l.pendingBook.providerId,l.pendingBook.format,l.pendingBook.coverImage);!N.success&&N.existingBook&&s({isLoading:!1,message:"",error:`A book with the same identifier is already in your library: "${N.existingBook.title}".`}),u(Ns)}catch(y){ne.error("Retry after provider login failed",y),s({isLoading:!1,message:"",error:y instanceof Error?y.message:"Retry failed"})}}},[l,r,c,s]);return{credentialPrompt:l,setCredentialPrompt:u,handleImportFromCatalog:h,handleCredentialSubmit:b,handleOpenAuthLink:k,handleRetryAfterProviderLogin:x,showNetworkDebug:f,setShowNetworkDebug:p}};var Cs={},Gl={},fh;function mw(){return fh||(fh=1,Gl.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",times:"",divide:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",euro:"",trade:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:""}),Gl}var Lo={},hh;function gw(){if(hh)return Lo;hh=1;var r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,s=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),n=new RegExp("^"+r.source+s.source+"*(?::"+r.source+s.source+"*)?$"),o=0,c=1,l=2,u=3,f=4,p=5,h=6,b=7;function k(F,U){this.message=F,this.locator=U,Error.captureStackTrace&&Error.captureStackTrace(this,k)}k.prototype=new Error,k.prototype.name=k.name;function x(){}x.prototype={parse:function(F,U,V){var ie=this.domBuilder;ie.startDocument(),L(U,U={}),y(F,U,V,ie,this.errorHandler),ie.endDocument()}};function y(F,U,V,ie,B){function H(ce){if(ce>65535){ce-=65536;var ue=55296+(ce>>10),X=56320+(ce&1023);return String.fromCharCode(ue,X)}else return String.fromCharCode(ce)}function C(ce){var ue=ce.slice(1,-1);return ue in V?V[ue]:ue.charAt(0)==="#"?H(parseInt(ue.substr(1).replace("x","0x"))):(B.error("entity not found:"+ce),ce)}function Q(ce){if(ce>ye){var ue=F.substring(ye,ce).replace(/&#?\w+;/g,C);ee&&ae(ye),ie.characters(ue,0,ce-ye),ye=ce}}function ae(ce,ue){for(;ce>=te&&(ue=re.exec(F));)J=ue.index,te=J+ue[0].length,ee.lineNumber++;ee.columnNumber=ce-J+1}for(var J=0,te=0,re=/.*(?:\r\n?|\n)|.*$/g,ee=ie.locator,P=[{currentNSMap:U}],$={},ye=0;;){try{var fe=F.indexOf("<",ye);if(fe<0){if(!F.substr(ye).match(/^\s*$/)){var oe=ie.doc,be=oe.createTextNode(F.substr(ye));oe.appendChild(be),ie.currentElement=be}return}switch(fe>ye&&Q(fe),F.charAt(fe+1)){case"/":var he=F.indexOf(">",fe+3),Se=F.substring(fe+2,he),ke=P.pop();he<0?(Se=F.substring(fe+2).replace(/[\s<].*/,""),B.error("end tag name: "+Se+" is not complete:"+ke.tagName),he=fe+1+Se.length):Se.match(/\s</)&&(Se=Se.replace(/[\s<].*/,""),B.error("end tag name: "+Se+" maybe not complete"),he=fe+1+Se.length);var _e=ke.localNSMap,De=ke.tagName==Se,Ve=De||ke.tagName&&ke.tagName.toLowerCase()==Se.toLowerCase();if(Ve){if(ie.endElement(ke.uri,ke.localName,Se),_e)for(var et in _e)ie.endPrefixMapping(et);De||B.fatalError("end tag name: "+Se+" is not match the current start tagName:"+ke.tagName)}else P.push(ke);he++;break;case"?":ee&&ae(fe),he=I(F,fe,ie);break;case"!":ee&&ae(fe),he=T(F,fe,ie,B);break;default:ee&&ae(fe);var Ke=new D,j=P[P.length-1].currentNSMap,he=g(F,fe,Ke,j,C,B),de=Ke.length;if(!Ke.closed&&A(F,he,Ke.tagName,$)&&(Ke.closed=!0,V.nbsp||B.warning("unclosed xml attribute")),ee&&de){for(var q=S(ee,{}),z=0;z<de;z++){var Z=Ke[z];ae(Z.offset),Z.locator=S(ee,{})}ie.locator=q,w(Ke,ie,j)&&P.push(Ke),ie.locator=ee}else w(Ke,ie,j)&&P.push(Ke);Ke.uri==="http://www.w3.org/1999/xhtml"&&!Ke.closed?he=N(F,he,Ke.tagName,C,ie):he++}}catch(ce){if(ce instanceof k)throw ce;B.error("element parse error: "+ce),he=-1}he>ye?ye=he:Q(Math.max(fe,ye)+1)}}function S(F,U){return U.lineNumber=F.lineNumber,U.columnNumber=F.columnNumber,U}function g(F,U,V,ie,B,H){function C(ee,P,$){ee in V.attributeNames&&H.fatalError("Attribute "+ee+" redefined"),V.addValue(ee,P,$)}for(var Q,ae,J=++U,te=o;;){var re=F.charAt(J);switch(re){case"=":if(te===c)Q=F.slice(U,J),te=u;else if(te===l)te=u;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(te===u||te===c)if(te===c&&(H.warning('attribute value must after "="'),Q=F.slice(U,J)),U=J+1,J=F.indexOf(re,U),J>0)ae=F.slice(U,J).replace(/&#?\w+;/g,B),C(Q,ae,U-1),te=p;else throw new Error("attribute value no end '"+re+"' match");else if(te==f)ae=F.slice(U,J).replace(/&#?\w+;/g,B),C(Q,ae,U),H.warning('attribute "'+Q+'" missed start quot('+re+")!!"),U=J+1,te=p;else throw new Error('attribute value must after "="');break;case"/":switch(te){case o:V.setTagName(F.slice(U,J));case p:case h:case b:te=b,V.closed=!0;case f:case c:case l:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return H.error("unexpected end of input"),te==o&&V.setTagName(F.slice(U,J)),J;case">":switch(te){case o:V.setTagName(F.slice(U,J));case p:case h:case b:break;case f:case c:ae=F.slice(U,J),ae.slice(-1)==="/"&&(V.closed=!0,ae=ae.slice(0,-1));case l:te===l&&(ae=Q),te==f?(H.warning('attribute "'+ae+'" missed quot(")!'),C(Q,ae.replace(/&#?\w+;/g,B),U)):((ie[""]!=="http://www.w3.org/1999/xhtml"||!ae.match(/^(?:disabled|checked|selected)$/i))&&H.warning('attribute "'+ae+'" missed value!! "'+ae+'" instead!!'),C(ae,ae,U));break;case u:throw new Error("attribute value missed!!")}return J;case"":re=" ";default:if(re<=" ")switch(te){case o:V.setTagName(F.slice(U,J)),te=h;break;case c:Q=F.slice(U,J),te=l;break;case f:var ae=F.slice(U,J).replace(/&#?\w+;/g,B);H.warning('attribute "'+ae+'" missed quot(")!!'),C(Q,ae,U);case p:te=h;break}else switch(te){case l:V.tagName,(ie[""]!=="http://www.w3.org/1999/xhtml"||!Q.match(/^(?:disabled|checked|selected)$/i))&&H.warning('attribute "'+Q+'" missed value!! "'+Q+'" instead2!!'),C(Q,Q,U),U=J,te=c;break;case p:H.warning('attribute space is required"'+Q+'"!!');case h:te=c,U=J;break;case u:te=f,U=J;break;case b:throw new Error("elements closed character '/' and '>' must be connected to")}}J++}}function w(F,U,V){for(var ie=F.tagName,B=null,re=F.length;re--;){var H=F[re],C=H.qName,Q=H.value,ee=C.indexOf(":");if(ee>0)var ae=H.prefix=C.slice(0,ee),J=C.slice(ee+1),te=ae==="xmlns"&&J;else J=C,ae=null,te=C==="xmlns"&&"";H.localName=J,te!==!1&&(B==null&&(B={},L(V,V={})),V[te]=B[te]=Q,H.uri="http://www.w3.org/2000/xmlns/",U.startPrefixMapping(te,Q))}for(var re=F.length;re--;){H=F[re];var ae=H.prefix;ae&&(ae==="xml"&&(H.uri="http://www.w3.org/XML/1998/namespace"),ae!=="xmlns"&&(H.uri=V[ae||""]))}var ee=ie.indexOf(":");ee>0?(ae=F.prefix=ie.slice(0,ee),J=F.localName=ie.slice(ee+1)):(ae=null,J=F.localName=ie);var P=F.uri=V[ae||""];if(U.startElement(P,J,ie,F),F.closed){if(U.endElement(P,J,ie),B)for(ae in B)U.endPrefixMapping(ae)}else return F.currentNSMap=V,F.localNSMap=B,!0}function N(F,U,V,ie,B){if(/^(?:script|textarea)$/i.test(V)){var H=F.indexOf("</"+V+">",U),C=F.substring(U+1,H);if(/[&<]/.test(C))return/^script$/i.test(V)?(B.characters(C,0,C.length),H):(C=C.replace(/&#?\w+;/g,ie),B.characters(C,0,C.length),H)}return U+1}function A(F,U,V,ie){var B=ie[V];return B==null&&(B=F.lastIndexOf("</"+V+">"),B<U&&(B=F.lastIndexOf("</"+V)),ie[V]=B),B<U}function L(F,U){for(var V in F)U[V]=F[V]}function T(F,U,V,ie){var B=F.charAt(U+2);switch(B){case"-":if(F.charAt(U+3)==="-"){var H=F.indexOf("-->",U+4);return H>U?(V.comment(F,U+4,H-U-4),H+3):(ie.error("Unclosed comment"),-1)}else return-1;default:if(F.substr(U+3,6)=="CDATA["){var H=F.indexOf("]]>",U+9);return V.startCDATA(),V.characters(F,U+9,H-U-9),V.endCDATA(),H+3}var C=W(F,U),Q=C.length;if(Q>1&&/!doctype/i.test(C[0][0])){var ae=C[1][0],J=!1,te=!1;Q>3&&(/^public$/i.test(C[2][0])?(J=C[3][0],te=Q>4&&C[4][0]):/^system$/i.test(C[2][0])&&(te=C[3][0]));var re=C[Q-1];return V.startDTD(ae,J,te),V.endDTD(),re.index+re[0].length}}return-1}function I(F,U,V){var ie=F.indexOf("?>",U);if(ie){var B=F.substring(U,ie).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return B?(B[0].length,V.processingInstruction(B[1],B[2]),ie+2):-1}return-1}function D(){this.attributeNames={}}D.prototype={setTagName:function(F){if(!n.test(F))throw new Error("invalid tagName:"+F);this.tagName=F},addValue:function(F,U,V){if(!n.test(F))throw new Error("invalid attribute:"+F);this.attributeNames[F]=this.length,this[this.length++]={qName:F,value:U,offset:V}},length:0,getLocalName:function(F){return this[F].localName},getLocator:function(F){return this[F].locator},getQName:function(F){return this[F].qName},getURI:function(F){return this[F].uri},getValue:function(F){return this[F].value}};function W(F,U){var V,ie=[],B=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(B.lastIndex=U,B.exec(F);V=B.exec(F);)if(ie.push(V),V[1])return ie}return Lo.XMLReader=x,Lo.ParseError=k,Lo}var js={},ph;function mh(){if(ph)return js;ph=1;function r(_,E){for(var M in _)E[M]=_[M]}function s(_,E){var M=_.prototype;if(!(M instanceof E)){let K=function(){};K.prototype=E.prototype,K=new K,r(M,K),_.prototype=M=K}M.constructor!=_&&(typeof _!="function"&&console.error("unknow Class:"+_),M.constructor=_)}var n="http://www.w3.org/1999/xhtml",o={},c=o.ELEMENT_NODE=1,l=o.ATTRIBUTE_NODE=2,u=o.TEXT_NODE=3,f=o.CDATA_SECTION_NODE=4,p=o.ENTITY_REFERENCE_NODE=5,h=o.ENTITY_NODE=6,b=o.PROCESSING_INSTRUCTION_NODE=7,k=o.COMMENT_NODE=8,x=o.DOCUMENT_NODE=9,y=o.DOCUMENT_TYPE_NODE=10,S=o.DOCUMENT_FRAGMENT_NODE=11,g=o.NOTATION_NODE=12,w={},N={};w.INDEX_SIZE_ERR=(N[1]="Index size error",1),w.DOMSTRING_SIZE_ERR=(N[2]="DOMString size error",2);var A=w.HIERARCHY_REQUEST_ERR=(N[3]="Hierarchy request error",3);w.WRONG_DOCUMENT_ERR=(N[4]="Wrong document",4),w.INVALID_CHARACTER_ERR=(N[5]="Invalid character",5),w.NO_DATA_ALLOWED_ERR=(N[6]="No data allowed",6),w.NO_MODIFICATION_ALLOWED_ERR=(N[7]="No modification allowed",7);var L=w.NOT_FOUND_ERR=(N[8]="Not found",8);w.NOT_SUPPORTED_ERR=(N[9]="Not supported",9);var T=w.INUSE_ATTRIBUTE_ERR=(N[10]="Attribute in use",10);w.INVALID_STATE_ERR=(N[11]="Invalid state",11),w.SYNTAX_ERR=(N[12]="Syntax error",12),w.INVALID_MODIFICATION_ERR=(N[13]="Invalid modification",13),w.NAMESPACE_ERR=(N[14]="Invalid namespace",14),w.INVALID_ACCESS_ERR=(N[15]="Invalid access",15);function I(_,E){if(E instanceof Error)var M=E;else M=this,Error.call(this,N[_]),this.message=N[_],Error.captureStackTrace&&Error.captureStackTrace(this,I);return M.code=_,E&&(this.message=this.message+": "+E),M}I.prototype=Error.prototype,r(w,I);function D(){}D.prototype={length:0,item:function(_){return this[_]||null},toString:function(_,E){for(var M=[],K=0;K<this.length;K++)Z(this[K],M,_,E);return M.join("")}};function W(_,E){this._node=_,this._refresh=E,F(this)}function F(_){var E=_._node._inc||_._node.ownerDocument._inc;if(_._inc!=E){var M=_._refresh(_._node);X(_,"length",M.length),r(M,_),_._inc=E}}W.prototype.item=function(_){return F(this),this[_]},s(W,D);function U(){}function V(_,E){for(var M=_.length;M--;)if(_[M]===E)return M}function ie(_,E,M,K){if(K?E[V(E,K)]=M:E[E.length++]=M,_){M.ownerElement=_;var ge=_.ownerDocument;ge&&(K&&re(ge,_,K),te(ge,_,M))}}function B(_,E,M){var K=V(E,M);if(K>=0){for(var ge=E.length-1;K<ge;)E[K]=E[++K];if(E.length=ge,_){var je=_.ownerDocument;je&&(re(je,_,M),M.ownerElement=null)}}else throw I(L,new Error(_.tagName+"@"+M))}U.prototype={length:0,item:D.prototype.item,getNamedItem:function(_){for(var E=this.length;E--;){var M=this[E];if(M.nodeName==_)return M}},setNamedItem:function(_){var E=_.ownerElement;if(E&&E!=this._ownerElement)throw new I(T);var M=this.getNamedItem(_.nodeName);return ie(this._ownerElement,this,_,M),M},setNamedItemNS:function(_){var E=_.ownerElement,M;if(E&&E!=this._ownerElement)throw new I(T);return M=this.getNamedItemNS(_.namespaceURI,_.localName),ie(this._ownerElement,this,_,M),M},removeNamedItem:function(_){var E=this.getNamedItem(_);return B(this._ownerElement,this,E),E},removeNamedItemNS:function(_,E){var M=this.getNamedItemNS(_,E);return B(this._ownerElement,this,M),M},getNamedItemNS:function(_,E){for(var M=this.length;M--;){var K=this[M];if(K.localName==E&&K.namespaceURI==_)return K}return null}};function H(_){if(this._features={},_)for(var E in _)this._features=_[E]}H.prototype={hasFeature:function(_,E){var M=this._features[_.toLowerCase()];return!!(M&&(!E||E in M))},createDocument:function(_,E,M){var K=new J;if(K.implementation=this,K.childNodes=new D,K.doctype=M,M&&K.appendChild(M),E){var ge=K.createElementNS(_,E);K.appendChild(ge)}return K},createDocumentType:function(_,E,M){var K=new De;return K.name=_,K.nodeName=_,K.publicId=E,K.systemId=M,K}};function C(){}C.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(_,E){return $(this,_,E)},replaceChild:function(_,E){this.insertBefore(_,E),E&&this.removeChild(E)},removeChild:function(_){return P(this,_)},appendChild:function(_){return this.insertBefore(_,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(_){return ue(this.ownerDocument||this,this,_)},normalize:function(){for(var _=this.firstChild;_;){var E=_.nextSibling;E&&E.nodeType==u&&_.nodeType==u?(this.removeChild(E),_.appendData(E.data)):(_.normalize(),_=E)}},isSupported:function(_,E){return this.ownerDocument.implementation.hasFeature(_,E)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(_){for(var E=this;E;){var M=E._nsMap;if(M){for(var K in M)if(M[K]==_)return K}E=E.nodeType==l?E.ownerDocument:E.parentNode}return null},lookupNamespaceURI:function(_){for(var E=this;E;){var M=E._nsMap;if(M&&_ in M)return M[_];E=E.nodeType==l?E.ownerDocument:E.parentNode}return null},isDefaultNamespace:function(_){var E=this.lookupPrefix(_);return E==null}};function Q(_){return _=="<"&&"&lt;"||_==">"&&"&gt;"||_=="&"&&"&amp;"||_=='"'&&"&quot;"||"&#"+_.charCodeAt()+";"}r(o,C),r(o,C.prototype);function ae(_,E){if(E(_))return!0;if(_=_.firstChild)do if(ae(_,E))return!0;while(_=_.nextSibling)}function J(){}function te(_,E,M){_&&_._inc++;var K=M.namespaceURI;K=="http://www.w3.org/2000/xmlns/"&&(E._nsMap[M.prefix?M.localName:""]=M.value)}function re(_,E,M,K){_&&_._inc++;var ge=M.namespaceURI;ge=="http://www.w3.org/2000/xmlns/"&&delete E._nsMap[M.prefix?M.localName:""]}function ee(_,E,M){if(_&&_._inc){_._inc++;var K=E.childNodes;if(M)K[K.length++]=M;else{for(var ge=E.firstChild,je=0;ge;)K[je++]=ge,ge=ge.nextSibling;K.length=je}}}function P(_,E){var M=E.previousSibling,K=E.nextSibling;return M?M.nextSibling=K:_.firstChild=K,K?K.previousSibling=M:_.lastChild=M,ee(_.ownerDocument,_),E}function $(_,E,M){var K=E.parentNode;if(K&&K.removeChild(E),E.nodeType===S){var ge=E.firstChild;if(ge==null)return E;var je=E.lastChild}else ge=je=E;var we=M?M.previousSibling:_.lastChild;ge.previousSibling=we,je.nextSibling=M,we?we.nextSibling=ge:_.firstChild=ge,M==null?_.lastChild=je:M.previousSibling=je;do ge.parentNode=_;while(ge!==je&&(ge=ge.nextSibling));return ee(_.ownerDocument||_,_),E.nodeType==S&&(E.firstChild=E.lastChild=null),E}function ye(_,E){var M=E.parentNode;if(M){var K=_.lastChild;M.removeChild(E);var K=_.lastChild}var K=_.lastChild;return E.parentNode=_,E.previousSibling=K,E.nextSibling=null,K?K.nextSibling=E:_.firstChild=E,_.lastChild=E,ee(_.ownerDocument,_,E),E}J.prototype={nodeName:"#document",nodeType:x,doctype:null,documentElement:null,_inc:1,insertBefore:function(_,E){if(_.nodeType==S){for(var M=_.firstChild;M;){var K=M.nextSibling;this.insertBefore(M,E),M=K}return _}return this.documentElement==null&&_.nodeType==c&&(this.documentElement=_),$(this,_,E),_.ownerDocument=this,_},removeChild:function(_){return this.documentElement==_&&(this.documentElement=null),P(this,_)},importNode:function(_,E){return ce(this,_,E)},getElementById:function(_){var E=null;return ae(this.documentElement,function(M){if(M.nodeType==c&&M.getAttribute("id")==_)return E=M,!0}),E},getElementsByClassName:function(_){var E=new RegExp("(^|\\s)"+_+"(\\s|$)");return new W(this,function(M){var K=[];return ae(M.documentElement,function(ge){ge!==M&&ge.nodeType==c&&E.test(ge.getAttribute("class"))&&K.push(ge)}),K})},createElement:function(_){var E=new fe;E.ownerDocument=this,E.nodeName=_,E.tagName=_,E.childNodes=new D;var M=E.attributes=new U;return M._ownerElement=E,E},createDocumentFragment:function(){var _=new j;return _.ownerDocument=this,_.childNodes=new D,_},createTextNode:function(_){var E=new Se;return E.ownerDocument=this,E.appendData(_),E},createComment:function(_){var E=new ke;return E.ownerDocument=this,E.appendData(_),E},createCDATASection:function(_){var E=new _e;return E.ownerDocument=this,E.appendData(_),E},createProcessingInstruction:function(_,E){var M=new he;return M.ownerDocument=this,M.tagName=M.target=_,M.nodeValue=M.data=E,M},createAttribute:function(_){var E=new oe;return E.ownerDocument=this,E.name=_,E.nodeName=_,E.localName=_,E.specified=!0,E},createEntityReference:function(_){var E=new Ke;return E.ownerDocument=this,E.nodeName=_,E},createElementNS:function(_,E){var M=new fe,K=E.split(":"),ge=M.attributes=new U;return M.childNodes=new D,M.ownerDocument=this,M.nodeName=E,M.tagName=E,M.namespaceURI=_,K.length==2?(M.prefix=K[0],M.localName=K[1]):M.localName=E,ge._ownerElement=M,M},createAttributeNS:function(_,E){var M=new oe,K=E.split(":");return M.ownerDocument=this,M.nodeName=E,M.name=E,M.namespaceURI=_,M.specified=!0,K.length==2?(M.prefix=K[0],M.localName=K[1]):M.localName=E,M}},s(J,C);function fe(){this._nsMap={}}fe.prototype={nodeType:c,hasAttribute:function(_){return this.getAttributeNode(_)!=null},getAttribute:function(_){var E=this.getAttributeNode(_);return E&&E.value||""},getAttributeNode:function(_){return this.attributes.getNamedItem(_)},setAttribute:function(_,E){var M=this.ownerDocument.createAttribute(_);M.value=M.nodeValue=""+E,this.setAttributeNode(M)},removeAttribute:function(_){var E=this.getAttributeNode(_);E&&this.removeAttributeNode(E)},appendChild:function(_){return _.nodeType===S?this.insertBefore(_,null):ye(this,_)},setAttributeNode:function(_){return this.attributes.setNamedItem(_)},setAttributeNodeNS:function(_){return this.attributes.setNamedItemNS(_)},removeAttributeNode:function(_){return this.attributes.removeNamedItem(_.nodeName)},removeAttributeNS:function(_,E){var M=this.getAttributeNodeNS(_,E);M&&this.removeAttributeNode(M)},hasAttributeNS:function(_,E){return this.getAttributeNodeNS(_,E)!=null},getAttributeNS:function(_,E){var M=this.getAttributeNodeNS(_,E);return M&&M.value||""},setAttributeNS:function(_,E,M){var K=this.ownerDocument.createAttributeNS(_,E);K.value=K.nodeValue=""+M,this.setAttributeNode(K)},getAttributeNodeNS:function(_,E){return this.attributes.getNamedItemNS(_,E)},getElementsByTagName:function(_){return new W(this,function(E){var M=[];return ae(E,function(K){K!==E&&K.nodeType==c&&(_==="*"||K.tagName==_)&&M.push(K)}),M})},getElementsByTagNameNS:function(_,E){return new W(this,function(M){var K=[];return ae(M,function(ge){ge!==M&&ge.nodeType===c&&(_==="*"||ge.namespaceURI===_)&&(E==="*"||ge.localName==E)&&K.push(ge)}),K})}},J.prototype.getElementsByTagName=fe.prototype.getElementsByTagName,J.prototype.getElementsByTagNameNS=fe.prototype.getElementsByTagNameNS,s(fe,C);function oe(){}oe.prototype.nodeType=l,s(oe,C);function be(){}be.prototype={data:"",substringData:function(_,E){return this.data.substring(_,_+E)},appendData:function(_){_=this.data+_,this.nodeValue=this.data=_,this.length=_.length},insertData:function(_,E){this.replaceData(_,0,E)},appendChild:function(_){throw new Error(N[A])},deleteData:function(_,E){this.replaceData(_,E,"")},replaceData:function(_,E,M){var K=this.data.substring(0,_),ge=this.data.substring(_+E);M=K+M+ge,this.nodeValue=this.data=M,this.length=M.length}},s(be,C);function Se(){}Se.prototype={nodeName:"#text",nodeType:u,splitText:function(_){var E=this.data,M=E.substring(_);E=E.substring(0,_),this.data=this.nodeValue=E,this.length=E.length;var K=this.ownerDocument.createTextNode(M);return this.parentNode&&this.parentNode.insertBefore(K,this.nextSibling),K}},s(Se,be);function ke(){}ke.prototype={nodeName:"#comment",nodeType:k},s(ke,be);function _e(){}_e.prototype={nodeName:"#cdata-section",nodeType:f},s(_e,be);function De(){}De.prototype.nodeType=y,s(De,C);function Ve(){}Ve.prototype.nodeType=g,s(Ve,C);function et(){}et.prototype.nodeType=h,s(et,C);function Ke(){}Ke.prototype.nodeType=p,s(Ke,C);function j(){}j.prototype.nodeName="#document-fragment",j.prototype.nodeType=S,s(j,C);function he(){}he.prototype.nodeType=b,s(he,C);function de(){}de.prototype.serializeToString=function(_,E,M){return q.call(_,E,M)},C.prototype.toString=q;function q(_,E){var M=[],K=this.nodeType==9&&this.documentElement||this,ge=K.prefix,je=K.namespaceURI;if(je&&ge==null){var ge=K.lookupPrefix(je);if(ge==null)var we=[{namespace:je,prefix:null}]}return Z(this,M,_,E,we),M.join("")}function z(_,E,M){var K=_.prefix||"",ge=_.namespaceURI;if(!K&&!ge||K==="xml"&&ge==="http://www.w3.org/XML/1998/namespace"||ge=="http://www.w3.org/2000/xmlns/")return!1;for(var je=M.length;je--;){var we=M[je];if(we.prefix==K)return we.namespace!=ge}return!0}function Z(_,E,M,K,ge){if(K)if(_=K(_),_){if(typeof _=="string"){E.push(_);return}}else return;switch(_.nodeType){case c:ge||(ge=[]),ge.length;var je=_.attributes,we=je.length,He=_.firstChild,ve=_.tagName;M=n===_.namespaceURI||M,E.push("<",ve);for(var Le=0;Le<we;Le++){var Ae=je.item(Le);Ae.prefix=="xmlns"?ge.push({prefix:Ae.localName,namespace:Ae.value}):Ae.nodeName=="xmlns"&&ge.push({prefix:"",namespace:Ae.value})}for(var Le=0;Le<we;Le++){var Ae=je.item(Le);if(z(Ae,M,ge)){var Pe=Ae.prefix||"",qe=Ae.namespaceURI,st=Pe?" xmlns:"+Pe:" xmlns";E.push(st,'="',qe,'"'),ge.push({prefix:Pe,namespace:qe})}Z(Ae,E,M,K,ge)}if(z(_,M,ge)){var Pe=_.prefix||"",qe=_.namespaceURI;if(qe){var st=Pe?" xmlns:"+Pe:" xmlns";E.push(st,'="',qe,'"'),ge.push({prefix:Pe,namespace:qe})}}if(He||M&&!/^(?:meta|link|img|br|hr|input)$/i.test(ve)){if(E.push(">"),M&&/^script$/i.test(ve))for(;He;)He.data?E.push(He.data):Z(He,E,M,K,ge),He=He.nextSibling;else for(;He;)Z(He,E,M,K,ge),He=He.nextSibling;E.push("</",ve,">")}else E.push("/>");return;case x:case S:for(var He=_.firstChild;He;)Z(He,E,M,K,ge),He=He.nextSibling;return;case l:return E.push(" ",_.name,'="',_.value.replace(/[<&"]/g,Q),'"');case u:return E.push(_.data.replace(/[<&]/g,Q).replace(/]]>/g,"]]&gt;"));case f:return E.push("<![CDATA[",_.data,"]]>");case k:return E.push("<!--",_.data,"-->");case y:var nt=_.publicId,Je=_.systemId;if(E.push("<!DOCTYPE ",_.name),nt)E.push(" PUBLIC ",nt),Je&&Je!="."&&E.push(" ",Je),E.push(">");else if(Je&&Je!=".")E.push(" SYSTEM ",Je,">");else{var it=_.internalSubset;it&&E.push(" [",it,"]"),E.push(">")}return;case b:return E.push("<?",_.target," ",_.data,"?>");case p:return E.push("&",_.nodeName,";");default:E.push("??",_.nodeName)}}function ce(_,E,M){var K;switch(E.nodeType){case c:K=E.cloneNode(!1),K.ownerDocument=_;case S:break;case l:M=!0;break}if(K||(K=E.cloneNode(!1)),K.ownerDocument=_,K.parentNode=null,M)for(var ge=E.firstChild;ge;)K.appendChild(ce(_,ge,M)),ge=ge.nextSibling;return K}function ue(_,E,M){var K=new E.constructor;for(var ge in E){var je=E[ge];typeof je!="object"&&je!=K[ge]&&(K[ge]=je)}switch(E.childNodes&&(K.childNodes=new D),K.ownerDocument=_,K.nodeType){case c:var we=E.attributes,ve=K.attributes=new U,Le=we.length;ve._ownerElement=K;for(var Ae=0;Ae<Le;Ae++)K.setAttributeNode(ue(_,we.item(Ae),!0));break;case l:M=!0}if(M)for(var Pe=E.firstChild;Pe;)K.appendChild(ue(_,Pe,M)),Pe=Pe.nextSibling;return K}function X(_,E,M){_[E]=M}try{if(Object.defineProperty){let _=function(E){switch(E.nodeType){case c:case S:var M=[];for(E=E.firstChild;E;)E.nodeType!==7&&E.nodeType!==8&&M.push(_(E)),E=E.nextSibling;return M.join("");default:return E.nodeValue}};Object.defineProperty(W.prototype,"length",{get:function(){return F(this),this.$$length}}),Object.defineProperty(C.prototype,"textContent",{get:function(){return _(this)},set:function(E){switch(this.nodeType){case c:case S:for(;this.firstChild;)this.removeChild(this.firstChild);(E||String(E))&&this.appendChild(this.ownerDocument.createTextNode(E));break;default:this.data=E,this.value=E,this.nodeValue=E}}}),X=function(E,M,K){E["$$"+M]=K}}}catch{}return js.Node=C,js.DOMException=I,js.DOMImplementation=H,js.XMLSerializer=de,js}var gh;function yw(){if(gh)return Cs;gh=1;function r(x){this.options=x||{locator:{}}}r.prototype.parseFromString=function(x,y){var S=this.options,g=new h,w=S.domBuilder||new n,N=S.errorHandler,A=S.locator,L=S.xmlns||{},T=/\/x?html?$/.test(y),I=T?f.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return A&&w.setDocumentLocator(A),g.errorHandler=s(N,w,A),g.domBuilder=S.domBuilder||w,T&&(L[""]="http://www.w3.org/1999/xhtml"),L.xml=L.xml||"http://www.w3.org/XML/1998/namespace",x&&typeof x=="string"?g.parse(x,L,I):g.errorHandler.error("invalid doc source"),w.doc};function s(x,y,S){if(!x){if(y instanceof n)return y;x=y}var g={},w=x instanceof Function;S=S||{};function N(A){var L=x[A];!L&&w&&(L=x.length==2?function(T){x(A,T)}:x),g[A]=L&&function(T){L("[xmldom "+A+"]	"+T+c(S))}||function(){}}return N("warning"),N("error"),N("fatalError"),g}function n(){this.cdata=!1}function o(x,y){y.lineNumber=x.lineNumber,y.columnNumber=x.columnNumber}n.prototype={startDocument:function(){this.doc=new k().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(x,y,S,g){var w=this.doc,N=w.createElementNS(x,S||y),A=g.length;u(this,N),this.currentElement=N,this.locator&&o(this.locator,N);for(var L=0;L<A;L++){var x=g.getURI(L),T=g.getValue(L),S=g.getQName(L),I=w.createAttributeNS(x,S);this.locator&&o(g.getLocator(L),I),I.value=I.nodeValue=T,N.setAttributeNode(I)}},endElement:function(x,y,S){var g=this.currentElement;g.tagName,this.currentElement=g.parentNode},startPrefixMapping:function(x,y){},endPrefixMapping:function(x){},processingInstruction:function(x,y){var S=this.doc.createProcessingInstruction(x,y);this.locator&&o(this.locator,S),u(this,S)},ignorableWhitespace:function(x,y,S){},characters:function(x,y,S){if(x=l.apply(this,arguments),x){if(this.cdata)var g=this.doc.createCDATASection(x);else var g=this.doc.createTextNode(x);this.currentElement?this.currentElement.appendChild(g):/^\s*$/.test(x)&&this.doc.appendChild(g),this.locator&&o(this.locator,g)}},skippedEntity:function(x){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(x){(this.locator=x)&&(x.lineNumber=0)},comment:function(x,y,S){x=l.apply(this,arguments);var g=this.doc.createComment(x);this.locator&&o(this.locator,g),u(this,g)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(x,y,S){var g=this.doc.implementation;if(g&&g.createDocumentType){var w=g.createDocumentType(x,y,S);this.locator&&o(this.locator,w),u(this,w)}},warning:function(x){console.warn("[xmldom warning]	"+x,c(this.locator))},error:function(x){console.error("[xmldom error]	"+x,c(this.locator))},fatalError:function(x){throw new b(x,this.locator)}};function c(x){if(x)return`
@`+(x.systemId||"")+"#[line:"+x.lineNumber+",col:"+x.columnNumber+"]"}function l(x,y,S){return typeof x=="string"?x.substr(y,S):x.length>=y+S||y?new java.lang.String(x,y,S)+"":x}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(x){n.prototype[x]=function(){return null}});function u(x,y){x.currentElement?x.currentElement.appendChild(y):x.doc.appendChild(y)}var f=mw(),p=gw(),h=p.XMLReader,b=p.ParseError,k=Cs.DOMImplementation=mh().DOMImplementation;return Cs.XMLSerializer=mh().XMLSerializer,Cs.DOMParser=r,Cs.__DOMHandler=n,Cs}var vw=yw();const xw={},ww={},bw={},kw={};function Sw(r){const n=new vw.DOMParser().parseFromString(r,"application/xml"),o=D=>n.getElementsByTagName(D)[0]?.textContent?.trim()||void 0,c=D=>Array.from(n.getElementsByTagName(D)).map(W=>W.textContent?.trim()||"").filter(Boolean),l=D=>{const W=n.getElementsByTagName("meta"),F=[];for(let U=0;U<W.length;U++){const V=W[U];if(V.getAttribute("property")===D){const ie=V.textContent?.trim();ie&&F.push(ie)}}return F},u=o("dc:title")||l("schema:title")[0],f=o("dc:creator")||l("schema:creator")[0],p=o("dc:publisher")||l("schema:publisher")[0],h=o("dc:date")||l("schema:date")[0],b=o("dc:language")||l("schema:language")[0],k=o("dc:rights")||l("schema:rights")[0],x=o("dc:description")||l("schema:description")[0],y=c("dc:subject").concat(l("schema:subject")),S=c("dc:identifier").concat(l("schema:identifier")),g=l("schema:accessMode").concat(c("dcterms:accessMode"),c("schema:accessMode")),w=l("schema:accessibilityFeature").concat(c("dcterms:accessibilityFeature"),c("schema:accessibilityFeature")),N=l("schema:accessibilityHazard").concat(c("dcterms:accessibilityHazard"),c("schema:accessibilityHazard")),A=l("schema:accessibilitySummary")[0]||o("schema:accessibilitySummary")||o("dcterms:accessibilitySummary"),L=l("schema:accessModeSufficient").concat(c("schema:accessModeSufficient"),c("dcterms:accessModeSufficient")),T=l("schema:accessibilityConformsTo").concat(c("dcterms:conformsTo"),c("schema:accessibilityConformsTo")),I=l("schema:accessibilityCertification")[0]||o("dcterms:certifiedBy")||o("schema:accessibilityCertification");return{title:u,author:f,publisher:p,publicationDate:h,language:b,rights:k,description:x,subjects:y.length?y:void 0,identifiers:S.length?S:void 0,accessModes:g.length?g:void 0,accessibilityFeatures:w.length?w:void 0,hazards:N.length?N:void 0,accessibilitySummary:A,accessModesSufficient:L.length?L:void 0,certificationConformsTo:T.length?T:void 0,certification:I}}function Nw(r){const s=(r.accessibilityFeature||[]).map(u=>xw[u]||u).join(", "),n=(r.accessibilityHazard||[]).map(u=>ww[u]||u).join(", "),o=(r.accessMode||[]).map(u=>bw[u]||u).join(", "),c=(r.accessibilityConformsTo||[]).map(u=>kw[u]||u).join(", ");let l="";return s&&(l+=`Features: ${s}. `),n&&(l+=`Hazards: ${n}. `),o&&(l+=`Access Modes: ${o}. `),c&&(l+=`Conforms to: ${c}. `),r.accessibilitySummary&&(l+=`Summary: ${r.accessibilitySummary}`),l.trim()}function Cw(r){const s=Sw(r),n=Nw(s);return{...s,accessibilityFeedback:n,opfRaw:r}}function Oo(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Kl={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var yh;function jw(){return yh||(yh=1,(function(r,s){(function(n){r.exports=n()})(function(){return(function n(o,c,l){function u(h,b){if(!c[h]){if(!o[h]){var k=typeof Oo=="function"&&Oo;if(!b&&k)return k(h,!0);if(f)return f(h,!0);var x=new Error("Cannot find module '"+h+"'");throw x.code="MODULE_NOT_FOUND",x}var y=c[h]={exports:{}};o[h][0].call(y.exports,function(S){var g=o[h][1][S];return u(g||S)},y,y.exports,n,o,c,l)}return c[h].exports}for(var f=typeof Oo=="function"&&Oo,p=0;p<l.length;p++)u(l[p]);return u})({1:[function(n,o,c){var l=n("./utils"),u=n("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(p){for(var h,b,k,x,y,S,g,w=[],N=0,A=p.length,L=A,T=l.getTypeOf(p)!=="string";N<p.length;)L=A-N,k=T?(h=p[N++],b=N<A?p[N++]:0,N<A?p[N++]:0):(h=p.charCodeAt(N++),b=N<A?p.charCodeAt(N++):0,N<A?p.charCodeAt(N++):0),x=h>>2,y=(3&h)<<4|b>>4,S=1<L?(15&b)<<2|k>>6:64,g=2<L?63&k:64,w.push(f.charAt(x)+f.charAt(y)+f.charAt(S)+f.charAt(g));return w.join("")},c.decode=function(p){var h,b,k,x,y,S,g=0,w=0,N="data:";if(p.substr(0,N.length)===N)throw new Error("Invalid base64 input, it looks like a data url.");var A,L=3*(p=p.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(p.charAt(p.length-1)===f.charAt(64)&&L--,p.charAt(p.length-2)===f.charAt(64)&&L--,L%1!=0)throw new Error("Invalid base64 input, bad content length.");for(A=u.uint8array?new Uint8Array(0|L):new Array(0|L);g<p.length;)h=f.indexOf(p.charAt(g++))<<2|(x=f.indexOf(p.charAt(g++)))>>4,b=(15&x)<<4|(y=f.indexOf(p.charAt(g++)))>>2,k=(3&y)<<6|(S=f.indexOf(p.charAt(g++))),A[w++]=h,y!==64&&(A[w++]=b),S!==64&&(A[w++]=k);return A}},{"./support":30,"./utils":32}],2:[function(n,o,c){var l=n("./external"),u=n("./stream/DataWorker"),f=n("./stream/Crc32Probe"),p=n("./stream/DataLengthProbe");function h(b,k,x,y,S){this.compressedSize=b,this.uncompressedSize=k,this.crc32=x,this.compression=y,this.compressedContent=S}h.prototype={getContentWorker:function(){var b=new u(l.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new p("data_length")),k=this;return b.on("end",function(){if(this.streamInfo.data_length!==k.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),b},getCompressedWorker:function(){return new u(l.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(b,k,x){return b.pipe(new f).pipe(new p("uncompressedSize")).pipe(k.compressWorker(x)).pipe(new p("compressedSize")).withStreamInfo("compression",k)},o.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,o,c){var l=n("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(){return new l("STORE compression")},uncompressWorker:function(){return new l("STORE decompression")}},c.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,o,c){var l=n("./utils"),u=(function(){for(var f,p=[],h=0;h<256;h++){f=h;for(var b=0;b<8;b++)f=1&f?3988292384^f>>>1:f>>>1;p[h]=f}return p})();o.exports=function(f,p){return f!==void 0&&f.length?l.getTypeOf(f)!=="string"?(function(h,b,k,x){var y=u,S=x+k;h^=-1;for(var g=x;g<S;g++)h=h>>>8^y[255&(h^b[g])];return-1^h})(0|p,f,f.length,0):(function(h,b,k,x){var y=u,S=x+k;h^=-1;for(var g=x;g<S;g++)h=h>>>8^y[255&(h^b.charCodeAt(g))];return-1^h})(0|p,f,f.length,0):0}},{"./utils":32}],5:[function(n,o,c){c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(n,o,c){var l=null;l=typeof Promise<"u"?Promise:n("lie"),o.exports={Promise:l}},{lie:37}],7:[function(n,o,c){var l=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",u=n("pako"),f=n("./utils"),p=n("./stream/GenericWorker"),h=l?"uint8array":"array";function b(k,x){p.call(this,"FlateWorker/"+k),this._pako=null,this._pakoAction=k,this._pakoOptions=x,this.meta={}}c.magic="\b\0",f.inherits(b,p),b.prototype.processChunk=function(k){this.meta=k.meta,this._pako===null&&this._createPako(),this._pako.push(f.transformTo(h,k.data),!1)},b.prototype.flush=function(){p.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},b.prototype.cleanUp=function(){p.prototype.cleanUp.call(this),this._pako=null},b.prototype._createPako=function(){this._pako=new u[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var k=this;this._pako.onData=function(x){k.push({data:x,meta:k.meta})}},c.compressWorker=function(k){return new b("Deflate",k)},c.uncompressWorker=function(){return new b("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,o,c){function l(y,S){var g,w="";for(g=0;g<S;g++)w+=String.fromCharCode(255&y),y>>>=8;return w}function u(y,S,g,w,N,A){var L,T,I=y.file,D=y.compression,W=A!==h.utf8encode,F=f.transformTo("string",A(I.name)),U=f.transformTo("string",h.utf8encode(I.name)),V=I.comment,ie=f.transformTo("string",A(V)),B=f.transformTo("string",h.utf8encode(V)),H=U.length!==I.name.length,C=B.length!==V.length,Q="",ae="",J="",te=I.dir,re=I.date,ee={crc32:0,compressedSize:0,uncompressedSize:0};S&&!g||(ee.crc32=y.crc32,ee.compressedSize=y.compressedSize,ee.uncompressedSize=y.uncompressedSize);var P=0;S&&(P|=8),W||!H&&!C||(P|=2048);var $=0,ye=0;te&&($|=16),N==="UNIX"?(ye=798,$|=(function(oe,be){var Se=oe;return oe||(Se=be?16893:33204),(65535&Se)<<16})(I.unixPermissions,te)):(ye=20,$|=(function(oe){return 63&(oe||0)})(I.dosPermissions)),L=re.getUTCHours(),L<<=6,L|=re.getUTCMinutes(),L<<=5,L|=re.getUTCSeconds()/2,T=re.getUTCFullYear()-1980,T<<=4,T|=re.getUTCMonth()+1,T<<=5,T|=re.getUTCDate(),H&&(ae=l(1,1)+l(b(F),4)+U,Q+="up"+l(ae.length,2)+ae),C&&(J=l(1,1)+l(b(ie),4)+B,Q+="uc"+l(J.length,2)+J);var fe="";return fe+=`
\0`,fe+=l(P,2),fe+=D.magic,fe+=l(L,2),fe+=l(T,2),fe+=l(ee.crc32,4),fe+=l(ee.compressedSize,4),fe+=l(ee.uncompressedSize,4),fe+=l(F.length,2),fe+=l(Q.length,2),{fileRecord:k.LOCAL_FILE_HEADER+fe+F+Q,dirRecord:k.CENTRAL_FILE_HEADER+l(ye,2)+fe+l(ie.length,2)+"\0\0\0\0"+l($,4)+l(w,4)+F+Q+ie}}var f=n("../utils"),p=n("../stream/GenericWorker"),h=n("../utf8"),b=n("../crc32"),k=n("../signature");function x(y,S,g,w){p.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=S,this.zipPlatform=g,this.encodeFileName=w,this.streamFiles=y,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}f.inherits(x,p),x.prototype.push=function(y){var S=y.meta.percent||0,g=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(y):(this.bytesWritten+=y.data.length,p.prototype.push.call(this,{data:y.data,meta:{currentFile:this.currentFile,percent:g?(S+100*(g-w-1))/g:100}}))},x.prototype.openedSource=function(y){this.currentSourceOffset=this.bytesWritten,this.currentFile=y.file.name;var S=this.streamFiles&&!y.file.dir;if(S){var g=u(y,S,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},x.prototype.closedSource=function(y){this.accumulate=!1;var S=this.streamFiles&&!y.file.dir,g=u(y,S,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),S)this.push({data:(function(w){return k.DATA_DESCRIPTOR+l(w.crc32,4)+l(w.compressedSize,4)+l(w.uncompressedSize,4)})(y),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},x.prototype.flush=function(){for(var y=this.bytesWritten,S=0;S<this.dirRecords.length;S++)this.push({data:this.dirRecords[S],meta:{percent:100}});var g=this.bytesWritten-y,w=(function(N,A,L,T,I){var D=f.transformTo("string",I(T));return k.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(N,2)+l(N,2)+l(A,4)+l(L,4)+l(D.length,2)+D})(this.dirRecords.length,g,y,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},x.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},x.prototype.registerPrevious=function(y){this._sources.push(y);var S=this;return y.on("data",function(g){S.processChunk(g)}),y.on("end",function(){S.closedSource(S.previous.streamInfo),S._sources.length?S.prepareNextSource():S.end()}),y.on("error",function(g){S.error(g)}),this},x.prototype.resume=function(){return!!p.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},x.prototype.error=function(y){var S=this._sources;if(!p.prototype.error.call(this,y))return!1;for(var g=0;g<S.length;g++)try{S[g].error(y)}catch{}return!0},x.prototype.lock=function(){p.prototype.lock.call(this);for(var y=this._sources,S=0;S<y.length;S++)y[S].lock()},o.exports=x},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,o,c){var l=n("../compressions"),u=n("./ZipFileWorker");c.generateWorker=function(f,p,h){var b=new u(p.streamFiles,h,p.platform,p.encodeFileName),k=0;try{f.forEach(function(x,y){k++;var S=(function(A,L){var T=A||L,I=l[T];if(!I)throw new Error(T+" is not a valid compression method !");return I})(y.options.compression,p.compression),g=y.options.compressionOptions||p.compressionOptions||{},w=y.dir,N=y.date;y._compressWorker(S,g).withStreamInfo("file",{name:x,dir:w,date:N,comment:y.comment||"",unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions}).pipe(b)}),b.entriesCount=k}catch(x){b.error(x)}return b}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,o,c){function l(){if(!(this instanceof l))return new l;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var u=new l;for(var f in this)typeof this[f]!="function"&&(u[f]=this[f]);return u}}(l.prototype=n("./object")).loadAsync=n("./load"),l.support=n("./support"),l.defaults=n("./defaults"),l.version="3.10.1",l.loadAsync=function(u,f){return new l().loadAsync(u,f)},l.external=n("./external"),o.exports=l},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,o,c){var l=n("./utils"),u=n("./external"),f=n("./utf8"),p=n("./zipEntries"),h=n("./stream/Crc32Probe"),b=n("./nodejsUtils");function k(x){return new u.Promise(function(y,S){var g=x.decompressed.getContentWorker().pipe(new h);g.on("error",function(w){S(w)}).on("end",function(){g.streamInfo.crc32!==x.decompressed.crc32?S(new Error("Corrupted zip : CRC32 mismatch")):y()}).resume()})}o.exports=function(x,y){var S=this;return y=l.extend(y||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode}),b.isNode&&b.isStream(x)?u.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):l.prepareContent("the loaded zip file",x,!0,y.optimizedBinaryString,y.base64).then(function(g){var w=new p(y);return w.load(g),w}).then(function(g){var w=[u.Promise.resolve(g)],N=g.files;if(y.checkCRC32)for(var A=0;A<N.length;A++)w.push(k(N[A]));return u.Promise.all(w)}).then(function(g){for(var w=g.shift(),N=w.files,A=0;A<N.length;A++){var L=N[A],T=L.fileNameStr,I=l.resolve(L.fileNameStr);S.file(I,L.decompressed,{binary:!0,optimizedBinaryString:!0,date:L.date,dir:L.dir,comment:L.fileCommentStr.length?L.fileCommentStr:null,unixPermissions:L.unixPermissions,dosPermissions:L.dosPermissions,createFolders:y.createFolders}),L.dir||(S.file(I).unsafeOriginalName=T)}return w.zipComment.length&&(S.comment=w.zipComment),S})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,o,c){var l=n("../utils"),u=n("../stream/GenericWorker");function f(p,h){u.call(this,"Nodejs stream input adapter for "+p),this._upstreamEnded=!1,this._bindStream(h)}l.inherits(f,u),f.prototype._bindStream=function(p){var h=this;(this._stream=p).pause(),p.on("data",function(b){h.push({data:b,meta:{percent:0}})}).on("error",function(b){h.isPaused?this.generatedError=b:h.error(b)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},f.prototype.pause=function(){return!!u.prototype.pause.call(this)&&(this._stream.pause(),!0)},f.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},o.exports=f},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,o,c){var l=n("readable-stream").Readable;function u(f,p,h){l.call(this,p),this._helper=f;var b=this;f.on("data",function(k,x){b.push(k)||b._helper.pause(),h&&h(x)}).on("error",function(k){b.emit("error",k)}).on("end",function(){b.push(null)})}n("../utils").inherits(u,l),u.prototype._read=function(){this._helper.resume()},o.exports=u},{"../utils":32,"readable-stream":16}],14:[function(n,o,c){o.exports={isNode:typeof Buffer<"u",newBufferFrom:function(l,u){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(l,u);if(typeof l=="number")throw new Error('The "data" argument must not be a number');return new Buffer(l,u)},allocBuffer:function(l){if(Buffer.alloc)return Buffer.alloc(l);var u=new Buffer(l);return u.fill(0),u},isBuffer:function(l){return Buffer.isBuffer(l)},isStream:function(l){return l&&typeof l.on=="function"&&typeof l.pause=="function"&&typeof l.resume=="function"}}},{}],15:[function(n,o,c){function l(I,D,W){var F,U=f.getTypeOf(D),V=f.extend(W||{},b);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(I=N(I)),V.createFolders&&(F=w(I))&&A.call(this,F,!0);var ie=U==="string"&&V.binary===!1&&V.base64===!1;W&&W.binary!==void 0||(V.binary=!ie),(D instanceof k&&D.uncompressedSize===0||V.dir||!D||D.length===0)&&(V.base64=!1,V.binary=!0,D="",V.compression="STORE",U="string");var B=null;B=D instanceof k||D instanceof p?D:S.isNode&&S.isStream(D)?new g(I,D):f.prepareContent(I,D,V.binary,V.optimizedBinaryString,V.base64);var H=new x(I,B,V);this.files[I]=H}var u=n("./utf8"),f=n("./utils"),p=n("./stream/GenericWorker"),h=n("./stream/StreamHelper"),b=n("./defaults"),k=n("./compressedObject"),x=n("./zipObject"),y=n("./generate"),S=n("./nodejsUtils"),g=n("./nodejs/NodejsStreamInputAdapter"),w=function(I){I.slice(-1)==="/"&&(I=I.substring(0,I.length-1));var D=I.lastIndexOf("/");return 0<D?I.substring(0,D):""},N=function(I){return I.slice(-1)!=="/"&&(I+="/"),I},A=function(I,D){return D=D!==void 0?D:b.createFolders,I=N(I),this.files[I]||l.call(this,I,null,{dir:!0,createFolders:D}),this.files[I]};function L(I){return Object.prototype.toString.call(I)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(I){var D,W,F;for(D in this.files)F=this.files[D],(W=D.slice(this.root.length,D.length))&&D.slice(0,this.root.length)===this.root&&I(W,F)},filter:function(I){var D=[];return this.forEach(function(W,F){I(W,F)&&D.push(F)}),D},file:function(I,D,W){if(arguments.length!==1)return I=this.root+I,l.call(this,I,D,W),this;if(L(I)){var F=I;return this.filter(function(V,ie){return!ie.dir&&F.test(V)})}var U=this.files[this.root+I];return U&&!U.dir?U:null},folder:function(I){if(!I)return this;if(L(I))return this.filter(function(U,V){return V.dir&&I.test(U)});var D=this.root+I,W=A.call(this,D),F=this.clone();return F.root=W.name,F},remove:function(I){I=this.root+I;var D=this.files[I];if(D||(I.slice(-1)!=="/"&&(I+="/"),D=this.files[I]),D&&!D.dir)delete this.files[I];else for(var W=this.filter(function(U,V){return V.name.slice(0,I.length)===I}),F=0;F<W.length;F++)delete this.files[W[F].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(I){var D,W={};try{if((W=f.extend(I||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:u.utf8encode})).type=W.type.toLowerCase(),W.compression=W.compression.toUpperCase(),W.type==="binarystring"&&(W.type="string"),!W.type)throw new Error("No output type specified.");f.checkSupport(W.type),W.platform!=="darwin"&&W.platform!=="freebsd"&&W.platform!=="linux"&&W.platform!=="sunos"||(W.platform="UNIX"),W.platform==="win32"&&(W.platform="DOS");var F=W.comment||this.comment||"";D=y.generateWorker(this,W,F)}catch(U){(D=new p("error")).error(U)}return new h(D,W.type||"string",W.mimeType)},generateAsync:function(I,D){return this.generateInternalStream(I).accumulate(D)},generateNodeStream:function(I,D){return(I=I||{}).type||(I.type="nodebuffer"),this.generateInternalStream(I).toNodejsStream(D)}};o.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,o,c){o.exports=n("stream")},{stream:void 0}],17:[function(n,o,c){var l=n("./DataReader");function u(f){l.call(this,f);for(var p=0;p<this.data.length;p++)f[p]=255&f[p]}n("../utils").inherits(u,l),u.prototype.byteAt=function(f){return this.data[this.zero+f]},u.prototype.lastIndexOfSignature=function(f){for(var p=f.charCodeAt(0),h=f.charCodeAt(1),b=f.charCodeAt(2),k=f.charCodeAt(3),x=this.length-4;0<=x;--x)if(this.data[x]===p&&this.data[x+1]===h&&this.data[x+2]===b&&this.data[x+3]===k)return x-this.zero;return-1},u.prototype.readAndCheckSignature=function(f){var p=f.charCodeAt(0),h=f.charCodeAt(1),b=f.charCodeAt(2),k=f.charCodeAt(3),x=this.readData(4);return p===x[0]&&h===x[1]&&b===x[2]&&k===x[3]},u.prototype.readData=function(f){if(this.checkOffset(f),f===0)return[];var p=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,p},o.exports=u},{"../utils":32,"./DataReader":18}],18:[function(n,o,c){var l=n("../utils");function u(f){this.data=f,this.length=f.length,this.index=0,this.zero=0}u.prototype={checkOffset:function(f){this.checkIndex(this.index+f)},checkIndex:function(f){if(this.length<this.zero+f||f<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+f+"). Corrupted zip ?")},setIndex:function(f){this.checkIndex(f),this.index=f},skip:function(f){this.setIndex(this.index+f)},byteAt:function(){},readInt:function(f){var p,h=0;for(this.checkOffset(f),p=this.index+f-1;p>=this.index;p--)h=(h<<8)+this.byteAt(p);return this.index+=f,h},readString:function(f){return l.transformTo("string",this.readData(f))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var f=this.readInt(4);return new Date(Date.UTC(1980+(f>>25&127),(f>>21&15)-1,f>>16&31,f>>11&31,f>>5&63,(31&f)<<1))}},o.exports=u},{"../utils":32}],19:[function(n,o,c){var l=n("./Uint8ArrayReader");function u(f){l.call(this,f)}n("../utils").inherits(u,l),u.prototype.readData=function(f){this.checkOffset(f);var p=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,p},o.exports=u},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,o,c){var l=n("./DataReader");function u(f){l.call(this,f)}n("../utils").inherits(u,l),u.prototype.byteAt=function(f){return this.data.charCodeAt(this.zero+f)},u.prototype.lastIndexOfSignature=function(f){return this.data.lastIndexOf(f)-this.zero},u.prototype.readAndCheckSignature=function(f){return f===this.readData(4)},u.prototype.readData=function(f){this.checkOffset(f);var p=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,p},o.exports=u},{"../utils":32,"./DataReader":18}],21:[function(n,o,c){var l=n("./ArrayReader");function u(f){l.call(this,f)}n("../utils").inherits(u,l),u.prototype.readData=function(f){if(this.checkOffset(f),f===0)return new Uint8Array(0);var p=this.data.subarray(this.zero+this.index,this.zero+this.index+f);return this.index+=f,p},o.exports=u},{"../utils":32,"./ArrayReader":17}],22:[function(n,o,c){var l=n("../utils"),u=n("../support"),f=n("./ArrayReader"),p=n("./StringReader"),h=n("./NodeBufferReader"),b=n("./Uint8ArrayReader");o.exports=function(k){var x=l.getTypeOf(k);return l.checkSupport(x),x!=="string"||u.uint8array?x==="nodebuffer"?new h(k):u.uint8array?new b(l.transformTo("uint8array",k)):new f(l.transformTo("array",k)):new p(k)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,o,c){c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,o,c){var l=n("./GenericWorker"),u=n("../utils");function f(p){l.call(this,"ConvertWorker to "+p),this.destType=p}u.inherits(f,l),f.prototype.processChunk=function(p){this.push({data:u.transformTo(this.destType,p.data),meta:p.meta})},o.exports=f},{"../utils":32,"./GenericWorker":28}],25:[function(n,o,c){var l=n("./GenericWorker"),u=n("../crc32");function f(){l.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(f,l),f.prototype.processChunk=function(p){this.streamInfo.crc32=u(p.data,this.streamInfo.crc32||0),this.push(p)},o.exports=f},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,o,c){var l=n("../utils"),u=n("./GenericWorker");function f(p){u.call(this,"DataLengthProbe for "+p),this.propName=p,this.withStreamInfo(p,0)}l.inherits(f,u),f.prototype.processChunk=function(p){if(p){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+p.data.length}u.prototype.processChunk.call(this,p)},o.exports=f},{"../utils":32,"./GenericWorker":28}],27:[function(n,o,c){var l=n("../utils"),u=n("./GenericWorker");function f(p){u.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,p.then(function(b){h.dataIsReady=!0,h.data=b,h.max=b&&b.length||0,h.type=l.getTypeOf(b),h.isPaused||h._tickAndRepeat()},function(b){h.error(b)})}l.inherits(f,u),f.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this.data=null},f.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,l.delay(this._tickAndRepeat,[],this)),!0)},f.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(l.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},f.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var p=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":p=this.data.substring(this.index,h);break;case"uint8array":p=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":p=this.data.slice(this.index,h)}return this.index=h,this.push({data:p,meta:{percent:this.max?this.index/this.max*100:0}})},o.exports=f},{"../utils":32,"./GenericWorker":28}],28:[function(n,o,c){function l(u){this.name=u||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}l.prototype={push:function(u){this.emit("data",u)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(u){this.emit("error",u)}return!0},error:function(u){return!this.isFinished&&(this.isPaused?this.generatedError=u:(this.isFinished=!0,this.emit("error",u),this.previous&&this.previous.error(u),this.cleanUp()),!0)},on:function(u,f){return this._listeners[u].push(f),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(u,f){if(this._listeners[u])for(var p=0;p<this._listeners[u].length;p++)this._listeners[u][p].call(this,f)},pipe:function(u){return u.registerPrevious(this)},registerPrevious:function(u){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=u.streamInfo,this.mergeStreamInfo(),this.previous=u;var f=this;return u.on("data",function(p){f.processChunk(p)}),u.on("end",function(){f.end()}),u.on("error",function(p){f.error(p)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var u=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),u=!0),this.previous&&this.previous.resume(),!u},flush:function(){},processChunk:function(u){this.push(u)},withStreamInfo:function(u,f){return this.extraStreamInfo[u]=f,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var u in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,u)&&(this.streamInfo[u]=this.extraStreamInfo[u])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var u="Worker "+this.name;return this.previous?this.previous+" -> "+u:u}},o.exports=l},{}],29:[function(n,o,c){var l=n("../utils"),u=n("./ConvertWorker"),f=n("./GenericWorker"),p=n("../base64"),h=n("../support"),b=n("../external"),k=null;if(h.nodestream)try{k=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function x(S,g){return new b.Promise(function(w,N){var A=[],L=S._internalType,T=S._outputType,I=S._mimeType;S.on("data",function(D,W){A.push(D),g&&g(W)}).on("error",function(D){A=[],N(D)}).on("end",function(){try{var D=(function(W,F,U){switch(W){case"blob":return l.newBlob(l.transformTo("arraybuffer",F),U);case"base64":return p.encode(F);default:return l.transformTo(W,F)}})(T,(function(W,F){var U,V=0,ie=null,B=0;for(U=0;U<F.length;U++)B+=F[U].length;switch(W){case"string":return F.join("");case"array":return Array.prototype.concat.apply([],F);case"uint8array":for(ie=new Uint8Array(B),U=0;U<F.length;U++)ie.set(F[U],V),V+=F[U].length;return ie;case"nodebuffer":return Buffer.concat(F);default:throw new Error("concat : unsupported type '"+W+"'")}})(L,A),I);w(D)}catch(W){N(W)}A=[]}).resume()})}function y(S,g,w){var N=g;switch(g){case"blob":case"arraybuffer":N="uint8array";break;case"base64":N="string"}try{this._internalType=N,this._outputType=g,this._mimeType=w,l.checkSupport(N),this._worker=S.pipe(new u(N)),S.lock()}catch(A){this._worker=new f("error"),this._worker.error(A)}}y.prototype={accumulate:function(S){return x(this,S)},on:function(S,g){var w=this;return S==="data"?this._worker.on(S,function(N){g.call(w,N.data,N.meta)}):this._worker.on(S,function(){l.delay(g,arguments,w)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(S){if(l.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new k(this,{objectMode:this._outputType!=="nodebuffer"},S)}},o.exports=y},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,o,c){if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",c.nodebuffer=typeof Buffer<"u",c.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")c.blob=!1;else{var l=new ArrayBuffer(0);try{c.blob=new Blob([l],{type:"application/zip"}).size===0}catch{try{var u=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);u.append(l),c.blob=u.getBlob("application/zip").size===0}catch{c.blob=!1}}}try{c.nodestream=!!n("readable-stream").Readable}catch{c.nodestream=!1}},{"readable-stream":16}],31:[function(n,o,c){for(var l=n("./utils"),u=n("./support"),f=n("./nodejsUtils"),p=n("./stream/GenericWorker"),h=new Array(256),b=0;b<256;b++)h[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;h[254]=h[254]=1;function k(){p.call(this,"utf-8 decode"),this.leftOver=null}function x(){p.call(this,"utf-8 encode")}c.utf8encode=function(y){return u.nodebuffer?f.newBufferFrom(y,"utf-8"):(function(S){var g,w,N,A,L,T=S.length,I=0;for(A=0;A<T;A++)(64512&(w=S.charCodeAt(A)))==55296&&A+1<T&&(64512&(N=S.charCodeAt(A+1)))==56320&&(w=65536+(w-55296<<10)+(N-56320),A++),I+=w<128?1:w<2048?2:w<65536?3:4;for(g=u.uint8array?new Uint8Array(I):new Array(I),A=L=0;L<I;A++)(64512&(w=S.charCodeAt(A)))==55296&&A+1<T&&(64512&(N=S.charCodeAt(A+1)))==56320&&(w=65536+(w-55296<<10)+(N-56320),A++),w<128?g[L++]=w:(w<2048?g[L++]=192|w>>>6:(w<65536?g[L++]=224|w>>>12:(g[L++]=240|w>>>18,g[L++]=128|w>>>12&63),g[L++]=128|w>>>6&63),g[L++]=128|63&w);return g})(y)},c.utf8decode=function(y){return u.nodebuffer?l.transformTo("nodebuffer",y).toString("utf-8"):(function(S){var g,w,N,A,L=S.length,T=new Array(2*L);for(g=w=0;g<L;)if((N=S[g++])<128)T[w++]=N;else if(4<(A=h[N]))T[w++]=65533,g+=A-1;else{for(N&=A===2?31:A===3?15:7;1<A&&g<L;)N=N<<6|63&S[g++],A--;1<A?T[w++]=65533:N<65536?T[w++]=N:(N-=65536,T[w++]=55296|N>>10&1023,T[w++]=56320|1023&N)}return T.length!==w&&(T.subarray?T=T.subarray(0,w):T.length=w),l.applyFromCharCode(T)})(y=l.transformTo(u.uint8array?"uint8array":"array",y))},l.inherits(k,p),k.prototype.processChunk=function(y){var S=l.transformTo(u.uint8array?"uint8array":"array",y.data);if(this.leftOver&&this.leftOver.length){if(u.uint8array){var g=S;(S=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),S.set(g,this.leftOver.length)}else S=this.leftOver.concat(S);this.leftOver=null}var w=(function(A,L){var T;for((L=L||A.length)>A.length&&(L=A.length),T=L-1;0<=T&&(192&A[T])==128;)T--;return T<0||T===0?L:T+h[A[T]]>L?T:L})(S),N=S;w!==S.length&&(u.uint8array?(N=S.subarray(0,w),this.leftOver=S.subarray(w,S.length)):(N=S.slice(0,w),this.leftOver=S.slice(w,S.length))),this.push({data:c.utf8decode(N),meta:y.meta})},k.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=k,l.inherits(x,p),x.prototype.processChunk=function(y){this.push({data:c.utf8encode(y.data),meta:y.meta})},c.Utf8EncodeWorker=x},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,o,c){var l=n("./support"),u=n("./base64"),f=n("./nodejsUtils"),p=n("./external");function h(g){return g}function b(g,w){for(var N=0;N<g.length;++N)w[N]=255&g.charCodeAt(N);return w}n("setimmediate"),c.newBlob=function(g,w){c.checkSupport("blob");try{return new Blob([g],{type:w})}catch{try{var N=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return N.append(g),N.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var k={stringifyByChunk:function(g,w,N){var A=[],L=0,T=g.length;if(T<=N)return String.fromCharCode.apply(null,g);for(;L<T;)w==="array"||w==="nodebuffer"?A.push(String.fromCharCode.apply(null,g.slice(L,Math.min(L+N,T)))):A.push(String.fromCharCode.apply(null,g.subarray(L,Math.min(L+N,T)))),L+=N;return A.join("")},stringifyByChar:function(g){for(var w="",N=0;N<g.length;N++)w+=String.fromCharCode(g[N]);return w},applyCanBeUsed:{uint8array:(function(){try{return l.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return l.nodebuffer&&String.fromCharCode.apply(null,f.allocBuffer(1)).length===1}catch{return!1}})()}};function x(g){var w=65536,N=c.getTypeOf(g),A=!0;if(N==="uint8array"?A=k.applyCanBeUsed.uint8array:N==="nodebuffer"&&(A=k.applyCanBeUsed.nodebuffer),A)for(;1<w;)try{return k.stringifyByChunk(g,N,w)}catch{w=Math.floor(w/2)}return k.stringifyByChar(g)}function y(g,w){for(var N=0;N<g.length;N++)w[N]=g[N];return w}c.applyFromCharCode=x;var S={};S.string={string:h,array:function(g){return b(g,new Array(g.length))},arraybuffer:function(g){return S.string.uint8array(g).buffer},uint8array:function(g){return b(g,new Uint8Array(g.length))},nodebuffer:function(g){return b(g,f.allocBuffer(g.length))}},S.array={string:x,array:h,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return f.newBufferFrom(g)}},S.arraybuffer={string:function(g){return x(new Uint8Array(g))},array:function(g){return y(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:h,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return f.newBufferFrom(new Uint8Array(g))}},S.uint8array={string:x,array:function(g){return y(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:h,nodebuffer:function(g){return f.newBufferFrom(g)}},S.nodebuffer={string:x,array:function(g){return y(g,new Array(g.length))},arraybuffer:function(g){return S.nodebuffer.uint8array(g).buffer},uint8array:function(g){return y(g,new Uint8Array(g.length))},nodebuffer:h},c.transformTo=function(g,w){if(w=w||"",!g)return w;c.checkSupport(g);var N=c.getTypeOf(w);return S[N][g](w)},c.resolve=function(g){for(var w=g.split("/"),N=[],A=0;A<w.length;A++){var L=w[A];L==="."||L===""&&A!==0&&A!==w.length-1||(L===".."?N.pop():N.push(L))}return N.join("/")},c.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":l.nodebuffer&&f.isBuffer(g)?"nodebuffer":l.uint8array&&g instanceof Uint8Array?"uint8array":l.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(g){if(!l[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(g){var w,N,A="";for(N=0;N<(g||"").length;N++)A+="\\x"+((w=g.charCodeAt(N))<16?"0":"")+w.toString(16).toUpperCase();return A},c.delay=function(g,w,N){setImmediate(function(){g.apply(N||null,w||[])})},c.inherits=function(g,w){function N(){}N.prototype=w.prototype,g.prototype=new N},c.extend=function(){var g,w,N={};for(g=0;g<arguments.length;g++)for(w in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],w)&&N[w]===void 0&&(N[w]=arguments[g][w]);return N},c.prepareContent=function(g,w,N,A,L){return p.Promise.resolve(w).then(function(T){return l.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new p.Promise(function(I,D){var W=new FileReader;W.onload=function(F){I(F.target.result)},W.onerror=function(F){D(F.target.error)},W.readAsArrayBuffer(T)}):T}).then(function(T){var I=c.getTypeOf(T);return I?(I==="arraybuffer"?T=c.transformTo("uint8array",T):I==="string"&&(L?T=u.decode(T):N&&A!==!0&&(T=(function(D){return b(D,l.uint8array?new Uint8Array(D.length):new Array(D.length))})(T))),T):p.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,o,c){var l=n("./reader/readerFor"),u=n("./utils"),f=n("./signature"),p=n("./zipEntry"),h=n("./support");function b(k){this.files=[],this.loadOptions=k}b.prototype={checkSignature:function(k){if(!this.reader.readAndCheckSignature(k)){this.reader.index-=4;var x=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+u.pretty(x)+", expected "+u.pretty(k)+")")}},isSignature:function(k,x){var y=this.reader.index;this.reader.setIndex(k);var S=this.reader.readString(4)===x;return this.reader.setIndex(y),S},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var k=this.reader.readData(this.zipCommentLength),x=h.uint8array?"uint8array":"array",y=u.transformTo(x,k);this.zipComment=this.loadOptions.decodeFileName(y)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var k,x,y,S=this.zip64EndOfCentralSize-44;0<S;)k=this.reader.readInt(2),x=this.reader.readInt(4),y=this.reader.readData(x),this.zip64ExtensibleData[k]={id:k,length:x,value:y}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var k,x;for(k=0;k<this.files.length;k++)x=this.files[k],this.reader.setIndex(x.localHeaderOffset),this.checkSignature(f.LOCAL_FILE_HEADER),x.readLocalPart(this.reader),x.handleUTF8(),x.processAttributes()},readCentralDir:function(){var k;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);)(k=new p({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(k);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var k=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(k<0)throw this.isSignature(0,f.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(k);var x=k;if(this.checkSignature(f.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===u.MAX_VALUE_16BITS||this.diskWithCentralDirStart===u.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===u.MAX_VALUE_16BITS||this.centralDirRecords===u.MAX_VALUE_16BITS||this.centralDirSize===u.MAX_VALUE_32BITS||this.centralDirOffset===u.MAX_VALUE_32BITS){if(this.zip64=!0,(k=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(k),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var y=this.centralDirOffset+this.centralDirSize;this.zip64&&(y+=20,y+=12+this.zip64EndOfCentralSize);var S=x-y;if(0<S)this.isSignature(x,f.CENTRAL_FILE_HEADER)||(this.reader.zero=S);else if(S<0)throw new Error("Corrupted zip: missing "+Math.abs(S)+" bytes.")},prepareReader:function(k){this.reader=l(k)},load:function(k){this.prepareReader(k),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},o.exports=b},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,o,c){var l=n("./reader/readerFor"),u=n("./utils"),f=n("./compressedObject"),p=n("./crc32"),h=n("./utf8"),b=n("./compressions"),k=n("./support");function x(y,S){this.options=y,this.loadOptions=S}x.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(y){var S,g;if(y.skip(22),this.fileNameLength=y.readInt(2),g=y.readInt(2),this.fileName=y.readData(this.fileNameLength),y.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((S=(function(w){for(var N in b)if(Object.prototype.hasOwnProperty.call(b,N)&&b[N].magic===w)return b[N];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+u.pretty(this.compressionMethod)+" unknown (inner file : "+u.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,S,y.readData(this.compressedSize))},readCentralPart:function(y){this.versionMadeBy=y.readInt(2),y.skip(2),this.bitFlag=y.readInt(2),this.compressionMethod=y.readString(2),this.date=y.readDate(),this.crc32=y.readInt(4),this.compressedSize=y.readInt(4),this.uncompressedSize=y.readInt(4);var S=y.readInt(2);if(this.extraFieldsLength=y.readInt(2),this.fileCommentLength=y.readInt(2),this.diskNumberStart=y.readInt(2),this.internalFileAttributes=y.readInt(2),this.externalFileAttributes=y.readInt(4),this.localHeaderOffset=y.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");y.skip(S),this.readExtraFields(y),this.parseZIP64ExtraField(y),this.fileComment=y.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var y=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),y==0&&(this.dosPermissions=63&this.externalFileAttributes),y==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var y=l(this.extraFields[1].value);this.uncompressedSize===u.MAX_VALUE_32BITS&&(this.uncompressedSize=y.readInt(8)),this.compressedSize===u.MAX_VALUE_32BITS&&(this.compressedSize=y.readInt(8)),this.localHeaderOffset===u.MAX_VALUE_32BITS&&(this.localHeaderOffset=y.readInt(8)),this.diskNumberStart===u.MAX_VALUE_32BITS&&(this.diskNumberStart=y.readInt(4))}},readExtraFields:function(y){var S,g,w,N=y.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});y.index+4<N;)S=y.readInt(2),g=y.readInt(2),w=y.readData(g),this.extraFields[S]={id:S,length:g,value:w};y.setIndex(N)},handleUTF8:function(){var y=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var S=this.findExtraFieldUnicodePath();if(S!==null)this.fileNameStr=S;else{var g=u.transformTo(y,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var N=u.transformTo(y,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(N)}}},findExtraFieldUnicodePath:function(){var y=this.extraFields[28789];if(y){var S=l(y.value);return S.readInt(1)!==1||p(this.fileName)!==S.readInt(4)?null:h.utf8decode(S.readData(y.length-5))}return null},findExtraFieldUnicodeComment:function(){var y=this.extraFields[25461];if(y){var S=l(y.value);return S.readInt(1)!==1||p(this.fileComment)!==S.readInt(4)?null:h.utf8decode(S.readData(y.length-5))}return null}},o.exports=x},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,o,c){function l(S,g,w){this.name=S,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=g,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var u=n("./stream/StreamHelper"),f=n("./stream/DataWorker"),p=n("./utf8"),h=n("./compressedObject"),b=n("./stream/GenericWorker");l.prototype={internalStream:function(S){var g=null,w="string";try{if(!S)throw new Error("No output type specified.");var N=(w=S.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),g=this._decompressWorker();var A=!this._dataBinary;A&&!N&&(g=g.pipe(new p.Utf8EncodeWorker)),!A&&N&&(g=g.pipe(new p.Utf8DecodeWorker))}catch(L){(g=new b("error")).error(L)}return new u(g,w,"")},async:function(S,g){return this.internalStream(S).accumulate(g)},nodeStream:function(S,g){return this.internalStream(S||"nodebuffer").toNodejsStream(g)},_compressWorker:function(S,g){if(this._data instanceof h&&this._data.compression.magic===S.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new p.Utf8EncodeWorker)),h.createWorkerFrom(w,S,g)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof b?this._data:new f(this._data)}};for(var k=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],x=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},y=0;y<k.length;y++)l.prototype[k[y]]=x;o.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,o,c){(function(l){var u,f,p=l.MutationObserver||l.WebKitMutationObserver;if(p){var h=0,b=new p(S),k=l.document.createTextNode("");b.observe(k,{characterData:!0}),u=function(){k.data=h=++h%2}}else if(l.setImmediate||l.MessageChannel===void 0)u="document"in l&&"onreadystatechange"in l.document.createElement("script")?function(){var g=l.document.createElement("script");g.onreadystatechange=function(){S(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},l.document.documentElement.appendChild(g)}:function(){setTimeout(S,0)};else{var x=new l.MessageChannel;x.port1.onmessage=S,u=function(){x.port2.postMessage(0)}}var y=[];function S(){var g,w;f=!0;for(var N=y.length;N;){for(w=y,y=[],g=-1;++g<N;)w[g]();N=y.length}f=!1}o.exports=function(g){y.push(g)!==1||f||u()}}).call(this,typeof Ao<"u"?Ao:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,o,c){var l=n("immediate");function u(){}var f={},p=["REJECTED"],h=["FULFILLED"],b=["PENDING"];function k(N){if(typeof N!="function")throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,N!==u&&g(this,N)}function x(N,A,L){this.promise=N,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof L=="function"&&(this.onRejected=L,this.callRejected=this.otherCallRejected)}function y(N,A,L){l(function(){var T;try{T=A(L)}catch(I){return f.reject(N,I)}T===N?f.reject(N,new TypeError("Cannot resolve promise with itself")):f.resolve(N,T)})}function S(N){var A=N&&N.then;if(N&&(typeof N=="object"||typeof N=="function")&&typeof A=="function")return function(){A.apply(N,arguments)}}function g(N,A){var L=!1;function T(W){L||(L=!0,f.reject(N,W))}function I(W){L||(L=!0,f.resolve(N,W))}var D=w(function(){A(I,T)});D.status==="error"&&T(D.value)}function w(N,A){var L={};try{L.value=N(A),L.status="success"}catch(T){L.status="error",L.value=T}return L}(o.exports=k).prototype.finally=function(N){if(typeof N!="function")return this;var A=this.constructor;return this.then(function(L){return A.resolve(N()).then(function(){return L})},function(L){return A.resolve(N()).then(function(){throw L})})},k.prototype.catch=function(N){return this.then(null,N)},k.prototype.then=function(N,A){if(typeof N!="function"&&this.state===h||typeof A!="function"&&this.state===p)return this;var L=new this.constructor(u);return this.state!==b?y(L,this.state===h?N:A,this.outcome):this.queue.push(new x(L,N,A)),L},x.prototype.callFulfilled=function(N){f.resolve(this.promise,N)},x.prototype.otherCallFulfilled=function(N){y(this.promise,this.onFulfilled,N)},x.prototype.callRejected=function(N){f.reject(this.promise,N)},x.prototype.otherCallRejected=function(N){y(this.promise,this.onRejected,N)},f.resolve=function(N,A){var L=w(S,A);if(L.status==="error")return f.reject(N,L.value);var T=L.value;if(T)g(N,T);else{N.state=h,N.outcome=A;for(var I=-1,D=N.queue.length;++I<D;)N.queue[I].callFulfilled(A)}return N},f.reject=function(N,A){N.state=p,N.outcome=A;for(var L=-1,T=N.queue.length;++L<T;)N.queue[L].callRejected(A);return N},k.resolve=function(N){return N instanceof this?N:f.resolve(new this(u),N)},k.reject=function(N){var A=new this(u);return f.reject(A,N)},k.all=function(N){var A=this;if(Object.prototype.toString.call(N)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=N.length,T=!1;if(!L)return this.resolve([]);for(var I=new Array(L),D=0,W=-1,F=new this(u);++W<L;)U(N[W],W);return F;function U(V,ie){A.resolve(V).then(function(B){I[ie]=B,++D!==L||T||(T=!0,f.resolve(F,I))},function(B){T||(T=!0,f.reject(F,B))})}},k.race=function(N){var A=this;if(Object.prototype.toString.call(N)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=N.length,T=!1;if(!L)return this.resolve([]);for(var I=-1,D=new this(u);++I<L;)W=N[I],A.resolve(W).then(function(F){T||(T=!0,f.resolve(D,F))},function(F){T||(T=!0,f.reject(D,F))});var W;return D}},{immediate:36}],38:[function(n,o,c){var l={};(0,n("./lib/utils/common").assign)(l,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),o.exports=l},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,o,c){var l=n("./zlib/deflate"),u=n("./utils/common"),f=n("./utils/strings"),p=n("./zlib/messages"),h=n("./zlib/zstream"),b=Object.prototype.toString,k=0,x=-1,y=0,S=8;function g(N){if(!(this instanceof g))return new g(N);this.options=u.assign({level:x,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:y,to:""},N||{});var A=this.options;A.raw&&0<A.windowBits?A.windowBits=-A.windowBits:A.gzip&&0<A.windowBits&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var L=l.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(L!==k)throw new Error(p[L]);if(A.header&&l.deflateSetHeader(this.strm,A.header),A.dictionary){var T;if(T=typeof A.dictionary=="string"?f.string2buf(A.dictionary):b.call(A.dictionary)==="[object ArrayBuffer]"?new Uint8Array(A.dictionary):A.dictionary,(L=l.deflateSetDictionary(this.strm,T))!==k)throw new Error(p[L]);this._dict_set=!0}}function w(N,A){var L=new g(A);if(L.push(N,!0),L.err)throw L.msg||p[L.err];return L.result}g.prototype.push=function(N,A){var L,T,I=this.strm,D=this.options.chunkSize;if(this.ended)return!1;T=A===~~A?A:A===!0?4:0,typeof N=="string"?I.input=f.string2buf(N):b.call(N)==="[object ArrayBuffer]"?I.input=new Uint8Array(N):I.input=N,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new u.Buf8(D),I.next_out=0,I.avail_out=D),(L=l.deflate(I,T))!==1&&L!==k)return this.onEnd(L),!(this.ended=!0);I.avail_out!==0&&(I.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(f.buf2binstring(u.shrinkBuf(I.output,I.next_out))):this.onData(u.shrinkBuf(I.output,I.next_out)))}while((0<I.avail_in||I.avail_out===0)&&L!==1);return T===4?(L=l.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===k):T!==2||(this.onEnd(k),!(I.avail_out=0))},g.prototype.onData=function(N){this.chunks.push(N)},g.prototype.onEnd=function(N){N===k&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.msg=this.strm.msg},c.Deflate=g,c.deflate=w,c.deflateRaw=function(N,A){return(A=A||{}).raw=!0,w(N,A)},c.gzip=function(N,A){return(A=A||{}).gzip=!0,w(N,A)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,o,c){var l=n("./zlib/inflate"),u=n("./utils/common"),f=n("./utils/strings"),p=n("./zlib/constants"),h=n("./zlib/messages"),b=n("./zlib/zstream"),k=n("./zlib/gzheader"),x=Object.prototype.toString;function y(g){if(!(this instanceof y))return new y(g);this.options=u.assign({chunkSize:16384,windowBits:0,to:""},g||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||g&&g.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&(15&w.windowBits)==0&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var N=l.inflateInit2(this.strm,w.windowBits);if(N!==p.Z_OK)throw new Error(h[N]);this.header=new k,l.inflateGetHeader(this.strm,this.header)}function S(g,w){var N=new y(w);if(N.push(g,!0),N.err)throw N.msg||h[N.err];return N.result}y.prototype.push=function(g,w){var N,A,L,T,I,D,W=this.strm,F=this.options.chunkSize,U=this.options.dictionary,V=!1;if(this.ended)return!1;A=w===~~w?w:w===!0?p.Z_FINISH:p.Z_NO_FLUSH,typeof g=="string"?W.input=f.binstring2buf(g):x.call(g)==="[object ArrayBuffer]"?W.input=new Uint8Array(g):W.input=g,W.next_in=0,W.avail_in=W.input.length;do{if(W.avail_out===0&&(W.output=new u.Buf8(F),W.next_out=0,W.avail_out=F),(N=l.inflate(W,p.Z_NO_FLUSH))===p.Z_NEED_DICT&&U&&(D=typeof U=="string"?f.string2buf(U):x.call(U)==="[object ArrayBuffer]"?new Uint8Array(U):U,N=l.inflateSetDictionary(this.strm,D)),N===p.Z_BUF_ERROR&&V===!0&&(N=p.Z_OK,V=!1),N!==p.Z_STREAM_END&&N!==p.Z_OK)return this.onEnd(N),!(this.ended=!0);W.next_out&&(W.avail_out!==0&&N!==p.Z_STREAM_END&&(W.avail_in!==0||A!==p.Z_FINISH&&A!==p.Z_SYNC_FLUSH)||(this.options.to==="string"?(L=f.utf8border(W.output,W.next_out),T=W.next_out-L,I=f.buf2string(W.output,L),W.next_out=T,W.avail_out=F-T,T&&u.arraySet(W.output,W.output,L,T,0),this.onData(I)):this.onData(u.shrinkBuf(W.output,W.next_out)))),W.avail_in===0&&W.avail_out===0&&(V=!0)}while((0<W.avail_in||W.avail_out===0)&&N!==p.Z_STREAM_END);return N===p.Z_STREAM_END&&(A=p.Z_FINISH),A===p.Z_FINISH?(N=l.inflateEnd(this.strm),this.onEnd(N),this.ended=!0,N===p.Z_OK):A!==p.Z_SYNC_FLUSH||(this.onEnd(p.Z_OK),!(W.avail_out=0))},y.prototype.onData=function(g){this.chunks.push(g)},y.prototype.onEnd=function(g){g===p.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},c.Inflate=y,c.inflate=S,c.inflateRaw=function(g,w){return(w=w||{}).raw=!0,S(g,w)},c.ungzip=S},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,o,c){var l=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";c.assign=function(p){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var b=h.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(var k in b)b.hasOwnProperty(k)&&(p[k]=b[k])}}return p},c.shrinkBuf=function(p,h){return p.length===h?p:p.subarray?p.subarray(0,h):(p.length=h,p)};var u={arraySet:function(p,h,b,k,x){if(h.subarray&&p.subarray)p.set(h.subarray(b,b+k),x);else for(var y=0;y<k;y++)p[x+y]=h[b+y]},flattenChunks:function(p){var h,b,k,x,y,S;for(h=k=0,b=p.length;h<b;h++)k+=p[h].length;for(S=new Uint8Array(k),h=x=0,b=p.length;h<b;h++)y=p[h],S.set(y,x),x+=y.length;return S}},f={arraySet:function(p,h,b,k,x){for(var y=0;y<k;y++)p[x+y]=h[b+y]},flattenChunks:function(p){return[].concat.apply([],p)}};c.setTyped=function(p){p?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,u)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(l)},{}],42:[function(n,o,c){var l=n("./common"),u=!0,f=!0;try{String.fromCharCode.apply(null,[0])}catch{u=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{f=!1}for(var p=new l.Buf8(256),h=0;h<256;h++)p[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function b(k,x){if(x<65537&&(k.subarray&&f||!k.subarray&&u))return String.fromCharCode.apply(null,l.shrinkBuf(k,x));for(var y="",S=0;S<x;S++)y+=String.fromCharCode(k[S]);return y}p[254]=p[254]=1,c.string2buf=function(k){var x,y,S,g,w,N=k.length,A=0;for(g=0;g<N;g++)(64512&(y=k.charCodeAt(g)))==55296&&g+1<N&&(64512&(S=k.charCodeAt(g+1)))==56320&&(y=65536+(y-55296<<10)+(S-56320),g++),A+=y<128?1:y<2048?2:y<65536?3:4;for(x=new l.Buf8(A),g=w=0;w<A;g++)(64512&(y=k.charCodeAt(g)))==55296&&g+1<N&&(64512&(S=k.charCodeAt(g+1)))==56320&&(y=65536+(y-55296<<10)+(S-56320),g++),y<128?x[w++]=y:(y<2048?x[w++]=192|y>>>6:(y<65536?x[w++]=224|y>>>12:(x[w++]=240|y>>>18,x[w++]=128|y>>>12&63),x[w++]=128|y>>>6&63),x[w++]=128|63&y);return x},c.buf2binstring=function(k){return b(k,k.length)},c.binstring2buf=function(k){for(var x=new l.Buf8(k.length),y=0,S=x.length;y<S;y++)x[y]=k.charCodeAt(y);return x},c.buf2string=function(k,x){var y,S,g,w,N=x||k.length,A=new Array(2*N);for(y=S=0;y<N;)if((g=k[y++])<128)A[S++]=g;else if(4<(w=p[g]))A[S++]=65533,y+=w-1;else{for(g&=w===2?31:w===3?15:7;1<w&&y<N;)g=g<<6|63&k[y++],w--;1<w?A[S++]=65533:g<65536?A[S++]=g:(g-=65536,A[S++]=55296|g>>10&1023,A[S++]=56320|1023&g)}return b(A,S)},c.utf8border=function(k,x){var y;for((x=x||k.length)>k.length&&(x=k.length),y=x-1;0<=y&&(192&k[y])==128;)y--;return y<0||y===0?x:y+p[k[y]]>x?y:x}},{"./common":41}],43:[function(n,o,c){o.exports=function(l,u,f,p){for(var h=65535&l|0,b=l>>>16&65535|0,k=0;f!==0;){for(f-=k=2e3<f?2e3:f;b=b+(h=h+u[p++]|0)|0,--k;);h%=65521,b%=65521}return h|b<<16|0}},{}],44:[function(n,o,c){o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,o,c){var l=(function(){for(var u,f=[],p=0;p<256;p++){u=p;for(var h=0;h<8;h++)u=1&u?3988292384^u>>>1:u>>>1;f[p]=u}return f})();o.exports=function(u,f,p,h){var b=l,k=h+p;u^=-1;for(var x=h;x<k;x++)u=u>>>8^b[255&(u^f[x])];return-1^u}},{}],46:[function(n,o,c){var l,u=n("../utils/common"),f=n("./trees"),p=n("./adler32"),h=n("./crc32"),b=n("./messages"),k=0,x=4,y=0,S=-2,g=-1,w=4,N=2,A=8,L=9,T=286,I=30,D=19,W=2*T+1,F=15,U=3,V=258,ie=V+U+1,B=42,H=113,C=1,Q=2,ae=3,J=4;function te(j,he){return j.msg=b[he],he}function re(j){return(j<<1)-(4<j?9:0)}function ee(j){for(var he=j.length;0<=--he;)j[he]=0}function P(j){var he=j.state,de=he.pending;de>j.avail_out&&(de=j.avail_out),de!==0&&(u.arraySet(j.output,he.pending_buf,he.pending_out,de,j.next_out),j.next_out+=de,he.pending_out+=de,j.total_out+=de,j.avail_out-=de,he.pending-=de,he.pending===0&&(he.pending_out=0))}function $(j,he){f._tr_flush_block(j,0<=j.block_start?j.block_start:-1,j.strstart-j.block_start,he),j.block_start=j.strstart,P(j.strm)}function ye(j,he){j.pending_buf[j.pending++]=he}function fe(j,he){j.pending_buf[j.pending++]=he>>>8&255,j.pending_buf[j.pending++]=255&he}function oe(j,he){var de,q,z=j.max_chain_length,Z=j.strstart,ce=j.prev_length,ue=j.nice_match,X=j.strstart>j.w_size-ie?j.strstart-(j.w_size-ie):0,_=j.window,E=j.w_mask,M=j.prev,K=j.strstart+V,ge=_[Z+ce-1],je=_[Z+ce];j.prev_length>=j.good_match&&(z>>=2),ue>j.lookahead&&(ue=j.lookahead);do if(_[(de=he)+ce]===je&&_[de+ce-1]===ge&&_[de]===_[Z]&&_[++de]===_[Z+1]){Z+=2,de++;do;while(_[++Z]===_[++de]&&_[++Z]===_[++de]&&_[++Z]===_[++de]&&_[++Z]===_[++de]&&_[++Z]===_[++de]&&_[++Z]===_[++de]&&_[++Z]===_[++de]&&_[++Z]===_[++de]&&Z<K);if(q=V-(K-Z),Z=K-V,ce<q){if(j.match_start=he,ue<=(ce=q))break;ge=_[Z+ce-1],je=_[Z+ce]}}while((he=M[he&E])>X&&--z!=0);return ce<=j.lookahead?ce:j.lookahead}function be(j){var he,de,q,z,Z,ce,ue,X,_,E,M=j.w_size;do{if(z=j.window_size-j.lookahead-j.strstart,j.strstart>=M+(M-ie)){for(u.arraySet(j.window,j.window,M,M,0),j.match_start-=M,j.strstart-=M,j.block_start-=M,he=de=j.hash_size;q=j.head[--he],j.head[he]=M<=q?q-M:0,--de;);for(he=de=M;q=j.prev[--he],j.prev[he]=M<=q?q-M:0,--de;);z+=M}if(j.strm.avail_in===0)break;if(ce=j.strm,ue=j.window,X=j.strstart+j.lookahead,_=z,E=void 0,E=ce.avail_in,_<E&&(E=_),de=E===0?0:(ce.avail_in-=E,u.arraySet(ue,ce.input,ce.next_in,E,X),ce.state.wrap===1?ce.adler=p(ce.adler,ue,E,X):ce.state.wrap===2&&(ce.adler=h(ce.adler,ue,E,X)),ce.next_in+=E,ce.total_in+=E,E),j.lookahead+=de,j.lookahead+j.insert>=U)for(Z=j.strstart-j.insert,j.ins_h=j.window[Z],j.ins_h=(j.ins_h<<j.hash_shift^j.window[Z+1])&j.hash_mask;j.insert&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[Z+U-1])&j.hash_mask,j.prev[Z&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=Z,Z++,j.insert--,!(j.lookahead+j.insert<U)););}while(j.lookahead<ie&&j.strm.avail_in!==0)}function Se(j,he){for(var de,q;;){if(j.lookahead<ie){if(be(j),j.lookahead<ie&&he===k)return C;if(j.lookahead===0)break}if(de=0,j.lookahead>=U&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+U-1])&j.hash_mask,de=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),de!==0&&j.strstart-de<=j.w_size-ie&&(j.match_length=oe(j,de)),j.match_length>=U)if(q=f._tr_tally(j,j.strstart-j.match_start,j.match_length-U),j.lookahead-=j.match_length,j.match_length<=j.max_lazy_match&&j.lookahead>=U){for(j.match_length--;j.strstart++,j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+U-1])&j.hash_mask,de=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart,--j.match_length!=0;);j.strstart++}else j.strstart+=j.match_length,j.match_length=0,j.ins_h=j.window[j.strstart],j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+1])&j.hash_mask;else q=f._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++;if(q&&($(j,!1),j.strm.avail_out===0))return C}return j.insert=j.strstart<U-1?j.strstart:U-1,he===x?($(j,!0),j.strm.avail_out===0?ae:J):j.last_lit&&($(j,!1),j.strm.avail_out===0)?C:Q}function ke(j,he){for(var de,q,z;;){if(j.lookahead<ie){if(be(j),j.lookahead<ie&&he===k)return C;if(j.lookahead===0)break}if(de=0,j.lookahead>=U&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+U-1])&j.hash_mask,de=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),j.prev_length=j.match_length,j.prev_match=j.match_start,j.match_length=U-1,de!==0&&j.prev_length<j.max_lazy_match&&j.strstart-de<=j.w_size-ie&&(j.match_length=oe(j,de),j.match_length<=5&&(j.strategy===1||j.match_length===U&&4096<j.strstart-j.match_start)&&(j.match_length=U-1)),j.prev_length>=U&&j.match_length<=j.prev_length){for(z=j.strstart+j.lookahead-U,q=f._tr_tally(j,j.strstart-1-j.prev_match,j.prev_length-U),j.lookahead-=j.prev_length-1,j.prev_length-=2;++j.strstart<=z&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+U-1])&j.hash_mask,de=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),--j.prev_length!=0;);if(j.match_available=0,j.match_length=U-1,j.strstart++,q&&($(j,!1),j.strm.avail_out===0))return C}else if(j.match_available){if((q=f._tr_tally(j,0,j.window[j.strstart-1]))&&$(j,!1),j.strstart++,j.lookahead--,j.strm.avail_out===0)return C}else j.match_available=1,j.strstart++,j.lookahead--}return j.match_available&&(q=f._tr_tally(j,0,j.window[j.strstart-1]),j.match_available=0),j.insert=j.strstart<U-1?j.strstart:U-1,he===x?($(j,!0),j.strm.avail_out===0?ae:J):j.last_lit&&($(j,!1),j.strm.avail_out===0)?C:Q}function _e(j,he,de,q,z){this.good_length=j,this.max_lazy=he,this.nice_length=de,this.max_chain=q,this.func=z}function De(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new u.Buf16(2*W),this.dyn_dtree=new u.Buf16(2*(2*I+1)),this.bl_tree=new u.Buf16(2*(2*D+1)),ee(this.dyn_ltree),ee(this.dyn_dtree),ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new u.Buf16(F+1),this.heap=new u.Buf16(2*T+1),ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new u.Buf16(2*T+1),ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ve(j){var he;return j&&j.state?(j.total_in=j.total_out=0,j.data_type=N,(he=j.state).pending=0,he.pending_out=0,he.wrap<0&&(he.wrap=-he.wrap),he.status=he.wrap?B:H,j.adler=he.wrap===2?0:1,he.last_flush=k,f._tr_init(he),y):te(j,S)}function et(j){var he=Ve(j);return he===y&&(function(de){de.window_size=2*de.w_size,ee(de.head),de.max_lazy_match=l[de.level].max_lazy,de.good_match=l[de.level].good_length,de.nice_match=l[de.level].nice_length,de.max_chain_length=l[de.level].max_chain,de.strstart=0,de.block_start=0,de.lookahead=0,de.insert=0,de.match_length=de.prev_length=U-1,de.match_available=0,de.ins_h=0})(j.state),he}function Ke(j,he,de,q,z,Z){if(!j)return S;var ce=1;if(he===g&&(he=6),q<0?(ce=0,q=-q):15<q&&(ce=2,q-=16),z<1||L<z||de!==A||q<8||15<q||he<0||9<he||Z<0||w<Z)return te(j,S);q===8&&(q=9);var ue=new De;return(j.state=ue).strm=j,ue.wrap=ce,ue.gzhead=null,ue.w_bits=q,ue.w_size=1<<ue.w_bits,ue.w_mask=ue.w_size-1,ue.hash_bits=z+7,ue.hash_size=1<<ue.hash_bits,ue.hash_mask=ue.hash_size-1,ue.hash_shift=~~((ue.hash_bits+U-1)/U),ue.window=new u.Buf8(2*ue.w_size),ue.head=new u.Buf16(ue.hash_size),ue.prev=new u.Buf16(ue.w_size),ue.lit_bufsize=1<<z+6,ue.pending_buf_size=4*ue.lit_bufsize,ue.pending_buf=new u.Buf8(ue.pending_buf_size),ue.d_buf=1*ue.lit_bufsize,ue.l_buf=3*ue.lit_bufsize,ue.level=he,ue.strategy=Z,ue.method=de,et(j)}l=[new _e(0,0,0,0,function(j,he){var de=65535;for(de>j.pending_buf_size-5&&(de=j.pending_buf_size-5);;){if(j.lookahead<=1){if(be(j),j.lookahead===0&&he===k)return C;if(j.lookahead===0)break}j.strstart+=j.lookahead,j.lookahead=0;var q=j.block_start+de;if((j.strstart===0||j.strstart>=q)&&(j.lookahead=j.strstart-q,j.strstart=q,$(j,!1),j.strm.avail_out===0)||j.strstart-j.block_start>=j.w_size-ie&&($(j,!1),j.strm.avail_out===0))return C}return j.insert=0,he===x?($(j,!0),j.strm.avail_out===0?ae:J):(j.strstart>j.block_start&&($(j,!1),j.strm.avail_out),C)}),new _e(4,4,8,4,Se),new _e(4,5,16,8,Se),new _e(4,6,32,32,Se),new _e(4,4,16,16,ke),new _e(8,16,32,32,ke),new _e(8,16,128,128,ke),new _e(8,32,128,256,ke),new _e(32,128,258,1024,ke),new _e(32,258,258,4096,ke)],c.deflateInit=function(j,he){return Ke(j,he,A,15,8,0)},c.deflateInit2=Ke,c.deflateReset=et,c.deflateResetKeep=Ve,c.deflateSetHeader=function(j,he){return j&&j.state?j.state.wrap!==2?S:(j.state.gzhead=he,y):S},c.deflate=function(j,he){var de,q,z,Z;if(!j||!j.state||5<he||he<0)return j?te(j,S):S;if(q=j.state,!j.output||!j.input&&j.avail_in!==0||q.status===666&&he!==x)return te(j,j.avail_out===0?-5:S);if(q.strm=j,de=q.last_flush,q.last_flush=he,q.status===B)if(q.wrap===2)j.adler=0,ye(q,31),ye(q,139),ye(q,8),q.gzhead?(ye(q,(q.gzhead.text?1:0)+(q.gzhead.hcrc?2:0)+(q.gzhead.extra?4:0)+(q.gzhead.name?8:0)+(q.gzhead.comment?16:0)),ye(q,255&q.gzhead.time),ye(q,q.gzhead.time>>8&255),ye(q,q.gzhead.time>>16&255),ye(q,q.gzhead.time>>24&255),ye(q,q.level===9?2:2<=q.strategy||q.level<2?4:0),ye(q,255&q.gzhead.os),q.gzhead.extra&&q.gzhead.extra.length&&(ye(q,255&q.gzhead.extra.length),ye(q,q.gzhead.extra.length>>8&255)),q.gzhead.hcrc&&(j.adler=h(j.adler,q.pending_buf,q.pending,0)),q.gzindex=0,q.status=69):(ye(q,0),ye(q,0),ye(q,0),ye(q,0),ye(q,0),ye(q,q.level===9?2:2<=q.strategy||q.level<2?4:0),ye(q,3),q.status=H);else{var ce=A+(q.w_bits-8<<4)<<8;ce|=(2<=q.strategy||q.level<2?0:q.level<6?1:q.level===6?2:3)<<6,q.strstart!==0&&(ce|=32),ce+=31-ce%31,q.status=H,fe(q,ce),q.strstart!==0&&(fe(q,j.adler>>>16),fe(q,65535&j.adler)),j.adler=1}if(q.status===69)if(q.gzhead.extra){for(z=q.pending;q.gzindex<(65535&q.gzhead.extra.length)&&(q.pending!==q.pending_buf_size||(q.gzhead.hcrc&&q.pending>z&&(j.adler=h(j.adler,q.pending_buf,q.pending-z,z)),P(j),z=q.pending,q.pending!==q.pending_buf_size));)ye(q,255&q.gzhead.extra[q.gzindex]),q.gzindex++;q.gzhead.hcrc&&q.pending>z&&(j.adler=h(j.adler,q.pending_buf,q.pending-z,z)),q.gzindex===q.gzhead.extra.length&&(q.gzindex=0,q.status=73)}else q.status=73;if(q.status===73)if(q.gzhead.name){z=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>z&&(j.adler=h(j.adler,q.pending_buf,q.pending-z,z)),P(j),z=q.pending,q.pending===q.pending_buf_size)){Z=1;break}Z=q.gzindex<q.gzhead.name.length?255&q.gzhead.name.charCodeAt(q.gzindex++):0,ye(q,Z)}while(Z!==0);q.gzhead.hcrc&&q.pending>z&&(j.adler=h(j.adler,q.pending_buf,q.pending-z,z)),Z===0&&(q.gzindex=0,q.status=91)}else q.status=91;if(q.status===91)if(q.gzhead.comment){z=q.pending;do{if(q.pending===q.pending_buf_size&&(q.gzhead.hcrc&&q.pending>z&&(j.adler=h(j.adler,q.pending_buf,q.pending-z,z)),P(j),z=q.pending,q.pending===q.pending_buf_size)){Z=1;break}Z=q.gzindex<q.gzhead.comment.length?255&q.gzhead.comment.charCodeAt(q.gzindex++):0,ye(q,Z)}while(Z!==0);q.gzhead.hcrc&&q.pending>z&&(j.adler=h(j.adler,q.pending_buf,q.pending-z,z)),Z===0&&(q.status=103)}else q.status=103;if(q.status===103&&(q.gzhead.hcrc?(q.pending+2>q.pending_buf_size&&P(j),q.pending+2<=q.pending_buf_size&&(ye(q,255&j.adler),ye(q,j.adler>>8&255),j.adler=0,q.status=H)):q.status=H),q.pending!==0){if(P(j),j.avail_out===0)return q.last_flush=-1,y}else if(j.avail_in===0&&re(he)<=re(de)&&he!==x)return te(j,-5);if(q.status===666&&j.avail_in!==0)return te(j,-5);if(j.avail_in!==0||q.lookahead!==0||he!==k&&q.status!==666){var ue=q.strategy===2?(function(X,_){for(var E;;){if(X.lookahead===0&&(be(X),X.lookahead===0)){if(_===k)return C;break}if(X.match_length=0,E=f._tr_tally(X,0,X.window[X.strstart]),X.lookahead--,X.strstart++,E&&($(X,!1),X.strm.avail_out===0))return C}return X.insert=0,_===x?($(X,!0),X.strm.avail_out===0?ae:J):X.last_lit&&($(X,!1),X.strm.avail_out===0)?C:Q})(q,he):q.strategy===3?(function(X,_){for(var E,M,K,ge,je=X.window;;){if(X.lookahead<=V){if(be(X),X.lookahead<=V&&_===k)return C;if(X.lookahead===0)break}if(X.match_length=0,X.lookahead>=U&&0<X.strstart&&(M=je[K=X.strstart-1])===je[++K]&&M===je[++K]&&M===je[++K]){ge=X.strstart+V;do;while(M===je[++K]&&M===je[++K]&&M===je[++K]&&M===je[++K]&&M===je[++K]&&M===je[++K]&&M===je[++K]&&M===je[++K]&&K<ge);X.match_length=V-(ge-K),X.match_length>X.lookahead&&(X.match_length=X.lookahead)}if(X.match_length>=U?(E=f._tr_tally(X,1,X.match_length-U),X.lookahead-=X.match_length,X.strstart+=X.match_length,X.match_length=0):(E=f._tr_tally(X,0,X.window[X.strstart]),X.lookahead--,X.strstart++),E&&($(X,!1),X.strm.avail_out===0))return C}return X.insert=0,_===x?($(X,!0),X.strm.avail_out===0?ae:J):X.last_lit&&($(X,!1),X.strm.avail_out===0)?C:Q})(q,he):l[q.level].func(q,he);if(ue!==ae&&ue!==J||(q.status=666),ue===C||ue===ae)return j.avail_out===0&&(q.last_flush=-1),y;if(ue===Q&&(he===1?f._tr_align(q):he!==5&&(f._tr_stored_block(q,0,0,!1),he===3&&(ee(q.head),q.lookahead===0&&(q.strstart=0,q.block_start=0,q.insert=0))),P(j),j.avail_out===0))return q.last_flush=-1,y}return he!==x?y:q.wrap<=0?1:(q.wrap===2?(ye(q,255&j.adler),ye(q,j.adler>>8&255),ye(q,j.adler>>16&255),ye(q,j.adler>>24&255),ye(q,255&j.total_in),ye(q,j.total_in>>8&255),ye(q,j.total_in>>16&255),ye(q,j.total_in>>24&255)):(fe(q,j.adler>>>16),fe(q,65535&j.adler)),P(j),0<q.wrap&&(q.wrap=-q.wrap),q.pending!==0?y:1)},c.deflateEnd=function(j){var he;return j&&j.state?(he=j.state.status)!==B&&he!==69&&he!==73&&he!==91&&he!==103&&he!==H&&he!==666?te(j,S):(j.state=null,he===H?te(j,-3):y):S},c.deflateSetDictionary=function(j,he){var de,q,z,Z,ce,ue,X,_,E=he.length;if(!j||!j.state||(Z=(de=j.state).wrap)===2||Z===1&&de.status!==B||de.lookahead)return S;for(Z===1&&(j.adler=p(j.adler,he,E,0)),de.wrap=0,E>=de.w_size&&(Z===0&&(ee(de.head),de.strstart=0,de.block_start=0,de.insert=0),_=new u.Buf8(de.w_size),u.arraySet(_,he,E-de.w_size,de.w_size,0),he=_,E=de.w_size),ce=j.avail_in,ue=j.next_in,X=j.input,j.avail_in=E,j.next_in=0,j.input=he,be(de);de.lookahead>=U;){for(q=de.strstart,z=de.lookahead-(U-1);de.ins_h=(de.ins_h<<de.hash_shift^de.window[q+U-1])&de.hash_mask,de.prev[q&de.w_mask]=de.head[de.ins_h],de.head[de.ins_h]=q,q++,--z;);de.strstart=q,de.lookahead=U-1,be(de)}return de.strstart+=de.lookahead,de.block_start=de.strstart,de.insert=de.lookahead,de.lookahead=0,de.match_length=de.prev_length=U-1,de.match_available=0,j.next_in=ue,j.input=X,j.avail_in=ce,de.wrap=Z,y},c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,o,c){o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,o,c){o.exports=function(l,u){var f,p,h,b,k,x,y,S,g,w,N,A,L,T,I,D,W,F,U,V,ie,B,H,C,Q;f=l.state,p=l.next_in,C=l.input,h=p+(l.avail_in-5),b=l.next_out,Q=l.output,k=b-(u-l.avail_out),x=b+(l.avail_out-257),y=f.dmax,S=f.wsize,g=f.whave,w=f.wnext,N=f.window,A=f.hold,L=f.bits,T=f.lencode,I=f.distcode,D=(1<<f.lenbits)-1,W=(1<<f.distbits)-1;e:do{L<15&&(A+=C[p++]<<L,L+=8,A+=C[p++]<<L,L+=8),F=T[A&D];t:for(;;){if(A>>>=U=F>>>24,L-=U,(U=F>>>16&255)===0)Q[b++]=65535&F;else{if(!(16&U)){if((64&U)==0){F=T[(65535&F)+(A&(1<<U)-1)];continue t}if(32&U){f.mode=12;break e}l.msg="invalid literal/length code",f.mode=30;break e}V=65535&F,(U&=15)&&(L<U&&(A+=C[p++]<<L,L+=8),V+=A&(1<<U)-1,A>>>=U,L-=U),L<15&&(A+=C[p++]<<L,L+=8,A+=C[p++]<<L,L+=8),F=I[A&W];r:for(;;){if(A>>>=U=F>>>24,L-=U,!(16&(U=F>>>16&255))){if((64&U)==0){F=I[(65535&F)+(A&(1<<U)-1)];continue r}l.msg="invalid distance code",f.mode=30;break e}if(ie=65535&F,L<(U&=15)&&(A+=C[p++]<<L,(L+=8)<U&&(A+=C[p++]<<L,L+=8)),y<(ie+=A&(1<<U)-1)){l.msg="invalid distance too far back",f.mode=30;break e}if(A>>>=U,L-=U,(U=b-k)<ie){if(g<(U=ie-U)&&f.sane){l.msg="invalid distance too far back",f.mode=30;break e}if(H=N,(B=0)===w){if(B+=S-U,U<V){for(V-=U;Q[b++]=N[B++],--U;);B=b-ie,H=Q}}else if(w<U){if(B+=S+w-U,(U-=w)<V){for(V-=U;Q[b++]=N[B++],--U;);if(B=0,w<V){for(V-=U=w;Q[b++]=N[B++],--U;);B=b-ie,H=Q}}}else if(B+=w-U,U<V){for(V-=U;Q[b++]=N[B++],--U;);B=b-ie,H=Q}for(;2<V;)Q[b++]=H[B++],Q[b++]=H[B++],Q[b++]=H[B++],V-=3;V&&(Q[b++]=H[B++],1<V&&(Q[b++]=H[B++]))}else{for(B=b-ie;Q[b++]=Q[B++],Q[b++]=Q[B++],Q[b++]=Q[B++],2<(V-=3););V&&(Q[b++]=Q[B++],1<V&&(Q[b++]=Q[B++]))}break}}break}}while(p<h&&b<x);p-=V=L>>3,A&=(1<<(L-=V<<3))-1,l.next_in=p,l.next_out=b,l.avail_in=p<h?h-p+5:5-(p-h),l.avail_out=b<x?x-b+257:257-(b-x),f.hold=A,f.bits=L}},{}],49:[function(n,o,c){var l=n("../utils/common"),u=n("./adler32"),f=n("./crc32"),p=n("./inffast"),h=n("./inftrees"),b=1,k=2,x=0,y=-2,S=1,g=852,w=592;function N(B){return(B>>>24&255)+(B>>>8&65280)+((65280&B)<<8)+((255&B)<<24)}function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new l.Buf16(320),this.work=new l.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function L(B){var H;return B&&B.state?(H=B.state,B.total_in=B.total_out=H.total=0,B.msg="",H.wrap&&(B.adler=1&H.wrap),H.mode=S,H.last=0,H.havedict=0,H.dmax=32768,H.head=null,H.hold=0,H.bits=0,H.lencode=H.lendyn=new l.Buf32(g),H.distcode=H.distdyn=new l.Buf32(w),H.sane=1,H.back=-1,x):y}function T(B){var H;return B&&B.state?((H=B.state).wsize=0,H.whave=0,H.wnext=0,L(B)):y}function I(B,H){var C,Q;return B&&B.state?(Q=B.state,H<0?(C=0,H=-H):(C=1+(H>>4),H<48&&(H&=15)),H&&(H<8||15<H)?y:(Q.window!==null&&Q.wbits!==H&&(Q.window=null),Q.wrap=C,Q.wbits=H,T(B))):y}function D(B,H){var C,Q;return B?(Q=new A,(B.state=Q).window=null,(C=I(B,H))!==x&&(B.state=null),C):y}var W,F,U=!0;function V(B){if(U){var H;for(W=new l.Buf32(512),F=new l.Buf32(32),H=0;H<144;)B.lens[H++]=8;for(;H<256;)B.lens[H++]=9;for(;H<280;)B.lens[H++]=7;for(;H<288;)B.lens[H++]=8;for(h(b,B.lens,0,288,W,0,B.work,{bits:9}),H=0;H<32;)B.lens[H++]=5;h(k,B.lens,0,32,F,0,B.work,{bits:5}),U=!1}B.lencode=W,B.lenbits=9,B.distcode=F,B.distbits=5}function ie(B,H,C,Q){var ae,J=B.state;return J.window===null&&(J.wsize=1<<J.wbits,J.wnext=0,J.whave=0,J.window=new l.Buf8(J.wsize)),Q>=J.wsize?(l.arraySet(J.window,H,C-J.wsize,J.wsize,0),J.wnext=0,J.whave=J.wsize):(Q<(ae=J.wsize-J.wnext)&&(ae=Q),l.arraySet(J.window,H,C-Q,ae,J.wnext),(Q-=ae)?(l.arraySet(J.window,H,C-Q,Q,0),J.wnext=Q,J.whave=J.wsize):(J.wnext+=ae,J.wnext===J.wsize&&(J.wnext=0),J.whave<J.wsize&&(J.whave+=ae))),0}c.inflateReset=T,c.inflateReset2=I,c.inflateResetKeep=L,c.inflateInit=function(B){return D(B,15)},c.inflateInit2=D,c.inflate=function(B,H){var C,Q,ae,J,te,re,ee,P,$,ye,fe,oe,be,Se,ke,_e,De,Ve,et,Ke,j,he,de,q,z=0,Z=new l.Buf8(4),ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!B||!B.state||!B.output||!B.input&&B.avail_in!==0)return y;(C=B.state).mode===12&&(C.mode=13),te=B.next_out,ae=B.output,ee=B.avail_out,J=B.next_in,Q=B.input,re=B.avail_in,P=C.hold,$=C.bits,ye=re,fe=ee,he=x;e:for(;;)switch(C.mode){case S:if(C.wrap===0){C.mode=13;break}for(;$<16;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if(2&C.wrap&&P===35615){Z[C.check=0]=255&P,Z[1]=P>>>8&255,C.check=f(C.check,Z,2,0),$=P=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&P)<<8)+(P>>8))%31){B.msg="incorrect header check",C.mode=30;break}if((15&P)!=8){B.msg="unknown compression method",C.mode=30;break}if($-=4,j=8+(15&(P>>>=4)),C.wbits===0)C.wbits=j;else if(j>C.wbits){B.msg="invalid window size",C.mode=30;break}C.dmax=1<<j,B.adler=C.check=1,C.mode=512&P?10:12,$=P=0;break;case 2:for(;$<16;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if(C.flags=P,(255&C.flags)!=8){B.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){B.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=P>>8&1),512&C.flags&&(Z[0]=255&P,Z[1]=P>>>8&255,C.check=f(C.check,Z,2,0)),$=P=0,C.mode=3;case 3:for(;$<32;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}C.head&&(C.head.time=P),512&C.flags&&(Z[0]=255&P,Z[1]=P>>>8&255,Z[2]=P>>>16&255,Z[3]=P>>>24&255,C.check=f(C.check,Z,4,0)),$=P=0,C.mode=4;case 4:for(;$<16;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}C.head&&(C.head.xflags=255&P,C.head.os=P>>8),512&C.flags&&(Z[0]=255&P,Z[1]=P>>>8&255,C.check=f(C.check,Z,2,0)),$=P=0,C.mode=5;case 5:if(1024&C.flags){for(;$<16;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}C.length=P,C.head&&(C.head.extra_len=P),512&C.flags&&(Z[0]=255&P,Z[1]=P>>>8&255,C.check=f(C.check,Z,2,0)),$=P=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(re<(oe=C.length)&&(oe=re),oe&&(C.head&&(j=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),l.arraySet(C.head.extra,Q,J,oe,j)),512&C.flags&&(C.check=f(C.check,Q,oe,J)),re-=oe,J+=oe,C.length-=oe),C.length))break e;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(re===0)break e;for(oe=0;j=Q[J+oe++],C.head&&j&&C.length<65536&&(C.head.name+=String.fromCharCode(j)),j&&oe<re;);if(512&C.flags&&(C.check=f(C.check,Q,oe,J)),re-=oe,J+=oe,j)break e}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(re===0)break e;for(oe=0;j=Q[J+oe++],C.head&&j&&C.length<65536&&(C.head.comment+=String.fromCharCode(j)),j&&oe<re;);if(512&C.flags&&(C.check=f(C.check,Q,oe,J)),re-=oe,J+=oe,j)break e}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;$<16;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if(P!==(65535&C.check)){B.msg="header crc mismatch",C.mode=30;break}$=P=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),B.adler=C.check=0,C.mode=12;break;case 10:for(;$<32;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}B.adler=C.check=N(P),$=P=0,C.mode=11;case 11:if(C.havedict===0)return B.next_out=te,B.avail_out=ee,B.next_in=J,B.avail_in=re,C.hold=P,C.bits=$,2;B.adler=C.check=1,C.mode=12;case 12:if(H===5||H===6)break e;case 13:if(C.last){P>>>=7&$,$-=7&$,C.mode=27;break}for(;$<3;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}switch(C.last=1&P,$-=1,3&(P>>>=1)){case 0:C.mode=14;break;case 1:if(V(C),C.mode=20,H!==6)break;P>>>=2,$-=2;break e;case 2:C.mode=17;break;case 3:B.msg="invalid block type",C.mode=30}P>>>=2,$-=2;break;case 14:for(P>>>=7&$,$-=7&$;$<32;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if((65535&P)!=(P>>>16^65535)){B.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&P,$=P=0,C.mode=15,H===6)break e;case 15:C.mode=16;case 16:if(oe=C.length){if(re<oe&&(oe=re),ee<oe&&(oe=ee),oe===0)break e;l.arraySet(ae,Q,J,oe,te),re-=oe,J+=oe,ee-=oe,te+=oe,C.length-=oe;break}C.mode=12;break;case 17:for(;$<14;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if(C.nlen=257+(31&P),P>>>=5,$-=5,C.ndist=1+(31&P),P>>>=5,$-=5,C.ncode=4+(15&P),P>>>=4,$-=4,286<C.nlen||30<C.ndist){B.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;$<3;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}C.lens[ce[C.have++]]=7&P,P>>>=3,$-=3}for(;C.have<19;)C.lens[ce[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,de={bits:C.lenbits},he=h(0,C.lens,0,19,C.lencode,0,C.work,de),C.lenbits=de.bits,he){B.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;_e=(z=C.lencode[P&(1<<C.lenbits)-1])>>>16&255,De=65535&z,!((ke=z>>>24)<=$);){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if(De<16)P>>>=ke,$-=ke,C.lens[C.have++]=De;else{if(De===16){for(q=ke+2;$<q;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if(P>>>=ke,$-=ke,C.have===0){B.msg="invalid bit length repeat",C.mode=30;break}j=C.lens[C.have-1],oe=3+(3&P),P>>>=2,$-=2}else if(De===17){for(q=ke+3;$<q;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}$-=ke,j=0,oe=3+(7&(P>>>=ke)),P>>>=3,$-=3}else{for(q=ke+7;$<q;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}$-=ke,j=0,oe=11+(127&(P>>>=ke)),P>>>=7,$-=7}if(C.have+oe>C.nlen+C.ndist){B.msg="invalid bit length repeat",C.mode=30;break}for(;oe--;)C.lens[C.have++]=j}}if(C.mode===30)break;if(C.lens[256]===0){B.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,de={bits:C.lenbits},he=h(b,C.lens,0,C.nlen,C.lencode,0,C.work,de),C.lenbits=de.bits,he){B.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,de={bits:C.distbits},he=h(k,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,de),C.distbits=de.bits,he){B.msg="invalid distances set",C.mode=30;break}if(C.mode=20,H===6)break e;case 20:C.mode=21;case 21:if(6<=re&&258<=ee){B.next_out=te,B.avail_out=ee,B.next_in=J,B.avail_in=re,C.hold=P,C.bits=$,p(B,fe),te=B.next_out,ae=B.output,ee=B.avail_out,J=B.next_in,Q=B.input,re=B.avail_in,P=C.hold,$=C.bits,C.mode===12&&(C.back=-1);break}for(C.back=0;_e=(z=C.lencode[P&(1<<C.lenbits)-1])>>>16&255,De=65535&z,!((ke=z>>>24)<=$);){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if(_e&&(240&_e)==0){for(Ve=ke,et=_e,Ke=De;_e=(z=C.lencode[Ke+((P&(1<<Ve+et)-1)>>Ve)])>>>16&255,De=65535&z,!(Ve+(ke=z>>>24)<=$);){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}P>>>=Ve,$-=Ve,C.back+=Ve}if(P>>>=ke,$-=ke,C.back+=ke,C.length=De,_e===0){C.mode=26;break}if(32&_e){C.back=-1,C.mode=12;break}if(64&_e){B.msg="invalid literal/length code",C.mode=30;break}C.extra=15&_e,C.mode=22;case 22:if(C.extra){for(q=C.extra;$<q;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}C.length+=P&(1<<C.extra)-1,P>>>=C.extra,$-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;_e=(z=C.distcode[P&(1<<C.distbits)-1])>>>16&255,De=65535&z,!((ke=z>>>24)<=$);){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if((240&_e)==0){for(Ve=ke,et=_e,Ke=De;_e=(z=C.distcode[Ke+((P&(1<<Ve+et)-1)>>Ve)])>>>16&255,De=65535&z,!(Ve+(ke=z>>>24)<=$);){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}P>>>=Ve,$-=Ve,C.back+=Ve}if(P>>>=ke,$-=ke,C.back+=ke,64&_e){B.msg="invalid distance code",C.mode=30;break}C.offset=De,C.extra=15&_e,C.mode=24;case 24:if(C.extra){for(q=C.extra;$<q;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}C.offset+=P&(1<<C.extra)-1,P>>>=C.extra,$-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){B.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(ee===0)break e;if(oe=fe-ee,C.offset>oe){if((oe=C.offset-oe)>C.whave&&C.sane){B.msg="invalid distance too far back",C.mode=30;break}be=oe>C.wnext?(oe-=C.wnext,C.wsize-oe):C.wnext-oe,oe>C.length&&(oe=C.length),Se=C.window}else Se=ae,be=te-C.offset,oe=C.length;for(ee<oe&&(oe=ee),ee-=oe,C.length-=oe;ae[te++]=Se[be++],--oe;);C.length===0&&(C.mode=21);break;case 26:if(ee===0)break e;ae[te++]=C.length,ee--,C.mode=21;break;case 27:if(C.wrap){for(;$<32;){if(re===0)break e;re--,P|=Q[J++]<<$,$+=8}if(fe-=ee,B.total_out+=fe,C.total+=fe,fe&&(B.adler=C.check=C.flags?f(C.check,ae,fe,te-fe):u(C.check,ae,fe,te-fe)),fe=ee,(C.flags?P:N(P))!==C.check){B.msg="incorrect data check",C.mode=30;break}$=P=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;$<32;){if(re===0)break e;re--,P+=Q[J++]<<$,$+=8}if(P!==(4294967295&C.total)){B.msg="incorrect length check",C.mode=30;break}$=P=0}C.mode=29;case 29:he=1;break e;case 30:he=-3;break e;case 31:return-4;case 32:default:return y}return B.next_out=te,B.avail_out=ee,B.next_in=J,B.avail_in=re,C.hold=P,C.bits=$,(C.wsize||fe!==B.avail_out&&C.mode<30&&(C.mode<27||H!==4))&&ie(B,B.output,B.next_out,fe-B.avail_out)?(C.mode=31,-4):(ye-=B.avail_in,fe-=B.avail_out,B.total_in+=ye,B.total_out+=fe,C.total+=fe,C.wrap&&fe&&(B.adler=C.check=C.flags?f(C.check,ae,fe,B.next_out-fe):u(C.check,ae,fe,B.next_out-fe)),B.data_type=C.bits+(C.last?64:0)+(C.mode===12?128:0)+(C.mode===20||C.mode===15?256:0),(ye==0&&fe===0||H===4)&&he===x&&(he=-5),he)},c.inflateEnd=function(B){if(!B||!B.state)return y;var H=B.state;return H.window&&(H.window=null),B.state=null,x},c.inflateGetHeader=function(B,H){var C;return B&&B.state?(2&(C=B.state).wrap)==0?y:((C.head=H).done=!1,x):y},c.inflateSetDictionary=function(B,H){var C,Q=H.length;return B&&B.state?(C=B.state).wrap!==0&&C.mode!==11?y:C.mode===11&&u(1,H,Q,0)!==C.check?-3:ie(B,H,Q,Q)?(C.mode=31,-4):(C.havedict=1,x):y},c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,o,c){var l=n("../utils/common"),u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],p=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];o.exports=function(b,k,x,y,S,g,w,N){var A,L,T,I,D,W,F,U,V,ie=N.bits,B=0,H=0,C=0,Q=0,ae=0,J=0,te=0,re=0,ee=0,P=0,$=null,ye=0,fe=new l.Buf16(16),oe=new l.Buf16(16),be=null,Se=0;for(B=0;B<=15;B++)fe[B]=0;for(H=0;H<y;H++)fe[k[x+H]]++;for(ae=ie,Q=15;1<=Q&&fe[Q]===0;Q--);if(Q<ae&&(ae=Q),Q===0)return S[g++]=20971520,S[g++]=20971520,N.bits=1,0;for(C=1;C<Q&&fe[C]===0;C++);for(ae<C&&(ae=C),B=re=1;B<=15;B++)if(re<<=1,(re-=fe[B])<0)return-1;if(0<re&&(b===0||Q!==1))return-1;for(oe[1]=0,B=1;B<15;B++)oe[B+1]=oe[B]+fe[B];for(H=0;H<y;H++)k[x+H]!==0&&(w[oe[k[x+H]]++]=H);if(W=b===0?($=be=w,19):b===1?($=u,ye-=257,be=f,Se-=257,256):($=p,be=h,-1),B=C,D=g,te=H=P=0,T=-1,I=(ee=1<<(J=ae))-1,b===1&&852<ee||b===2&&592<ee)return 1;for(;;){for(F=B-te,V=w[H]<W?(U=0,w[H]):w[H]>W?(U=be[Se+w[H]],$[ye+w[H]]):(U=96,0),A=1<<B-te,C=L=1<<J;S[D+(P>>te)+(L-=A)]=F<<24|U<<16|V|0,L!==0;);for(A=1<<B-1;P&A;)A>>=1;if(A!==0?(P&=A-1,P+=A):P=0,H++,--fe[B]==0){if(B===Q)break;B=k[x+w[H]]}if(ae<B&&(P&I)!==T){for(te===0&&(te=ae),D+=C,re=1<<(J=B-te);J+te<Q&&!((re-=fe[J+te])<=0);)J++,re<<=1;if(ee+=1<<J,b===1&&852<ee||b===2&&592<ee)return 1;S[T=P&I]=ae<<24|J<<16|D-g|0}}return P!==0&&(S[D+P]=B-te<<24|64<<16|0),N.bits=ae,0}},{"../utils/common":41}],51:[function(n,o,c){o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,o,c){var l=n("../utils/common"),u=0,f=1;function p(z){for(var Z=z.length;0<=--Z;)z[Z]=0}var h=0,b=29,k=256,x=k+1+b,y=30,S=19,g=2*x+1,w=15,N=16,A=7,L=256,T=16,I=17,D=18,W=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ie=new Array(2*(x+2));p(ie);var B=new Array(2*y);p(B);var H=new Array(512);p(H);var C=new Array(256);p(C);var Q=new Array(b);p(Q);var ae,J,te,re=new Array(y);function ee(z,Z,ce,ue,X){this.static_tree=z,this.extra_bits=Z,this.extra_base=ce,this.elems=ue,this.max_length=X,this.has_stree=z&&z.length}function P(z,Z){this.dyn_tree=z,this.max_code=0,this.stat_desc=Z}function $(z){return z<256?H[z]:H[256+(z>>>7)]}function ye(z,Z){z.pending_buf[z.pending++]=255&Z,z.pending_buf[z.pending++]=Z>>>8&255}function fe(z,Z,ce){z.bi_valid>N-ce?(z.bi_buf|=Z<<z.bi_valid&65535,ye(z,z.bi_buf),z.bi_buf=Z>>N-z.bi_valid,z.bi_valid+=ce-N):(z.bi_buf|=Z<<z.bi_valid&65535,z.bi_valid+=ce)}function oe(z,Z,ce){fe(z,ce[2*Z],ce[2*Z+1])}function be(z,Z){for(var ce=0;ce|=1&z,z>>>=1,ce<<=1,0<--Z;);return ce>>>1}function Se(z,Z,ce){var ue,X,_=new Array(w+1),E=0;for(ue=1;ue<=w;ue++)_[ue]=E=E+ce[ue-1]<<1;for(X=0;X<=Z;X++){var M=z[2*X+1];M!==0&&(z[2*X]=be(_[M]++,M))}}function ke(z){var Z;for(Z=0;Z<x;Z++)z.dyn_ltree[2*Z]=0;for(Z=0;Z<y;Z++)z.dyn_dtree[2*Z]=0;for(Z=0;Z<S;Z++)z.bl_tree[2*Z]=0;z.dyn_ltree[2*L]=1,z.opt_len=z.static_len=0,z.last_lit=z.matches=0}function _e(z){8<z.bi_valid?ye(z,z.bi_buf):0<z.bi_valid&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0}function De(z,Z,ce,ue){var X=2*Z,_=2*ce;return z[X]<z[_]||z[X]===z[_]&&ue[Z]<=ue[ce]}function Ve(z,Z,ce){for(var ue=z.heap[ce],X=ce<<1;X<=z.heap_len&&(X<z.heap_len&&De(Z,z.heap[X+1],z.heap[X],z.depth)&&X++,!De(Z,ue,z.heap[X],z.depth));)z.heap[ce]=z.heap[X],ce=X,X<<=1;z.heap[ce]=ue}function et(z,Z,ce){var ue,X,_,E,M=0;if(z.last_lit!==0)for(;ue=z.pending_buf[z.d_buf+2*M]<<8|z.pending_buf[z.d_buf+2*M+1],X=z.pending_buf[z.l_buf+M],M++,ue===0?oe(z,X,Z):(oe(z,(_=C[X])+k+1,Z),(E=W[_])!==0&&fe(z,X-=Q[_],E),oe(z,_=$(--ue),ce),(E=F[_])!==0&&fe(z,ue-=re[_],E)),M<z.last_lit;);oe(z,L,Z)}function Ke(z,Z){var ce,ue,X,_=Z.dyn_tree,E=Z.stat_desc.static_tree,M=Z.stat_desc.has_stree,K=Z.stat_desc.elems,ge=-1;for(z.heap_len=0,z.heap_max=g,ce=0;ce<K;ce++)_[2*ce]!==0?(z.heap[++z.heap_len]=ge=ce,z.depth[ce]=0):_[2*ce+1]=0;for(;z.heap_len<2;)_[2*(X=z.heap[++z.heap_len]=ge<2?++ge:0)]=1,z.depth[X]=0,z.opt_len--,M&&(z.static_len-=E[2*X+1]);for(Z.max_code=ge,ce=z.heap_len>>1;1<=ce;ce--)Ve(z,_,ce);for(X=K;ce=z.heap[1],z.heap[1]=z.heap[z.heap_len--],Ve(z,_,1),ue=z.heap[1],z.heap[--z.heap_max]=ce,z.heap[--z.heap_max]=ue,_[2*X]=_[2*ce]+_[2*ue],z.depth[X]=(z.depth[ce]>=z.depth[ue]?z.depth[ce]:z.depth[ue])+1,_[2*ce+1]=_[2*ue+1]=X,z.heap[1]=X++,Ve(z,_,1),2<=z.heap_len;);z.heap[--z.heap_max]=z.heap[1],(function(je,we){var ve,Le,Ae,Pe,qe,st,He=we.dyn_tree,nt=we.max_code,Je=we.stat_desc.static_tree,it=we.stat_desc.has_stree,ft=we.stat_desc.extra_bits,ht=we.stat_desc.extra_base,Tt=we.stat_desc.max_length,Ht=0;for(Pe=0;Pe<=w;Pe++)je.bl_count[Pe]=0;for(He[2*je.heap[je.heap_max]+1]=0,ve=je.heap_max+1;ve<g;ve++)Tt<(Pe=He[2*He[2*(Le=je.heap[ve])+1]+1]+1)&&(Pe=Tt,Ht++),He[2*Le+1]=Pe,nt<Le||(je.bl_count[Pe]++,qe=0,ht<=Le&&(qe=ft[Le-ht]),st=He[2*Le],je.opt_len+=st*(Pe+qe),it&&(je.static_len+=st*(Je[2*Le+1]+qe)));if(Ht!==0){do{for(Pe=Tt-1;je.bl_count[Pe]===0;)Pe--;je.bl_count[Pe]--,je.bl_count[Pe+1]+=2,je.bl_count[Tt]--,Ht-=2}while(0<Ht);for(Pe=Tt;Pe!==0;Pe--)for(Le=je.bl_count[Pe];Le!==0;)nt<(Ae=je.heap[--ve])||(He[2*Ae+1]!==Pe&&(je.opt_len+=(Pe-He[2*Ae+1])*He[2*Ae],He[2*Ae+1]=Pe),Le--)}})(z,Z),Se(_,ge,z.bl_count)}function j(z,Z,ce){var ue,X,_=-1,E=Z[1],M=0,K=7,ge=4;for(E===0&&(K=138,ge=3),Z[2*(ce+1)+1]=65535,ue=0;ue<=ce;ue++)X=E,E=Z[2*(ue+1)+1],++M<K&&X===E||(M<ge?z.bl_tree[2*X]+=M:X!==0?(X!==_&&z.bl_tree[2*X]++,z.bl_tree[2*T]++):M<=10?z.bl_tree[2*I]++:z.bl_tree[2*D]++,_=X,ge=(M=0)===E?(K=138,3):X===E?(K=6,3):(K=7,4))}function he(z,Z,ce){var ue,X,_=-1,E=Z[1],M=0,K=7,ge=4;for(E===0&&(K=138,ge=3),ue=0;ue<=ce;ue++)if(X=E,E=Z[2*(ue+1)+1],!(++M<K&&X===E)){if(M<ge)for(;oe(z,X,z.bl_tree),--M!=0;);else X!==0?(X!==_&&(oe(z,X,z.bl_tree),M--),oe(z,T,z.bl_tree),fe(z,M-3,2)):M<=10?(oe(z,I,z.bl_tree),fe(z,M-3,3)):(oe(z,D,z.bl_tree),fe(z,M-11,7));_=X,ge=(M=0)===E?(K=138,3):X===E?(K=6,3):(K=7,4)}}p(re);var de=!1;function q(z,Z,ce,ue){fe(z,(h<<1)+(ue?1:0),3),(function(X,_,E,M){_e(X),ye(X,E),ye(X,~E),l.arraySet(X.pending_buf,X.window,_,E,X.pending),X.pending+=E})(z,Z,ce)}c._tr_init=function(z){de||((function(){var Z,ce,ue,X,_,E=new Array(w+1);for(X=ue=0;X<b-1;X++)for(Q[X]=ue,Z=0;Z<1<<W[X];Z++)C[ue++]=X;for(C[ue-1]=X,X=_=0;X<16;X++)for(re[X]=_,Z=0;Z<1<<F[X];Z++)H[_++]=X;for(_>>=7;X<y;X++)for(re[X]=_<<7,Z=0;Z<1<<F[X]-7;Z++)H[256+_++]=X;for(ce=0;ce<=w;ce++)E[ce]=0;for(Z=0;Z<=143;)ie[2*Z+1]=8,Z++,E[8]++;for(;Z<=255;)ie[2*Z+1]=9,Z++,E[9]++;for(;Z<=279;)ie[2*Z+1]=7,Z++,E[7]++;for(;Z<=287;)ie[2*Z+1]=8,Z++,E[8]++;for(Se(ie,x+1,E),Z=0;Z<y;Z++)B[2*Z+1]=5,B[2*Z]=be(Z,5);ae=new ee(ie,W,k+1,x,w),J=new ee(B,F,0,y,w),te=new ee(new Array(0),U,0,S,A)})(),de=!0),z.l_desc=new P(z.dyn_ltree,ae),z.d_desc=new P(z.dyn_dtree,J),z.bl_desc=new P(z.bl_tree,te),z.bi_buf=0,z.bi_valid=0,ke(z)},c._tr_stored_block=q,c._tr_flush_block=function(z,Z,ce,ue){var X,_,E=0;0<z.level?(z.strm.data_type===2&&(z.strm.data_type=(function(M){var K,ge=4093624447;for(K=0;K<=31;K++,ge>>>=1)if(1&ge&&M.dyn_ltree[2*K]!==0)return u;if(M.dyn_ltree[18]!==0||M.dyn_ltree[20]!==0||M.dyn_ltree[26]!==0)return f;for(K=32;K<k;K++)if(M.dyn_ltree[2*K]!==0)return f;return u})(z)),Ke(z,z.l_desc),Ke(z,z.d_desc),E=(function(M){var K;for(j(M,M.dyn_ltree,M.l_desc.max_code),j(M,M.dyn_dtree,M.d_desc.max_code),Ke(M,M.bl_desc),K=S-1;3<=K&&M.bl_tree[2*V[K]+1]===0;K--);return M.opt_len+=3*(K+1)+5+5+4,K})(z),X=z.opt_len+3+7>>>3,(_=z.static_len+3+7>>>3)<=X&&(X=_)):X=_=ce+5,ce+4<=X&&Z!==-1?q(z,Z,ce,ue):z.strategy===4||_===X?(fe(z,2+(ue?1:0),3),et(z,ie,B)):(fe(z,4+(ue?1:0),3),(function(M,K,ge,je){var we;for(fe(M,K-257,5),fe(M,ge-1,5),fe(M,je-4,4),we=0;we<je;we++)fe(M,M.bl_tree[2*V[we]+1],3);he(M,M.dyn_ltree,K-1),he(M,M.dyn_dtree,ge-1)})(z,z.l_desc.max_code+1,z.d_desc.max_code+1,E+1),et(z,z.dyn_ltree,z.dyn_dtree)),ke(z),ue&&_e(z)},c._tr_tally=function(z,Z,ce){return z.pending_buf[z.d_buf+2*z.last_lit]=Z>>>8&255,z.pending_buf[z.d_buf+2*z.last_lit+1]=255&Z,z.pending_buf[z.l_buf+z.last_lit]=255&ce,z.last_lit++,Z===0?z.dyn_ltree[2*ce]++:(z.matches++,Z--,z.dyn_ltree[2*(C[ce]+k+1)]++,z.dyn_dtree[2*$(Z)]++),z.last_lit===z.lit_bufsize-1},c._tr_align=function(z){fe(z,2,3),oe(z,L,ie),(function(Z){Z.bi_valid===16?(ye(Z,Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0):8<=Z.bi_valid&&(Z.pending_buf[Z.pending++]=255&Z.bi_buf,Z.bi_buf>>=8,Z.bi_valid-=8)})(z)}},{"../utils/common":41}],53:[function(n,o,c){o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,o,c){(function(l){(function(u,f){if(!u.setImmediate){var p,h,b,k,x=1,y={},S=!1,g=u.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(u);w=w&&w.setTimeout?w:u,p={}.toString.call(u.process)==="[object process]"?function(T){process.nextTick(function(){A(T)})}:(function(){if(u.postMessage&&!u.importScripts){var T=!0,I=u.onmessage;return u.onmessage=function(){T=!1},u.postMessage("","*"),u.onmessage=I,T}})()?(k="setImmediate$"+Math.random()+"$",u.addEventListener?u.addEventListener("message",L,!1):u.attachEvent("onmessage",L),function(T){u.postMessage(k+T,"*")}):u.MessageChannel?((b=new MessageChannel).port1.onmessage=function(T){A(T.data)},function(T){b.port2.postMessage(T)}):g&&"onreadystatechange"in g.createElement("script")?(h=g.documentElement,function(T){var I=g.createElement("script");I.onreadystatechange=function(){A(T),I.onreadystatechange=null,h.removeChild(I),I=null},h.appendChild(I)}):function(T){setTimeout(A,0,T)},w.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var I=new Array(arguments.length-1),D=0;D<I.length;D++)I[D]=arguments[D+1];var W={callback:T,args:I};return y[x]=W,p(x),x++},w.clearImmediate=N}function N(T){delete y[T]}function A(T){if(S)setTimeout(A,0,T);else{var I=y[T];if(I){S=!0;try{(function(D){var W=D.callback,F=D.args;switch(F.length){case 0:W();break;case 1:W(F[0]);break;case 2:W(F[0],F[1]);break;case 3:W(F[0],F[1],F[2]);break;default:W.apply(f,F)}})(I)}finally{N(T),S=!1}}}}function L(T){T.source===u&&typeof T.data=="string"&&T.data.indexOf(k)===0&&A(+T.data.slice(k.length))}})(typeof self>"u"?l===void 0?this:l:self)}).call(this,typeof Ao<"u"?Ao:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Kl)),Kl.exports}var Ew=jw();const _p=dc(Ew);async function _w(r){const s=await _p.loadAsync(r),n=await s.file("META-INF/container.xml")?.async("string");if(!n)throw new Error("container.xml not found in EPUB");const o=n.match(/full-path="([^"]+\.opf)"/);if(!o)throw new Error("OPF path not found in container.xml");const c=o[1],l=await s.file(c)?.async("string");if(!l)throw new Error(`OPF file not found at ${c}`);return l}async function Aw(r){const s=await _p.loadAsync(r),n=await s.file("META-INF/container.xml")?.async("string");if(!n)return null;const o=n.match(/full-path="([^"]+\.opf)"/);if(!o)return null;const c=o[1],l=await s.file(c)?.async("string");if(!l)return null;const u=c.substring(0,c.lastIndexOf("/")+1),f=S=>u+S;let p=null,h=null;const b=l.match(/<meta[^>]+name=["']cover["'][^>]+content=["']([^"']+)["'][^>]*>/i);if(b&&(p=b[1]),!p){const S=l.match(/<item[^>]+properties=["'][^"']*cover-image[^"']*["'][^>]+id=["']([^"']+)["'][^>]*href=["']([^"']+)["'][^>]+media-type=["']([^"']+)["'][^>]*>/i);S&&(p=S[1],h=S[2],S[3])}if(!p){const S=l.match(/<item[^>]+id=["']([^"']*cover[^"']*)["'][^>]*href=["']([^"']+)["'][^>]+media-type=["']([^"']+)["'][^>]*>/i);S&&(p=S[1],h=S[2],S[3])}if(p&&!h){const S=new RegExp(`<item[^>]+id=["']${p}["'][^>]+href=["']([^"']+)["'][^>]+media-type=["']([^"']+)["'][^>]*>`,"i"),g=l.match(S);g&&(h=g[1],g[2])}if(!h){const S=l.match(/<item[^>]+href=["']([^"']+)["'][^>]+media-type=["'](image\/(jpeg|png|gif|jpg))["'][^>]*>/i);S&&(h=S[1],S[2])}if(!h){const S=l.match(/<spine[\s\S]*?<itemref[^>]+idref=["']([^"']+)["'][^>]*>/i);if(S){const g=S[1],w=new RegExp(`<item[^>]+id=["']${g}["'][^>]+href=["']([^"']+)["'][^>]+media-type=["']application/xhtml+xml["'][^>]*>`,"i"),N=l.match(w);if(N){const A=N[1],L=f(A),T=s.file(L);if(T){const D=(await T.async("string")).match(/<img[^>]+src=["']([^"']+)["'][^>]*>/i);D&&(h=D[1],h.endsWith(".png")||h.endsWith(".jpg")||h.endsWith(".jpeg")||h.endsWith(".gif"))}}}}if(!h)return null;const k=f(h),x=s.file(k);if(!x)return null;const y=await x.async("blob");return await new Promise((S,g)=>{const w=new FileReader;w.onloadend=()=>S(w.result),w.onerror=g,w.readAsDataURL(y)})}const pi={isLoading:!1,message:"",error:null},Tw=r=>{if(r)return typeof r=="string"?r:r.name},Rw=({onCatalogImportSuccess:r})=>{const[s,n]=R.useState(pi),[o,c]=R.useState(0),l=R.useCallback(()=>{c(f=>f+1)},[]),u=R.useCallback(async(f,p="Untitled Book",h,b="file",k,x,y,S,g)=>{let w=null;if(S&&(w=await $f(S)),(y||(p.toLowerCase().endsWith(".pdf")?"PDF":"EPUB"))==="PDF"){n({isLoading:!0,message:"Saving PDF to library...",error:null});try{const T=p.replace(/\.(pdf)$/i,""),I=h||"Unknown Author";!w&&b==="file"&&(w=await Mf(T,I));const D=new Uint8Array(f).slice(0,5);if(!(D[0]===37&&D[1]===80&&D[2]===68&&D[3]===70&&D[4]===45)||!f||f instanceof ArrayBuffer&&f.byteLength<1e3)return n({isLoading:!1,message:"",error:"Downloaded file is not a valid PDF or is empty. Import aborted."}),{success:!1};let F=w;F&&typeof F=="string"&&!/^data:image\/(png|jpeg|jpg);base64,/.test(F)&&(F=null);let U={};b==="catalog"&&g&&(U={summary:g.summary,publisher:g.publisher,publicationDate:g.publicationDate,subjects:g.subjects,coverImage:F||(g.coverImage?await $f(g.coverImage):null)}),b==="catalog"&&!U.coverImage&&(F=await Mf(T,I),U={...U,coverImage:F});const V=x||p,ie={title:T,author:I,coverImage:U.coverImage||F,epubData:f,format:"PDF",providerName:k,providerId:V,description:U.summary,publisher:Tw(U.publisher),publicationDate:U.publicationDate,subjects:U.subjects};if(V){const B=await ut.findBookByIdentifier(V);if(B)return n(pi),{success:!1,bookRecord:ie,existingBook:B}}return await ut.saveBook(ie),n({isLoading:!1,message:"Import successful!",error:null}),l(),setTimeout(()=>n(pi),2e3),{success:!0}}catch(T){ne.error("Error saving PDF:",T);const I=T instanceof Error?T.message:"Failed to save the PDF file to the library.";return n({isLoading:!1,message:"",error:I}),{success:!1}}}n({isLoading:!0,message:"Extracting EPUB metadata...",error:null});let A,L;try{try{A=await _w(f)}catch(D){ne.error("[processAndSaveBook] Failed to extract OPF XML:",D),n({isLoading:!1,message:"",error:"Failed to extract EPUB metadata (OPF not found). Importing with minimal info."})}if(A)try{L=Cw(A)}catch(D){ne.error("[processAndSaveBook] Failed to parse OPF metadata:",D),n({isLoading:!1,message:"",error:"Failed to parse EPUB metadata. Importing with minimal info."})}if(n(D=>({...D,message:"Extracting cover..."})),!w)try{w=await Aw(f)}catch(D){ne.error("[processAndSaveBook] Failed to extract cover image:",D)}const T=x||L?.identifiers?.[0],I={title:L?.title||p,author:L?.author||h||"Unknown Author",coverImage:w,epubData:f,publisher:L?.publisher,publicationDate:L?.publicationDate,providerId:T,providerName:k,description:L?.description,subjects:L?.subjects,format:"EPUB",language:L?.language,rights:L?.rights,identifiers:L?.identifiers,opfRaw:A,accessModes:L?.accessModes,accessModesSufficient:L?.accessModesSufficient,accessibilityFeatures:L?.accessibilityFeatures,hazards:L?.hazards,accessibilitySummary:L?.accessibilitySummary,certificationConformsTo:Array.isArray(L?.certificationConformsTo)?L?.certificationConformsTo:typeof L?.certificationConformsTo=="string"?[L.certificationConformsTo]:void 0,certification:L?.certification,accessibilityFeedback:L?.accessibilityFeedback};if(T){const D=await ut.findBookByIdentifier(T);if(D)return n(pi),{success:!1,bookRecord:I,existingBook:D}}return n(D=>({...D,message:"Saving to library..."})),await ut.saveBook(I),n({isLoading:!1,message:"Import successful!",error:null}),l(),setTimeout(()=>n(pi),2e3),b==="catalog"&&r(),{success:!0}}catch(T){ne.error("Error processing EPUB:",T);let I="Failed to import the EPUB file. It might be corrupted or in an unsupported format.";return T instanceof Error&&T.message.includes("File is not a zip")&&(I="The provided file is not a valid EPUB (it's not a zip archive). Please try a different file."),n({isLoading:!1,message:"",error:I}),{success:!1}}},[l,r]);return{importStatus:s,setImportStatus:n,libraryRefreshFlag:o,processAndSaveBook:u}},Pw={state:"idle",message:""},Lw=({tokenClient:r,confirm:s})=>{const[n,o]=R.useState(Pw),[c,l]=R.useState([]),[u,f]=R.useState(""),[p,h]=R.useState(!1),b=R.useCallback(async()=>{const S=await ut.getAllBooks(),g=S.map(I=>{const D={...I};return delete D.epubData,D}),w=JSON.parse(localStorage.getItem("ebook-catalogs")||"[]"),N=JSON.parse(localStorage.getItem("ebook-reader-settings-global")||"{}"),A={},L={},T={};return S.forEach(I=>{I.id&&(A[I.id]=JSON.parse(localStorage.getItem(`ebook-reader-bookmarks-${I.id}`)||"[]"),L[I.id]=JSON.parse(localStorage.getItem(`ebook-reader-citations-${I.id}`)||"[]"),T[I.id]=localStorage.getItem(`ebook-reader-pos-${I.id}`))}),{payload:{library:g,catalogs:w,bookmarks:A,citations:L,positions:T,settings:N},booksWithData:S}},[]),k=R.useCallback(async()=>{if(!r){l([]),f("");return}h(!0);try{const S=await o0();l(S);const g=S.find(w=>w.isLatest);!u&&g?.id?f(g.id):u&&!S.some(w=>w.id===u)&&f(g?.id||"")}catch(S){ne.warn("Failed to load Drive snapshots",S),l([]),f("")}finally{h(!1)}},[u,r]),x=R.useCallback(async()=>{if(r){o({state:"syncing",message:"Gathering local data..."});try{const{payload:S,booksWithData:g}=await b();o({state:"syncing",message:"Uploading to Google Drive... This may take a while."}),await i0(S,g,w=>{o({state:"syncing",message:w})}),localStorage.setItem("ebook-reader-last-sync",new Date().toISOString()),await k(),o({state:"success",message:"Library successfully uploaded!"})}catch(S){ne.error("Upload failed:",S),o({state:"error",message:S instanceof Error?S.message:"An unknown error occurred."})}}},[b,k,r]),y=R.useCallback(async()=>{if(!(!r||!await s({message:`DANGER: This will replace your entire local library with the version from Google Drive.

Any local books or changes not uploaded to Drive will be permanently lost.

Are you absolutely sure you want to continue?`,title:"Dangerous Operation",confirmLabel:"Yes, replace",cancelLabel:"Cancel"}))){o({state:"syncing",message:"Downloading from Google Drive..."});try{const g=await a0(w=>{o({state:"syncing",message:w})},u||void 0);if(!g)throw new Error("No data found in Google Drive.");o({state:"syncing",message:"Clearing local library..."}),await ut.clearAllBooks(),Object.keys(localStorage).filter(w=>w.startsWith("ebook-reader-")).forEach(w=>localStorage.removeItem(w)),o({state:"syncing",message:"Importing downloaded library..."}),localStorage.setItem("ebook-catalogs",JSON.stringify(g.payload.catalogs||[])),localStorage.setItem("ebook-reader-settings-global",JSON.stringify(g.payload.settings||{}));for(const w of g.booksWithData)if(await ut.saveBook(w),w.id){const N=w.id;g.payload.bookmarks[N]&&localStorage.setItem(`ebook-reader-bookmarks-${N}`,JSON.stringify(g.payload.bookmarks[N])),g.payload.citations[N]&&localStorage.setItem(`ebook-reader-citations-${N}`,JSON.stringify(g.payload.citations[N]));const A=g.payload.positions[N];A&&localStorage.setItem(`ebook-reader-pos-${N}`,A)}localStorage.setItem("ebook-reader-last-sync",new Date().toISOString()),o({state:"success",message:"Library successfully downloaded! Reloading app..."}),setTimeout(()=>window.location.reload(),2e3)}catch(g){ne.error("Download failed:",g),o({state:"error",message:g instanceof Error?g.message:"An unknown error occurred."})}}},[s,u,r]);return{syncStatus:n,setSyncStatus:o,driveSnapshots:c,selectedSnapshotId:u,setSelectedSnapshotId:f,isLoadingSnapshots:p,refreshDriveSnapshots:k,handleUploadToDrive:x,handleDownloadFromDrive:y}},Ow=new Vg({defaultOptions:{queries:{staleTime:300*1e3,gcTime:600*1e3,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!1,throwOnError:!1},mutations:{retry:1,throwOnError:!1}}}),Iw=()=>{const{addCatalog:r}=cp(),{uiTheme:s,resolvedTheme:n}=up(),o=wp(),c=Jo(),{tokenClient:l}=Rc(),u=wc(),f=xc(),[p,h]=R.useState(()=>{try{return JSON.parse(localStorage.getItem("ebook-reader-settings-global")||"{}").citationFormat||"apa"}catch{return"apa"}});R.useEffect(()=>{const ue=()=>{try{const X=JSON.parse(localStorage.getItem("ebook-reader-settings-global")||"{}");h(X.citationFormat||"apa")}catch{}};return window.addEventListener("storage",ue),()=>window.removeEventListener("storage",ue)},[]);const[b,k]=R.useState("library"),[x,y]=R.useState(null),[S,g]=R.useState(null),[w,N]=R.useState(null),[A,L]=R.useState([]),[T,I]=R.useState(!0),[D,W]=R.useState(!1),[F,U]=R.useState(!1),[V,ie]=R.useState(!1),[B,H]=R.useState(null),C=R.useCallback(()=>{H(null),k("library")},[]),{importStatus:Q,setImportStatus:ae,libraryRefreshFlag:J,processAndSaveBook:te}=Rw({onCatalogImportSuccess:C}),{credentialPrompt:re,setCredentialPrompt:ee,handleImportFromCatalog:P,handleCredentialSubmit:$,handleOpenAuthLink:ye,handleRetryAfterProviderLogin:fe,showNetworkDebug:oe,setShowNetworkDebug:be}=pw({processAndSaveBook:te,setImportStatus:ae,setActiveOpdsSource:N,setCurrentView:k,pushToast:o.pushToast}),{syncStatus:Se,setSyncStatus:ke,driveSnapshots:_e,selectedSnapshotId:De,setSelectedSnapshotId:Ve,isLoadingSnapshots:et,refreshDriveSnapshots:Ke,handleUploadToDrive:j,handleDownloadFromDrive:he}=Lw({tokenClient:l,confirm:c});R.useEffect(()=>{D&&Ke()},[D,Ke]),R.useEffect(()=>{ut.init();const ue=setTimeout(()=>{I(!1)},2500);return()=>clearTimeout(ue)},[]),w0({shortcuts:[{key:"?",description:"Show keyboard shortcuts",category:"global",action:()=>ie(!0)},{key:"Escape",description:"Close active modal or return to library",category:"global",action:()=>{V?ie(!1):D?W(!1):F?U(!1):re.isOpen?ee(ue=>({...ue,isOpen:!1})):b==="bookDetail"&&k("library")}}],enabled:!T}),R.useEffect(()=>{new URLSearchParams(f.search).get("autoOpen")==="first"&&(async()=>{try{const _=await ut.getAllBooks();if(!_||_.length===0)return;const E=_[0];if(!E||!E.id)return;(E.format||"EPUB")==="PDF"?u(`/pdf/${E.id}`):(y(E.id),k("reader"))}catch(_){ne.warn("Auto-open failed",_)}})()},[f.search,u]);const de=R.useCallback((ue,X)=>{try{return r(X,ue,"2"),o.pushToast(`Successfully added catalog: ${X}`,4e3),ne.info("[App] Auto-imported OPDS catalog from registry",{importUrl:ue,catalogName:X}),k("library"),window.focus(),!0}catch(_){return o.pushToast(`Failed to add catalog: ${X}`,6e3),ne.error("[App] Failed to import OPDS catalog from registry",{importUrl:ue,catalogName:X,error:_}),!1}},[r,o]);R.useEffect(()=>{const ue=new URLSearchParams(f.search),X=ue.get("import"),_=ue.get("name");if(X&&_){de(X,_);const E=new URL(window.location.href);E.searchParams.delete("import"),E.searchParams.delete("name"),window.history.replaceState({},document.title,E.toString())}},[f.search,de]),R.useEffect(()=>{const ue=X=>{if(X.key==="mebooks-import-catalog"&&X.newValue)try{const{importUrl:_,catalogName:E,timestamp:M}=JSON.parse(X.newValue);if(Date.now()-M<5e3){const K=de(_,E);localStorage.setItem("mebooks-import-response",JSON.stringify({success:K,catalogName:E,timestamp:Date.now()})),localStorage.removeItem("mebooks-import-catalog")}}catch(_){ne.error("[App] Failed to process cross-tab import message",{error:_})}if(X.key==="mebooks-ping"&&X.newValue)try{const{timestamp:_}=JSON.parse(X.newValue);Date.now()-_<2e3&&(localStorage.setItem("mebooks-pong",JSON.stringify({timestamp:Date.now(),version:"1.0.0"})),localStorage.removeItem("mebooks-ping"))}catch(_){ne.error("[App] Failed to process ping message",{error:_})}};return window.addEventListener("storage",ue),()=>window.removeEventListener("storage",ue)},[de]);const q=R.useCallback((ue,X,_="EPUB")=>{y(ue),_==="PDF"?(g(null),u(`/pdf/${ue}`)):(g(X),k("reader"))},[u]),z=R.useCallback(()=>{y(null),k("library"),g(null),u("/")},[u]),Z=R.useCallback((ue,X,_)=>{H({book:ue,source:X,catalogName:_}),k("bookDetail")},[]),ce=R.useCallback(()=>{k("about")},[]);return a.jsxs("div",{className:`min-h-screen font-sans theme-shell ${n==="light"?"bg-slate-50 text-slate-950":"bg-slate-900 text-white"}`,"data-ui-theme":s,"data-ui-theme-resolved":n,children:[a.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-sky-500 focus:text-white focus:rounded-md focus:font-semibold focus:shadow-lg",children:"Skip to main content"}),a.jsx(W0,{isVisible:T}),!T&&a.jsx("main",{id:"main-content",children:a.jsx(hw,{currentView:b,selectedBookId:x,coverAnimationData:S,onCloseReader:z,detailViewData:B,onReturnToLibrary:C,onReadBook:q,onImportFromCatalog:P,onAutoBackupToDrive:j,onOpenBook:q,onShowBookDetail:Z,syncStatus:Se,processAndSaveBook:te,activeOpdsSource:w,setActiveOpdsSource:N,catalogNavPath:A,setCatalogNavPath:L,onOpenCloudSyncModal:()=>W(!0),onOpenLocalStorageModal:()=>U(!0),onShowAbout:ce,importStatus:Q,setImportStatus:ae,libraryRefreshFlag:J,userCitationFormat:p})}),a.jsx(V0,{isCloudSyncModalOpen:D,onCloseCloudSyncModal:()=>W(!1),onUploadToDrive:j,onDownloadFromDrive:he,driveSnapshots:_e,selectedSnapshotId:De,onSelectSnapshotId:Ve,onRefreshSnapshots:Ke,isLoadingSnapshots:et,syncStatus:Se,setSyncStatus:ke,isLocalStorageModalOpen:F,onCloseLocalStorageModal:()=>U(!1),credentialPrompt:re,onCloseCredentialPrompt:()=>ee({isOpen:!1,host:null,pendingHref:null,pendingBook:null,pendingCatalogName:void 0,authDocument:null}),onCredentialSubmit:$,onOpenAuthLink:ye,onRetryAfterProviderLogin:fe,showNetworkDebug:oe,onCloseNetworkDebug:()=>be(!1),onOpenNetworkDebug:()=>be(!0),isShortcutHelpOpen:V,onCloseShortcutHelp:()=>ie(!1)}),a.jsx(ah,{message:Q.isLoading?Q.message:Q.error||null,politeness:Q.error?"assertive":"polite"}),a.jsx(ah,{message:Se.state!=="idle"?Se.message:null,politeness:Se.state==="error"?"assertive":"polite"})]})},Fw=()=>a.jsxs(qg,{client:Ow,children:[a.jsx(Kg,{children:({reset:r})=>a.jsx(rv,{children:a.jsxs(Jy,{children:[a.jsx(rc,{path:"/pdf/:id",element:a.jsx(Es,{onReset:()=>{r(),window.location.replace("/")},fallbackMessage:"There was an error loading the PDF viewer.",children:a.jsx(Dw,{})})}),a.jsx(rc,{path:"/*",element:a.jsx(Es,{onReset:()=>{r(),window.location.reload()},fallbackMessage:"There was an error loading the application.",children:a.jsx(Iw,{})})})]})})}),a.jsx(iy,{initialIsOpen:!1})]}),Dw=()=>{const r=wc();return a.jsx(Ep,{onClose:()=>r("/")})},Ap=document.getElementById("root");if(!Ap)throw new Error("Could not find root element to mount to");const Bw=bg.createRoot(Ap);Bw.render(a.jsx(mt.StrictMode,{children:a.jsx(B0,{children:a.jsx(R0,{children:a.jsx(P0,{children:a.jsx(Fw,{})})})})}));export{dc as g,a as j,R as r};
